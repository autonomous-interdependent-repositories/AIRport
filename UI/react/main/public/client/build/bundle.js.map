{"version":3,"file":"bundle.js","sources":["../../../../../../libs/direction-indicator/dist/esm/index.mjs","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/util.js","../../../../../../common/temp/node_modules/.pnpm/@babel/runtime@7.16.7/node_modules/@babel/runtime/helpers/interopRequireDefault.js","../../../../../../common/temp/node_modules/.pnpm/@babel/runtime@7.16.7/node_modules/@babel/runtime/helpers/typeof.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/methods/native.js","../../../../../../common/temp/node_modules/.pnpm/oblivious-set@1.0.0/node_modules/oblivious-set/dist/es/index.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/options.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/methods/indexed-db.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/methods/localstorage.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/methods/simulate.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/method-chooser.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/broadcast-channel.js","../../../../../../common/temp/node_modules/.pnpm/unload@2.3.1/node_modules/unload/dist/es/index.js","../../../../../../common/temp/node_modules/.pnpm/unload@2.3.1/node_modules/unload/dist/es/browser.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/leader-election.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/index.js","../../../../../../common/temp/node_modules/.pnpm/broadcast-channel@4.9.0/node_modules/broadcast-channel/dist/lib/index.es5.js","../../../../../../libs/vhf-radio/src/CrossTabCommunicator.ts","../../../../../../common/temp/node_modules/.pnpm/tslib@2.1.0/node_modules/tslib/tslib.es6.js"],"sourcesContent":["class InjectionDomain {\n    constructor(name) {\n        this.name = name;\n        this.applicationMap = {};\n    }\n    app(applicationName) {\n        if (this.applicationMap[applicationName]) {\n            throw new Error(`\r\n\t\t\tApplication already defined.\r\n\t\t\tDomain:      ${this.name}\r\n\t\t\tApplication: ${applicationName}\r\n\t\t\t`);\n        }\n        const application = new InjectionApplication(applicationName, this);\n        this.applicationMap[applicationName] = application;\n        return application;\n    }\n    getApp(applicationName) {\n        return this.applicationMap[applicationName];\n    }\n}\nconst DOMAIN_MAP = {};\nfunction domain(domainName) {\n    if (DOMAIN_MAP[domainName]) {\n        return DOMAIN_MAP[domainName];\n    }\n    const domain = new InjectionDomain(domainName);\n    DOMAIN_MAP[domainName] = domain;\n    return domain;\n}\nconst AIRPORT_DOMAIN = domain('turbase.app');\n\nclass DependencyInjectionToken {\n    constructor(application, descriptor) {\n        this.application = application;\n        this.descriptor = descriptor;\n    }\n    get dependencyConfiguration() {\n        return this.getInheritedDependencyConfiguration(this.descriptor.class);\n    }\n    getPath() {\n        return this.application.domain.name + ':' + this.application.name + ':'\n            + this.descriptor.token;\n    }\n    setDependencies(dependencyConfiguration) {\n        if (this._dependencyConfiguration) {\n            this._dependencyConfiguration = {\n                ...this._dependencyConfiguration,\n                ...dependencyConfiguration\n            };\n        }\n        else {\n            this._dependencyConfiguration = dependencyConfiguration;\n        }\n        if (!this.descriptor.class) {\n            return;\n        }\n        if (this.descriptor.class.dependencyConfiguration) {\n            this.descriptor.class.dependencyConfiguration = {\n                ...this.descriptor.class.dependencyConfiguration,\n                ...dependencyConfiguration\n            };\n        }\n        else {\n            this.descriptor.class.dependencyConfiguration = dependencyConfiguration;\n        }\n    }\n    setClass(aClass) {\n        this.descriptor.class = aClass;\n        aClass.dependencyConfiguration = this._dependencyConfiguration;\n    }\n    getInheritedDependencyConfiguration(aClass) {\n        const parentClass = Object.getPrototypeOf(aClass);\n        let returnedDependencyConfiguration = {};\n        if (parentClass) {\n            returnedDependencyConfiguration = this.getInheritedDependencyConfiguration(parentClass);\n        }\n        const dependencyConfiguration = aClass.dependencyConfiguration;\n        if (dependencyConfiguration) {\n            returnedDependencyConfiguration = {\n                ...returnedDependencyConfiguration,\n                ...dependencyConfiguration\n            };\n        }\n        return returnedDependencyConfiguration;\n    }\n    getClass() {\n        return this.descriptor.class;\n    }\n}\n\nclass InjectionApplication {\n    constructor(name, domain) {\n        this.name = name;\n        this.domain = domain;\n        this.tokenMap = new Map();\n        this.autopilot = false;\n    }\n    getFullName() {\n        return `${this.domain.name}/${this.name}`;\n    }\n    token(descriptor) {\n        const existingToken = this.tokenMap.get(descriptor.interface);\n        if (existingToken) {\n            throw new Error(`Token with name '${descriptor.interface}' has already been created`);\n        }\n        const diToken = new DependencyInjectionToken(this, descriptor);\n        this.tokenMap.set(descriptor.interface, diToken);\n        return diToken;\n    }\n}\nfunction lib(libraryName) {\n    return AIRPORT_DOMAIN.app(libraryName);\n}\n\nvar ContextType;\n(function (ContextType) {\n    ContextType[\"DB\"] = \"DB\";\n    ContextType[\"UI\"] = \"UI\";\n})(ContextType || (ContextType = {}));\nclass Context {\n    constructor(id, type) {\n        this.id = id;\n        this.type = type;\n    }\n}\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\n\nclass Container {\n}\n\nconst Injected = function () {\n    return function (constructor) {\n        // No runtime logic required.\n    };\n};\nconst Inject = function () {\n    return function (targetObject, propertyKey) {\n        // No runtime logic required.\n    };\n};\n\nlet ContainerAccessor = class ContainerAccessor {\n    getContainer(injectedObject) {\n        const iocContainer = injectedObject.__container__;\n        if (!iocContainer) {\n            throw new Error('\"container\" is not set on injectable object.');\n        }\n        if (!(iocContainer instanceof Container)) {\n            throw new Error('\"container\" property of injectable is not an' +\n                'instance of @airport/direction-indicator Container');\n        }\n        return iocContainer;\n    }\n};\nContainerAccessor = __decorate([\n    Injected()\n], ContainerAccessor);\n\nconst directionIndicator = lib('direction-indicator');\nconst AUTOPILOT_API_LOADER = directionIndicator.token({\n    class: null,\n    interface: 'IAutopilotApiLoader',\n    token: 'AUTOPILOT_API_LOADER'\n});\nconst CONTAINER_ACCESSOR = directionIndicator.token({\n    class: ContainerAccessor,\n    interface: 'IContainerAccessor',\n    token: 'CONTAINER_ACCESSOR'\n});\nconst INTER_APP_API_CLIENT = directionIndicator.token({\n    class: null,\n    interface: 'IInterAppAPIClient',\n    token: 'INTER_APP_API_CLIENT'\n});\n\nclass ChildContainer extends Container {\n    constructor(rootContainer, context) {\n        super();\n        this.rootContainer = rootContainer;\n        this.context = context;\n        // TODO: implement continuous upgrading\n        // classes: any[]  = []\n        // numPendingInits = 0\n        // theObjects: any[]  = []\n        this.objectMap = new Map();\n    }\n    doEventuallyGet(tokens, successCallback, errorCallback) {\n        let { firstDiNotSetClass, firstMissingClassToken, objects } = this.doGetCore(tokens);\n        if (firstMissingClassToken || firstDiNotSetClass) {\n            setTimeout(() => {\n                this.doEventuallyGet(tokens, successCallback, errorCallback);\n            }, 100);\n        }\n        else {\n            if (objects.length > 1) {\n                successCallback(objects);\n            }\n            else {\n                successCallback(objects[0]);\n            }\n        }\n    }\n    doGet(tokens, successCallback, errorCallback) {\n        const { firstDiNotSetClass, firstMissingClassToken, objects } = this.doGetCore(tokens);\n        if (firstDiNotSetClass) {\n            console.log(`Dependency Injection is not ready for token ${firstMissingClassToken.getPath()}\r\n\t\t\t, class: ${firstDiNotSetClass.name}. Delaying injection by 100ms`);\n            setTimeout(() => {\n                this.doGet(tokens, successCallback, errorCallback);\n            }, 100);\n            return;\n        }\n        else if (objects.filter(object => object && !object.__initialized__).length) {\n            const notInitializedObjectIndexes = objects.map((object, index) => object.__initialized__ ? -1 : index)\n                .filter(index => index !== -1);\n            const objectPaths = [];\n            for (const index of notInitializedObjectIndexes) {\n                objectPaths.push(tokens[index].getPath());\n            }\n            console.log(`Dependency Injection is not ready for tokens:\r\n\t\t\t\t ${objectPaths.join('\\n')}\r\n\t\t\t, these classes are not yet initialized, delaying injection by 100ms`);\n            setTimeout(() => {\n                this.doGet(tokens, successCallback, errorCallback);\n            }, 100);\n            return;\n        }\n        if (firstMissingClassToken) {\n            const message = 'Dependency Injection could not find class for token: '\n                + firstMissingClassToken.getPath();\n            console.log(message);\n            errorCallback(message);\n        }\n        else {\n            if (objects.length > 1) {\n                successCallback(objects);\n            }\n            else {\n                successCallback(objects[0]);\n            }\n        }\n    }\n    doGetCore(tokens) {\n        let firstMissingClassToken;\n        let firstDiNotSetClass;\n        const objects = tokens.map(token => {\n            if (firstMissingClassToken || firstDiNotSetClass) {\n                return;\n            }\n            let object = this.objectMap.get(token.descriptor.token);\n            if (!object) {\n                if (!this.rootContainer.isFramework && token.application.autopilot) {\n                    object = this.getSync(AUTOPILOT_API_LOADER)\n                        .loadApiAutopilot(token);\n                }\n                else {\n                    // NOTE: object pooling is not supported, see RootContainer for why\n                    // const rootObjectPool = this.rootContainer.objectPoolMap.get(token.descriptor.token);\n                    // if (rootObjectPool && rootObjectPool.length) {\n                    //     object = rootObjectPool.pop()\n                    // } else {\n                    const aClass = token.descriptor.class;\n                    if (!aClass) {\n                        firstMissingClassToken = token;\n                        return;\n                    }\n                    if (aClass.diSet && !aClass.diSet()) {\n                        firstMissingClassToken = token;\n                        firstDiNotSetClass = aClass;\n                        return;\n                    }\n                    object = new aClass();\n                    this.setDependencyGetters(object, token);\n                    // }\n                }\n                object.__container__ = this;\n                this.objectMap.set(token.descriptor.token, object);\n                if (!token.application.autopilot && object.init) {\n                    const result = object.init();\n                    if (result instanceof Promise) {\n                        result.then(_ => {\n                            object.__initialized__ = true;\n                            console.log(`${token.getPath()} initialized.`);\n                        });\n                    }\n                    else {\n                        object.__initialized__ = true;\n                        console.log(`${token.getPath()} initialized.`);\n                    }\n                }\n                else {\n                    object.__initialized__ = true;\n                }\n            }\n            return object;\n        });\n        return {\n            firstDiNotSetClass,\n            firstMissingClassToken,\n            objects\n        };\n    }\n    manualInject(object, token) {\n        object.__container__ = this;\n        this.setDependencyGetters(object, token);\n    }\n    setDependencyGetters(object, token) {\n        if (!token.dependencyConfiguration) {\n            return;\n        }\n        const dependencyConfiguration = token.dependencyConfiguration;\n        for (let propertyName in dependencyConfiguration) {\n            delete object[propertyName];\n            const dependencyToken = dependencyConfiguration[propertyName];\n            Object.defineProperty(object, propertyName, {\n                get() {\n                    return this.__container__.getSync(dependencyToken);\n                }\n            });\n            object['get' + propertyName + 'Async'] = async function () {\n                return await this.__container__.get(dependencyToken);\n            };\n        }\n    }\n    async getByNames(domainName, applicationName, tokenInterface) {\n        const injectionDomain = domain(domainName);\n        if (!injectionDomain) {\n            throw new Error(`Could nof find\r\n\tDomain:\r\n\t\t${domainName}\r\n\t\t`);\n        }\n        const application = domain(domainName).getApp(applicationName);\n        if (!application) {\n            throw new Error(`Could not find\r\n\tDomain:\r\n\t\t${domainName}\r\n\tApplication:\r\n\t\t${applicationName}\r\n\t\t`);\n        }\n        const token = application.tokenMap.get(tokenInterface);\n        if (!token) {\n            throw new Error(`Could not find token: ${tokenInterface}\r\n\tin Domain:\r\n\t\t${domainName}\r\n \tApplication:\r\n\t\t\t${applicationName}\r\n\t\t`);\n        }\n        return await this.get(token);\n    }\n    get(...tokens) {\n        return new Promise((resolve, reject) => {\n            this.doGet(tokens, resolve, reject);\n        });\n    }\n    eventuallyGet(...tokens) {\n        return new Promise((resolve, reject) => {\n            this.doEventuallyGet(tokens, resolve, reject);\n        });\n    }\n    getSync(...tokens) {\n        const { firstDiNotSetClass, firstMissingClassToken, objects } = this.doGetCore(tokens);\n        if (firstMissingClassToken) {\n            throw new Error('Dependency Injection could not find class for token: '\n                + firstMissingClassToken.getPath());\n        }\n        else if (firstDiNotSetClass) {\n            throw new Error('Dependency Injection is not ready for class: '\n                + firstDiNotSetClass.name);\n        }\n        if (objects.length > 1) {\n            return objects;\n        }\n        else {\n            return objects[0];\n        }\n    }\n}\n\nclass RootContainer extends Container {\n    constructor() {\n        super(...arguments);\n        this.isFramework = false;\n        this.dbContainerMap = new Map();\n        this.uiContainers = new Set();\n    }\n    // NOTE: Object pooling is not supported because of possible callbacks\n    // that are out of synchronous flow of a transaction.  Thus objects are\n    // retained in the container even after the container is removed\n    // in order to allow for transactionId reference\n    // objectPoolMap: Map<string, any[]> = new Map();\n    db(id = null) {\n        let dbContainer = this.dbContainerMap.get(id);\n        if (!dbContainer) {\n            dbContainer = new ChildContainer(this, new Context(id, ContextType.DB));\n            this.dbContainerMap.set(id, dbContainer);\n        }\n        return dbContainer;\n    }\n    remove(container) {\n        if (!container) {\n            return;\n        }\n        const dbContainer = this.dbContainerMap.get(container.context.id);\n        if (dbContainer) {\n            this.dbContainerMap.delete(container.context.id);\n            // NOTE: objectPooling is not supported, see above\n            // const objectTokens = dbContainer.objectMap.keys()\n            // for (const objectToken of objectTokens) {\n            // const object = dbContainer.objectMap.get(objectToken)\n            // let objectPool = this.objectPoolMap.get(objectToken)\n            // if (!objectPool) {\n            //     objectPool = []\n            //     this.objectPoolMap.set(objectToken, objectPool)\n            // }\n            // objectPool.push(object)\n            // }\n        }\n        else {\n            this.uiContainers.delete(container);\n        }\n    }\n    ui(componentName) {\n        const context = new Context(componentName, ContextType.UI);\n        const childContainer = new ChildContainer(this, context);\n        this.uiContainers.add(childContainer);\n        return childContainer;\n    }\n}\nconst DEPENDENCY_INJECTION = new RootContainer();\n\nclass InversionOfControl {\n    async get(...tokens) {\n        return await DEPENDENCY_INJECTION.db().get(...tokens);\n    }\n    async eventuallyGet(...tokens) {\n        return await DEPENDENCY_INJECTION.db().eventuallyGet(...tokens);\n    }\n    getSync(...tokens) {\n        return DEPENDENCY_INJECTION.db().getSync(...tokens);\n    }\n}\n\n/**\n * From:\n * http://js-bits.blogspot.com/2010/08/javascript-inheritance-done-right.html\n * Via:\n * https://stackoverflow.com/questions/6617780/how-to-call-parent-constructor\n */\nfunction extend(base, sub, methods) {\n    sub.prototype = Object.create(base.prototype);\n    sub.prototype.constructor = sub;\n    sub.base = base.prototype;\n    // Copy the methods passed in to the prototype\n    for (const name in methods) {\n        sub.prototype[name] = methods[name];\n    }\n    // so we can define the constructor inline\n    return sub;\n}\n\nif (typeof window !== 'undefined') {\n    window.DEPENDENCY_INJECTION = DEPENDENCY_INJECTION;\n    window.lib = lib;\n    window.domain = domain;\n}\nconst IOC = new InversionOfControl();\n\nexport { AIRPORT_DOMAIN, AUTOPILOT_API_LOADER, CONTAINER_ACCESSOR, ChildContainer, Container, ContainerAccessor, Context, ContextType, DEPENDENCY_INJECTION, DependencyInjectionToken, INTER_APP_API_CLIENT, IOC, Inject, Injected, InjectionApplication, InjectionDomain, InversionOfControl, RootContainer, domain, extend, lib };\n//# sourceMappingURL=index.mjs.map\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isNode = exports.PROMISE_RESOLVED_VOID = exports.PROMISE_RESOLVED_TRUE = exports.PROMISE_RESOLVED_FALSE = void 0;\nexports.isPromise = isPromise;\nexports.microSeconds = microSeconds;\nexports.randomInt = randomInt;\nexports.randomToken = randomToken;\nexports.sleep = sleep;\n\n/**\n * returns true if the given object is a promise\n */\nfunction isPromise(obj) {\n  if (obj && typeof obj.then === 'function') {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nvar PROMISE_RESOLVED_FALSE = Promise.resolve(false);\nexports.PROMISE_RESOLVED_FALSE = PROMISE_RESOLVED_FALSE;\nvar PROMISE_RESOLVED_TRUE = Promise.resolve(true);\nexports.PROMISE_RESOLVED_TRUE = PROMISE_RESOLVED_TRUE;\nvar PROMISE_RESOLVED_VOID = Promise.resolve();\nexports.PROMISE_RESOLVED_VOID = PROMISE_RESOLVED_VOID;\n\nfunction sleep(time, resolveWith) {\n  if (!time) time = 0;\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      return res(resolveWith);\n    }, time);\n  });\n}\n\nfunction randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n/**\n * https://stackoverflow.com/a/8084248\n */\n\n\nfunction randomToken() {\n  return Math.random().toString(36).substring(2);\n}\n\nvar lastMs = 0;\nvar additional = 0;\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\n\nfunction microSeconds() {\n  var ms = new Date().getTime();\n\n  if (ms === lastMs) {\n    additional++;\n    return ms * 1000 + additional;\n  } else {\n    lastMs = ms;\n    additional = 0;\n    return ms * 1000;\n  }\n}\n/**\n * copied from the 'detect-node' npm module\n * We cannot use the module directly because it causes problems with rollup\n * @link https://github.com/iliakan/detect-node/blob/master/index.js\n */\n\n\nvar isNode = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\nexports.isNode = isNode;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(obj);\n}\n\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports.microSeconds = exports[\"default\"] = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.type = void 0;\n\nvar _util = require(\"../util\");\n\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar type = 'native';\nexports.type = type;\n\nfunction create(channelName) {\n  var state = {\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n\n  };\n\n  state.bc.onmessage = function (msg) {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n\n  return state;\n}\n\nfunction close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\n\nfunction postMessage(channelState, messageJson) {\n  try {\n    channelState.bc.postMessage(messageJson, false);\n    return _util.PROMISE_RESOLVED_VOID;\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\n\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  /**\n   * in the electron-renderer, isNode will be true even if we are in browser-context\n   * so we also check if window is undefined\n   */\n  if (_util.isNode && typeof window === 'undefined') return false;\n\n  if (typeof BroadcastChannel === 'function') {\n    if (BroadcastChannel._pubkey) {\n      throw new Error('BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill');\n    }\n\n    return true;\n  } else return false;\n}\n\nfunction averageResponseTime() {\n  return 150;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n */\nvar ObliviousSet = /** @class */ (function () {\n    function ObliviousSet(ttl) {\n        this.ttl = ttl;\n        this.set = new Set();\n        this.timeMap = new Map();\n    }\n    ObliviousSet.prototype.has = function (value) {\n        return this.set.has(value);\n    };\n    ObliviousSet.prototype.add = function (value) {\n        var _this = this;\n        this.timeMap.set(value, now());\n        this.set.add(value);\n        /**\n         * When a new value is added,\n         * start the cleanup at the next tick\n         * to not block the cpu for more important stuff\n         * that might happen.\n         */\n        setTimeout(function () {\n            removeTooOldValues(_this);\n        }, 0);\n    };\n    ObliviousSet.prototype.clear = function () {\n        this.set.clear();\n        this.timeMap.clear();\n    };\n    return ObliviousSet;\n}());\nexport { ObliviousSet };\n/**\n * Removes all entries from the set\n * where the TTL has expired\n */\nexport function removeTooOldValues(obliviousSet) {\n    var olderThen = now() - obliviousSet.ttl;\n    var iterator = obliviousSet.set[Symbol.iterator]();\n    /**\n     * Because we can assume the new values are added at the bottom,\n     * we start from the top and stop as soon as we reach a non-too-old value.\n     */\n    while (true) {\n        var value = iterator.next().value;\n        if (!value) {\n            return; // no more elements\n        }\n        var time = obliviousSet.timeMap.get(value);\n        if (time < olderThen) {\n            obliviousSet.timeMap.delete(value);\n            obliviousSet.set.delete(value);\n        }\n        else {\n            // We reached a value that is not old enough\n            return;\n        }\n    }\n}\nexport function now() {\n    return new Date().getTime();\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fillOptionsWithDefaults = fillOptionsWithDefaults;\n\nfunction fillOptionsWithDefaults() {\n  var originalOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var options = JSON.parse(JSON.stringify(originalOptions)); // main\n\n  if (typeof options.webWorkerSupport === 'undefined') options.webWorkerSupport = true; // indexed-db\n\n  if (!options.idb) options.idb = {}; //  after this time the messages get deleted\n\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150; //  handles abrupt db onclose events.\n\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === 'function') options.idb.onclose = originalOptions.idb.onclose; // localstorage\n\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60; // custom methods\n\n  if (originalOptions.methods) options.methods = originalOptions.methods; // node\n\n  if (!options.node) options.node = {};\n  if (!options.node.ttl) options.node.ttl = 1000 * 60 * 2; // 2 minutes;\n\n  /**\n   * On linux use 'ulimit -Hn' to get the limit of open files.\n   * On ubuntu this was 4096 for me, so we use half of that as maxParallelWrites default.\n   */\n\n  if (!options.node.maxParallelWrites) options.node.maxParallelWrites = 2048;\n  if (typeof options.node.useFastPath === 'undefined') options.node.useFastPath = true;\n  return options;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.cleanOldMessages = cleanOldMessages;\nexports.close = close;\nexports.create = create;\nexports.createDatabase = createDatabase;\nexports[\"default\"] = void 0;\nexports.getAllMessages = getAllMessages;\nexports.getIdb = getIdb;\nexports.getMessagesHigherThan = getMessagesHigherThan;\nexports.getOldMessages = getOldMessages;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeMessageById = removeMessageById;\nexports.type = void 0;\nexports.writeMessage = writeMessage;\n\nvar _util = require(\"../util.js\");\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _options = require(\"../options\");\n\n/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n */\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\nvar type = 'idb';\nexports.type = type;\n\nfunction getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n\n  return false;\n}\n\nfunction createDatabase(channelName) {\n  var IndexedDB = getIdb(); // create table\n\n  var dbName = DB_PREFIX + channelName;\n  var openRequest = IndexedDB.open(dbName, 1);\n\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n\n  var dbPromise = new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n/**\n * writes the new message to the database\n * so other readers can find it\n */\n\n\nfunction writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var transaction = db.transaction([OBJECT_STORE_ID], 'readwrite');\n  return new Promise(function (res, rej) {\n    transaction.oncomplete = function () {\n      return res();\n    };\n\n    transaction.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    var objectStore = transaction.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n  });\n}\n\nfunction getAllMessages(db) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        ret.push(cursor.value); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n        cursor[\"continue\"]();\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction getMessagesHigherThan(db, lastCursorId) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n\n  return new Promise(function (res) {\n    openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction removeMessageById(db, id) {\n  var request = db.transaction([OBJECT_STORE_ID], 'readwrite').objectStore(OBJECT_STORE_ID)[\"delete\"](id);\n  return new Promise(function (res) {\n    request.onsuccess = function () {\n      return res();\n    };\n  });\n}\n\nfunction getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        var msgObk = cursor.value;\n\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          res(ret);\n          return;\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(function (tooOld) {\n    return Promise.all(tooOld.map(function (msgObj) {\n      return removeMessageById(db, msgObj.id);\n    }));\n  });\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: (0, _util.randomToken)(),\n\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new _obliviousSet.ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: _util.PROMISE_RESOLVED_VOID,\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n\n\n    _readLoop(state);\n\n    return state;\n  });\n}\n\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return (0, _util.sleep)(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\n\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n\n  return true;\n}\n/**\n * reads all new messages from the database and emits them\n */\n\n\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return _util.PROMISE_RESOLVED_VOID; // if no one is listening, we do not need to scan for new messages\n\n  if (!state.messagesCallback) return _util.PROMISE_RESOLVED_VOID;\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */\n    .filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return _util.PROMISE_RESOLVED_VOID;\n  });\n}\n\nfunction close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\n\nfunction postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if ((0, _util.randomInt)(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\n\nfunction canBeUsed() {\n  if (_util.isNode) return false;\n  var idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\n\nfunction averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.getLocalStorage = getLocalStorage;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _options = require(\"../options\");\n\nvar _util = require(\"../util\");\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexports.type = type;\n\nfunction getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    (0, _util.sleep)().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: (0, _util.randomToken)(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\n\nfunction addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\n\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  if (_util.isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports.microSeconds = exports[\"default\"] = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.type = void 0;\n\nvar _util = require(\"../util\");\n\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar type = 'simulate';\nexports.type = type;\nvar SIMULATE_CHANNELS = new Set();\n\nfunction create(channelName) {\n  var state = {\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\n\nfunction close(channelState) {\n  SIMULATE_CHANNELS[\"delete\"](channelState);\n}\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      var channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.filter(function (channel) {\n        return channel.name === channelState.name;\n      }).filter(function (channel) {\n        return channel !== channelState;\n      }).filter(function (channel) {\n        return !!channel.messagesCallback;\n      }).forEach(function (channel) {\n        return channel.messagesCallback(messageJson);\n      });\n      res();\n    }, 5);\n  });\n}\n\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  return true;\n}\n\nfunction averageResponseTime() {\n  return 5;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.chooseMethod = chooseMethod;\n\nvar _native = _interopRequireDefault(require(\"./methods/native.js\"));\n\nvar _indexedDb = _interopRequireDefault(require(\"./methods/indexed-db.js\"));\n\nvar _localstorage = _interopRequireDefault(require(\"./methods/localstorage.js\"));\n\nvar _simulate = _interopRequireDefault(require(\"./methods/simulate.js\"));\n\n\n\nvar _util = require(\"./util\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n// the line below will be removed from es5/browser builds\n// order is important\nvar METHODS = [_native[\"default\"], // fastest\n_indexedDb[\"default\"], _localstorage[\"default\"]];\n\nfunction chooseMethod(options) {\n  var chooseMethods = [].concat(options.methods, METHODS).filter(Boolean); // the line below will be removed from es5/browser builds\n\n\n\n  if (options.type) {\n    if (options.type === 'simulate') {\n      // only use simulate-method if directly chosen\n      return _simulate[\"default\"];\n    }\n\n    var ret = chooseMethods.find(function (m) {\n      return m.type === options.type;\n    });\n    if (!ret) throw new Error('method-type ' + options.type + ' not found');else return ret;\n  }\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage is been chosen\n   */\n\n\n  if (!options.webWorkerSupport && !_util.isNode) {\n    chooseMethods = chooseMethods.filter(function (m) {\n      return m.type !== 'idb';\n    });\n  }\n\n  var useMethod = chooseMethods.find(function (method) {\n    return method.canBeUsed();\n  });\n  if (!useMethod) throw new Error(\"No useable method found in \" + JSON.stringify(METHODS.map(function (m) {\n    return m.type;\n  })));else return useMethod;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OPEN_BROADCAST_CHANNELS = exports.BroadcastChannel = void 0;\nexports.clearNodeFolder = clearNodeFolder;\nexports.enforceOptions = enforceOptions;\n\nvar _util = require(\"./util.js\");\n\nvar _methodChooser = require(\"./method-chooser.js\");\n\nvar _options = require(\"./options.js\");\n\n/**\n * Contains all open channels,\n * used in tests to ensure everything is closed.\n */\nvar OPEN_BROADCAST_CHANNELS = new Set();\nexports.OPEN_BROADCAST_CHANNELS = OPEN_BROADCAST_CHANNELS;\nvar lastId = 0;\n\nvar BroadcastChannel = function BroadcastChannel(name, options) {\n  // identifier of the channel to debug stuff\n  this.id = lastId++;\n  OPEN_BROADCAST_CHANNELS.add(this);\n  this.name = name;\n\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n\n  this.options = (0, _options.fillOptionsWithDefaults)(options);\n  this.method = (0, _methodChooser.chooseMethod)(this.options); // isListening\n\n  this._iL = false;\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n\n  this._onML = null;\n  /**\n   * _addEventListeners\n   */\n\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n  /**\n   * Unsend message promises\n   * where the sending is still in progress\n   * @type {Set<Promise>}\n   */\n\n  this._uMP = new Set();\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n\n  this._befC = [];\n  /**\n   * _preparePromise\n   */\n\n  this._prepP = null;\n\n  _prepareChannel(this);\n}; // STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\n\n\nexports.BroadcastChannel = BroadcastChannel;\nBroadcastChannel._pubkey = true;\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\n\nfunction clearNodeFolder(options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  var method = (0, _methodChooser.chooseMethod)(options);\n\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return _util.PROMISE_RESOLVED_FALSE;\n  }\n}\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\n\n\nvar ENFORCED_OPTIONS;\n\nfunction enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n} // PROTOTYPE\n\n\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed');\n    }\n\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _removeListenerObject(this, 'message', this._onML);\n\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n\n    if (this.closed) {\n      return;\n    }\n\n    OPEN_BROADCAST_CHANNELS[\"delete\"](this);\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : _util.PROMISE_RESOLVED_VOID;\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare // wait until all current sending are processed\n    .then(function () {\n      return Promise.all(Array.from(_this._uMP));\n    }) // run before-close hooks\n    .then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    }) // close the channel\n    .then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n\n  get type() {\n    return this.method.type;\n  },\n\n  get isClosed() {\n    return this.closed;\n  }\n\n};\n/**\n * Post a message over the channel\n * @returns {Promise} that resolved when the message sending is done\n */\n\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : _util.PROMISE_RESOLVED_VOID;\n  return awaitPrepare.then(function () {\n    var sendPromise = broadcastChannel.method.postMessage(broadcastChannel._state, msgObj); // add/remove to unsend messages list\n\n    broadcastChannel._uMP.add(sendPromise);\n\n    sendPromise[\"catch\"]().then(function () {\n      return broadcastChannel._uMP[\"delete\"](sendPromise);\n    });\n    return sendPromise;\n  });\n}\n\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n\n  if ((0, _util.isPromise)(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\n\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\n\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n\n  _startListening(channel);\n}\n\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n\n  _stopListening(channel);\n}\n\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (listenerObject) {\n        /**\n         * Getting the current time in JavaScript has no good precision.\n         * So instead of only listening to events that happend 'after' the listener\n         * was added, we also listen to events that happended 100ms before it.\n         * This ensures that when another process, like a WebWorker, sends events\n         * we do not miss them out because their timestamp is a bit off compared to the main process.\n         * Not doing this would make messages missing when we send data directly after subscribing and awaiting a response.\n         * @link https://johnresig.com/blog/accuracy-of-javascript-time/\n         */\n        var hundredMsInMicro = 100 * 1000;\n        var minMessageTime = listenerObject.time - hundredMsInMicro;\n\n        if (msgObj.time >= minMessageTime) {\n          listenerObject.fn(msgObj.data);\n        }\n      });\n    };\n\n    var time = channel.method.microSeconds();\n\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\n\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // noone is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}","import isNode from 'detect-node';\nimport BrowserMethod from './browser.js';\nimport NodeMethod from './node.js';\nvar USE_METHOD = isNode ? NodeMethod : BrowserMethod;\nvar LISTENERS = new Set();\nvar startedListening = false;\n\nfunction startListening() {\n  if (startedListening) return;\n  startedListening = true;\n  USE_METHOD.add(runAll);\n}\n\nexport function add(fn) {\n  startListening();\n  if (typeof fn !== 'function') throw new Error('Listener is no function');\n  LISTENERS.add(fn);\n  var addReturn = {\n    remove: function remove() {\n      return LISTENERS[\"delete\"](fn);\n    },\n    run: function run() {\n      LISTENERS[\"delete\"](fn);\n      return fn();\n    }\n  };\n  return addReturn;\n}\nexport function runAll() {\n  var promises = [];\n  LISTENERS.forEach(function (fn) {\n    promises.push(fn());\n    LISTENERS[\"delete\"](fn);\n  });\n  return Promise.all(promises);\n}\nexport function removeAll() {\n  LISTENERS.clear();\n}\nexport function getSize() {\n  return LISTENERS.size;\n}","/* global WorkerGlobalScope */\nfunction add(fn) {\n  if (typeof WorkerGlobalScope === 'function' && self instanceof WorkerGlobalScope) {// this is run inside of a webworker\n  } else {\n    /**\n     * if we are on react-native, there is no window.addEventListener\n     * @link https://github.com/pubkey/unload/issues/6\n     */\n    if (typeof window.addEventListener !== 'function') return;\n    /**\n     * for normal browser-windows, we use the beforeunload-event\n     */\n\n    window.addEventListener('beforeunload', function () {\n      fn();\n    }, true);\n    /**\n     * for iframes, we have to use the unload-event\n     * @link https://stackoverflow.com/q/47533670/3443137\n     */\n\n    window.addEventListener('unload', function () {\n      fn();\n    }, true);\n  }\n  /**\n   * TODO add fallback for safari-mobile\n   * @link https://stackoverflow.com/a/26193516/3443137\n   */\n\n}\n\nexport default {\n  add: add\n};","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.beLeader = beLeader;\nexports.createLeaderElection = createLeaderElection;\n\nvar _util = require(\"./util.js\");\n\nvar _unload = require(\"unload\");\n\nvar LeaderElection = function LeaderElection(broadcastChannel, options) {\n  var _this = this;\n\n  this.broadcastChannel = broadcastChannel;\n  this._options = options;\n  this.isLeader = false;\n  this.hasLeader = false;\n  this.isDead = false;\n  this.token = (0, _util.randomToken)();\n  /**\n   * Apply Queue,\n   * used to ensure we do not run applyOnce()\n   * in parallel.\n   */\n\n  this._aplQ = _util.PROMISE_RESOLVED_VOID; // amount of unfinished applyOnce() calls\n\n  this._aplQC = 0; // things to clean up\n\n  this._unl = []; // _unloads\n\n  this._lstns = []; // _listeners\n\n  this._dpL = function () {}; // onduplicate listener\n\n\n  this._dpLC = false; // true when onduplicate called\n\n  /**\n   * Even when the own instance is not applying,\n   * we still listen to messages to ensure the hasLeader flag\n   * is set correctly.\n   */\n\n  var hasLeaderListener = function hasLeaderListener(msg) {\n    if (msg.context === 'leader') {\n      if (msg.action === 'death') {\n        _this.hasLeader = false;\n      }\n\n      if (msg.action === 'tell') {\n        _this.hasLeader = true;\n      }\n    }\n  };\n\n  this.broadcastChannel.addEventListener('internal', hasLeaderListener);\n\n  this._lstns.push(hasLeaderListener);\n};\n\nLeaderElection.prototype = {\n  /**\n   * Returns true if the instance is leader,\n   * false if not.\n   * @async\n   */\n  applyOnce: function applyOnce( // true if the applyOnce() call came from the fallbackInterval cycle\n  isFromFallbackInterval) {\n    var _this2 = this;\n\n    if (this.isLeader) {\n      return (0, _util.sleep)(0, true);\n    }\n\n    if (this.isDead) {\n      return (0, _util.sleep)(0, false);\n    }\n    /**\n     * Already applying more then once,\n     * -> wait for the apply queue to be finished.\n     */\n\n\n    if (this._aplQC > 1) {\n      return this._aplQ;\n    }\n    /**\n     * Add a new apply-run\n     */\n\n\n    var applyRun = function applyRun() {\n      /**\n       * Optimization shortcuts.\n       * Directly return if a previous run\n       * has already elected a leader.\n       */\n      if (_this2.isLeader) {\n        return _util.PROMISE_RESOLVED_TRUE;\n      }\n\n      var stopCriteria = false;\n      var stopCriteriaPromiseResolve;\n      /**\n       * Resolves when a stop criteria is reached.\n       * Uses as a performance shortcut so we do not\n       * have to await the responseTime when it is already clear\n       * that the election failed.\n       */\n\n      var stopCriteriaPromise = new Promise(function (res) {\n        stopCriteriaPromiseResolve = function stopCriteriaPromiseResolve() {\n          stopCriteria = true;\n          res();\n        };\n      });\n      var recieved = [];\n\n      var handleMessage = function handleMessage(msg) {\n        if (msg.context === 'leader' && msg.token != _this2.token) {\n          recieved.push(msg);\n\n          if (msg.action === 'apply') {\n            // other is applying\n            if (msg.token > _this2.token) {\n              /**\n               * other has higher token\n               * -> stop applying and let other become leader.\n               */\n              stopCriteriaPromiseResolve();\n            }\n          }\n\n          if (msg.action === 'tell') {\n            // other is already leader\n            stopCriteriaPromiseResolve();\n            _this2.hasLeader = true;\n          }\n        }\n      };\n\n      _this2.broadcastChannel.addEventListener('internal', handleMessage);\n      /**\n       * If the applyOnce() call came from the fallbackInterval,\n       * we can assume that the election runs in the background and\n       * not critical process is waiting for it.\n       * When this is true, we give the other intances\n       * more time to answer to messages in the election cycle.\n       * This makes it less likely to elect duplicate leaders.\n       * But also it takes longer which is not a problem because we anyway\n       * run in the background.\n       */\n\n\n      var waitForAnswerTime = isFromFallbackInterval ? _this2._options.responseTime * 4 : _this2._options.responseTime;\n\n      var applyPromise = _sendMessage(_this2, 'apply') // send out that this one is applying\n      .then(function () {\n        return Promise.race([(0, _util.sleep)(waitForAnswerTime), stopCriteriaPromise.then(function () {\n          return Promise.reject(new Error());\n        })]);\n      }) // send again in case another instance was just created\n      .then(function () {\n        return _sendMessage(_this2, 'apply');\n      }) // let others time to respond\n      .then(function () {\n        return Promise.race([(0, _util.sleep)(waitForAnswerTime), stopCriteriaPromise.then(function () {\n          return Promise.reject(new Error());\n        })]);\n      })[\"catch\"](function () {}).then(function () {\n        _this2.broadcastChannel.removeEventListener('internal', handleMessage);\n\n        if (!stopCriteria) {\n          // no stop criteria -> own is leader\n          return beLeader(_this2).then(function () {\n            return true;\n          });\n        } else {\n          // other is leader\n          return false;\n        }\n      });\n\n      return applyPromise;\n    };\n\n    this._aplQC = this._aplQC + 1;\n    this._aplQ = this._aplQ.then(function () {\n      return applyRun();\n    }).then(function () {\n      _this2._aplQC = _this2._aplQC - 1;\n    });\n    return this._aplQ.then(function () {\n      return _this2.isLeader;\n    });\n  },\n  awaitLeadership: function awaitLeadership() {\n    if (\n    /* _awaitLeadershipPromise */\n    !this._aLP) {\n      this._aLP = _awaitLeadershipOnce(this);\n    }\n\n    return this._aLP;\n  },\n\n  set onduplicate(fn) {\n    this._dpL = fn;\n  },\n\n  die: function die() {\n    var _this3 = this;\n\n    this._lstns.forEach(function (listener) {\n      return _this3.broadcastChannel.removeEventListener('internal', listener);\n    });\n\n    this._lstns = [];\n\n    this._unl.forEach(function (uFn) {\n      return uFn.remove();\n    });\n\n    this._unl = [];\n\n    if (this.isLeader) {\n      this.hasLeader = false;\n      this.isLeader = false;\n    }\n\n    this.isDead = true;\n    return _sendMessage(this, 'death');\n  }\n};\n/**\n * @param leaderElector {LeaderElector}\n */\n\nfunction _awaitLeadershipOnce(leaderElector) {\n  if (leaderElector.isLeader) {\n    return _util.PROMISE_RESOLVED_VOID;\n  }\n\n  return new Promise(function (res) {\n    var resolved = false;\n\n    function finish() {\n      if (resolved) {\n        return;\n      }\n\n      resolved = true;\n      leaderElector.broadcastChannel.removeEventListener('internal', whenDeathListener);\n      res(true);\n    } // try once now\n\n\n    leaderElector.applyOnce().then(function () {\n      if (leaderElector.isLeader) {\n        finish();\n      }\n    });\n    /**\n     * Try on fallbackInterval\n     * @recursive\n     */\n\n    var tryOnFallBack = function tryOnFallBack() {\n      return (0, _util.sleep)(leaderElector._options.fallbackInterval).then(function () {\n        if (leaderElector.isDead || resolved) {\n          return;\n        }\n\n        if (leaderElector.isLeader) {\n          finish();\n        } else {\n          return leaderElector.applyOnce(true).then(function () {\n            if (leaderElector.isLeader) {\n              finish();\n            } else {\n              tryOnFallBack();\n            }\n          });\n        }\n      });\n    };\n\n    tryOnFallBack(); // try when other leader dies\n\n    var whenDeathListener = function whenDeathListener(msg) {\n      if (msg.context === 'leader' && msg.action === 'death') {\n        leaderElector.hasLeader = false;\n        leaderElector.applyOnce().then(function () {\n          if (leaderElector.isLeader) {\n            finish();\n          }\n        });\n      }\n    };\n\n    leaderElector.broadcastChannel.addEventListener('internal', whenDeathListener);\n\n    leaderElector._lstns.push(whenDeathListener);\n  });\n}\n/**\n * sends and internal message over the broadcast-channel\n */\n\n\nfunction _sendMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector.broadcastChannel.postInternal(msgJson);\n}\n\nfunction beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  leaderElector.hasLeader = true;\n  var unloadFn = (0, _unload.add)(function () {\n    return leaderElector.die();\n  });\n\n  leaderElector._unl.push(unloadFn);\n\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      _sendMessage(leaderElector, 'tell');\n    }\n\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n\n\n      _sendMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n\n    }\n  };\n\n  leaderElector.broadcastChannel.addEventListener('internal', isLeaderListener);\n\n  leaderElector._lstns.push(isLeaderListener);\n\n  return _sendMessage(leaderElector, 'tell');\n}\n\nfunction fillOptionsWithDefaults(options, channel) {\n  if (!options) options = {};\n  options = JSON.parse(JSON.stringify(options));\n\n  if (!options.fallbackInterval) {\n    options.fallbackInterval = 3000;\n  }\n\n  if (!options.responseTime) {\n    options.responseTime = channel.method.averageResponseTime(channel.options);\n  }\n\n  return options;\n}\n\nfunction createLeaderElection(channel, options) {\n  if (channel._leaderElector) {\n    throw new Error('BroadcastChannel already has a leader-elector');\n  }\n\n  options = fillOptionsWithDefaults(options, channel);\n  var elector = new LeaderElection(channel, options);\n\n  channel._befC.push(function () {\n    return elector.die();\n  });\n\n  channel._leaderElector = elector;\n  return elector;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"BroadcastChannel\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.BroadcastChannel;\n  }\n});\nObject.defineProperty(exports, \"OPEN_BROADCAST_CHANNELS\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.OPEN_BROADCAST_CHANNELS;\n  }\n});\nObject.defineProperty(exports, \"beLeader\", {\n  enumerable: true,\n  get: function get() {\n    return _leaderElection.beLeader;\n  }\n});\nObject.defineProperty(exports, \"clearNodeFolder\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.clearNodeFolder;\n  }\n});\nObject.defineProperty(exports, \"createLeaderElection\", {\n  enumerable: true,\n  get: function get() {\n    return _leaderElection.createLeaderElection;\n  }\n});\nObject.defineProperty(exports, \"enforceOptions\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.enforceOptions;\n  }\n});\n\nvar _broadcastChannel = require(\"./broadcast-channel\");\n\nvar _leaderElection = require(\"./leader-election\");","\"use strict\";\n\nvar _index = require(\"./index.js\");\n\n/**\n * because babel can only export on default-attribute,\n * we use this for the non-module-build\n * this ensures that users do not have to use\n * var BroadcastChannel = require('broadcast-channel').default;\n * but\n * var BroadcastChannel = require('broadcast-channel');\n */\nmodule.exports = {\n  BroadcastChannel: _index.BroadcastChannel,\n  createLeaderElection: _index.createLeaderElection,\n  clearNodeFolder: _index.clearNodeFolder,\n  enforceOptions: _index.enforceOptions,\n  beLeader: _index.beLeader\n};",null,"/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n"],"names":["InjectionDomain","constructor","name","this","applicationMap","app","applicationName","Error","application","InjectionApplication","getApp","DOMAIN_MAP","domain","domainName","AIRPORT_DOMAIN","DependencyInjectionToken","descriptor","dependencyConfiguration","getInheritedDependencyConfiguration","class","getPath","token","setDependencies","_dependencyConfiguration","setClass","aClass","parentClass","Object","getPrototypeOf","returnedDependencyConfiguration","getClass","tokenMap","Map","autopilot","getFullName","get","interface","diToken","set","lib","libraryName","ContextType","Context","id","type","Container","ContainerAccessor","getContainer","injectedObject","iocContainer","__container__","decorators","target","key","desc","d","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__decorate","directionIndicator","AUTOPILOT_API_LOADER","ChildContainer","rootContainer","context","super","objectMap","doEventuallyGet","tokens","successCallback","errorCallback","firstDiNotSetClass","firstMissingClassToken","objects","doGetCore","setTimeout","doGet","console","log","filter","object","__initialized__","notInitializedObjectIndexes","map","index","objectPaths","push","join","message","isFramework","getSync","loadApiAutopilot","diSet","setDependencyGetters","init","result","Promise","then","_","manualInject","propertyName","dependencyToken","async","tokenInterface","resolve","reject","eventuallyGet","DEPENDENCY_INJECTION","dbContainerMap","uiContainers","Set","db","dbContainer","DB","remove","container","delete","ui","componentName","UI","childContainer","add","window","IOC","value","exports","obj","ms","Date","getTime","lastMs","additional","min","max","Math","floor","random","toString","substring","time","resolveWith","res","PROMISE_RESOLVED_FALSE","PROMISE_RESOLVED_TRUE","PROMISE_RESOLVED_VOID","isNode","prototype","call","process","module","__esModule","default","_typeof","Symbol","iterator","averageResponseTime","canBeUsed","close","create","onMessage","postMessage","microSeconds","_util","channelName","state","messagesCallback","bc","BroadcastChannel","subFns","onmessage","msg","data","channelState","messageJson","err","fn","_pubkey","_default","ObliviousSet","ttl","timeMap","has","_this","now","removeTooOldValues","clear","obliviousSet","olderThen","next","originalOptions","undefined","options","JSON","parse","stringify","webWorkerSupport","idb","fallbackInterval","onclose","localstorage","removeTimeout","methods","node","maxParallelWrites","useFastPath","cleanOldMessages","createDatabase","objectStore","transaction","OBJECT_STORE_ID","ret","openCursor","onsuccess","ev","cursor","getIdb","getMessagesHigherThan","getOldMessages","removeMessageById","writeMessage","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","dbName","openRequest","open","onupgradeneeded","createObjectStore","keyPath","autoIncrement","rej","onerror","readerUuid","writeObject","uuid","oncomplete","lastCursorId","keyRangeValue","IDBKeyRange","bound","Infinity","e","request","msgObk","tooOld","all","msgObj","_options","fillOptionsWithDefaults","closed","randomToken","eMIs","_obliviousSet","writeBlockPromise","readQueuePromises","_readLoop","readNewMessages","sleep","newerMessages","useMessages","messagesCallbackTime","_filterMessage","sort","msgObjA","msgObjB","forEach","randomInt","addStorageEventListener","getLocalStorage","removeStorageEventListener","storageKey","localStorage","writeObj","setItem","document","createEvent","initEvent","newValue","dispatchEvent","listener","addEventListener","removeEventListener","ls","removeItem","userAgent","navigator","toLowerCase","includes","defaultTime","SIMULATE_CHANNELS","Array","from","channel","chooseMethods","concat","METHODS","Boolean","_simulate","find","m","useMethod","method","_native","_interopRequireDefault","_indexedDb","require$$1","_localstorage","require$$2","require$$3","_methodChooser","chooseMethod","clearNodeFolder","ENFORCED_OPTIONS","OPEN_BROADCAST_CHANNELS","lastId","maybePromise","_iL","_onML","_addEL","internal","_uMP","_befC","_prepP","isPromise","s","_state","_post","broadcastChannel","sendPromise","_hasMessageListeners","_addListenerObject","listenerFn","listenerObject","hundredMsInMicro","minMessageTime","_startListening","_removeListenerObject","o","_stopListening","postInternal","listenObj","awaitPrepare","isClosed","USE_METHOD","WorkerGlobalScope","self","LISTENERS","startedListening","runAll","promises","run","size","beLeader","_leaderElector","responseTime","elector","LeaderElection","die","isLeader","hasLeader","isDead","_aplQ","_aplQC","_unl","_lstns","_dpL","_dpLC","hasLeaderListener","action","_sendMessage","leaderElector","msgJson","unloadFn","_unload","isLeaderListener","applyOnce","isFromFallbackInterval","_this2","stopCriteriaPromiseResolve","stopCriteria","stopCriteriaPromise","handleMessage","waitForAnswerTime","race","applyRun","awaitLeadership","_aLP","resolved","finish","whenDeathListener","tryOnFallBack","_awaitLeadershipOnce","onduplicate","_this3","uFn","enumerable","_broadcastChannel","_leaderElection","createLeaderElection","enforceOptions","_index","event"],"mappings":"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"}