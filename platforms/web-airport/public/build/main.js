function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e){e.parentNode.removeChild(e)}let s;function c(e){s=e}function l(e){(function(){if(!s)throw new Error("Function called outside component initialization");return s})().$$.on_mount.push(e)}const p=[],d=[],u=[],f=[],y=Promise.resolve();let h=!1;function m(e){u.push(e)}let I=!1;const R=new Set;function E(){if(!I){I=!0;do{for(let e=0;e<p.length;e+=1){const t=p[e];c(t),_(t.$$)}for(c(null),p.length=0;d.length;)d.pop()();for(let e=0;e<u.length;e+=1){const t=u[e];R.has(t)||(R.add(t),t())}u.length=0}while(p.length);for(;f.length;)f.pop()();h=!1,I=!1,R.clear()}}function _(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(m)}}const g=new Set;function T(e,t){-1===e.$$.dirty[0]&&(p.push(e),h||(h=!0,y.then(E)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function O(r,l,p,d,u,f,y,h=[-1]){const I=s;c(r);const R=r.$$={fragment:null,ctx:null,props:f,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(I?I.$$.context:l.context||[]),callbacks:n(),dirty:h,skip_bound:!1,root:l.target||I.$$.root};y&&y(R.root);let _=!1;if(R.ctx=p?p(r,l.props||{},((e,t,...n)=>{const i=n.length?n[0]:t;return R.ctx&&u(R.ctx[e],R.ctx[e]=i)&&(!R.skip_bound&&R.bound[e]&&R.bound[e](i),_&&T(r,e)),t})):[],R.update(),_=!0,i(R.before_update),R.fragment=!!d&&d(R.ctx),l.target){if(l.hydrate){const e=(N=l.target,Array.from(N.childNodes));R.fragment&&R.fragment.l(e),e.forEach(a)}else R.fragment&&R.fragment.c();l.intro&&((O=r.$$.fragment)&&O.i&&(g.delete(O),O.i(A))),function(e,n,r,a){const{fragment:s,on_mount:c,on_destroy:l,after_update:p}=e.$$;s&&s.m(n,r),a||m((()=>{const n=c.map(t).filter(o);l?l.push(...n):i(n),e.$$.on_mount=[]})),p.forEach(m)}(r,l.target,l.anchor,l.customElement),E()}var O,A,N;c(I)}var A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function N(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})})),t}function x(e){var t={exports:{}};return e(t,t.exports),t.exports}var b=x((function(e,t){e.exports=function(){var e=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},t=R,n=s,i=c,o=l,r=I,a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function s(e){for(var t,n=[],i=0,o=0,r="";null!=(t=a.exec(e));){var s=t[0],c=t[1],l=t.index;if(r+=e.slice(o,l),o=l+s.length,c)r+=c[1];else{r&&(n.push(r),r="");var p=t[2],u=t[3],f=t[4],y=t[5],h=t[6],m=t[7],I="+"===h||"*"===h,R="?"===h||"*"===h,E=p||"/",_=f||y||(m?".*":"[^"+E+"]+?");n.push({name:u||i++,prefix:p||"",delimiter:E,optional:R,repeat:I,pattern:d(_)})}}return o<e.length&&(r+=e.substr(o)),r&&n.push(r),n}function c(e){return l(s(e))}function l(t){for(var n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof t[i]&&(n[i]=new RegExp("^"+t[i].pattern+"$"));return function(i){for(var o="",r=i||{},a=0;a<t.length;a++){var s=t[a];if("string"!=typeof s){var c,l=r[s.name];if(null==l){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to be defined')}if(e(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received "'+l+'"');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(c=encodeURIComponent(l[p]),!n[a].test(c))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received "'+c+'"');o+=(0===p?s.prefix:s.delimiter)+c}}else{if(c=encodeURIComponent(l),!n[a].test(c))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+c+'"');o+=s.prefix+c}}else o+=s}return o}}function p(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function d(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function u(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function y(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u(e,t)}function h(e,t,n){for(var i=[],o=0;o<e.length;o++)i.push(R(e[o],t,n).source);return u(new RegExp("(?:"+i.join("|")+")",f(n)),t)}function m(e,t,n){for(var i=s(e),o=I(i,n),r=0;r<i.length;r++)"string"!=typeof i[r]&&t.push(i[r]);return u(o,t)}function I(e,t){for(var n=(t=t||{}).strict,i=!1!==t.end,o="",r=e[e.length-1],a="string"==typeof r&&/\/$/.test(r),s=0;s<e.length;s++){var c=e[s];if("string"==typeof c)o+=p(c);else{var l=p(c.prefix),d=c.pattern;c.repeat&&(d+="(?:"+l+d+")*"),o+=d=c.optional?l?"(?:"+l+"("+d+"))?":"("+d+")?":l+"("+d+")"}}return n||(o=(a?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=i?"$":n&&a?"":"(?=\\/|$)",new RegExp("^"+o,f(t))}function R(t,n,i){return e(n=n||[])?i||(i={}):(i=n,n=[]),t instanceof RegExp?y(t,n):e(t)?h(t,n,i):m(t,n,i)}t.parse=n,t.compile=i,t.tokensToFunction=o,t.tokensToRegExp=r;var E,_="undefined"!=typeof document,g="undefined"!=typeof window,T="undefined"!=typeof history,O="undefined"!=typeof process,A=_&&document.ontouchstart?"touchstart":"click",N=g&&!(!window.history.location&&!window.location);function x(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function b(){var e=new x;function t(){return w.apply(e,arguments)}return t.callbacks=e.callbacks,t.exits=e.exits,t.base=e.base.bind(e),t.strict=e.strict.bind(e),t.start=e.start.bind(e),t.stop=e.stop.bind(e),t.show=e.show.bind(e),t.back=e.back.bind(e),t.redirect=e.redirect.bind(e),t.replace=e.replace.bind(e),t.dispatch=e.dispatch.bind(e),t.exit=e.exit.bind(e),t.configure=e.configure.bind(e),t.sameOrigin=e.sameOrigin.bind(e),t.clickHandler=e.clickHandler.bind(e),t.create=b,Object.defineProperty(t,"len",{get:function(){return e.len},set:function(t){e.len=t}}),Object.defineProperty(t,"current",{get:function(){return e.current},set:function(t){e.current=t}}),t.Context=C,t.Route=D,t}function w(e,t){if("function"==typeof e)return w.call(this,"*",e);if("function"==typeof t)for(var n=new D(e,null,this),i=1;i<arguments.length;++i)this.callbacks.push(n.middleware(arguments[i]));else"string"==typeof e?this["string"==typeof t?"redirect":"show"](e,t):this.start(e)}function S(e){if(!e.handled){var t=this,n=t._window;(t._hashbang?N&&this._getBase()+n.location.hash.replace("#!",""):N&&n.location.pathname+n.location.search)!==e.canonicalPath&&(t.stop(),e.handled=!1,N&&(n.location.href=e.canonicalPath))}}function v(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function C(e,t,n){var i=this.page=n||w,o=i._window,r=i._hashbang,a=i._getBase();"/"===e[0]&&0!==e.indexOf(a)&&(e=a+(r?"#!":"")+e);var s=e.indexOf("?");this.canonicalPath=e;var c=new RegExp("^"+v(a));if(this.path=e.replace(c,"")||"/",r&&(this.path=this.path.replace("#!","")||"/"),this.title=_&&o.document.title,this.state=t||{},this.state.path=e,this.querystring=~s?i._decodeURLEncodedURIComponent(e.slice(s+1)):"",this.pathname=i._decodeURLEncodedURIComponent(~s?e.slice(0,s):e),this.params={},this.hash="",!r){if(!~this.path.indexOf("#"))return;var l=this.path.split("#");this.path=this.pathname=l[0],this.hash=i._decodeURLEncodedURIComponent(l[1])||"",this.querystring=this.querystring.split("#")[0]}}function D(e,n,i){var o=this.page=i||M,r=n||{};r.strict=r.strict||o._strict,this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=t(this.path,this.keys=[],r)}x.prototype.configure=function(e){var t=e||{};this._window=t.window||g&&window,this._decodeURLComponents=!1!==t.decodeURLComponents,this._popstate=!1!==t.popstate&&g,this._click=!1!==t.click&&_,this._hashbang=!!t.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):g&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(A,this.clickHandler,!1):_&&n.document.removeEventListener(A,this.clickHandler,!1),this._hashbang&&g&&!T?n.addEventListener("hashchange",this._onpopstate,!1):g&&n.removeEventListener("hashchange",this._onpopstate,!1)},x.prototype.base=function(e){if(0===arguments.length)return this._base;this._base=e},x.prototype._getBase=function(){var e=this._base;if(e)return e;var t=g&&this._window&&this._window.location;return g&&this._hashbang&&t&&"file:"===t.protocol&&(e=t.pathname),e},x.prototype.strict=function(e){if(0===arguments.length)return this._strict;this._strict=e},x.prototype.start=function(e){var t=e||{};if(this.configure(t),!1!==t.dispatch){var n;if(this._running=!0,N){var i=this._window.location;n=this._hashbang&&~i.hash.indexOf("#!")?i.hash.substr(2)+i.search:this._hashbang?i.search+i.hash:i.pathname+i.search+i.hash}this.replace(n,null,!0,t.dispatch)}},x.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var e=this._window;this._click&&e.document.removeEventListener(A,this.clickHandler,!1),g&&e.removeEventListener("popstate",this._onpopstate,!1),g&&e.removeEventListener("hashchange",this._onpopstate,!1)}},x.prototype.show=function(e,t,n,i){var o=new C(e,t,this),r=this.prevContext;return this.prevContext=o,this.current=o.path,!1!==n&&this.dispatch(o,r),!1!==o.handled&&!1!==i&&o.pushState(),o},x.prototype.back=function(e,t){var n=this;if(this.len>0){var i=this._window;T&&i.history.back(),this.len--}else e?setTimeout((function(){n.show(e,t)})):setTimeout((function(){n.show(n._getBase(),t)}))},x.prototype.redirect=function(e,t){var n=this;"string"==typeof e&&"string"==typeof t&&w.call(this,e,(function(e){setTimeout((function(){n.replace(t)}),0)})),"string"==typeof e&&void 0===t&&setTimeout((function(){n.replace(e)}),0)},x.prototype.replace=function(e,t,n,i){var o=new C(e,t,this),r=this.prevContext;return this.prevContext=o,this.current=o.path,o.init=n,o.save(),!1!==i&&this.dispatch(o,r),o},x.prototype.dispatch=function(e,t){var n=0,i=0,o=this;function r(){var e=o.exits[i++];if(!e)return a();e(t,r)}function a(){var t=o.callbacks[n++];if(e.path===o.current)return t?void t(e,a):S.call(o,e);e.handled=!1}t?r():a()},x.prototype.exit=function(e,t){if("function"==typeof e)return this.exit("*",e);for(var n=new D(e,null,this),i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},x.prototype.clickHandler=function(e){if(1===this._which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var t=e.target,n=e.path||(e.composedPath?e.composedPath():null);if(n)for(var i=0;i<n.length;i++)if(n[i].nodeName&&"A"===n[i].nodeName.toUpperCase()&&n[i].href){t=n[i];break}for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(t&&"A"===t.nodeName.toUpperCase()){var o="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(!t.hasAttribute("download")&&"external"!==t.getAttribute("rel")){var r=t.getAttribute("href");if((this._hashbang||!this._samePath(t)||!t.hash&&"#"!==r)&&!(r&&r.indexOf("mailto:")>-1)&&!(o?t.target.baseVal:t.target)&&(o||this.sameOrigin(t.href))){var a=o?t.href.baseVal:t.pathname+t.search+(t.hash||"");a="/"!==a[0]?"/"+a:a,O&&a.match(/^\/[a-zA-Z]:\//)&&(a=a.replace(/^\/[a-zA-Z]:\//,"/"));var s=a,c=this._getBase();0===a.indexOf(c)&&(a=a.substr(c.length)),this._hashbang&&(a=a.replace("#!","")),(!c||s!==a||N&&"file:"===this._window.location.protocol)&&(e.preventDefault(),this.show(s))}}}}},x.prototype._onpopstate=(E=!1,g?(_&&"complete"===document.readyState?E=!0:window.addEventListener("load",(function(){setTimeout((function(){E=!0}),0)})),function(e){if(E){var t=this;if(e.state){var n=e.state.path;t.replace(n,e.state)}else if(N){var i=t._window.location;t.show(i.pathname+i.search+i.hash,void 0,void 0,!1)}}}):function(){}),x.prototype._which=function(e){return null==(e=e||g&&this._window.event).which?e.button:e.which},x.prototype._toURL=function(e){var t=this._window;if("function"==typeof URL&&N)return new URL(e,t.location.toString());if(_){var n=t.document.createElement("a");return n.href=e,n}},x.prototype.sameOrigin=function(e){if(!e||!N)return!1;var t=this._toURL(e),n=this._window.location;return n.protocol===t.protocol&&n.hostname===t.hostname&&(n.port===t.port||""===n.port&&(80==t.port||443==t.port))},x.prototype._samePath=function(e){if(!N)return!1;var t=this._window.location;return e.pathname===t.pathname&&e.search===t.search},x.prototype._decodeURLEncodedURIComponent=function(e){return"string"!=typeof e?e:this._decodeURLComponents?decodeURIComponent(e.replace(/\+/g," ")):e},C.prototype.pushState=function(){var e=this.page,t=e._window,n=e._hashbang;e.len++,T&&t.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},C.prototype.save=function(){var e=this.page;T&&e._window.history.replaceState(this.state,this.title,e._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},D.prototype.middleware=function(e){var t=this;return function(n,i){if(t.match(n.path,n.params))return n.routePath=t.path,e(n,i);i()}},D.prototype.match=function(e,t){var n=this.keys,i=e.indexOf("?"),o=~i?e.slice(0,i):e,r=this.regexp.exec(decodeURIComponent(o));if(!r)return!1;delete t[0];for(var a=1,s=r.length;a<s;++a){var c=n[a-1],l=this.page._decodeURLEncodedURIComponent(r[a]);void 0===l&&hasOwnProperty.call(t,c.name)||(t[c.name]=l)}return!0};var M=b(),V=M,P=M;return V.default=P,V}()}));function w(e){var t=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};return b("/:uiPath",(e=>{console.log(e)})),b(),l((()=>t(void 0,void 0,void 0,(function*(){})))),[]}class S{constructor(e){this.name=e,this.applicationMap={}}app(e){if(this.applicationMap[e])throw new Error(`\n\t\t\tApplication already defined.\n\t\t\tDomain:      ${this.name}\n\t\t\tApplication: ${e}\n\t\t\t`);const t=new V(e,this);return this.applicationMap[e]=t,t}getApp(e){return this.applicationMap[e]}}const v={};function C(e){if(v[e])return v[e];const t=new S(e);return v[e]=t,t}const D=C("turbase.app");class M{constructor(e,t){this.application=e,this.descriptor=t}get dependencyConfiguration(){return this.getInheritedDependencyConfiguration(this.descriptor.class)}getPath(){return this.application.domain.name+":"+this.application.name+":"+this.descriptor.token}setDependencies(e){this._dependencyConfiguration?this._dependencyConfiguration={...this._dependencyConfiguration,...e}:this._dependencyConfiguration=e,this.descriptor.class&&(this.descriptor.class.dependencyConfiguration?this.descriptor.class.dependencyConfiguration={...this.descriptor.class.dependencyConfiguration,...e}:this.descriptor.class.dependencyConfiguration=e)}setClass(e){this.descriptor.class=e,e.dependencyConfiguration=this._dependencyConfiguration}getInheritedDependencyConfiguration(e){const t=Object.getPrototypeOf(e);let n={};t&&(n=this.getInheritedDependencyConfiguration(t));const i=e.dependencyConfiguration;return i&&(n={...n,...i}),n}getClass(){return this.descriptor.class}}class V{constructor(e,t){this.name=e,this.domain=t,this.tokenMap=new Map,this.autopilot=!1}getFullName(){return`${this.domain.name}/${this.name}`}token(e){if(this.tokenMap.get(e.interface))throw new Error(`Token with name '${e.interface}' has already been created`);const t=new M(this,e);return this.tokenMap.set(e.interface,t),t}}function P(e){return D.app(e)}var L;!function(e){e.DB="DB",e.UI="UI"}(L||(L={}));class U{constructor(e,t){this.id=e,this.type=t}}class j{}var F=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let G=class{getContainer(e){const t=e.__container__;if(!t)throw new Error('"container" is not set on injectable object.');if(!(t instanceof j))throw new Error('"container" property of injectable is not aninstance of @airport/direction-indicator Container');return t}};G=F([function(e){}],G);const k=P("direction-indicator"),B=k.token({class:null,interface:"IAutopilotApiLoader",token:"AUTOPILOT_API_LOADER"}),H=k.token({class:G,interface:"IContainerAccessor",token:"CONTAINER_ACCESSOR"}),$=k.token({class:null,interface:"IInterAppAPIClient",token:"INTER_APP_API_CLIENT"});class q extends j{constructor(e,t){super(),this.rootContainer=e,this.context=t,this.objectMap=new Map}doEventuallyGet(e,t,n){let{firstDiNotSetClass:i,firstMissingClassToken:o,objects:r}=this.doGetCore(e);o||i?setTimeout((()=>{this.doEventuallyGet(e,t,n)}),100):r.length>1?t(r):t(r[0])}doGet(e,t,n){const{firstDiNotSetClass:i,firstMissingClassToken:o,objects:r}=this.doGetCore(e);if(i)return console.log(`Dependency Injection is not ready for token ${o.getPath()}\n\t\t\t, class: ${i.name}. Delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100);if(r.filter((e=>e&&!e.__initialized__)).length){const i=r.map(((e,t)=>e.__initialized__?-1:t)).filter((e=>-1!==e)),o=[];for(const t of i)o.push(e[t].getPath());return console.log(`Dependency Injection is not ready for tokens:\n\t\t\t\t ${o.join("\n")}\n\t\t\t, these classes are not yet initialized, delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100)}if(o){const e="Dependency Injection could not find class for token: "+o.getPath();console.log(e),n(e)}else r.length>1?t(r):t(r[0])}doGetCore(e){let t,n;const i=e.map((e=>{if(t||n)return;let i=this.objectMap.get(e.descriptor.token);if(!i){if(!this.rootContainer.isFramework&&e.application.autopilot)i=this.getSync(B).loadApiAutopilot(e);else{const o=e.descriptor.class;if(!o)return void(t=e);if(o.diSet&&!o.diSet())return t=e,void(n=o);i=new o,this.setDependencyGetters(i,e)}if(i.__container__=this,this.objectMap.set(e.descriptor.token,i),!e.application.autopilot&&i.init){const t=i.init();t instanceof Promise?t.then((t=>{i.__initialized__=!0,console.log(`${e.getPath()} initialized.`)})):(i.__initialized__=!0,console.log(`${e.getPath()} initialized.`))}else i.__initialized__=!0}return i}));return{firstDiNotSetClass:n,firstMissingClassToken:t,objects:i}}manualInject(e,t){e.__container__=this,this.setDependencyGetters(e,t)}setDependencyGetters(e,t){if(!t.dependencyConfiguration)return;const n=t.dependencyConfiguration;for(let t in n){delete e[t];const i=n[t];Object.defineProperty(e,t,{get(){return this.__container__.getSync(i)}}),e["get"+t+"Async"]=async function(){return await this.__container__.get(i)}}}async getByNames(e,t,n){if(!C(e))throw new Error(`Could nof find\n\tDomain:\n\t\t${e}\n\t\t`);const i=C(e).getApp(t);if(!i)throw new Error(`Could not find\n\tDomain:\n\t\t${e}\n\tApplication:\n\t\t${t}\n\t\t`);const o=i.tokenMap.get(n);if(!o)throw new Error(`Could not find token: ${n}\n\tin Domain:\n\t\t${e}\n \tApplication:\n\t\t\t${t}\n\t\t`);return await this.get(o)}get(...e){return new Promise(((t,n)=>{this.doGet(e,t,n)}))}eventuallyGet(...e){return new Promise(((t,n)=>{this.doEventuallyGet(e,t,n)}))}getSync(...e){const{firstDiNotSetClass:t,firstMissingClassToken:n,objects:i}=this.doGetCore(e);if(n)throw new Error("Dependency Injection could not find class for token: "+n.getPath());if(t)throw new Error("Dependency Injection is not ready for class: "+t.name);return i.length>1?i:i[0]}}const Y=new class extends j{constructor(){super(...arguments),this.isFramework=!1,this.dbContainerMap=new Map,this.uiContainers=new Set}db(e=null){let t=this.dbContainerMap.get(e);return t||(t=new q(this,new U(e,L.DB)),this.dbContainerMap.set(e,t)),t}remove(e){if(!e)return;this.dbContainerMap.get(e.context.id)?this.dbContainerMap.delete(e.context.id):this.uiContainers.delete(e)}ui(e){const t=new U(e,L.UI),n=new q(this,t);return this.uiContainers.add(n),n}};function Q(e,t,n){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.base=e.prototype;for(const e in n)t.prototype[e]=n[e];return t}"undefined"!=typeof window&&(window.DEPENDENCY_INJECTION=Y,window.lib=P,window.domain=C);const W=new class{async get(...e){return await Y.db().get(...e)}async eventuallyGet(...e){return await Y.db().eventuallyGet(...e)}getSync(...e){return Y.db().getSync(...e)}};var z=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let J=class{async loadRepository(e,t,n){if(n.repositoryExistenceChecked)return;n.repositoryExistenceChecked=!0;const i=await this.repositoryDao.getRepositoryLoadInfo(e,t,n);let o=!1,r=0;if(i){if(!i.immutable){o=!0;for(const e of i.repositoryTransactionHistory)r<e.saveTimestamp&&(r=e.saveTimestamp)}}else o=!0;if(!o)return;const a=(new Date).getTime(),s=await this.synchronizationAdapterLoader.load(e);let c;try{if(r){if(r>=a-1e4)return;r-=1e5,c=await s.getTransactionsForRepository(e,t,r)}else c=await s.getTransactionsForRepository(e,t);const i=new Map;for(const e of c)i.set(e.history.GUID,e);await this.synchronizationInManager.receiveMessages(i,n)}catch(e){return void console.error(e)}}};z([function(e,t){}],J.prototype,"repositoryDao",void 0),z([function(e,t){}],J.prototype,"synchronizationAdapterLoader",void 0),z([function(e,t){}],J.prototype,"synchronizationInManager",void 0),J=z([function(e){}],J);var K,Z,X,ee,te,ne,ie,oe,re,ae,se,ce,le,pe,de,ue,fe,ye,he,me,Ie,Re,Ee,_e,ge,Te,Oe,Ae,Ne,xe,be,we,Se,ve;!function(e){var t;e.NAME="name",(t=e.type||(e.type={})).ANY="any",t.BOOLEAN="boolean",t.DATE="Date",t.NUMBER="number",t.STRING="string"}(K||(K={})),function(e){e.ENTITY="Entity",e.TABLE="Table"}(Z||(Z={})),function(e){e.DATABASES="databases"}(X||(X={})),function(e){e.DEFINITION="foreignKeyDefinition",e.NAME="name",e.VALUE="value"}(ee||(ee={})),function(e){e.COLUMN_LIST="columnList",e.NAME="name",e.UNIQUE="unique"}(te||(te={})),function(e){e.FOREIGN_KEY="foreignKey",e.REFERENCED_COLUMN_NAME="referencedColumnName",e.VALUE="value"}(ne||(ne={})),function(e){e.COLUMN="Column",e.ENUM_TYPE="Enum",e.ID="Id",e.JOIN_COLUMN="JoinColumn",e.JOIN_COLUMNS="JoinColumns",e.JSON_TYPE="Json",e.MANY_TO_ONE="ManyToOne",e.ONE_TO_MANY="OneToMany",e.SUB_QUERY="SubQuery"}(ie||(ie={})),function(e){e.MAPPED_BY="mappedBy"}(oe||(oe={})),function(e){e.INDEXES="indexes",e.NAME="name",e.PRIMARY_KEY="primaryKey",e.APPLICATION="application"}(re||(re={})),function(e){e.ACTOR_LID="ACTOR_LID",e.ACTOR_RECORD_ID="ACTOR_RECORD_ID",e.ENTITY_NAME="AirEntity",e.FOREIGN_KEY="REPOSITORY_LID",e.LOCAL_ENTITY_NAME="LocalAirEntity",e.REPOSITORY_LID="REPOSITORY_LID",e.ORIGINAL_ACTOR_ID="ORIGINAL_ACTOR_LID",e.ORIGINAL_ACTOR_RECORD_ID="ORIGINAL_ACTOR_RECORD_ID",e.ORIGINAL_REPOSITORY_ID="ORIGINAL_REPOSITORY_LID",e.SYS_WIDE_OP_ID_APPLICATION="air____at_airport_slash_airport_dash_code",e.SYS_WIDE_OP_ID_ENTITY="SystemWideOperationId",e.systemWideOperationId="systemWideOperationId",e.SYSTEM_WIDE_OPERATION_ID="SYSTEM_WIDE_OPERATION_LID"}(ae||(ae={})),function(e){e.FULL_JOIN="FULL_JOIN",e.INNER_JOIN="INNER_JOIN",e.LEFT_JOIN="LEFT_JOIN",e.RIGHT_JOIN="RIGHT_JOIN"}(se||(se={})),function(e){e.ONE_TO_MANY="ONE_TO_MANY",e.MANY_TO_ONE="MANY_TO_ONE"}(ce||(ce={})),function(e){e.ENTITY_JOIN_ON="ENTITY_JOIN_ON",e.ENTITY_APPLICATION_RELATION="ENTITY_APPLICATION_RELATION",e.ENTITY_ROOT="ENTITY_ROOT",e.SUB_QUERY_JOIN_ON="SUB_QUERY_JOIN_ON",e.SUB_QUERY_ROOT="SUB_QUERY_ROOT"}(le||(le={})),function(e){e.ASCENDING="ASCENDING",e.DESCENDING="DESCENDING"}(pe||(pe={})),function(e){e.ABS="ABS",e.AVG="AVG",e.COUNT="COUNT",e.MAX="MAX",e.MIN="MIN",e.SUM="SUM",e.UCASE="UCASE",e.LCASE="LCASE",e.MID="MID",e.LEN="LEN",e.ROUND="ROUND",e.NOW="NOW",e.FORMAT="FORMAT",e.REPLACE="REPLACE",e.TRIM="TRIM",e.DISTINCT="DISTINCT",e.EXISTS="EXISTS",e.DIVIDE="DIVIDE",e.MINUS="MINUS",e.MODULUS="MODULUS",e.MULTIPLY="MULTIPLY",e.PLUS="PLUS",e.CONCATENATE="CONCATENATE",e.COALESCE="COALESCE"}(de||(de={})),function(e){e.FIELD="FIELD",e.FIELD_FUNCTION="FIELD_FUNCTION",e.FIELD_QUERY="FIELD_QUERY",e.DISTINCT_FUNCTION="DISTINCT_FUNCTION",e.EXISTS_FUNCTION="EXISTS_FUNCTION",e.MANY_TO_ONE_RELATION="MANY_TO_ONE_RELATION"}(ue||(ue={})),function(e){e.ANY="ANY",e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.JSON="JSON",e.NUMBER="NUMBER",e.STRING="STRING"}(fe||(fe={})),function(e){e.CREATE="CREATE",e.DATE="DATE",e.DELETE="DELETE",e.PARENT_SCHEMA_ID="PARENT_SCHEMA_LID",e.PASS_THROUGH="PASS_THROUGH",e.STUB="STUB",e.UPDATE="UPDATE"}(ye||(ye={})),function(e){e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.FUNCTION="FUNCTION",e.LOGICAL="LOGICAL",e.NUMBER="NUMBER",e.STRING="STRING",e.UNTYPED="UNTYPED"}(he||(he={})),function(e){e.AND="AND",e.EQUALS="EQUALS",e.EXISTS="EXISTS",e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUALS="GREATER_THAN_OR_EQUALS",e.IN="IN",e.IS_NOT_NULL="IS_NOT_NULL",e.IS_NULL="IS_NULL",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUALS="LESS_THAN_OR_EQUALS",e.LIKE="LIKE",e.OR="OR",e.NOT="NOT",e.NOT_EQUALS="NOT_EQUALS",e.NOT_IN="NOT_IN"}(me||(me={})),function(e){e.CREATE="CREATE",e.READ="READ",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Ie||(Ie={})),function(e){e.LOCAL="LOCAL",e.REMOTE_SYNC="REMOTE_SYNC"}(Re||(Re={})),function(e){e.DELETE_ROWS="DELETE_ROWS",e.INSERT_VALUES="INSERT_VALUES",e.UPDATE_ROWS="UPDATE_ROWS"}(Ee||(Ee={})),function(e){e.S3_SECURE_POLL="S3_SECURE_POLL",e.S3_DISTIBUTED_PUSH="S3_DISTIBUTED_PUSH"}(_e||(_e={})),function(e){e.DDL="DDL",e.SELECT="SELECT",e.MUTATE="MUTATE"}(ge||(ge={})),function(e){e.GOOGLE_DOCS="GOOGLE_DOCS",e.IN_MEMORY="IN_MEMORY",e.OFFLINE="OFFLINE",e.STUB="STUB"}(Te||(Te={})),function(e){e.COCKROACHDB="COCKROACHDB",e.MYSQL="MYSQL",e.POSTGRESQL="POSTGRESQL",e.REMOTE="REMOTE",e.SQLITE="SQLITE",e.SQLJS="SQLJS",e.WEB_SQL="WEB_SQL"}(Oe||(Oe={})),function(e){e.ENTITY_CHANGE_ID="ENTITY_CHANGE_LID"}(Ae||(Ae={})),function(e){e.ENTITY_QUERY="ENTITY_QUERY",e.NON_ENTITY_QUERY="NON_ENTITY_QUERY"}(Ne||(Ne={})),function(e){e.ENTITY_GRAPH="ENTITY_GRAPH",e.ENTITY_TREE="ENTITY_TREE",e.TREE="TREE",e.SHEET="SHEET",e.FIELD="FIELD",e.RAW="RAW"}(xe||(xe={})),function(e){e.DELETE="DELETE",e.FIND_ONE_GRAPH="FIND_ONE_GRAPH",e.FIND_ONE_TREE="FIND_ONE_TREE",e.FIND_GRAPH="FIND_GRAPH",e.FIND_TREE="FIND_TREE",e.SAVE="SAVE",e.SEARCH_ONE_GRAPH="SEARCH_ONE_GRAPH",e.SEARCH_ONE_TREE="SEARCH_ONE_TREE",e.SEARCH_GRAPH="SEARCH_GRAPH",e.SEARCH_TREE="SEARCH_TREE"}(be||(be={})),function(e){e.PARAMETER="PARAMETER",e.Q="Q",e.QENTITY="QENTITY"}(we||(we={})),function(e){e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.NUMBER="NUMBER",e.STRING="STRING"}(Se||(Se={})),function(e){e.CURRENT="CURRENT",e.MISSING="MISSING",e.NEEDS_UPGRADES="NEEDS_UPGRADES",e.STUB="STUB"}(ve||(ve={}));class Ce{constructor(e,t={}){this.applicationVersionId=e,this.tableMap=t}ensure(e,t=!1,n=De){let i=this.tableMap[e];return i||(i=new n(e,t),this.tableMap[e]=i),i}existsByStructure(e,t){let n=this.tableMap[e];return!!n&&!!n.columnMap[t]}}class De{constructor(e,t=!1){this.tableIndex=e,this.columnMap={},t&&(this.columnMap.A=!0)}ensure(e){this.columnMap[e]=!0}}var Me=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ve=class{getFullApplication_Name({domain:e,name:t}){return e.name&&(e=e.name),this.getFullApplication_NameFromDomainAndName(e,t)}getFullApplication_NameFromDomainAndName(e,t){if(e.indexOf("___")>-1)throw new Error('Domain Name cannot contain "___" (3 consecutive underscores) in it.');if(e.endsWith(".")||e.endsWith("-")||e.endsWith(":")||e.endsWith("__"))throw new Error('Domain Name cannot end with ".", "-", ":" or "__"');const n=e.replace(/\./g,"_dot_").replace(/-/g,"_dash_").replace(/:/g,"_colon_");if(n.indexOf("___")>-1)throw new Error('Domain Name cannot have with ".", "-", ":", or "_" right next to each other.');if(t.indexOf("_")>-1)throw new Error('Application Name cannot contain "_" in it.');if(t.indexOf("@")!==t.lastIndexOf("@"))throw new Error('Application Name cannot have more than one "@" in it.');if(t.indexOf("@")>0)throw new Error('Application Name cannot contain "@" after the first character in it.');if(t.indexOf("/")!==t.lastIndexOf("/"))throw new Error('Application Name cannot have more than one "/" in it.');const i=t.replace(/@/g,"_at_").replace(/\//g,"_slash_").replace(/-/g,"_dash_");if(i.endsWith("_"))throw new Error('Application Name cannot end with "@", "/" or "."');if(i.indexOf("___")>-1)throw new Error('Application Name cannot have with "@", "/", "." or "_" right next to each other.');let o=`${n}___${i}`;return o.endsWith("_dash_runtime")&&(o=o.substring(0,o.length-13)),o}getSequenceName(e,t){return`${e}_${t}__SEQUENCE`}};Ve=Me([function(e){}],Ve);class Pe{constructor(e={}){this.applicationMap=e}ensureEntity(e,t=!1,n=Ce){return this.ensure(e.applicationVersion._localId,e.index,t,n)}ensure(e,t,n=!1,i=Ce){let o=this.applicationMap[e];return o||(o=new i(e),this.applicationMap[e]=o),o.ensure(t,n)}existsByStructure(e,t,n){let i=this.applicationMap[e];return!!i&&i.existsByStructure(t,n)}}class Le extends De{constructor(e,t=!1){super(e,t)}}class Ue extends Ce{constructor(e,t){super(e,t)}ensureEntity(e,t=!1){return super.ensure(e,t,Le)}intersects(e){for(let t in this.tableMap)if(e.tableMap[t]){let n=this.tableMap[t],i=e.tableMap[t];if(n.A||n.A)return!0;for(let e in n.columnMap)if(i.columnMap[e])return!0}return!1}}class je extends Pe{constructor(e){super(e)}ensureEntity(e,t=!1){return super.ensureEntity(e,t,Ue)}intersects(e){for(const t in this.applicationMap)if(e.applicationMap[t]){if(new Ue(parseInt(t),this.applicationMap[t].tableMap).intersects(e.applicationMap[t]))return!0}return!1}}var Fe,Ge,ke,Be;function He(e,t){let n;return n=e instanceof Map?e.get(t):e[t],n||(n=[],e instanceof Map?e.set(t,n):e[t]=n),n}function $e(e,t){let n;return e instanceof Map?(n=e.get(t),n||(n={},e.set(t,n))):(n=e[t],n||(n={},e[t]=n)),n}function qe(e,t){let n=e.get(t);return n||(n=new Map,e.set(t,n)),n}function Ye(e,t){let n=e.get(t);return n||(n=new Set,e.set(t,n)),n}function Qe(e){return void 0===e?null:e}function We(e){Be=e}!function(e){e.SYNCHRONIZING="SYNCHRONIZING",e.SYNCHRONIZED="SYNCHRONIZED",e.REQUESTING_SYNC_STATUS="REQUESTING_SYNC_STATUS",e.RESYNC_REQUESTED="RESYNC_REQUESTED"}(Fe||(Fe={})),function(e){e.ACTIVE="ACTIVE",e.PENDING="PENDING",e.DELAYED="DELAYED",e.SUSPENDED="SUSPENDED",e.TEMPORARILY_REROUTED="TEMPORARILY_REROUTED",e.PERMANENTLY_REROUTED="PERMANENTLY_REROUTED"}(Ge||(Ge={})),function(e){e.ACTIVE="ACTIVE",e.SUSPENDED="SUSPENDED"}(ke||(ke={}));const ze=P("ground-control"),Je=ze.token({class:Ve,interface:"IDbApplicationUtils",token:"DB_APPLICATION_UTILS"}),Ke=ze.token({class:null,interface:"IEntityStateManager",token:"ENTITY_STATE_MANAGER"}),Ze=ze.token({class:null,interface:"ISequenceGenerator",token:"SEQUENCE_GENERATOR"}),Xe=ze.token({class:null,interface:"ITransactionalConnector",token:"TRANSACTIONAL_CONNECTOR"}),et=ze.token({class:null,interface:"IUpdateCacheManager",token:"UPDATE_CACHE_MANAGER"});Xe.setDependencies({dbApplicationUtils:Je});const tt={airportSelectField:!0,insert:!0,update:!1},nt={__allFields__:!0};function it(e){return e&&!0===e.airportSelectField}function ot(e){return e&&!1===e.airportSelectField}function rt(e){for(let t in e){let n=e[t];if(n instanceof Object)if(n.hasOwnProperty("airportSelectField"))switch(n.airportSelectField){case"LID":e[t]="LID";break;case!0:e[t]="Y";break;case!1:e[t]="N"}else rt(n)}}function at(e){const t=JSON.parse(JSON.stringify(e));return rt(t),JSON.stringify(t,null,4)}const st=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];class ct{constructor(e=""){this.aliasPrefix=e,this.reset()}getFollowingAlias(){let e=this.lastAlias;for(var t=2;t>=0;t--){let n=e[t];if(n=(n+1)%26,e[t]=n,0!==n)break}let n=this.aliasPrefix;for(t=0;t<3;t++)n+=st[e[t]];return"add"===n&&(n=this.getFollowingAlias()),n}reset(){this.lastAlias=[-1,-1,-1]}}class lt{constructor(e){this.aliasCache=e,this.aliasMap=new Map}getNextAlias(e){if(this.hasAliasFor(e))return this.getExistingAlias(e);let t=this.aliasCache.getFollowingAlias();return this.aliasMap.set(e,t),t}hasAliasFor(e){return this.aliasMap.has(e)}}class pt extends lt{constructor(e=new ct("E"),t=new ct("C"),n=new ct("P")){super(e),this.columnAliasCache=t,this.parameterAliases=new dt(n)}getParams(){return this.parameterAliases}getNewFieldColumnAliases(){return new ut(this,this.columnAliasCache)}getExistingAlias(e){if(!this.hasAliasFor(e))throw new Error(`No alias found for entity ${e.__driver__.dbEntity.name}`);return this.aliasMap.get(e)}getOnlyAlias(){return 1!==this.aliasMap.size?"Expecting only 1 entry in Field's alias map":this.aliasMap.get(this.aliasMap.keys().next().value)}}class dt extends lt{constructor(e){super(e)}getNextAlias(e){if(this.hasAliasFor(e))return this.getExistingAlias(e).alias;let t=this.aliasCache.getFollowingAlias(),n={alias:t,value:e.value};return this.aliasMap.set(e,n),t}getExistingAlias(e){if(!this.hasAliasFor(e))throw new Error("No alias found for a parameter");return this.aliasMap.get(e)}getParameters(){let e={};return this.aliasMap.forEach(((t,n)=>{e[t.alias]=t})),e}}class ut extends lt{constructor(e,t){super(t),this._entityAliases=e}get entityAliases(){return this._entityAliases}getExistingAlias(e){if(!this.hasAliasFor(e)){const t=e;throw new Error(`No alias found for property ${t.dbProperty.entity.name}.${t.dbProperty.name}`)}return this.aliasMap.get(e)}}const ft=P("tarmaq-query"),yt=ft.token({class:null,interface:"IEntityUtils",token:"ENTITY_UTILS"}),ht=ft.token({class:null,interface:"IQueryUtils",token:"QUERY_UTILS"});function mt(e){let t;t=e instanceof Function?e():e;let n=W.getSync(yt).getQTree([],t);return n=It(t.SELECT,t,n,n,"f"),n}function It(e,t,n,i,o){let r=0;for(let a in e){let s=`${o}${++r}`,c=e[a];if(W.getSync(yt).isQField(c)){let e=c.getInstance(n);e.alias=s,e.q=n,i[a]=e}else{if(!(c instanceof Object)||c instanceof Date)throw new Error("All SELECT clause entries of a Mapped query must be Fields or Functions");i[c]=It(c,t,n,{},`${s}_`)}}return n}function Rt(e){let t;t=e instanceof Function?e():e;let n=t.SELECT;return n=n.addSubQuery(t),n}class Et{constructor(e){if(this.joinTo=e,!W.getSync(yt).isQEntity(this.joinTo))throw new Error("Right value in join must be a View or an Entity")}ON(e){return this.joinTo.__driver__.joinWhereClause=e(this.joinTo),this.joinTo}}function _t(e,t,n,i=[],o=null,r=null,a=gt){this.__driver__=new a(e,t,n,i,o,r,this)}_t.prototype.fullJoin=function(e){return this.__driver__.join(e,se.FULL_JOIN)},_t.prototype.INNER_JOIN=function(e){return this.__driver__.join(e,se.INNER_JOIN)},_t.prototype.LEFT_JOIN=function(e){return this.__driver__.join(e,se.LEFT_JOIN)},_t.prototype.RIGHT_JOIN=function(e){return this.__driver__.join(e,se.RIGHT_JOIN)},_t.prototype.equals=function(e){return W.getSync(ht).equals(e,this)},_t.prototype.in=function(e){return W.getSync(ht).in(e,this)};class gt{constructor(e,t,n,i=[],o=null,r=null,a){this.dbEntity=e,this.applicationUtils=t,this.relationManager=n,this.fromClausePosition=i,this.dbRelation=o,this.joinType=r,this.qEntity=a,this.childQEntities=[],this.entityFieldMap={},this.entityRelations=[],this.idColumns=[],this.allColumns=[],this.relations=[],this.currentChildIndex=-1}getInstance(){let e=new(this.applicationUtils.getQEntityConstructor(this.dbEntity))(this.dbEntity,this.applicationUtils,this.relationManager,this.fromClausePosition,this.dbRelation,this.joinType);return e.__driver__.currentChildIndex=this.currentChildIndex,e.__driver__.joinWhereClause=this.joinWhereClause,e.__driver__.entityFieldMap=this.entityFieldMap,e.__driver__.entityRelations=this.entityRelations,e}getRelationJson(e,t,n,i){let o={currentChildIndex:this.currentChildIndex,ti:this.dbEntity.index,fromClausePosition:this.fromClausePosition,jt:this.joinType,rt:null,rep:e.entityAliases.getNextAlias(this.getRootJoinEntity()),si:this.dbEntity.applicationVersion.application.index};return this.joinWhereClause?this.getJoinRelationJson(o,e,t,n,i):this.dbRelation?this.getEntityRelationJson(o):this.getRootRelationJson(o,e,t,n,i),o}getJoinRelationJson(e,t,n,i,o){return e.rt=le.ENTITY_JOIN_ON,e.joinWhereClause=n.whereClauseToJSON(this.joinWhereClause,t),e}getEntityRelationJson(e){return e.rt=le.ENTITY_APPLICATION_RELATION,e.ri=this.dbRelation.index,e}getRootRelationJson(e,t,n,i,o){return e.rt=W.getSync(yt).isQTree(this)?le.SUB_QUERY_ROOT:le.ENTITY_ROOT,e}getQ(){return this.qEntity}join(e,t){let n=e.__driver__.getInstance();n.__driver__.currentChildIndex=0;let i=this.relationManager.getNextChildJoinPosition(this);return n.__driver__.fromClausePosition=i,n.__driver__.joinType=t,n.__driver__.parentJoinEntity=this.qEntity,this.qEntity.__driver__.childQEntities.push(n),new Et(n)}isRootEntity(){return!this.parentJoinEntity}getRootJoinEntity(){let e=this.qEntity;for(;e.__driver__.parentJoinEntity;)e=e.__driver__.parentJoinEntity;return e}}class Tt{constructor(e,t,n){this.jsonRelation=e,this.childNodes=t,this.parentNode=n}addChildNode(e){let t=e.jsonRelation.fromClausePosition,n=t[t.length-1];this.childNodes[n]=e}getEntityRelationChildNode(e){return this.getEntityRelationChildNodeByIndexes(e.property.entity.applicationVersion._localId,e.property.entity.index,e.index)}getEntityRelationChildNodeByIndexes(e,t,n){let i=this.childNodes.filter((e=>e.jsonRelation.ri===n));switch(i.length){case 0:break;case 1:return i[0];default:throw new Error(`More than one child node matched relation property index '${n}'`)}let o,r=this.jsonRelation.fromClausePosition.slice();r.push(this.childNodes.length),o=this.parentNode?this.parentNode.jsonRelation.rep:this.jsonRelation.rep;let a={currentChildIndex:0,fromClausePosition:r,ti:t,jt:se.LEFT_JOIN,rt:le.ENTITY_APPLICATION_RELATION,rep:o,ri:n,si:e},s=new Tt(a,[],this);return this.addChildNode(s),s}}class Ot{constructor(e){this.category=e}}class At extends Ot{constructor(e){super(e),this.category=e}equals(e,t){return{c:this.category,l:e,o:me.EQUALS,r:t}}greaterThan(e,t){return{c:this.category,l:e,o:me.GREATER_THAN,r:t}}greaterThanOrEquals(e,t){return{c:this.category,l:e,o:me.GREATER_THAN_OR_EQUALS,r:t}}IS_NOT_NULL(e){return{c:this.category,l:e,o:me.IS_NOT_NULL}}IS_NULL(e){return{c:this.category,l:e,o:me.IS_NULL}}IN(e,t){return{c:this.category,l:e,o:me.IN,r:t}}lessThan(e,t){return{c:this.category,l:e,o:me.LESS_THAN,r:t}}lessThanOrEquals(e,t){return{c:this.category,l:e,o:me.LESS_THAN_OR_EQUALS,r:t}}notEquals(e,t){return{c:this.category,l:e,o:me.NOT_EQUALS,r:e}}NOT_IN(e,t){return{c:this.category,l:e,o:me.NOT_IN,r:t}}}const Nt=function(...e){return(new bt).AND(e)},xt=function(...e){return(new bt).OR(e)};class bt extends Ot{constructor(){super(null)}static verifyChildOps(e){if(!e||!e.length)throw new Error("No child operations provided")}AND(e){return{c:he.LOGICAL,o:me.AND,v:e}}OR(e){return{c:he.LOGICAL,o:me.OR,v:e}}NOT(e){return{c:he.LOGICAL,o:me.NOT,v:e}}}function wt(e,t,n,i){this.dbRelation=e,this.parentQ=t,this.applicationUtils=n,this.relationManager=i}function St(e,t,n,i){St.base.constructor.call(this,e,t,n,i)}wt.prototype.INNER_JOIN=function(){const e=this.getNewQEntity(se.INNER_JOIN);return this.parentQ.__driver__.childQEntities.push(e),e},wt.prototype.LEFT_JOIN=function(){const e=this.getNewQEntity(se.LEFT_JOIN);return this.parentQ.__driver__.childQEntities.push(e),e},wt.prototype.getNewQEntity=function(e){const t=this.dbRelation.relationEntity;let n=new(this.applicationUtils.getQEntityConstructor(this.dbRelation.relationEntity))(t,this.applicationUtils,this.relationManager,this.relationManager.getNextChildJoinPosition(this.parentQ.__driver__),this.dbRelation,e,this.applicationUtils,this.relationManager);return n.__driver__.parentJoinEntity=this.parentQ,n};function vt(e,t,n,i){vt.base.constructor.call(this,e,t,n,i)}Q(wt,St,{isNull(){return xt(this.actor._localId.isNull(),this.repository._localId.isNull(),this._actorRecordId.isNull())},isNotNull(){return Nt(this.actor._localId.isNotNull(),this.repository._localId.isNotNull(),this._actorRecordId.isNotNull())}});function Ct(e,t,n,i){Ct.base.constructor.call(this,e,t,n,i)}Q(wt,vt,{});function Dt(e=[],t){Dt.base.constructor.call(this,null,e,null,null,Mt),this.__driver__.subQuery=t}Q(St,Ct,{});Q(_t,Dt,{});class Mt extends gt{getInstance(){let e=super.getInstance();return e.__driver__.subQuery=this.subQuery,e}getJoinRelationJson(e,t,n,i,o){return(e=super.getJoinRelationJson(e,t,n,i,o)).rt=le.SUB_QUERY_JOIN_ON,e.subQuery=W.getSync(yt).getTreeQuery(this.subQuery,t.entityAliases).toJSON(n,i,o),e}getRootRelationJson(e,t,n,i,o){return(e=super.getJoinRelationJson(e,t,n,i,o)).rt=le.SUB_QUERY_ROOT,e.subQuery=W.getSync(yt).getTreeQuery(this.subQuery,t.entityAliases).toJSON(n,i,o),e}}class Vt extends At{constructor(){super(he.BOOLEAN)}}class Pt{constructor(e,t){this.field=e,this.sortOrder=t}toJSON(e){if(!e.hasAliasFor(this.field))throw new Error("Field used in ORDER_BY clause is not present in SELECT clause");return{fa:e.getExistingAlias(this.field),so:this.sortOrder}}toEntityJSON(){let e=this.field;return{fa:void 0,ci:e.dbColumn.index,pi:e.dbProperty.index,ti:e.dbProperty.entity.index,si:e.dbProperty.entity.applicationVersion._localId,so:this.sortOrder}}}class Lt{constructor(e,t,n,i){this.dbColumn=e,this.dbProperty=t,this.q=n,this.objectType=i,this.__appliedFunctions__=[]}applySqlFunction(e){let t=this.getInstance();return t.__appliedFunctions__.push(e),t}toJSON(e,t,n,i,o){let r,a;t&&(r=e.getNextAlias(this)),a=this.__fieldSubQuery__?e.entityAliases.getOnlyAlias():e.entityAliases.getExistingAlias(this.q.__driver__.getRootJoinEntity());let s={appliedFunctions:this.appliedFunctionsToJson(this.__appliedFunctions__,e,n,i,o),si:this.dbProperty.entity.applicationVersion._localId,ti:this.dbProperty.entity.index,fa:r,pi:this.dbProperty.index,ci:this.dbColumn.index,ta:o.getPositionAlias(a,this.q.__driver__.fromClausePosition),ot:this.objectType,dt:this.dbColumn.type};return this.__fieldSubQuery__&&(s.fieldSubQuery=i.getFieldQueryJson(this.__fieldSubQuery__,e.entityAliases,n),s.ot=ue.FIELD_QUERY),s}asc(){return new Pt(this,pe.ASCENDING)}desc(){return new Pt(this,pe.DESCENDING)}addSubQuery(e){let t=this.getInstance();return t.__fieldSubQuery__=e,t}operableFunctionToJson(e,t,n,i,o,r){let a;return n&&(a=t.getNextAlias(this)),{appliedFunctions:this.appliedFunctionsToJson(this.__appliedFunctions__,t,i,o,r),fa:a,ot:this.objectType,dt:this.dbColumn.type,v:this.valueToJSON(e,t,!1,!0,i,o,r)}}copyFunctions(e){return e.__appliedFunctions__=this.__appliedFunctions__.slice(),e}appliedFunctionsToJson(e,t,n,i,o){return e?e.map((e=>this.functionCallToJson(e,t,n,i,o))):e}functionCallToJson(e,t,n,i,o){let r;return e.p&&(r=e.p.map((e=>this.valueToJSON(e,t,!1,!1,n,i,o)))),{ft:e.ft,p:r}}valueToJSON(e,t,n,i,o,r,a){if(!e)throw new Error("Function object must be provided to valueToJSON function.");if(!i&&e instanceof Lt)return e.toJSON(t,n,o,r,a);let s=e.value;switch(typeof s){case"boolean":case"number":case"string":return t.entityAliases.getParams().getNextAlias(e);case"object":if(s instanceof Date)return t.entityAliases.getParams().getNextAlias(e);if(s instanceof Array)return t.entityAliases.getParams().getNextAlias(e);if(null===s)return t.entityAliases.getParams().getNextAlias(e);throw new Error("Unexpected query parameter type allowed types are:\nboolean | Date | Date[] | number | number[] | string | string[]\n");case"undefined":throw new Error("Undefined is not allowed as a query parameter");default:throw new Error("Unexpected query parameter type allowed types are:\nboolean | Date | Date[] | number | number[] | string | string[]\n")}}}class Ut extends Lt{constructor(e,t,n,i,o){super(e,t,n,i),this.operation=o}equals(e){return e instanceof Function&&(e=e()),this.operation.equals(this,e)}greaterThan(e){return e instanceof Function&&(e=e()),this.operation.greaterThan(this,e)}greaterThanOrEquals(e){return e instanceof Function&&(e=e()),this.operation.greaterThanOrEquals(this,e)}IS_NOT_NULL(){return this.operation.IS_NOT_NULL(this)}IS_NULL(){return this.operation.IS_NULL(this)}IN(e){return e instanceof Function&&(e=e()),this.operation.IN(this,e)}lessThan(e){return e instanceof Function&&(e=e()),this.operation.lessThan(this,e)}lessThanOrEquals(e){return e instanceof Function&&(e=e()),this.operation.lessThanOrEquals(this,e)}notEquals(e){return e instanceof Function&&(e=e()),this.operation.notEquals(this,e)}NOT_IN(e){return e=e.map((e=>e instanceof Function?e():e)),this.operation.NOT_IN(this,e)}}class jt extends Ut{constructor(e,t,n,i=ue.FIELD){super(e,t,n,i,new Vt)}getInstance(e=this.q){return this.copyFunctions(new jt(this.dbColumn,this.dbProperty,e,this.objectType))}}class Ft extends jt{constructor(e,t=!1){super({type:fe.BOOLEAN},null,null,ue.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Ft(this.value))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class Gt extends At{constructor(){super(he.DATE)}}class kt extends Ut{constructor(e,t,n,i=ue.FIELD){super(e,t,n,i,new Gt)}getInstance(e=this.q){return this.copyFunctions(new kt(this.dbColumn,this.dbProperty,e,this.objectType))}}class Bt extends kt{constructor(e,t=!1){super({type:fe.DATE},null,null,ue.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Bt(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class Ht extends At{constructor(){super(he.NUMBER)}}class $t extends Ut{constructor(e,t,n,i=ue.FIELD){super(e,t,n,i,new Ht)}getInstance(e=this.q){return this.copyFunctions(new $t(this.dbColumn,this.dbProperty,e,this.objectType))}}class qt extends $t{constructor(e,t=!1){super({type:fe.NUMBER},null,null,ue.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new qt(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class Yt extends At{constructor(){super(he.STRING)}LIKE(e,t){return{c:this.category,l:e,o:me.LIKE,r:t}}}class Qt extends Ut{constructor(e,t,n,i=ue.FIELD){super(e,t,n,i,new Yt)}getInstance(e=this.q){return this.copyFunctions(new Qt(this.dbColumn,this.dbProperty,e,this.objectType))}LIKE(e){return e instanceof Function&&(e=e()),this.operation.LIKE(this,e)}}class Wt extends Qt{constructor(e,t=!1){super({type:fe.STRING},null,null,ue.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Wt(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class zt extends Lt{constructor(){super(null,null,null,ue.FIELD_FUNCTION),this.value=null}getInstance(){return this.copyFunctions(new zt)}toJSON(e,t,n,i,o){return this.operableFunctionToJson(this,e,t,n,i,o)}}const Jt=function(e){if("boolean"!=typeof e)throw new Error("bool() accepts booleans only.");return new Ft(e)},Kt=function(e){if(!(e instanceof Date))throw new Error("date() accepts Dates only.");return new Bt(e)},Zt=function(e){if("number"!=typeof e)throw new Error("num() accepts numbers only.");return new qt(e)},Xt=function(e){if("string"!=typeof e)throw new Error("str() accepts strings only.");return new Wt(e)};function en(e){switch(typeof e){case"boolean":return Jt(e);case"number":return Zt(e);case"string":return Xt(e);case"undefined":throw new Error("Cannot use an 'undefined' value in an operation.")}return null===e?new zt:e instanceof Date?Kt(e):e}function tn(e,t,n,i){if(e.indexOf(typeof i)<-1){const i=e.join(", ");throw new Error(`Unexpected typeof value for row: ${n+1}, column: ${nn(t)}.  Expecting: ${i}`)}}function nn(e){return e.name?e.name:e.propertyColumns[0].property.name}function on(e,t){return t&&(t=t.map((e=>{switch(typeof e){case"boolean":return Jt(e);case"number":return Zt(e);case"string":return Xt(e);case"undefined":throw new Error("'undefined' cannot be used as a function parameter")}return e instanceof Date?Kt(e):e}))),{ft:e,p:t}}function rn(e){switch(typeof e){case"boolean":return new Ft(e);case"number":return new qt(e);case"string":return new Wt(e)}if(e instanceof Date)return new Bt(e);let t=e.SELECT;if(t instanceof ln&&(t=t.getSelectClause()),t instanceof jt)return new Ft(e);if(t instanceof kt)return new Bt(e);if(t instanceof $t)return new qt(e);if(t instanceof Qt)return new Wt(e);throw new Error("Function rValue must be a primitive, Date, Field or Field query")}const an=function(e){return e instanceof Ut?e.applySqlFunction(on(de.MAX)):rn(e).applySqlFunction(on(de.MAX))},sn=function(e,t){return e instanceof $t?e.applySqlFunction(on(de.PLUS,[t])):new qt(e).applySqlFunction(on(de.PLUS,[t]))};class cn{}class ln extends cn{constructor(e){super(),this.selectClause=e,this.__appliedFunctions__=[]}static getSelect(e){return e.__appliedFunctions__[0].p[0]}applySqlFunction(e){return this.__appliedFunctions__.push(e),this}getSelectClause(){return this.selectClause}toJSON(e){if(1!=this.__appliedFunctions__.length)throw new Error('Not expecting and parent or child functions on "distinct"');if(!this.selectClause)throw new Error('SELECT clause is missing in "distinct" function.');return{appliedFunctions:[on(de.DISTINCT)],dt:null,fa:null,ot:ue.DISTINCT_FUNCTION,v:e}}}class pn extends cn{constructor(e){super(),this.subQuery=e,this.__appliedFunctions__=[],this.operator=me.EXISTS,this.o=me.EXISTS,this.category=he.FUNCTION,this.c=he.FUNCTION}applySqlFunction(e){return this.__appliedFunctions__.push(e),this}getQuery(){return this.subQuery}toJSON(e){if(1!=this.__appliedFunctions__.length)throw new Error('Not expecting and parent or child functions on "exists"');if(!this.subQuery)throw new Error('Subquery is not defined in "exists" function.');let t=[on(de.EXISTS)];return{c:this.category,ob:{appliedFunctions:t,dt:null,ot:ue.EXISTS_FUNCTION,v:e},o:this.operator}}}const dn=function(...e){throw new Error("not implemented")};class un extends At{constructor(){super(he.UNTYPED)}LIKE(e,t){return{c:this.category,l:e,o:me.LIKE,r:t}}}class fn extends Ut{constructor(e,t,n,i=ue.FIELD){super(e,t,n,i,new un)}getInstance(e=this.q){return this.copyFunctions(new fn(this.dbColumn,this.dbProperty,e,this.objectType))}like(e){return e instanceof Function&&(e=e()),this.operation.LIKE(this,e)}}class yn{constructor(e=new pt,t=e.getNewFieldColumnAliases()){this.entityAliases=e,this.columnAliases=t,this.isEntityQuery=!1}getParameters(){return this.entityAliases.getParams().getParameters()}getNonEntityQuery(e,t,n,i,o,r){let a=this.fromClauseToJSON(e.FROM,i,o,r);return t.F=a,n&&n(t),t.W=i.whereClauseToJSON(e.WHERE,this.columnAliases),t.GB=this.groupByClauseToJSON(e.GROUP_BY),t.H=i.whereClauseToJSON(e.HAVING,this.columnAliases),t.OB=this.orderByClauseToJSON(e.ORDER_BY),t.L=e.LIMIT,t.O=e.OFFSET,t}fromClauseToJSON(e,t,n,i){if(!e){if(this.isEntityQuery)return[];throw new Error("From clause must be present in a non-Entity based query.")}return e.map((e=>{if(!W.getSync(yt).isQEntity(e))throw new Error("FROM clause can contain only Views or Entities.");if(this.isEntityQuery&&W.getSync(yt).isQTree(e))throw new Error("Entity FROM clauses can contain only Entities.");return e.__driver__.getRelationJson(this.columnAliases,t,n,i)}))}groupByClauseToJSON(e){return e&&e.length?e.map((e=>{if(!this.columnAliases.hasAliasFor(e))throw new Error("Field used in group by clause is not present in SELECT clause");return{fa:this.columnAliases.getExistingAlias(e)}})):null}orderByClauseToJSON(e){return e&&e.length?e.map((e=>e.toJSON(this.columnAliases))):null}}class hn extends yn{constructor(e,t){super(),this.rawInsertValues=e,this.columnIndexes=t}validateColumn(e,t,n){if(!e)throw new Error(`\n\t\tCould not find column ${n} in entity: ${t.name}\n\t\t\t\t(table: ${t.tableConfig.name})\n\t\t\t\t\t\t`);if(e.entity.applicationVersion.application.index!==t.applicationVersion.application.index||e.entity.index!==t.index){const n=e.entity.applicationVersion.application,i=t.applicationVersion.application;throw new Error(`Unexpected entity for column ${e.name}.\n\t\t\tExpecting:\n\t\t\t\tDomain: ${i.domain.name}\n\t\t\t\tApplication: ${i.name}\n\t\t\t\tEntity: ${t.name}\n\t\t\tFound:\n\t\t\t\tDomain: ${n.domain.name}\n\t\t\t\tApplication: ${n.name}\n\t\t\t\tEntity: ${e.entity.name}`)}}valuesToJSON(e,t,n,i,o){return e.map(((e,r)=>e.map(((e,a)=>{if(void 0===e)throw new Error("Cannot use 'undefined' in VALUES clause.");return e instanceof Lt?e.toJSON(this.columnAliases,!1,n,i,o):function(e,t,n,i=!0){switch(t.type){case fe.ANY:tn(["boolean","number","object","string"],t,n,e);break;case fe.BOOLEAN:tn(["boolean"],t,n,e);break;case fe.DATE:tn(["number","object"],t,n,e);break;case fe.JSON:tn(["object"],t,n,e);break;case fe.NUMBER:tn(["number"],t,n,e);break;case fe.STRING:tn(["string"],t,n,e);break;default:throw new Error("Unexpected SQLDataType: "+t.type)}switch(typeof e){case"boolean":return e?1:0;case"number":case"string":return e;case"object":if(null===e)return e;if(e instanceof Date){if(t.type!==fe.DATE)throw new Error(`Unexpected Date object for row: ${n+1}, column: ${nn(t)}`);return i?e.getTime():e}if(t.type!==fe.JSON)throw new Error(`Unexpected Json object for row: ${n+1}, column: ${nn(t)}`);return JSON.stringify(e);case"undefined":throw new Error("Cannot use an 'undefined' value in an operation.");default:throw new Error("Unexpected object in operation.")}}(e,t[a],r)}))))}}class mn extends yn{constructor(e){super(),this.rawUpdate=e}toJSON(e,t,n){return{U:this.rawUpdate.UPDATE.__driver__.getRelationJson(this.columnAliases,e,t,n),S:this.setToJSON(this.rawUpdate.SET,e,t,n),W:e.whereClauseToJSON(this.rawUpdate.WHERE,this.columnAliases)}}}class In extends yn{constructor(e){super(),this.rawDelete=e}toJSON(e,t,n){return{DF:this.rawDelete.DELETE_FROM.__driver__.getRelationJson(this.columnAliases,e,t,n),W:e.whereClauseToJSON(this.rawDelete.WHERE,this.columnAliases)}}}const Rn='Unsupported entry in Non-Entity SELECT clause, must be a(n): Entity Field | ManyToOne Relation | primitive wrapped by "bool","date","num","str" | query wrapped by "field"';class En extends yn{constructor(e){super(e),this.isHierarchicalEntityQuery=!1}selectClauseToJSON(e,t,n,i){if(e instanceof ln){if(this.isHierarchicalEntityQuery)throw new Error("Distinct cannot be used in SELECT of Hierarchical/Bridged Entity queries.");let o=e.getSelectClause(),r=this.nonDistinctSelectClauseToJSON(o,t,n,i);return e.toJSON(r)}return this.nonDistinctSelectClauseToJSON(e,t,n,i)}}class _n extends En{nonDistinctSelectClauseToJSON(e,t,n,i){let o={};for(let r in e){let a=e[r];if(a instanceof Lt){if(this.isEntityQuery)throw new Error("Entity SELECT clauses can only contain fields assigned: null | undefined | boolean | Date | number | string | Relation SELECT");o[r]=a.toJSON(this.columnAliases,!0,t,n,i)}else{if(a instanceof vt||a instanceof Ct)throw new Error("@OneToMany relation objects can cannot be used in SELECT clauses");{let e=!1;try{switch(typeof a){case"boolean":case"number":case"string":case"undefined":continue;case"object":a instanceof Date||null===a||(e=!0,o[r]=this.nonDistinctSelectClauseToJSON(a,t,n,i))}}finally{if(!e&&!this.isEntityQuery)throw new Error(Rn)}}}}return o}}class gn extends _n{constructor(e){super(),this.rawQuery=e,this.isEntityQuery=!0,this.isHierarchicalEntityQuery=!0}toJSON(e,t,n){return{S:this.selectClauseToJSON(this.rawQuery.SELECT,e,t,n),F:this.fromClauseToJSON(this.rawQuery.FROM,e,t,n),forUpdate:this.rawQuery.FOR_UPDATE,W:e.whereClauseToJSON(this.rawQuery.WHERE,this.columnAliases),OB:this.orderByClauseToJSON(this.rawQuery.ORDER_BY)}}nonDistinctSelectClauseToJSON(e){for(let t in e){let n=e[t];if(n instanceof Lt)throw new Error("Field References cannot be used in Entity Queries");n instanceof Object&&!(n instanceof Date)&&this.nonDistinctSelectClauseToJSON(n)}return e}orderByClauseToJSON(e){return e&&e.length?e.map((e=>e.toEntityJSON())):null}}class Tn extends En{constructor(e,t=new pt){super(t),this.rawQuery=e}nonDistinctSelectClauseToJSON(e,t,n,i){if(!(this.rawQuery.SELECT instanceof Lt))throw new Error(Rn);return this.columnAliases.entityAliases.getNextAlias(this.rawQuery.SELECT.q.__driver__.getRootJoinEntity()),this.rawQuery.SELECT.toJSON(this.columnAliases,!0,t,n,i)}toJSON(e,t,n){let i={S:this.selectClauseToJSON(this.rawQuery.SELECT,e,t,n),forUpdate:this.rawQuery.FOR_UPDATE,ot:ue.FIELD_QUERY,dt:this.getClauseDataType()};return this.getNonEntityQuery(this.rawQuery,i,null,e,t,n)}getClauseDataType(){let e=this.rawQuery.SELECT;if(e instanceof ln&&(e=e.getSelectClause()),e instanceof jt)return fe.BOOLEAN;if(e instanceof kt)return fe.DATE;if(e instanceof $t)return fe.NUMBER;if(e instanceof Qt)return fe.STRING;if(e instanceof fn)return fe.ANY;throw new Error("Unsupported type of SELECT field in Field Query")}}class On extends hn{toJSON(e,t,n){const i=this.rawInsertValues.INSERT_INTO.__driver__,o=i.getRelationJson(this.columnAliases,e,t,n),r=i.dbEntity.columnMap,a=[];return{II:o,C:this.columnIndexes?this.columnIndexes:this.rawInsertValues.columns.map((e=>{const t=r[e];return this.validateColumn(t,i.dbEntity,e),a.push(t),t.index})),V:this.valuesToJSON(this.rawInsertValues.VALUES,a,e,t,n)}}}class An extends hn{toJSON(e,t,n){const i=this.rawInsertValues.INSERT_INTO.__driver__,o=i.getRelationJson(this.columnAliases,e,t,n),r=[];let a;if(this.columnIndexes){a=this.columnIndexes;for(let e=0;e<a.length;e++){const t=i.dbEntity.columns[a[e]];this.validateColumn(t,i.dbEntity),r.push(t)}}else a=this.rawInsertValues.columns.map((e=>{const t=e.dbColumn;return this.validateColumn(t,i.dbEntity),r.push(t),t.index}));return{II:o,C:a,V:this.valuesToJSON(this.rawInsertValues.VALUES,r,e,t,n)}}}class Nn extends En{constructor(e){super(),this.rawQuery=e}nonDistinctSelectClauseToJSON(e,t,n,i){if(!(e instanceof Array))throw new Error("Flat Queries an array of fields in SELECT clause.");return e.map((e=>{if(!(e instanceof Lt))throw new Error(Rn);return this.columnAliases.entityAliases.getNextAlias(e.q.__driver__.getRootJoinEntity()),e.toJSON(this.columnAliases,!0,t,n,i)}))}toJSON(e,t,n){let i={S:this.selectClauseToJSON(this.rawQuery.SELECT,e,t,n),forUpdate:this.rawQuery.FOR_UPDATE};return this.getNonEntityQuery(this.rawQuery,i,null,e,t,n)}}class xn extends _n{constructor(e,t=new pt){super(t),this.rawQuery=e}toJSON(e,t,n){return this.getNonEntityQuery(this.rawQuery,{},(i=>{i.S=this.selectClauseToJSON(this.rawQuery.SELECT,e,t,n),i.forUpdate=this.rawQuery.FOR_UPDATE}),e,t,n)}}class bn extends mn{constructor(e){super(e)}setToJSON(e,t,n,i){const o={},r=this.rawUpdate.UPDATE.__driver__.dbEntity,a=r.columnMap,s=r.idColumnMap;for(const c in e){let l=e[c];if(void 0!==l){if(!a[c])throw new Error(`\n\tUnknown column: '${c}' for entity: '${r.name}'\n\t\t\t(table: '${r.tableConfig.name}').\n\t\t\t\t`);if(s[c])throw new Error(`\n\tCannot update @Id columns:\n\tColumn: '${c}' for entity: '${r.name}'\n\t\t\t(table: '${r.tableConfig.name}').\n\t\t\t\t`);if(l=en(l),!l.toJSON)throw`Unexpected value ${JSON.stringify(l)} for property ${c} of entity ${r.name}`;o[c]=l.toJSON(this.columnAliases,!1,t,n,i)}else delete e[c]}return o}}class wn extends mn{constructor(e){super(e)}toJSON(e,t,n){return{U:this.rawUpdate.UPDATE.__driver__.getRelationJson(this.columnAliases,e,t,n),S:this.setToJSON(this.rawUpdate.SET,e,t,n),W:e.whereClauseToJSON(this.rawUpdate.WHERE,this.columnAliases)}}setToJSON(e,t,n,i){const o={},r=this.rawUpdate.UPDATE.__driver__.dbEntity.propertyMap;return this.setEntityFragmentsToJSON(e,o,[],r,[],t,n,i),o}setEntityFragmentsToJSON(e,t,n,i,o,r,a,s){const c=!i.length;for(const l in e){const p=i[l],d=p.entity;if(!p)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tUnknown property: '${l}' for entity: '${d.name}'\n\t\t\t(table: '${d.tableConfig.name}').\n\t\t\t\t`);if(c&&p.isId)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update @Id properties:\n\tProperty: '${l}' for entity: '${d.name}'\n\t\t\t(table: '${d.tableConfig.name}').\n\t\t\t\t`);if(!c&&!p.isId)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tUpdated properties of nested entities must be @Id properties:\n\tProperty: '${l}' for entity: '${d.name}'\n\t\t\t(table: '${d.tableConfig.name}').\n\t\t\t\t`);const u=[...n];u.push(p),this.setFragmentToJSON(e,t,u,l,o,r,a,s)}}setFragmentToJSON(e,t,n,i,o,r,a,s){const c=n[n.length-1],l=c.entity;let p=e[i];if(void 0!==p){if(p=en(p),p.toJSON){if(1!==c.propertyColumns.length)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update multi-column property to a single value:\n\tProperty: '${i}' for entity: '${l.name}'\n\t\t\t(table: '${l.tableConfig.name}')\n\t\t\thas ${c.propertyColumns.length+1} columns \n\t\t\tbut is being updates to a single value.\n\t\t\t\t`);{let e=c.propertyColumns[0].column;if(o.length)for(let t=o.length-1;t>=0;t--){const n=o[t].manyRelationColumns.filter((t=>t.manyColumn.index===e.index))[0];e=n.oneColumn}if(t[e.name]){const t=n[0];throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update the same column multiple times in the same statement:\n\tProperty: '${i}' for entity: '${l.name}'\n\t\t\t(table: '${l.tableConfig.name}')\n\tmaps to table: ${t.entity.tableConfig.name}, column: ${e.name}\n\t\twhich has already been set in this update statement (above).\n\t\t\t\t`)}return void(t[e.name]=p.toJSON(this.columnAliases,!1,r,a,s))}}if("object"!=typeof p)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tUnexpected value ${JSON.stringify(p)} \n\t\t\t\t\tfor property: '${i}' of entity: '${this.rawUpdate.UPDATE.__driver__.dbEntity.name}'\n\t\t\t\tExpecting a nested property definition.\n\t\t\t\t`);{const e=c.relation[0],l=[...o];switch(l.push(e),e.relationType){case ce.MANY_TO_ONE:this.setEntityFragmentsToJSON(p,t,n,e.relationEntity.propertyMap,l,r,a,s);break;case ce.ONE_TO_MANY:throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tCannot update @OneToMany properties:\n\t\t\t\t\tProperty: '${i}' of entity: '${this.rawUpdate.UPDATE.__driver__.dbEntity.name}\n\t\t\t\t\tis a @OneToMany relation and cannot be updated since it is\n\t\t\t\t\tassumed to be based on @Id columns (which cannot be updated).'\n\t\t\t\t`);default:throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tUndefined relation type: \n\t\t\t\t\tProperty: '${i}' of entity: '${this.rawUpdate.UPDATE.__driver__.dbEntity.name}'\n\t\t\t\t\tis defined with an unknown type of a relation.  Expecting either\n\t\t\t\t\t@ManyToOne(...)\n\t\t\t\t\tor\n\t\t\t\t\t@OneToMany(...)\n\t\t\t\t`)}}}else delete e[i]}getPropertyChainDesription(e){let t="    ",n="",i="...\n}",o=`\nUpdated Entity: ${e[0].entity.name}, property chain:\n{`;const r=e.length;for(let a=0;a<r;a++){o+=`${t}${e[a].name}: `,o+=a+1<r?": {\n":"VALUE",i=t+`...\n${n}}`,n=t,t+="    "}return`${o}\n${i}`}}var Sn,vn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Cn=Sn=class{getDbEntity(e,t){return this.airportDatabase.applications[e].currentVersion[0].applicationVersion.entities[t]}isActorId(e){return e===ae.ACTOR_LID}isActorRecordId(e){return e===ae.ACTOR_RECORD_ID}isRepositoryId(e){return e===ae.REPOSITORY_LID}doCascade(e,t){if(e.relationType!==ce.ONE_TO_MANY)return!1;if(!e.oneToManyElems)return!1;switch(t){case Ie.CREATE:case Ie.UPDATE:case Ie.DELETE:return!0;default:throw new Error(`Unsupported CRUDOperation '${t}' for cascade check.`)}}getQEntityConstructor(e){return this.airportDatabase.qApplications[e.applicationVersion.application.index].__qConstructors__[e.index]}getEntityConstructor(e){return this.airportDatabase.qApplications[e.applicationVersion.application.index].__constructors__[e.name]}getNewEntity(e){const t=this.getEntityConstructor(e);return t?new t:{}}isIdEmpty(e){return!e&&0!==e}isEmpty(e){return this.isIdEmpty(e)&&!1!==e&&""!==e}isRelationColumn(e){return this.isManyRelationColumn(e)||this.isOneRelationColumn(e)}isManyRelationColumn(e){return!(!e.manyRelationColumns||!e.manyRelationColumns.length)}isOneRelationColumn(e){return!(!e.oneRelationColumns||!e.oneRelationColumns.length)}getIdKey(e,t,n=!0,i){return this.getIdKeyInfo(e,t,n,i).arrayByIdColumnIndex.join("|")}getIdKeyInfo(e,t,n=!0,i){if(!t.idColumns.length){if(n)throw new Error(`@Id is not defined on entity '${t.name}'.`);return null}const o={arrayByIdColumnIndex:[],mapByIdColumnName:{}};for(const r of t.idColumns){const[a,s]=this.getColumnPropertyNameChainsAndValue(t,r,e,!0,n);i&&i(r,s,a),o.arrayByIdColumnIndex.push(s),o.mapByIdColumnName[r.name]=s}return o}getColumnPropertyNameChainsAndValue(e,t,n,i=!1,o=!0){const r=this.getColumnValuesAndPaths(t,n,[],i,o),a=r[0],s=[a.path],c=a.value;return r.reduce(((n,i)=>{if(!this.utils.valuesEqual(n.value,i.value,!0))throw new Error(`Values differ for ${e.name}.${t.name}:\n\t\t\t\t\t\t'${n.path.join(".")}' = ${n.value}\n\t\t\t\t\t\t'${i.path.join(".")}' = ${i.value}`);return s.push(i.path),i})),[s,c]}addRelationToEntitySelectClause(e,t,n=!1){this.forEachColumnTypeOfRelation(e,((i,o)=>{let r=!0,a=t;const s=o[0];s.forEach(((t,i)=>{let o=a[t];if(o)if(i<s.length-1){if(!(o instanceof Object)||o instanceof Date)throw new Error(`Invalid entry:\n\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t\t${t}: ${o}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tin '${e.property.entity.name}.${e.property.name}',\n\t\t\t\t\t\t\t\tProperty must be an Object.`)}else{if(!n&&!it(o)){const n=e.property.isId?`'${e.property.entity.name}.${e.property.name}' is an @Id property`:`'${e.property.entity.name}' has no @Id - all properties are treated as @Ids`;throw new Error(`Defaults are not allowed in:\n\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t\t${t}: ${o}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t${n}.`)}r=!1}else o={},this.entityStateManager.markAsStub(o),a[t]=o;a=o})),r&&(a.airportSelectField=!0)}))}forEachColumnOfRelation(e,t,n,i=!0){const o=e.property.entity;for(const i of e.manyRelationColumns){const e=i.manyColumn,[r,a]=this.getColumnPropertyNameChainsAndValue(o,e,t);if(n(e,a,r))return}}forEachColumnTypeOfRelation(e,t){for(const n of e.manyRelationColumns){const e=n.manyColumn;if(t(e,this.getColumnPaths(e,[])))return}}getSheetSelectFromSetClause(e,t,n,i){const o=[];let r,a,s,c;for(const l in e.columns){const p=e.columns[l];let d;let u=!1;if(p.propertyColumns.some((e=>(d=e.property,d.isId)))){if(n[p.name])throw new Error(i+`Cannot update @Id column '${p.name}' \nof property '${e.name}.${d.name}'.`);this.addColumnToSheetSelect(p,t,o)}else n[p.name]&&(u=!0,this.addColumnToSheetSelect(p,t,o));const f=o.length-1;switch(p.name){case ae.ACTOR_LID:r=f;break;case ae.ACTOR_RECORD_ID:a=f;break;case ae.REPOSITORY_LID:s=f;break;case ae.SYSTEM_WIDE_OPERATION_ID:if(u)throw new Error(i+"Cannot update 'systemWideOperationId' of Repository Entities.");c=p}}return{actorIdColumnIndex:r,actorRecordIdColumnIndex:a,repositoryIdColumnIndex:s,selectClause:o,systemWideOperationIdColumn:c}}getColumnValuesAndPaths(e,t,n,i=!1,o=!0){if(this.isManyRelationColumn(e)){let o=[];for(const r of e.manyRelationColumns){const e=r.manyRelation.property,a=[...n],s=e.name;a.push(s);const c=t[s];if(c){const e=r.oneColumn,t=this.getColumnValuesAndPaths(e,c,a,i);o=o.concat(t)}else{if(i)throw new Error(`Cannot retrieve composite Id value, value chain '${a.join(".")}' is : ${c}.`);o.push({path:a,value:c})}}return o}{const r=e.propertyColumns[0].property,a=[...n],s=r.name;a.push(s);let c=t[s];if(i&&this.isIdEmpty(c)){if(!e.isGenerated)throw new Error(`Cannot retrieve composite Id value, value chain '${a.join(".")}' is : ${c}.`);c=o?--Sn.TEMP_ID:null,t[s]=c}return[{path:a,value:c}]}}getColumnPaths(e,t){let n=[];if(this.isManyRelationColumn(e))for(const i of e.manyRelationColumns){const e=i.manyRelation.property,o=[...t];o.push(e.name);const r=i.oneColumn,a=this.getColumnPaths(r,o);n=n.concat(a)}else{const i=e.propertyColumns[0].property,o=[...t];o.push(i.name),n.push(o)}return n}addColumnToSheetSelect(e,t,n){if(this.isManyRelationColumn(e)){const i=this.getColumnPaths(e,[])[0];let o=t[i[0]];i.reduce(((e,t)=>(o=o[t],t))),n.push(o)}else n.push(t[e.propertyColumns[0].property.name])}handleNoId(e,t,n,i,o){if(!o)throw new Error(`Cannot retrieve composite Id value, value chain '${n.join(".")}' is : ${i}.`);return!o(e,i,n)}};Cn.TEMP_ID=0,vn([function(e,t){}],Cn.prototype,"airportDatabase",void 0),vn([function(e,t){}],Cn.prototype,"entityStateManager",void 0),vn([function(e,t){}],Cn.prototype,"utils",void 0),Cn=Sn=vn([function(e){}],Cn);var Dn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Mn=class{getObjectClassName(e){if("object"!=typeof e||null===e)throw new Error("Not an object instance");return this.getClassName(e.constructor)}getClassName(e){if("function"!=typeof e)throw new Error("Not a constructor function");return e.name}exists(e){return this.utils.objectExists(e)}isAppliable(e){return e instanceof Ut}getQuery(e){return this.getRawQuery(e)}ensureId(e){let t=this.getRawQuery(e);return this.ensureIdAtLevel(t.SELECT,t.FROM[0]),t}ensureIdAtLevel(e,t){for(const n in e){const i=e[n];if(i instanceof Object&&"boolean"!=typeof i.airportSelectField&&!i.__allFields__){let e;for(const i of t.__driver__.childQEntities)if(i.__driver__.dbRelation.property.name===n){e=i;break}e&&this.ensureIdAtLevel(i,e)}}if(!e.id)return;let n=e.repository;if(n){if(!(n instanceof Object))throw new Error("id queries must include a repository object in the SELECT clause.\nIt must be an Object with the id property.");n.GUID=tt}let i=e.actor;if(i){if(!(i instanceof Object))throw new Error("id queries must include an actor object in the SELECT clause.\nIt must be an Object with the id property.");i.GUID=tt}e._actorRecordId=tt,this.ensureRepositoryAndActorJoin(t)}ensureRepositoryAndActorJoin(e){let t,n,i=!1,o=!1;for(const r of e.__driver__.childQEntities)"actor"===r.__driver__.dbRelation.property.name&&(o=!0,t=r),"repository"===r.__driver__.dbRelation.property.name&&(i=!0,n=r);return o||(t=e.actor.LEFT_JOIN()),i||(n=e.repository.LEFT_JOIN()),{qActor:t,qRepository:n}}findActorQEntity(){}getRawQuery(e){return e instanceof Function?e():e}getEntityQuery(e){return new gn(this.getRawQuery(e))}getTreeQuery(e,t){return new xn(e,t)}isQEntity(e){return e instanceof _t}isQTree(e){return e instanceof Mt}getQTree(e,t){return new Dt(e,t)}isQField(e){return e instanceof Lt}};Dn([function(e,t){}],Mn.prototype,"utils",void 0),Mn=Dn([function(e){}],Mn),yt.setClass(Mn);var Vn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Pn=class{getFieldQueryJson(e,t,n){return new Tn(e,t).toJSON(n,this,this.relationManager)}};Vn([function(e,t){}],Pn.prototype,"relationManager",void 0),Pn=Vn([function(e){}],Pn);var Ln=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Un=class{getAllColumns(e){return e.__driver__.allColumns}getAllNonGeneratedColumns(e){return this.getAllColumns(e).filter((e=>!e.dbColumn.isGenerated))}getAllInsertableColumns(e){return this.getAllColumns(e).filter((t=>{if(t.dbColumn.isGenerated)return!1;if(e.__driver__.dbEntity.isAirEntity)switch(t.dbColumn.name){case ae.SYSTEM_WIDE_OPERATION_ID:return!1}return!0}))}getDbEntity(e){return e.__driver__.dbEntity}getNewEntity(e,t){const n=e.__driver__.dbEntity,i=t.qApplications[n.applicationVersion.application.index].__constructors__[n.name];return i?new i:{}}};function jn(e,t,n,i){switch(i.type){case fe.ANY:return new fn(i,t,n);case fe.BOOLEAN:return new jt(i,t,n);case fe.DATE:return new kt(i,t,n);case fe.NUMBER:return new $t(i,t,n);case fe.JSON:case fe.STRING:return new Qt(i,t,n);default:throw new Error(`Unsupported data type for property ${e.applicationVersion.application.name}.${e.name}.${t.name}`)}}function Fn(e){var t=function(n,i,o,r,a,s){t.base.constructor.call(this,n,i,o,r,a,s),n.properties.forEach((t=>{let r;if(t.relation&&t.relation.length){r=function(e,t,n,i,o,r){const a=t.relation[0];switch(a.relationType){case ce.MANY_TO_ONE:const t=a.relationEntity;return new(0,i[t.applicationVersion.application.index].__qIdRelationConstructors__[t.index])(a.relationEntity,a,n,o,r);case ce.ONE_TO_MANY:return e.isAirEntity?new Ct(a,n,o,r):new vt(a,n,o,r);default:throw new Error(`Unknown EntityRelationType: ${a.relationType}.`)}}(n,t,this,e,i,o);for(const e of t.propertyColumns)Gn(n,t,this,e.column)}else r=Gn(n,t,this,t.propertyColumns[0].column);this[t.name]=r}))};return Q(_t,t,{}),t}function Gn(e,t,n,i){const o=jn(e,t,n,i);return n.__driver__.allColumns[i.index]=o,(i.idIndex||0===i.idIndex)&&(n.__driver__.idColumns[i.idIndex]=o),o}function kn(e){function t(e,n,i,o,r){t.base.constructor.call(this,n,i,o,r),Bn(this,e,i,n.property)}const n={};return e.isAirEntity?Q(St,t,n):Q(wt,t,n),t}function Bn(e,t,n,i,o){if(!o){const e=i.relation[0].manyRelationColumns;o=new Map;for(const t of e)o.set(t.oneColumn,t.manyColumn)}return t.properties.forEach((r=>{if(!r.isId)return;let a;if(r.relation&&r.relation.length){const e=r.relation[0],t=e.manyRelationColumns;for(const e of t){const t=o.get(e.manyColumn);o.delete(e.manyColumn),o.set(e.oneColumn,t)}a=Bn({},e.relationEntity,n,i,o)}else{const e=o.get(r.propertyColumns[0].column);a=jn(t,i,n,e)}e[r.name]=a})),e}function Hn(e,t,n,i,o){t.__qIdRelationConstructors__=[],t.__qConstructors__={},e.currentVersion[0].applicationVersion.entities.forEach((e=>{for(const t of e.idColumns)if(t.manyRelationColumns&&t.manyRelationColumns.length){const i=t.manyRelationColumns[0].oneColumn,o=i.entity;if(!n[o.applicationVersion.application.index])throw new Error(`QApplication not yet initialized for ID relation:\n\t\t\t\t\t${e.name}.${i.name}\n\t\t\t\t\t`)}const r=kn(e);t.__qIdRelationConstructors__[e.index]=r;const a=Fn(n);t.__qConstructors__[e.index]=a,Object.getOwnPropertyNames(t).filter((t=>t===e.name)).length||Object.defineProperty(t,e.name,{get:function(){return new this.__qConstructors__[e.index](e,i,o)}})}))}function $n(e,t,n){return!!e.dependencies.has(t)}Un=Ln([function(e){}],Un);var qn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yn=class{equals(e,t){if(!e)throw new Error("null entity/Id is passed into 'equals' method");const{qActor:n,qRepository:i}=this.entityUtils.ensureRepositoryAndActorJoin(t);if(e instanceof _t){const o=this.entityUtils.ensureRepositoryAndActorJoin(e);return Nt(i.GUID.equals(o.qRepository.repository.GUID),n.GUID.equals(o.qActor.actor.GUID),t._actorRecordId.equals(e._actorRecordId))}{let o=this.validateEntityId(e);return Nt(i.GUID.equals(o.repository.GUID),n.GUID.equals(o.actor.GUID),t._actorRecordId.equals(o._actorRecordId))}}in(e,t){if(!e||!e.length)throw new Error("null entity/Id array is passed into 'in' method");let n=e.map((e=>this.validateEntityId(e)));const{qActor:i,qRepository:o}=this.entityUtils.ensureRepositoryAndActorJoin(t),r=[];for(const e of n)r.push(Nt(o.GUID.equals(e.repository.GUID),i.GUID.equals(e.actor.GUID),t._actorRecordId.equals(e._actorRecordId)));return xt(...r)}validateEntityId(e){if("string"==typeof e)return this.airEntityUtils.parseEGUID(e);if(!(e.repository&&e.repository.GUID&&"string"==typeof e.repository.GUID&&e.actor&&e.actor.GUID&&"number"==typeof e.actor.GUID&&e._actorRecordId&&"number"==typeof e._actorRecordId))throw new Error("Passed in AirEntity does not have\n\t\t\t\tthe necessary fields to query by id.  Expecting:\n\t\t\t\t\tinterface AnInterface extends AirEntity {\n\t\t\t\t\t\trepository: {\n\t\t\t\t\t\t\tGUID: string\n\t\t\t\t\t\t},\n\t\t\t\t\t\tactor: {\n\t\t\t\t\t\t\tGUID: string\n\t\t\t\t\t\t},\n\t\t\t\t\t\t_actorRecordId: number\n\t\t\t\t\t}\n\t\t\t\t\t");return e}whereClauseToJSON(e,t){if(!e)return null;let n=e,i={c:n.c,o:n.o};switch(n.c){case he.LOGICAL:let e=n,o=i;switch(n.o){case me.NOT:o.v=this.whereClauseToJSON(e.v,t);break;case me.AND:case me.OR:o.v=e.v.map((e=>this.whereClauseToJSON(e,t)));break;default:throw new Error(`Unsupported logical operation '${n.o}'`)}break;case he.FUNCTION:let r=n,a=r.getQuery(),s=W.getSync(yt).getTreeQuery(a,t.entityAliases).toJSON(this,this.fieldUtils,this.relationManager);i=r.toJSON(s);break;case he.BOOLEAN:case he.DATE:case he.NUMBER:case he.STRING:case he.UNTYPED:let c=n,l=i;l.l=this.convertLRValue(c.l,t);let p=c.r;l.r=p instanceof Array?p.map((e=>this.convertLRValue(e,t))):this.convertLRValue(p,t)}return i}convertLRValue(e,t){switch(typeof(e=en(e))){case"undefined":throw new Error("'undefined' is not a valid L or R value");default:if(e instanceof Ut)return e.toJSON(t,!1,this,this.fieldUtils,this.relationManager);{let n=e;return this.fieldUtils.getFieldQueryJson(n,t.entityAliases,this)}}}};qn([function(e,t){}],Yn.prototype,"entityUtils",void 0),qn([function(e,t){}],Yn.prototype,"fieldUtils",void 0),qn([function(e,t){}],Yn.prototype,"relationManager",void 0),qn([function(e,t){}],Yn.prototype,"airEntityUtils",void 0),Yn=qn([function(e){}],Yn);const Qn={applications:[],entityMap:new Map,functions:{ABS:function(e){return e instanceof $t?e.applySqlFunction(on(de.AVG)):new qt(e).applySqlFunction(on(de.ABS))},ADD:function(e,t){return e instanceof $t?e.applySqlFunction(on(de.PLUS,[t])):new qt(e).applySqlFunction(on(de.PLUS,[t]))},AVG:function(e){return e instanceof $t?e.applySqlFunction(on(de.AVG)):new qt(e).applySqlFunction(on(de.AVG))},CONCAT:function(...e){if(e.length>2)throw new Error("Less than two operands passed to 'concat' function.");let t=e[0],n=e.slice(1);return t instanceof Qt?t.applySqlFunction(on(de.CONCATENATE,n)):new Wt(t).applySqlFunction(on(de.CONCATENATE,n))},COUNT:function(e){return e instanceof Ut?e.applySqlFunction(on(de.COUNT)):rn(e).applySqlFunction(on(de.COUNT))},DISTINCT:function(e){let t=new ln(e);return t.applySqlFunction(on(de.DISTINCT)),t},DIVIDE:function(e,t){return e instanceof $t?e.applySqlFunction(on(de.DIVIDE,[t])):new qt(e).applySqlFunction(on(de.DIVIDE,[t]))},EXISTS:function(e){if(!e.SELECT)throw new Error("Sub-Query must have SELECT clause defined to be used in EXITS function");return new pn(e).applySqlFunction(on(de.EXISTS))},FORMAT:function(e,...t){return e instanceof Qt?e.applySqlFunction(on(de.FORMAT,t)):new Wt(e).applySqlFunction(on(de.FORMAT,t))},INTERSECT:function(...e){throw new Error("not implemented")},LCASE:function(e){return e instanceof Qt?e.applySqlFunction(on(de.LCASE)):new Wt(e).applySqlFunction(on(de.LCASE))},LEN:function(e){return e instanceof Qt?e.applySqlFunction(on(de.LEN)):new Wt(e).applySqlFunction(on(de.LEN))},ROUND:function(e,t=0){return e instanceof $t?e.applySqlFunction(on(de.ROUND,[t])):new qt(e).applySqlFunction(on(de.ROUND,[t]))},MAX:an,MID:function(e,t,n){return e instanceof Qt?e.applySqlFunction(on(de.MID,[t,n])):new Wt(e).applySqlFunction(on(de.MID,[t,n]))},MIN:function(e){return e instanceof Ut?e.applySqlFunction(on(de.MIN)):rn(e).applySqlFunction(on(de.MIN))},MINUS:dn,MODULUS:function(e,t){return e instanceof $t?e.applySqlFunction(on(de.MODULUS,[t])):new qt(e).applySqlFunction(on(de.MODULUS,[t]))},MULTIPLY:function(e,t){return e instanceof $t?e.applySqlFunction(on(de.MULTIPLY,[t])):new qt(e).applySqlFunction(on(de.MULTIPLY,[t]))},NOW:function(){return new Bt(null).applySqlFunction(on(de.NOW))},REPLACE:function(e,t,n){return e instanceof Qt?e.applySqlFunction(on(de.REPLACE,[t,n])):new Wt(e).applySqlFunction(on(de.REPLACE,[t,n]))},SUBTRACT:function(e,t){return e instanceof $t?e.applySqlFunction(on(de.MINUS,[t])):new qt(e).applySqlFunction(on(de.MINUS,[t]))},SUM:function(e){return e instanceof $t?e.applySqlFunction(on(de.SUM)):new qt(e).applySqlFunction(on(de.SUM))},TRIM:function(e){return e instanceof Qt?e.applySqlFunction(on(de.TRIM)):new Wt(e).applySqlFunction(on(de.TRIM))},UCASE:function(e){return e instanceof Qt?e.applySqlFunction(on(de.UCASE)):new Wt(e).applySqlFunction(on(de.UCASE))},UNION:function(...e){throw new Error("not implemented")},UNION_ALL:function(...e){throw new Error("not implemented")},AND:Nt,NOT:function(e){return(new bt).NOT(e)},OR:xt,bool:Jt,date:Kt,num:Zt,str:Xt,wrapPrimitive:en},qApplications:[],QM:{}};var Wn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let zn=class{constructor(){this.databaseState=Qn}get applications(){return this.databaseState.applications}get entityMap(){return this.databaseState.entityMap}get functions(){return this.databaseState.functions}get qApplications(){return this.databaseState.qApplications}get QM(){return this.databaseState.QM}};zn=Wn([function(e){}],zn);var Jn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Kn=class{getPositionAlias(e,t){return`${e}_${t.join("_")}`}getAlias(e){return this.getPositionAlias(e.rep,e.fromClausePosition)}getParentAlias(e){let t=e.fromClausePosition;if(0===t.length)throw new Error("Cannot find alias of a parent entity for the root entity");return this.getPositionAlias(e.rep,t.slice(0,t.length-1))}createRelatedQEntity(e,t){const n=this.applicationUtils.getDbEntity(e.si,e.ti);return new(this.applicationUtils.getQEntityConstructor(n))(n,this.applicationUtils,this,e.fromClausePosition,n.relations[e.ri],e.jt)}getNextChildJoinPosition(e){let t=e.fromClausePosition.slice();return t.push(++e.currentChildIndex),t}};async function Zn(e,t){return(await Xn(1,e,t))[0]}async function Xn(e,t,n){if(!e)return[];const i=t.QM[ae.SYS_WIDE_OP_ID_APPLICATION].__dbApplication__.currentVersion[0].applicationVersion.entityMapByName[ae.SYS_WIDE_OP_ID_ENTITY].columnMap.SYSTEM_WIDE_OPERATION_LID;return(await n.generateSequenceNumbers([i],[e]))[0]}Jn([function(e,t){}],Kn.prototype,"applicationUtils",void 0),Kn=Jn([function(e){}],Kn);var ei=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ti=class{strsToNums(e){return e.map((e=>parseInt(e)))}objectExists(e){return null!=e}valuesEqual(e,t,n=!1){if("object"==typeof e){if(e instanceof Date)return t instanceof Date&&e.getTime()===t.getTime();{if("object"!=typeof t)return!1;if(!n)return!0;let i={};for(let o in e)if(i[o]=!0,!this.valuesEqual(e[o],t[o],n))return!1;for(let e in t)if(!i[e])return!1;return!0}}return e?!!t&&e===t:""===e?""===t:!1===e?!1===t:0===e?0===t:""!==t&&!1!==t&&0!==t&&!t}compareNumbers(e,t){return e<t?-1:e>t?1:0}};ti=ei([function(e){}],ti);const ni=P("air-traffic-control"),ii=ni.token({class:ti,interface:"IUtils",token:"UTILS"});yt.setDependencies({utils:ii}),ht.setClass(Yn);const oi={setQApplication:function(e){},dS:function(e,t){return!0},ddS:function(e,t){return!0}};var ri=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ai=class{getCreatedBy(e){return e.actor.userAccount}encodeId(e){if(!(e.repository&&e.repository.GUID&&e.actor&&e.actor.GUID&&e._actorRecordId))return null;if("string"!=typeof e.repository.GUID)throw Error('Type of "repository.GUID" property is not a string.');if("string"!=typeof e.actor.GUID)throw Error('Type of "actor.GUID" property is not a string.');if("number"!=typeof e._actorRecordId)throw Error('Type of "_actorRecordId" property is not a number.');return e.repository.GUID+"-"+e.actor.GUID+"-"+e._actorRecordId}parseEGUID(e){const t=e.split("-");if(11!==t.length)throw new Error("Invalid Entity Id, expecting ${repository.GUID}-${actor.GUID}-${_actorRecordId}");const n=[];for(let e=0;e<5;e++)n.push(t[e]);const i=[];for(let e=5;e<10;e++)i.push(t[e]);return{repository:{GUID:n.join("-")},actor:{GUID:i.join("-")},_actorRecordId:parseInt(t[11])}}setId(e,t){if(!e)return;let n=this.parseEGUID(e);t.repository?t.repository.GUID=n.repository.GUID:t.repository={GUID:n.repository.GUID},t.actor?t.actor.GUID=n.actor.GUID:t.actor={GUID:n.repository.GUID},t._actorRecordId=n._actorRecordId}};ai=ri([function(e){}],ai);const si=P("aviation-communication").token({class:ai,interface:"IAirEntityUtils",token:"AIR_ENTITY_UTILS"});var ci=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let li=class{ensureContext(e){return pi(e)}async lookup(e,t,n,i,o,r){let a,s;if(o){a=new o(this.entityUtils.getQuery(e))}else a=this.entityUtils.getEntityQuery(e);s=n?i?this.queryFacade.searchOne:this.queryFacade.search:i?this.queryFacade.findOne:this.queryFacade.find;let c=await s.call(this.queryFacade,a,t,r);return i||c||(c=[]),c}};function pi(e){return e||(e={}),e.startedAt||(e.startedAt=new Date),e}ci([function(e,t){}],li.prototype,"entityUtils",void 0),ci([function(e,t){}],li.prototype,"queryFacade",void 0),li=ci([function(e){}],li);class di extends class{constructor(e){this.dao=e}ensureContext(e){return pi(e)}async lookup(e,t,n,i,o,r,a){return await this.dao.lookup.lookup(e,t,n,i,o,r,a)}}{constructor(e,t,n=di.mapResults){super(t),this.dbEntity=e,this.mapResults=n}setNoCache(e){return new e(this.dbEntity,this.dao,this.mapResults)}async entityLookup(e,t,n,i,o){o.dbEntity=this.dbEntity,e=W.getSync(yt).ensureId(e);const r=await this.lookup(e,t,n,i,null,o,this.mapResults);if(n)throw new Error("Search operations are not yet supported");return this.dao.updateCacheManager.saveOriginalValues(r,o.dbEntity),r}}di.mapResults=!1;class ui extends di{async graph(e,t){return await this.find(e,xe.ENTITY_GRAPH,t)}async tree(e,t){return await this.find(e,xe.ENTITY_TREE,t)}async find(e,t,n){return await this.entityLookup(e,t,!1,!1,this.ensureContext(n))}noCache(){return this.setNoCache(ui)}}class fi extends di{async graph(e,t){return await this.findOne(e,xe.ENTITY_GRAPH,t)}async tree(e,t){return await this.findOne(e,xe.ENTITY_TREE,t)}async findOne(e,t,n){return await this.entityLookup(e,t,!1,!0,this.ensureContext(n))}noCache(){return this.setNoCache(fi)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yi=function(e,t){return(yi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function hi(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}yi(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function mi(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function Ii(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function Ri(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ei(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function _i(e,t){for(var n=0,i=t.length,o=e.length;n<i;n++,o++)e[o]=t[n];return e}function gi(e){return this instanceof gi?(this.v=e,this):new gi(e)}function Ti(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=n.apply(e,t||[]),r=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){o[e]&&(i[e]=function(t){return new Promise((function(n,i){r.push([e,t,n,i])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof gi?Promise.resolve(n.value.v).then(c,l):p(r[0][2],n)}catch(e){p(r[0][3],e)}var n}function c(e){s("next",e)}function l(e){s("throw",e)}function p(e,t){e(t),r.shift(),r.length&&s(r[0][0],r[0][1])}}function Oi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ri(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,o){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,o,(t=e[n](t)).done,t.value)}))}}}function Ai(e){return"function"==typeof e}function Ni(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var xi=Ni((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function bi(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var wi=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,i,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=Ri(r),s=a.next();!s.done;s=a.next()){s.value.remove(this)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else r.remove(this);var c=this.initialTeardown;if(Ai(c))try{c()}catch(e){o=e instanceof xi?e.errors:[e]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var p=Ri(l),d=p.next();!d.done;d=p.next()){var u=d.value;try{Ci(u)}catch(e){o=null!=o?o:[],e instanceof xi?o=_i(_i([],Ei(o)),Ei(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new xi(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Ci(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&bi(t,e)},e.prototype.remove=function(t){var n=this._teardowns;n&&bi(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Si=wi.EMPTY;function vi(e){return e instanceof wi||e&&"closed"in e&&Ai(e.remove)&&Ai(e.add)&&Ai(e.unsubscribe)}function Ci(e){Ai(e)?e():e.unsubscribe()}var Di={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Mi={setTimeout:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Mi.delegate;return((null==n?void 0:n.setTimeout)||setTimeout).apply(void 0,_i([],Ei(e)))},clearTimeout:function(e){var t=Mi.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Vi(e){Mi.setTimeout((function(){var t=Di.onUnhandledError;if(!t)throw e;t(e)}))}function Pi(){}var Li=Ui("C",void 0,void 0);function Ui(e,t,n){return{kind:e,value:t,error:n}}var ji=null;function Fi(e){if(Di.useDeprecatedSynchronousErrorHandling){var t=!ji;if(t&&(ji={errorThrown:!1,error:null}),e(),t){var n=ji,i=n.errorThrown,o=n.error;if(ji=null,i)throw o}}else e()}function Gi(e){Di.useDeprecatedSynchronousErrorHandling&&ji&&(ji.errorThrown=!0,ji.error=e)}var ki=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,vi(t)&&t.add(n)):n.destination=Yi,n}return hi(t,e),t.create=function(e,t,n){return new Bi(e,t,n)},t.prototype.next=function(e){this.isStopped?qi(function(e){return Ui("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?qi(Ui("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?qi(Li,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(wi),Bi=function(e){function t(t,n,i){var o,r=e.call(this)||this;if(Ai(t))o=t;else if(t){var a;o=t.next,n=t.error,i=t.complete,r&&Di.useDeprecatedNextContext?(a=Object.create(t)).unsubscribe=function(){return r.unsubscribe()}:a=t,o=null==o?void 0:o.bind(a),n=null==n?void 0:n.bind(a),i=null==i?void 0:i.bind(a)}return r.destination={next:o?Hi(o):Pi,error:Hi(null!=n?n:$i),complete:i?Hi(i):Pi},r}return hi(t,e),t}(ki);function Hi(e,t){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{e.apply(void 0,_i([],Ei(t)))}catch(e){Di.useDeprecatedSynchronousErrorHandling?Gi(e):Vi(e)}}}function $i(e){throw e}function qi(e,t){var n=Di.onStoppedNotification;n&&Mi.setTimeout((function(){return n(e,t)}))}var Yi={closed:!0,next:Pi,error:$i,complete:Pi},Qi="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wi(e){return e}function zi(e){return 0===e.length?Wi:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Ji=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i,o=this,r=(i=e)&&i instanceof ki||function(e){return e&&Ai(e.next)&&Ai(e.error)&&Ai(e.complete)}(i)&&vi(i)?e:new Bi(e,t,n);return Fi((function(){var e=o,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?o._subscribe(r):o._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ki(t))((function(t,i){var o;o=n.subscribe((function(t){try{e(t)}catch(e){i(e),null==o||o.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Qi]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zi(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ki(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Ki(e){var t;return null!==(t=null!=e?e:Di.Promise)&&void 0!==t?t:Promise}function Zi(e){return function(t){if(function(e){return Ai(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Xi=function(e){function t(t,n,i,o,r){var a=e.call(this,t)||this;return a.onFinalize=r,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return hi(t,e),t.prototype.unsubscribe=function(){var t,n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(ki),eo=Ni((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),to=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return hi(t,e),t.prototype.lift=function(e){var t=new no(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new eo},t.prototype.next=function(e){var t=this;Fi((function(){var n,i;if(t._throwIfClosed(),!t.isStopped){var o=t.observers.slice();try{for(var r=Ri(o),a=r.next();!a.done;a=r.next()){a.value.next(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Fi((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Fi((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=t.hasError,i=t.isStopped,o=t.observers;return n||i?Si:(o.push(e),new wi((function(){return bi(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,o=t.isStopped;n?e.error(i):o&&e.complete()},t.prototype.asObservable=function(){var e=new Ji;return e.source=this,e},t.create=function(e,t){return new no(e,t)},t}(Ji),no=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return hi(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Si},t}(to),io=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return hi(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(to),oo=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ro(e){return Ai(null==e?void 0:e.then)}function ao(e){return Ai(e[Qi])}function so(e){return Symbol.asyncIterator&&Ai(null==e?void 0:e[Symbol.asyncIterator])}function co(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var lo="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function po(e){return Ai(null==e?void 0:e[lo])}function uo(e){return Ti(this,arguments,(function(){var t,n,i;return Ii(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,gi(t.read())];case 3:return n=o.sent(),i=n.value,n.done?[4,gi(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,gi(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function fo(e){return Ai(null==e?void 0:e.getReader)}function yo(e){if(e instanceof Ji)return e;if(null!=e){if(ao(e))return o=e,new Ji((function(e){var t=o[Qi]();if(Ai(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(oo(e))return i=e,new Ji((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if(ro(e))return n=e,new Ji((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Vi)}));if(so(e))return ho(e);if(po(e))return t=e,new Ji((function(e){var n,i;try{for(var o=Ri(t),r=o.next();!r.done;r=o.next()){var a=r.value;if(e.next(a),e.closed)return}}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}e.complete()}));if(fo(e))return ho(uo(e))}var t,n,i,o;throw co(e)}function ho(e){return new Ji((function(t){(function(e,t){var n,i,o,r;return mi(this,void 0,void 0,(function(){var a,s;return Ii(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Oi(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(a=i.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),o={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function mo(e,t,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!1);var r=t.schedule((function(){n(),o?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(r),!o)return r}function Io(e,t){return void 0===t&&(t=0),Zi((function(n,i){n.subscribe(new Xi(i,(function(n){return mo(i,e,(function(){return i.next(n)}),t)}),(function(){return mo(i,e,(function(){return i.complete()}),t)}),(function(n){return mo(i,e,(function(){return i.error(n)}),t)})))}))}function Ro(e,t){return void 0===t&&(t=0),Zi((function(n,i){i.add(e.schedule((function(){return n.subscribe(i)}),t))}))}function Eo(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ji((function(n){mo(n,t,(function(){var i=e[Symbol.asyncIterator]();mo(n,t,(function(){i.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function _o(e,t){if(null!=e){if(ao(e))return function(e,t){return yo(e).pipe(Ro(t),Io(t))}(e,t);if(oo(e))return function(e,t){return new Ji((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}(e,t);if(ro(e))return function(e,t){return yo(e).pipe(Ro(t),Io(t))}(e,t);if(so(e))return Eo(e,t);if(po(e))return function(e,t){return new Ji((function(n){var i;return mo(n,t,(function(){i=e[lo](),mo(n,t,(function(){var e,t,o;try{t=(e=i.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return Ai(null==i?void 0:i.return)&&i.return()}}))}(e,t);if(fo(e))return function(e,t){return Eo(uo(e),t)}(e,t)}throw co(e)}function go(e,t){return t?_o(e,t):yo(e)}function To(e,t){return Zi((function(n,i){var o=0;n.subscribe(new Xi(i,(function(n){i.next(e.call(t,n,o++))})))}))}function Oo(e,t){return e===t}var Ao=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let No=class extends li{field(e,t){return this.find(e,xe.FIELD,Tn,t)}sheet(e,t,n,i){if(t||n)throw new Error("Implement!");return this.find(e,xe.SHEET,Nn,i)}tree(e,t){return this.find(e,xe.TREE,xn,t)}find(e,t,n,i){return this.lookup(e,t,!1,!1,n,this.ensureContext(i))}};No=Ao([function(e){}],No);var xo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let bo=class extends li{field(e,t){return this.findOne(e,xe.FIELD,Tn,t)}sheet(e,t){return this.findOne(e,xe.SHEET,Nn,t)}tree(e,t){return this.findOne(e,xe.TREE,xn,t)}findOne(e,t,n,i){return this.lookup(e,t,!1,!0,n,this.ensureContext(i))}};bo=xo([function(e){}],bo);var wo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let So=class extends li{field(e,t){return go(this.search(e,xe.FIELD,Tn,t))}sheet(e,t){return go(this.search(e,xe.SHEET,Nn,t))}tree(e,t){return go(this.search(e,xe.TREE,xn,t))}search(e,t,n,i){return this.lookup(e,t,!0,!1,n,this.ensureContext(i))}};So=wo([function(e){}],So);var vo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Co=class extends li{field(e,t){return go(this.searchOne(e,xe.FIELD,Tn,t))}sheet(e,t){return go(this.searchOne(e,xe.SHEET,Nn,t))}tree(e,t){return go(this.searchOne(e,xe.TREE,xn,t))}searchOne(e,t,n,i){return this.lookup(e,t,!0,!0,n,this.ensureContext(i))}};Co=vo([function(e){}],Co);class Do{constructor(e,t,n){this.dbEntity=e,this.Q=t,this.dao=n,this.find=new ui(this.dbEntity,n),this.findOne=new fi(this.dbEntity,n)}get FROM(){return this.Q[this.dbEntity.name]}async insertColumnValues(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertColumnValues(e,n)))}async insertValues(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertValues(e,n)))}async insertColumnValuesGenerateIds(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertColumnValuesGenerateIds(e,n)))}async insertValuesGenerateIds(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertValuesGenerateIds(e,n)))}async updateColumnsWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.updateColumnsWhere(e,n)))}async updateWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.updateWhere(e,n)))}async deleteWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.deleteWhere(e,n)))}async save(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.save(e,n)))}async saveToDestination(e,t,n){return await this.withDbEntity(n,(async(n,i)=>await n.saveToDestination(e,t,i)))}async withDbEntity(e,t){e||(e={}),e.startedAt||(e.startedAt=new Date);const n=e.dbEntity;e.dbEntity=this.dbEntity;try{return await t(this.dao.databaseFacade,e)}finally{e.dbEntity=n}}}var Mo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vo=class{constructor(e,t,n=!1){this.internal=n;const i=t.__dbApplication__.currentVersion[0].applicationVersion.entities[e];this.db=new Do(i,t,this)}static BaseSave(e){return function(e,t){}}mapById(e){const t=new Map;for(const n of e)t.set(n.id,n);return t}async count(e){throw new Error("Not Implemented")}exists(e,t){throw new Error("Not Implemented")}async findAll(e,t,n=!1){if(e)throw new Error("Not implemented");return await this.db.find.graph({SELECT:{},FROM:[this.db.FROM]},t)}async findAllAsTrees(e,t,n=!1){if(e)throw new Error("Not implemented");return await this.db.find.tree({SELECT:{},FROM:[this.db.FROM]},t)}async findOne(e,t=!1,n){if(!this.db.dbEntity.isAirEntity)throw new Error("Dao.findOne can only be called for Repository Entities.");const i=e;let o;return await this.db.findOne.graph({SELECT:{"*":tt},FROM:[o=this.db.FROM],WHERE:o.equals(i),FOR_UPDATE:t},n)}async findIn(e,t,n){if(!this.db.dbEntity.isAirEntity)throw new Error("Dao.findIn can only be called for Repository Entities.");let i;return await this.db.find.graph({SELECT:{"*":tt},FROM:[i=this.db.FROM],WHERE:i.in(e),FOR_UPDATE:t},n)}async save(e,t){return await this.db.save(e,this.ensureContext(t))}markForDeletion(e,t){if(e instanceof Array)for(const t of e)this.entityStateManager.markForDeletion(t);else this.entityStateManager.markForDeletion(e)}_repositoryId(){return{actor:{_localId:tt},_actorRecordId:tt,ageSuitability:tt,repository:{_localId:tt}}}async _find(e,t){return await this.db.find.graph(e,t)}async _findUnique(e,t){const n=await this.db.find.graph(e,t);if(!n.length)return null;if(n.length>1){n.sort(((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()));for(let e=1;e<n.length;e++)this.markForDeletion(n[e]);await this.save(n)}return n[0]}async _findOne(e,t){return await this.db.findOne.graph(e,t)}_search(e,t){throw new Error("Not implemented")}_searchOne(e,t){throw new Error("Not implemented")}ensureContext(e){return pi(e)}};Mo([function(e,t){}],Vo.prototype,"databaseFacade",void 0),Mo([function(e,t){}],Vo.prototype,"entityStateManager",void 0),Mo([function(e,t){}],Vo.prototype,"lookup",void 0),Mo([function(e,t){}],Vo.prototype,"updateCacheManager",void 0),Vo=Mo([function(e){}],Vo);class Po{Graph(e){return function(e,t){}}Tree(e){return function(e,t){}}}class Lo{constructor(e){this.dbEntity=e}get ids(){const e=this.dbEntity.properties.filter((e=>e.isId)).map((e=>e.name));return this.getSelect(e,!1)}get fields(){const e=this.dbEntity.properties.filter((e=>!e.relation||!e.relation.length)).map((e=>e.name));return this.getSelect(e,!1)}get manyToOnes(){return this.getRelationSelect(ce.MANY_TO_ONE)}get oneToManys(){return this.getRelationSelect(ce.ONE_TO_MANY)}getRelationSelect(e){const t=this.dbEntity.properties.filter((t=>t.relation&&t.relation.length&&t.relation[0].relationType===e)).map((e=>e.name));return this.getSelect(t,!0)}getSelect(e,t){const n={};for(const i of e)n[i]=t?{}:tt;return n}}class Uo{constructor(e,t){this.dbEntity="number"==typeof e?t.__dbApplication__.currentVersion[0].applicationVersion.entities[e]:e,this.SELECT=new Lo(this.dbEntity)}getLocalIdStub(e){throw new Error("Not Implemented.")}getLocalIdStubs(e){throw new Error("Not Implemented.")}}const jo=P("tarmaq-dao"),Fo=jo.token({class:Vo,interface:"class Dao",token:"DAO"}),Go=jo.token({class:null,interface:"IDatabaseFacade",token:"DATABASE_FACADE"}),ko=jo.token({class:li,interface:"ILookup",token:"LOOKUP"}),Bo=jo.token({class:No,interface:"INonEntityFind",token:"NON_ENTITY_FIND"}),Ho=jo.token({class:bo,interface:"INonEntityFindOne",token:"NON_ENTITY_FIND_ONE"}),$o=jo.token({class:So,interface:"INonEntitySearch",token:"NON_ENTITY_SEARCH"}),qo=jo.token({class:Co,interface:"INonEntitySearchOne",token:"NON_ENTITY_SEARCH_ONE"}),Yo=jo.token({class:null,interface:"IQueryFacade",token:"QUERY_FACADE"});Fo.setDependencies({databaseFacade:Go,entityStateManager:Ke,lookup:ko,updateCacheManager:et}),oi.dS=function(e,t){if(!Be||!e)return!1;const n=e.currentVersion[0].applicationVersion.entities[t];return Be.exists(n)},oi.ddS=function(e,t){return e&&e.currentVersion[0].applicationVersion.entities[t]};const Qo=ni.token({class:null,interface:"IAirportDatabase",token:"AIRPORT_DATABASE"}),Wo=ni.token({class:Cn,interface:"IApplicationUtils",token:"APPLICATION_UTILS"}),zo=ni.token({class:zn,interface:"IDatabaseState",token:"DATABASE_STORE"}),Jo=ni.token({class:Pn,interface:"IFieldUtils",token:"FIELD_UTILS"}),Ko=ni.token({class:Un,interface:"IQMetadataUtils",token:"Q_METADATA_UTILS"}),Zo=ni.token({class:Kn,interface:"IRelationManager",token:"RELATION_MANAGER"}),Xo=ni.token({class:null,interface:"IRepositoryLoader",token:"REPOSITORY_LOADER"});var er;Qo.setDependencies({appliationUtils:Wo,databaseFacade:Go,databaseStore:zo,dbApplicationUtils:Je,find:Bo,findOne:Ho,relationManager:Zo,search:$o,searchOne:qo}),Wo.setDependencies({airportDatabase:Qo,entityStateManager:Ke,utils:ii}),Go.setDependencies({applicationUtils:Wo,entityStateManager:Ke,transactionalConnector:Xe,updateCacheManager:et}),Jo.setDependencies({relationManager:Zo}),ko.setDependencies({entityUtils:yt,queryFacade:Yo}),Yo.setDependencies({fieldUtils:Jo,queryUtils:ht,relationManager:Zo,transactionalConnector:Xe}),ht.setDependencies({entityUtils:yt,fieldUtils:Jo,relationManager:Zo,airEntityUtils:si}),Zo.setDependencies({applicationUtils:Wo}),et.setDependencies({applicationUtils:Wo,entityStateManager:Ke}),oi.setQApplication=function(e){Y.db().eventuallyGet(Qo).then((t=>{t.setQApplication(e)}))};var tr=new Uint8Array(16);function nr(){if(!er&&!(er="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return er(tr)}var ir=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function or(e){return"string"==typeof e&&ir.test(e)}for(var rr=[],ar=0;ar<256;++ar)rr.push((ar+256).toString(16).substr(1));function sr(e,t,n){var i=(e=e||{}).random||(e.rng||nr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=i[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(rr[e[t+0]]+rr[e[t+1]]+rr[e[t+2]]+rr[e[t+3]]+"-"+rr[e[t+4]]+rr[e[t+5]]+"-"+rr[e[t+6]]+rr[e[t+7]]+"-"+rr[e[t+8]]+rr[e[t+9]]+"-"+rr[e[t+10]]+rr[e[t+11]]+rr[e[t+12]]+rr[e[t+13]]+rr[e[t+14]]+rr[e[t+15]]).toLowerCase();if(!or(n))throw TypeError("Stringified UUID is invalid");return n}(i)}var cr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let lr=class{async initialize(){}async createRepository(e,t){if(t.newRepository)throw new Error("Cannot create more than one repository per transaction:\nAttempting to create a new repository and Operation Context\nalready contains a new repository.");let n=await this.createRepositoryRecord(e,t);return t.newRepository=n,n}goOffline(){throw new Error("not implemented")}getUpdateState(e){throw new Error("not implemented")}setUpdateStateForAll(e){throw new Error("not implemented")}setUpdateState(e,t){throw new Error("not implemented")}getRepositoryRecord(e){return{ageSuitability:0,createdAt:new Date,_localId:null,immutable:!1,owner:e.userAccount,repositoryTransactionHistory:[],source:"localhost:9000",GUID:sr()}}async createRepositoryRecord(e,t){const n=this.getRepositoryRecord(e);return await this.repositoryDao.save(n,t),n}ensureRepositoryScopeOnInsertValues(e,t){let n=t.INSERT_INTO;if(!n.__driver__.dbEntity.isAirEntity)return t;let i=t.columns.slice();if(i.some(((e,t)=>"repository"===e.dbProperty.name)))return t;i.push(n.repository);let o=t.VALUES.slice();for(let t=0;t<o.length;t++){let n=o[t].slice();o[t]=n,n.push(e._localId)}return{INSERT_INTO:n,columns:i,VALUES:o}}ensureRepositoryLinkOnUpdateWhere(e,t,n){if(e.__driver__.dbEntity.isAirEntity)return{UPDATE:n.UPDATE,SET:n.SET,WHERE:Nt(n.WHERE,e.repository._localId.equals(t._localId))}}ensureRepositoryScopeOnDeleteWhere(e,t,n){if(e.__driver__.dbEntity.isAirEntity)return{DELETE_FROM:n.DELETE_FROM,WHERE:Nt(n.WHERE,e.repository._localId.equals(t._localId))}}};var pr;cr([function(e,t){}],lr.prototype,"repositoryDao",void 0),lr=cr([function(e){}],lr),function(e){e.CONSTRAINT="CONSTRAINT",e.NO_CONSTRAINT="NO_CONSTRAINT",e.PROVIDER_DEFAULT="PROVIDER_DEFAULT"}(pr||(pr={}));var dr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ur=class{constructor(){this.recordHistory=[]}};dr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],ur.prototype,"_localId",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"orderNumber",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"changeType",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"systemWideOperationId",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"entity",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"actor",void 0),dr([function(e,t){},function(e,t){}],ur.prototype,"repositoryTransactionHistory",void 0),dr([function(e,t){}],ur.prototype,"recordHistory",void 0),ur=dr([function(e){},function(e){}],ur);var fr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yr=class{constructor(){this.newValues=[],this.oldValues=[]}};fr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],yr.prototype,"_localId",void 0),fr([function(e,t){},function(e,t){}],yr.prototype,"_actorRecordId",void 0),fr([function(e,t){},function(e,t){}],yr.prototype,"actor",void 0),fr([function(e,t){},function(e,t){}],yr.prototype,"operationHistory",void 0),fr([function(e,t){}],yr.prototype,"newValues",void 0),fr([function(e,t){}],yr.prototype,"oldValues",void 0),fr([function(e,t){}],yr.prototype,"tableColumnMap",void 0),yr=fr([function(e){},function(e){}],yr);var hr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mr=class{};hr([function(e,t){},function(e,t){},function(e,t){}],mr.prototype,"recordHistory",void 0),hr([function(e,t){},function(e,t){},function(e,t){}],mr.prototype,"columnIndex",void 0),hr([function(e,t){},function(e,t){}],mr.prototype,"newValue",void 0),mr=hr([function(e){},function(e){}],mr);var Ir=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Rr=class{};var Er;Ir([function(e,t){},function(e,t){},function(e,t){}],Rr.prototype,"recordHistory",void 0),Ir([function(e,t){},function(e,t){},function(e,t){}],Rr.prototype,"columnIndex",void 0),Ir([function(e,t){},function(e,t){}],Rr.prototype,"oldValue",void 0),Rr=Ir([function(e){},function(e){}],Rr),function(e){e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.REMOTE_REFERENCE="REMOTE_REFERENCE"}(Er||(Er={}));var _r=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gr=class{constructor(e){this.repositoryTransactionType=Er.LOCAL,this.operationHistory=[],e&&(this._localId=e._localId,this.transactionHistory=e.transactionHistory,this.repository=e.repository,this.saveTimestamp=e.saveTimestamp,this.operationHistory=e.operationHistory)}};_r([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],gr.prototype,"_localId",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"repositoryTransactionType",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"saveTimestamp",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"syncTimestamp",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"GUID",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"isRepositoryCreation",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"repository",void 0),_r([function(e,t){},function(e,t){}],gr.prototype,"transactionHistory",void 0),_r([function(e,t){}],gr.prototype,"operationHistory",void 0),gr=_r([function(e){},function(e){}],gr);var Tr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Or=class{constructor(){this.repositoryTransactionHistories=[],this.repositoryTransactionHistoryMap={},this.applicationMap=new je,this.allOperationHistory=[],this.allRecordHistory=[],this.allRecordHistoryNewValues=[],this.allRecordHistoryOldValues=[]}};Tr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Or.prototype,"_localId",void 0),Tr([function(e,t){},function(e,t){}],Or.prototype,"transactionType",void 0),Tr([function(e,t){}],Or.prototype,"repositoryTransactionHistories",void 0),Tr([function(e,t){}],Or.prototype,"repositoryTransactionHistoryMap",void 0),Tr([function(e,t){}],Or.prototype,"applicationMap",void 0),Tr([function(e,t){}],Or.prototype,"allOperationHistory",void 0),Tr([function(e,t){}],Or.prototype,"allRecordHistory",void 0),Tr([function(e,t){}],Or.prototype,"allRecordHistoryNewValues",void 0),Tr([function(e,t){}],Or.prototype,"allRecordHistoryOldValues",void 0),Or=Tr([function(e){},function(e){}],Or);var Ar=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Nr=class{};Ar([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Nr.prototype,"_localId",void 0),Ar([function(e,t){},function(e,t){}],Nr.prototype,"GUID",void 0),Ar([function(e,t){},function(e,t){}],Nr.prototype,"userAccount",void 0),Ar([function(e,t){},function(e,t){}],Nr.prototype,"terminal",void 0),Ar([function(e,t){},function(e,t){}],Nr.prototype,"application",void 0),Ar([function(e,t){},function(e,t){}],Nr.prototype,"client",void 0),Nr=Ar([function(e){}],Nr);var xr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let br=class{constructor(e){this.id=e,delete this.id,Object.defineProperty(this,"id",{get(){return W.getSync(si).encodeId(this)},set(e){W.getSync(si).setId(e,this)}}),delete this.isNew,Object.defineProperty(this,"isNew",{get(){return!!this._actorRecordId}}),delete this.createdBy,Object.defineProperty(this,"createdBy",{get(){return this.actor.userAccount}})}};xr([function(e,t){},function(e,t){},function(e,t){}],br.prototype,"repository",void 0),xr([function(e,t){},function(e,t){},function(e,t){}],br.prototype,"actor",void 0),xr([function(e,t){},function(e,t){},function(e,t){}],br.prototype,"_actorRecordId",void 0),xr([function(e,t){},function(e,t){}],br.prototype,"ageSuitability",void 0),xr([function(e,t){},function(e,t){}],br.prototype,"createdAt",void 0),xr([function(e,t){}],br.prototype,"systemWideOperationId",void 0),xr([function(e,t){},function(e,t){}],br.prototype,"originalRepository",void 0),xr([function(e,t){},function(e,t){}],br.prototype,"originalActor",void 0),xr([function(e,t){}],br.prototype,"originalActorRecordId",void 0),xr([function(e,t){}],br.prototype,"createdBy",void 0),xr([function(e,t){}],br.prototype,"isNew",void 0),xr([function(e,t){}],br.prototype,"id",void 0),br=xr([function(e){}],br);var wr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sr=class{constructor(){this.repositoryTransactionHistory=[]}};wr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Sr.prototype,"_localId",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"GUID",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"ageSuitability",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"createdAt",void 0),wr([function(e,t){}],Sr.prototype,"immutable",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"source",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"owner",void 0),wr([function(e,t){}],Sr.prototype,"repositoryTransactionHistory",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"continent",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"country",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"state",void 0),wr([function(e,t){},function(e,t){}],Sr.prototype,"metroArea",void 0),wr([function(e,t){}],Sr.prototype,"repositoryApplications",void 0),wr([function(e,t){}],Sr.prototype,"repositoryClients",void 0),wr([function(e,t){}],Sr.prototype,"repositoryDatabases",void 0),wr([function(e,t){}],Sr.prototype,"repositoryTerminals",void 0),wr([function(e,t){}],Sr.prototype,"repositoryTypes",void 0),Sr=wr([function(e){},function(e){}],Sr);var vr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Cr=class{};vr([function(e,t){},function(e,t){},function(e,t){}],Cr.prototype,"application",void 0),vr([function(e,t){},function(e,t){},function(e,t){}],Cr.prototype,"repository",void 0),Cr=vr([function(e){},function(e){}],Cr);var Dr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Mr=class{};Dr([function(e,t){},function(e,t){},function(e,t){}],Mr.prototype,"repository",void 0),Dr([function(e,t){},function(e,t){},function(e,t){}],Mr.prototype,"client",void 0),Mr=Dr([function(e){},function(e){}],Mr);var Vr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Pr=class{};Vr([function(e,t){},function(e,t){},function(e,t){}],Pr.prototype,"repository",void 0),Vr([function(e,t){},function(e,t){},function(e,t){}],Pr.prototype,"database",void 0),Pr=Vr([function(e){},function(e){}],Pr);var Lr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ur=class{};Lr([function(e,t){},function(e,t){},function(e,t){}],Ur.prototype,"repository",void 0),Lr([function(e,t){},function(e,t){},function(e,t){}],Ur.prototype,"terminal",void 0),Ur=Lr([function(e){},function(e){}],Ur);var jr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Fr=class{};jr([function(e,t){},function(e,t){},function(e,t){}],Fr.prototype,"repository",void 0),jr([function(e,t){},function(e,t){},function(e,t){}],Fr.prototype,"type",void 0),Fr=jr([function(e){},function(e){}],Fr);const Gr={__constructors__:{Actor:Nr,AirEntity:br,OperationHistory:ur,RecordHistory:yr,RecordHistoryNewValue:mr,RecordHistoryOldValue:Rr,Repository:Sr,RepositoryApplication:Cr,RepositoryClient:Mr,RepositoryDatabase:Pr,RepositoryTerminal:Ur,RepositoryTransactionHistory:gr,RepositoryType:Fr,TransactionHistory:Or},domain:"air",name:"@airport/holding-pattern"},kr=Gr;function Br(e){return oi.ddS(kr.__dbApplication__,e)}oi.setQApplication(Gr);class Hr extends Vo{constructor(e){super(e,kr)}}class $r extends Hr{constructor(){super(0)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(0)}}$r.Find=new Po,$r.FindOne=new Po,$r.Search=new Po,$r.SearchOne=new Po;class qr extends Hr{constructor(){super(12)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(12)}}qr.Find=new Po,qr.FindOne=new Po,qr.Search=new Po,qr.SearchOne=new Po;class Yr extends Hr{constructor(){super(3)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(3)}}Yr.Find=new Po,Yr.FindOne=new Po,Yr.Search=new Po,Yr.SearchOne=new Po;class Qr extends Hr{constructor(){super(1)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(1)}}Qr.Find=new Po,Qr.FindOne=new Po,Qr.Search=new Po,Qr.SearchOne=new Po;class Wr extends Hr{constructor(){super(2)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(2)}}Wr.Find=new Po,Wr.FindOne=new Po,Wr.Search=new Po,Wr.SearchOne=new Po;class zr extends Hr{constructor(){super(9)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(9)}}zr.Find=new Po,zr.FindOne=new Po,zr.Search=new Po,zr.SearchOne=new Po;class Jr extends Hr{constructor(){super(8)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(8)}}Jr.Find=new Po,Jr.FindOne=new Po,Jr.Search=new Po,Jr.SearchOne=new Po;class Kr extends Hr{constructor(){super(6)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(6)}}Kr.Find=new Po,Kr.FindOne=new Po,Kr.Search=new Po,Kr.SearchOne=new Po;class Zr extends Hr{constructor(){super(5)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(5)}}Zr.Find=new Po,Zr.FindOne=new Po,Zr.Search=new Po,Zr.SearchOne=new Po;class Xr extends Hr{constructor(){super(7)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(7)}}Xr.Find=new Po,Xr.FindOne=new Po,Xr.Search=new Po,Xr.SearchOne=new Po;class ea extends Hr{constructor(){super(11)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(11)}}ea.Find=new Po,ea.FindOne=new Po,ea.Search=new Po,ea.SearchOne=new Po;class ta extends Hr{constructor(){super(4)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(4)}}ta.Find=new Po,ta.FindOne=new Po,ta.Search=new Po,ta.SearchOne=new Po;class na extends Hr{constructor(){super(10)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Br(10)}}na.Find=new Po,na.FindOne=new Po,na.Search=new Po,na.SearchOne=new Po;class ia extends Uo{constructor(e){super(e,kr)}}class oa extends ia{static diSet(){return Br(12)}constructor(){super(12)}}class ra extends ia{static diSet(){return Br(3)}constructor(){super(3)}}class aa extends ia{static diSet(){return Br(1)}constructor(){super(1)}}class sa extends ia{static diSet(){return Br(2)}constructor(){super(2)}}class ca extends ia{static diSet(){return Br(11)}constructor(){super(11)}}class la extends ia{static diSet(){return Br(10)}constructor(){super(10)}}var pa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let da=class extends Qr{async findByRecordHistory_LocalIdIn(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=kr.RecordHistoryNewValue],WHERE:t.recordHistory._localId.IN(e)})}};da=pa([function(e){}],da);var ua=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let fa=class extends Wr{async findByRecordHistory_LocalIdIn(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=kr.RecordHistoryOldValue],WHERE:t.recordHistory._localId.IN(e)})}};fa=ua([function(e){}],fa);var ya=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ha=class extends ea{async findWhereGUIDsIn(e){let t;return await this.db.find.tree({SELECT:{GUID:tt},FROM:[t=kr.RepositoryTransactionHistory],WHERE:t.GUID.IN(e)})}async findAllLocalChangesForRecordIds(e){const t=new Map,n=kr.RepositoryTransactionHistory,i=n.transactionHistory.INNER_JOIN(),o=n.operationHistory.LEFT_JOIN(),r=o.entity.LEFT_JOIN(),a=r.applicationVersion.LEFT_JOIN(),s=o.recordHistory.LEFT_JOIN(),c=s.newValues.LEFT_JOIN();let l=tt;const p=[];for(const[t,i]of e){const e=i.actorRecordIdsByLocalIds,r=[];for(const[t,n]of e){const e=[];for(const[t,i]of n)e.push(Nt(o.actor._localId.equals(t),s._actorRecordId.IN(Array.from(i))));r.push(Nt(o.entity._localId.equals(t),xt(...e)))}p.push(Nt(n.repository._localId.equals(t),n.saveTimestamp.greaterThanOrEquals(i.firstChangeTime),xt(...r)))}const d=await this.db.find.tree({SELECT:{...nt,operationHistory:{orderNumber:tt,changeType:tt,entity:{_localId:l,applicationVersion:{_localId:tt}},recordHistory:{_localId:l,newValues:{columnIndex:tt,newValue:tt}}}},FROM:[n,i,o,r,a,s,c],WHERE:Nt(i.transactionType.equals(Re.LOCAL),xt(...p))});for(const e of d)He(t,e.repository._localId).push(e),e.operationHistory.sort(((e,t)=>e.orderNumber<t.orderNumber?-1:e.orderNumber>t.orderNumber?1:0));return t}async updateSyncTimestamp(e){let t;await this.db.updateWhere({UPDATE:t=kr.RepositoryTransactionHistory,SET:{syncTimestamp:e.syncTimestamp},WHERE:t._localId.equals(e._localId)})}};ha=ya([function(e){}],ha);var ma=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ia=class extends $r{async findWithDetailsAndGlobalIdsByIds(e){return await this.findWithDetailsAndGlobalIdsByWhereClause((t=>t._localId.IN(e)))}async findMapsWithDetailsByGlobalIds(e,t,n,i,o){const r=await this.findWithDetailsByGlobalIds(e,t,n);for(const e of r)qe(i,e.userAccount._localId).set(e.terminal._localId,e),o.set(e._localId,e)}async findWithDetailsByGlobalIds(e,t,n){return await this.findWithDetailsAndGlobalIdsByWhereClause((i=>Nt(i.GUID.IN(e),i.terminal._localId.IN(n),i.userAccount._localId.IN(t))))}async findByDomainAndApplication_Names(e,t){let n,i,o;return await this.db.find.tree({SELECT:{_localId:tt,application:{...nt,domain:{}},terminal:{},userAccount:{},GUID:tt},FROM:[n=kr.Actor,i=n.application.INNER_JOIN(),o=i.domain.INNER_JOIN(),n.terminal.LEFT_JOIN(),n.userAccount.LEFT_JOIN()],WHERE:Nt(o.name.equals(e),i.name.equals(t))})}async findByGUIDs(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=kr.Actor],WHERE:t.GUID.IN(e)})}async findWithUserAccountBy_LocalIdIn(e){let t,n;return await this.db.find.graph({SELECT:{"*":tt,userAccount:{_localId:tt,GUID:tt,ranking:tt,username:tt}},FROM:[t=kr.Actor,n=t.userAccount.LEFT_JOIN(),n.continent.LEFT_JOIN(),n.country.LEFT_JOIN(),n.metroArea.LEFT_JOIN(),n.state.LEFT_JOIN()],WHERE:t._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.GUID,t.application.index,t.userAccount._localId,t.terminal._localId]);const o=await this.db.insertValuesGenerateIds({INSERT_INTO:n=kr.Actor,columns:[n.GUID,n.application.index,n.userAccount._localId,n.terminal._localId],VALUES:i},t);for(let t=0;t<e.length;t++){e[t]._localId=o[t][0]}}async findWithDetailsAndGlobalIdsByWhereClause(e){let t,n,i;const o=tt,r=tt,a=tt;return await this.db.find.tree({SELECT:{...nt,application:{index:tt,name:tt,domain:{name:tt}},terminal:{id:o,GUID:a,owner:{id:o,username:r,GUID:a}},userAccount:{id:o,username:r,GUID:a}},FROM:[t=kr.Actor,n=t.application.LEFT_JOIN(),n.domain.LEFT_JOIN(),i=t.terminal.LEFT_JOIN(),i.owner.LEFT_JOIN(),t.userAccount.LEFT_JOIN()],WHERE:e(t)})}};Ia=ma([function(e){}],Ia);var Ra=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ea=class extends zr{async getRepositoryLoadInfo(e,t,n){let i,o,r;return await this.db.findOne.tree({SELECT:{immutable:tt,repositoryTransactionHistory:{saveTimestamp:tt}},FROM:[i=kr.Repository,o=i.repositoryTransactionHistory.INNER_JOIN(),r=o.transactionHistory.INNER_JOIN()],WHERE:Nt(i.source.equals(e),i.GUID.equals(t),r.transactionType.equals(Re.REMOTE_SYNC))},n)}async findReposWithDetailsAndSyncNodeIds(e){let t;const n=tt;return await this.db.find.tree({SELECT:{_localId:n,owner:{_localId:n},createdAt:tt,GUID:tt},FROM:[t=kr.Repository],WHERE:t._localId.IN(e)})}async findWithOwnerBy_LocalIds(e){let t;return await this.db.find.tree({SELECT:{"*":tt,owner:{_localId:tt,GUID:tt,username:tt}},FROM:[t=kr.Repository,t.owner.INNER_JOIN()],WHERE:t._localId.IN(e)})}async findWithOwnerBy_LocalIdIn(e){let t;return await this.db.find.graph({SELECT:{"*":tt,owner:{_localId:tt,GUID:tt,ranking:tt,username:tt}},FROM:[t=kr.Repository,t.owner.INNER_JOIN()],WHERE:t._localId.IN(e)})}async findByGUIDs(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=kr.Repository],WHERE:t.GUID.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.createdAt,t.GUID,t.ageSuitability,t.source,t.immutable,t.owner._localId]);const o=await this.db.insertValuesGenerateIds({INSERT_INTO:n=kr.Repository,columns:[n.createdAt,n.GUID,n.ageSuitability,n.source,n.immutable,n.owner._localId],VALUES:i},t);for(let t=0;t<e.length;t++){e[t]._localId=o[t][0]}}};Ea=Ra([function(e){}],Ea);var _a=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ga=class extends oa{getNewRecord(e,t,n,i,o,r){return{actor:n,changeType:e,entity:t,_localId:void 0,orderNumber:++r.numberOfOperations,recordHistory:[],repositoryTransactionHistory:i,systemWideOperationId:o}}sort(e,t){let n=e.orderNumber,i=t.orderNumber;return n>i?1:i>n?-1:0}startRecordHistory(e,t,n){const i=this.recordHistoryDuo.getNewRecord(t,n);return i.operationHistory=e,e.recordHistory.push(i),e.repositoryTransactionHistory.transactionHistory.allRecordHistory.push(i),i}};_a([function(e,t){}],ga.prototype,"recordHistoryDuo",void 0),ga=_a([function(e){}],ga);var Ta=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Oa=class extends ra{getNewRecord(e,t){const n=new yr;return n._actorRecordId=t,n.actor={_localId:e},n}addNewValue(e,t,n){if(null===n)return null;const i=this.recordHistoryNewValueDuo.getNewRecord(e,t,n);return e.newValues.push(i),e.operationHistory.repositoryTransactionHistory.transactionHistory.allRecordHistoryNewValues.push(i),i}addOldValue(e,t,n){if(null===n)return null;const i=this.recordHistoryOldValueDuo.getNewRecord(e,t,n);return e.oldValues.push(i),e.operationHistory.repositoryTransactionHistory.transactionHistory.allRecordHistoryOldValues.push(i),i}};Ta([function(e,t){}],Oa.prototype,"recordHistoryNewValueDuo",void 0),Ta([function(e,t){}],Oa.prototype,"recordHistoryOldValueDuo",void 0),Oa=Ta([function(e){}],Oa);var Aa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Na=class extends aa{constructor(){super()}getNewRecord(e,t,n){const i=new mr;return i.columnIndex=t.index,i.recordHistory=e,i.newValue=n,i}};Na=Aa([function(e){}],Na);var xa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ba=class extends sa{constructor(){super()}getNewRecord(e,t,n){const i=new Rr;return i.columnIndex=t.index,i.recordHistory=e,i.oldValue=n,i}};ba=xa([function(e){}],ba);var wa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sa=class extends ca{getNewRecord(e,t){let n=new gr,i=(new Date).getTime();return n.saveTimestamp=i,n.GUID=sr(),n.isRepositoryCreation=t,n.repository=new Sr,n.repository._localId=e,n}newRecord(e){return e?{...e}:null}sortRepoTransHistories(e,t){e.sort(((e,t)=>{const n=this.compareNumbers(e.syncTimestamp,t.syncTimestamp);if(n)return n;const i=this.compareNumbers(e.saveTimestamp,t.saveTimestamp);return i||0}))}startOperation(e,t,n,i,o,r){let a=this.operationHistoryDuo.getNewRecord(n,i,o,e,t,r);return e.operationHistory.push(a),e.transactionHistory.allOperationHistory.push(a),a}compareDates(e,t){const n=e?e.getTime():-1,i=t?t.getTime():-1;return this.compareNumbers(n,i)}compareNumbers(e,t){return e<t?-1:t>e?1:0}};wa([function(e,t){}],Sa.prototype,"operationHistoryDuo",void 0),Sa=wa([function(e){}],Sa);var va=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ca=class extends la{getNewRecord(e=Re.LOCAL){let t=new Or;return t.transactionType=Re.LOCAL,t}getRepositoryTransaction(e,t,n){let i=e.repositoryTransactionHistoryMap[t];return i||(i=this.repositoryTransactionHistoryDuo.getNewRecord(t,n),e.repositoryTransactionHistories.push(i),e.repositoryTransactionHistoryMap[t]=i,i.transactionHistory=e),i}};va([function(e,t){}],Ca.prototype,"repositoryTransactionHistoryDuo",void 0),Ca=va([function(e){}],Ca);const Da=P("holding-pattern"),Ma=Da.token({class:Ia,interface:"IActorDao",token:"ACTOR_DAO"}),Va=Da.token({class:ga,interface:"IOperationHistoryDuo",token:"OPERATION_HISTORY_DUO"}),Pa=Da.token({class:Oa,interface:"IRecordHistoryDuo",token:"RECORD_HISTORY_DUO"});Da.token({class:da,interface:"IRecordHistoryNewValueDao",token:"RECORD_HISTORY_NEW_VALUE_DAO"});const La=Da.token({class:Na,interface:"IRecordHistoryNewValueDuo",token:"RECORD_HISTORY_NEW_VALUE_DUO"});Da.token({class:fa,interface:"IRecordHistoryOldValueDao",token:"RECORD_HISTORY_OLD_VALUE_DAO"});const Ua=Da.token({class:ba,interface:"IRecordHistoryOldValueDuo",token:"RECORD_HISTORY_OLD_VALUE_DUO"}),ja=Da.token({class:Ea,interface:"IRepositoryDao",token:"REPOSITORY_DAO"}),Fa=Da.token({class:ha,interface:"IRepositoryTransactionHistoryDao",token:"REPOSITORY_TRANSACTION_HISTORY_DAO"}),Ga=Da.token({class:Sa,interface:"IRepositoryTransactionHistoryDuo",token:"REPOSITORY_TRANSACTION_HISTORY_DUO"}),ka=Da.token({class:Ca,interface:"ITransactionHistoryDuo",token:"TRANSACTION_HISTORY_DUO"});Va.setDependencies({recordHistoryDuo:Pa}),Pa.setDependencies({recordHistoryNewValueDuo:La,recordHistoryOldValueDuo:Ua}),Ga.setDependencies({operationHistoryDuo:Va}),ka.setDependencies({repositoryTransactionHistoryDuo:Ga});const Ba=P("travel-document-checkpoint"),Ha=Ba.token({class:null,interface:"UserAccountApi",token:"USER_ACCOUNT_API"});var $a,qa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.EMAIL_TAKEN="EMAIL_TAKEN",e.INVALID_BIRTH_MONTH="INVALID_BIRTH_MONTH",e.INVALID_COUNTRY="INVALID_COUNTRY",e.INVALID_EMAIL="INVALID_EMAIL",e.INVALID_USERNAME="INVALID_USERNAME",e.USER_ACCOUNTNAME_TAKEN="USER_ACCOUNTNAME_TAKEN"}($a||($a={}));let Ya=class{constructor(){Y.db().manualInject(this,Ha)}async addUserAccount(e,t){return await this.userAccountApi.addUserAccount(e,t)}async findUserAccount(e){return await this.userAccountApi.findUserAccount(e)}};qa([function(e,t){}],Ya.prototype,"userAccountApi",void 0),Ya=qa([function(e){}],Ya);var Qa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wa=class{constructor(){this.pendingDemoMessageMap=new Map,this.demoListenerStarted=!1,this.lastConnectionReadyCheckMap=new Map}init(){this.initializeForWeb()}initializeForWeb(){const e=document.getElementsByName("AIRportClient");e.length?this.clientIframe=e[0]:(this.clientIframe=document.createElement("iframe"),this.clientIframe.src="http://localhost:7500/client/index.html",this.clientIframe.name="AIRportClient",this.clientIframe.style.display="none",document.body.appendChild(this.clientIframe)),window.addEventListener("message",(e=>{const t=e.data;if(!t.__received__){if(t.__received__=!0,this.messageCallback){const e=new Date;t.__receivedTime__=e.getTime(),this.messageCallback(t)}switch(t.category){case"ConnectionIsReady":let e=this.lastConnectionReadyCheckMap.get(t.domain);e||(e=new Map,this.lastConnectionReadyCheckMap.set(t.domain,e)),e.set(t.application,!0);break;case"ToClientRedirected":if(!this.hasValidApplicationInfo(t))return;let n=this.pendingDemoMessageMap.get(t.id);n&&n.resolve(t)}}}),!1)}onMessage(e){this.messageCallback=e}hasValidApplicationInfo(e){return"string"==typeof e.domain&&e.domain.length>=3&&"string"==typeof e.application&&e.application.length>=3}async invokeApiMethod(e,t,n){for(;!await this.isConnectionReady(e);)await this.wait(100);let i;i=n;const o={application:e.application.name,args:i,category:"FromClient",domain:e.application.domain.name,hostDomain:null,hostProtocol:null,id:sr(),methodName:t,objectName:e.descriptor.interface,protocol:window.location.protocol};let r,a;if(r=await this.sendDemoRequest(o),r.errorMessage)throw new Error(r.errorMessage);a=r.payload,a&&this.queryResultsDeserializer.setPropertyDescriptors(a);for(let e=0;e<n.length;e++)this.queryResultsDeserializer.deepCopyProperties(r.args[e],n[e]);return a}wait(e){return new Promise(((t,n)=>{setTimeout((()=>{t()}),e)}))}async isConnectionReady(e){const t=e.application.domain.name,n=e.application.name;if(this.lastConnectionReadyCheckMap.get(t)&&this.lastConnectionReadyCheckMap.get(t).get(n))return!0;let i={application:n,args:[],category:"IsConnectionReady",domain:t,hostDomain:null,hostProtocol:null,id:null,methodName:null,objectName:null,protocol:window.location.protocol};return this.clientIframe.contentWindow.postMessage(i,"http://localhost:7500"),!1}async sendLocalRequest(e){const t=await fetch("http://localhost:31817",{method:"PUT",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json"},referrerPolicy:"origin",body:JSON.stringify(e)});return await t.json()}async sendDemoRequest(e){this.demoListenerStarted||this.startDemoListener();const t=new Promise(((t,n)=>{this.pendingDemoMessageMap.set(e.id,{request:e,resolve:t,reject:n})}));return this.clientIframe.contentWindow.postMessage(e,"http://localhost:7500"),t}startDemoListener(){window.addEventListener("message",(e=>{this.handleDemoResponse(e.data)}))}handleDemoResponse(e){if(e.domain!==window.location.host)return;if("ToClientRedirected"!==e.category)return;const t=this.pendingDemoMessageMap.get(e.id);t&&(e.errorMessage?t.reject(e.errorMessage):t.resolve(e))}};Qa([function(e,t){}],Wa.prototype,"operationSerializer",void 0),Qa([function(e,t){}],Wa.prototype,"queryResultsDeserializer",void 0),Wa=Qa([function(e){}],Wa);var za=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ja=class{loadApiAutopilot(e){let t=this;return new Proxy({},{get(n,i){switch(i){case"__initialized__":return!0;case"then":return n}return function(...n){return $.getClass()?t.interAppApiClient.invokeApiMethod(e,i,n):t.localApiClient.invokeApiMethod(e,i,n)}}})}};za([function(e,t){}],Ja.prototype,"interAppApiClient",void 0),za([function(e,t){}],Ja.prototype,"localApiClient",void 0),Ja=za([function(e){}],Ja);var Ka=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Za=class{serializeAsArray(e){let t=[];return e?(t=e instanceof Array?e.map((e=>this.serialize(e))):[this.serialize(e)],t):t}serialize(e){const t={namePath:["root"],processedEntityMap:new Map,sequence:0,stubLookupTable:[]};return this.doSerialize(e,t)}doSerialize(e,t){if(!(e instanceof Object))return e;if(e instanceof Array)return e.map((e=>this.doSerialize(e,t)));if(e instanceof Date)return this.serializationStateManager.serializeAsDate(e);let n=t.processedEntityMap.get(e);if(n)return t.stubLookupTable[n];n=++t.sequence,t.processedEntityMap.set(e,n);let i={};this.serializationStateManager.markAsStub(e),i[this.serializationStateManager.getUniqueIdFieldName()]=n,t.stubLookupTable[n]=i;let o={};o[this.serializationStateManager.getUniqueIdFieldName()]=n;var r=!0;for(const n in e){const i=e[n];let a;r||t.namePath.pop(),r=!1,t.namePath.push(n),a=i instanceof Object?i instanceof Array?i.map((e=>this.doSerialize(e,t))):i instanceof Date?this.serializationStateManager.serializeAsDate(i):this.doSerialize(i,t):i,o[n]=a}return r||t.namePath.pop(),o}};Ka([function(e,t){}],Za.prototype,"serializationStateManager",void 0),Za=Ka([function(e){}],Za);var Xa,es,ts=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.DATE="DATE",e.STUB="STUB"}(es||(es={}));let ns=Xa=class{getSerializationUniqueId(e,t=!0){const n=e[Xa.SERIALIZATION_UNIQUE_ID_FIELD];if((!n||"number"!=typeof n||n<1)&&t)throw new Error(`Could not find "${Xa.SERIALIZATION_UNIQUE_ID_FIELD}" property on DTO:\n        \n        ${JSON.stringify(e)}`);return n}getEntityState(e){return e[Xa.SERIALIZATION_STATE_FIELD]}markAsStub(e){this.markAs(e,es.STUB)}isStub(e){return this.is(e,es.STUB)}serializeAsDate(e){return{__serializationState__:es.DATE,value:e.toISOString()}}isDate(e){return this.is(e,es.DATE)}getUniqueIdFieldName(){return Xa.SERIALIZATION_UNIQUE_ID_FIELD}is(e,t){return e[Xa.SERIALIZATION_STATE_FIELD]==t}markAs(e,t){e[Xa.SERIALIZATION_STATE_FIELD]=t}};ns.SERIALIZATION_UNIQUE_ID_FIELD="__SUID__",ns.SERIALIZATION_STATE_FIELD="__serializationState__",ns=Xa=ts([function(e){}],ns);var is=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let os=class{deserialize(e){const t={lookupTable:[]};let n;return n=e instanceof Array?e.map((e=>this.doDeserialize(e,t))):this.doDeserialize(e,t),n}doDeserialize(e,t){let n=this.serializationStateManager.getEntityState(e);switch(n){case es.DATE:return new Date(e.value)}let i=this.serializationStateManager.getSerializationUniqueId(e);if(!i||"number"!=typeof i||i<1)throw new Error(`Invalid or missing ${this.serializationStateManager.getUniqueIdFieldName()} field.`);let o=t.lookupTable[i];switch(n){case es.STUB:if(!o)throw new Error(`Could not find an already present entity for\n\t\t\t\t\t${this.serializationStateManager.getUniqueIdFieldName()} of ${i}`);return o;default:if(o)throw new Error(`Entity appears more than once for\n\t\t\t\t\t${this.serializationStateManager.getUniqueIdFieldName()} of ${i}`)}let r={};t.lookupTable[i]=r;for(const n in e){const i=e[n];let o;o=i instanceof Object?i instanceof Array?i.map((e=>this.doDeserialize(e,t))):this.doDeserialize(i,t):i,r[n]=o}return delete r[this.serializationStateManager.getUniqueIdFieldName()],r}deepCopyProperties(e,t){if(e instanceof Array)for(let n=0;n<e.length;n++)this.deepCopyProperties(e[n],t[n]);if(e instanceof Object&&!(e instanceof Date)){for(let n in e){if(!e.hasOwnProperty(n))continue;let i=e[n],o=t[n];i instanceof Object&&o instanceof Object?this.deepCopyProperties(i,o):t[n]=e[n]}for(let n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||delete t[n]);this.doSetPropertyDescriptors(t)}}setPropertyDescriptors(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.setPropertyDescriptors(e[t]);if(e instanceof Object&&!(e instanceof Date)){for(let t in e){if(!e.hasOwnProperty(t))continue;let n=e[t];n instanceof Object&&this.setPropertyDescriptors(n)}this.doSetPropertyDescriptors(e)}}doSetPropertyDescriptors(e){let t=Object.getPrototypeOf(e);e.id||Object.getOwnPropertyDescriptor(e,"id")||t&&Object.getOwnPropertyDescriptor(t,"id")||Object.defineProperty(e,"id",{get(){return this.__container__.getSync(si).encodeId(this)},set(e){this.__container__.getSync(si).setId(e,this)}}),e.isNew||Object.getOwnPropertyDescriptor(e,"isNew")||t&&Object.getOwnPropertyDescriptor(t,"isNew")||Object.defineProperty(e,"isNew",{get(){return!!this._actorRecordId}}),e.createdBy||Object.getOwnPropertyDescriptor(e,"createdBy")||t&&Object.getOwnPropertyDescriptor(t,"createdBy")||Object.defineProperty(e,"createdBy",{get(){return this.actor.userAccount}})}};is([function(e,t){}],os.prototype,"airEntityUtils",void 0),is([function(e,t){}],os.prototype,"serializationStateManager",void 0),os=is([function(e){}],os);const rs=P("pressurization"),as=rs.token({class:Za,interface:"IOperationSerializer",token:"OPERATION_SERIALIZER"}),ss=rs.token({class:os,interface:"IQueryResultsDeserializer",token:"QUERY_RESULTS_DESERIALIZER"}),cs=rs.token({class:ns,interface:"ISerializationStateManager",token:"SERIALIZATION_STATE_MANAGER"});as.setDependencies({serializationStateManager:cs}),ss.setDependencies({airEntityUtils:si,serializationStateManager:cs});var ls,ps,ds=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.CREATE="CREATE",e.DATE="DATE",e.DELETE="DELETE",e.PARENT_SCHEMA_ID="PARENT_SCHEMA_LID",e.STUB="STUB",e.UPDATE="UPDATE"}(ps||(ps={}));let us=ls=class{isStub(e){return this.getEntityState(e)===ps.STUB}isParentSchemaId(e){return this.getEntityState(e)===ps.PARENT_SCHEMA_ID}markForDeletion(e,t){if(e[ls.STATE_FIELD]=ps.DELETE,t)for(let n=t.length-1;n>=0;n--)if(t[n]===e){t.splice(n,1);break}}isDeleted(e){return e[ls.STATE_FIELD]===ps.DELETE}markAsStub(e){e[ls.STATE_FIELD]=ps.STUB}getEntityState(e){return e[ls.STATE_FIELD]}};us.STATE_FIELD="__state__",us=ls=ds([function(e){}],us);const fs=P("autopilot"),ys=fs.token({class:Wa,interface:"ILocalAPIClient",token:"LOCAL_API_CLIENT"});fs.token({class:us,interface:"IUiStateManager",token:"UI_STATE_MANAGER"}),ys.setDependencies({operationSerializer:as,queryResultsDeserializer:ss}),B.setClass(Ja),B.setDependencies({interAppApiClient:$,localApiClient:ys}),console.log("@airport/autopilot loaded");var hs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ms=class{};hs([function(e,t){},function(e,t){},function(e,t){}],ms.prototype,"_localId",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"domain",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"GUID",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"continent",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"country",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"state",void 0),hs([function(e,t){},function(e,t){}],ms.prototype,"metroArea",void 0),hs([function(e,t){}],ms.prototype,"clientTypes",void 0),ms=hs([function(e){},function(e){}],ms);var Is=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Rs=class{};Is([function(e,t){},function(e,t){},function(e,t){}],Rs.prototype,"client",void 0),Is([function(e,t){},function(e,t){},function(e,t){}],Rs.prototype,"type",void 0),Rs=Is([function(e){},function(e){}],Rs);var Es=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _s=class{};Es([function(e,t){},function(e,t){},function(e,t){}],_s.prototype,"_localId",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"domain",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"GUID",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"continent",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"country",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"state",void 0),Es([function(e,t){},function(e,t){}],_s.prototype,"metroArea",void 0),Es([function(e,t){}],_s.prototype,"databaseTypes",void 0),_s=Es([function(e){},function(e){}],_s);var gs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ts=class{};gs([function(e,t){},function(e,t){},function(e,t){}],Ts.prototype,"database",void 0),gs([function(e,t){},function(e,t){},function(e,t){}],Ts.prototype,"type",void 0),Ts=gs([function(e){},function(e){}],Ts);var Os=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let As=class{};Os([function(e,t){},function(e,t){},function(e,t){}],As.prototype,"id",void 0),Os([function(e,t){}],As.prototype,"name",void 0),Os([function(e,t){}],As.prototype,"countries",void 0),Os([function(e,t){}],As.prototype,"userAccounts",void 0),As=Os([function(e){},function(e){}],As);var Ns=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let xs=class{};Ns([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],xs.prototype,"id",void 0),Ns([function(e,t){}],xs.prototype,"abbreviation",void 0),Ns([function(e,t){}],xs.prototype,"name",void 0),Ns([function(e,t){},function(e,t){}],xs.prototype,"continent",void 0),Ns([function(e,t){}],xs.prototype,"userAccounts",void 0),xs=Ns([function(e){},function(e){}],xs);var bs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ws=class{};bs([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],ws.prototype,"id",void 0),bs([function(e,t){}],ws.prototype,"name",void 0),bs([function(e,t){},function(e,t){}],ws.prototype,"country",void 0),bs([function(e,t){}],ws.prototype,"metroAreaStates",void 0),bs([function(e,t){}],ws.prototype,"userAccounts",void 0),ws=bs([function(e){},function(e){}],ws);var Ss=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let vs=class{};Ss([function(e,t){},function(e,t){},function(e,t){}],vs.prototype,"state",void 0),Ss([function(e,t){},function(e,t){},function(e,t){}],vs.prototype,"metroArea",void 0),vs=Ss([function(e){},function(e){}],vs);var Cs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ds=class{};Cs([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Ds.prototype,"id",void 0),Cs([function(e,t){}],Ds.prototype,"abbreviation",void 0),Cs([function(e,t){}],Ds.prototype,"name",void 0),Cs([function(e,t){},function(e,t){}],Ds.prototype,"country",void 0),Cs([function(e,t){}],Ds.prototype,"metroAreaStates",void 0),Cs([function(e,t){}],Ds.prototype,"userAccounts",void 0),Ds=Cs([function(e){},function(e){}],Ds);var Ms=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vs=class{constructor(){this.isLocal=!1}};Ms([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Vs.prototype,"_localId",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"GUID",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"owner",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"isLocal",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"continent",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"country",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"state",void 0),Ms([function(e,t){},function(e,t){}],Vs.prototype,"metroArea",void 0),Ms([function(e,t){}],Vs.prototype,"terminalTypes",void 0),Vs=Ms([function(e){},function(e){}],Vs);var Ps=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ls=class{};Ps([function(e,t){},function(e,t){},function(e,t){}],Ls.prototype,"terminal",void 0),Ps([function(e,t){},function(e,t){},function(e,t){}],Ls.prototype,"type",void 0),Ls=Ps([function(e){},function(e){}],Ls);var Us=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let js=class{};Us([function(e,t){},function(e,t){}],js.prototype,"id",void 0),js=Us([function(e){},function(e){}],js);var Fs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gs=class{};Fs([function(e,t){},function(e,t){}],Gs.prototype,"id",void 0),Fs([function(e,t){}],Gs.prototype,"typeClassifications",void 0),Gs=Fs([function(e){},function(e){}],Gs);var ks=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Bs=class{};ks([function(e,t){},function(e,t){},function(e,t){}],Bs.prototype,"classification",void 0),ks([function(e,t){},function(e,t){},function(e,t){}],Bs.prototype,"type",void 0),Bs=ks([function(e){},function(e){}],Bs);var Hs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $s=class{};Hs([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],$s.prototype,"_localId",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"email",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"passwordHash",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"ranking",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"username",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"GUID",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"domain",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"continent",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"country",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"state",void 0),Hs([function(e,t){},function(e,t){}],$s.prototype,"metroArea",void 0),$s=Hs([function(e){}],$s);const qs={__constructors__:{Classification:js,Client:ms,ClientType:Rs,Continent:As,Country:xs,Database:_s,DatabaseType:Ts,MetroArea:ws,MetroAreaState:vs,State:Ds,Terminal:Vs,TerminalType:Ls,Type:Gs,TypeClassification:Bs,UserAccount:$s},domain:"air",name:"@airport/travel-document-checkpoint"},Ys=qs;function Qs(e){return oi.ddS(Ys.__dbApplication__,e)}oi.setQApplication(qs),Ha.setClass(Ya),Ha.setDependencies({interAppApiClient:$});var Ws=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let zs=class{async ensureApplicationRecords(e,t){await this.transactionManager.transactInternal((async(t,n)=>{await this.updateDomain(e,n);let i,o=this.terminalStore.getApplicationActorMapByDomainAndApplication_Names().get(e.domain);if(o&&(i=o.get(e.name),i&&i.length))return;i=await this.actorDao.findByDomainAndApplication_Names(e.domain,e.name);let r=await this.applicationDao.findByIndex(e.lastIds.applications+1);if(!i||!i.length){const e=this.terminalStore.getFrameworkActor(),t={_localId:null,application:r,terminal:e.terminal,userAccount:e.userAccount,GUID:sr()};await this.actorDao.save(t,n),i=[t]}const a=this.terminalStore.getTerminalState(),s=a.applications.slice();s.push(r);let c=a.applicationActors.slice();c=c.concat(i),this.terminalStore.state.next({...a,applicationActors:c,applications:s})}),t)}async initTerminal(e,t){await this.transactionManager.transactInternal((async e=>{const n=new $s;n.GUID="AIRportA-demo-demo-demo-functionalty",n.username="internalUserAccount";const i=new Vs;i.owner=n,i.isLocal=!0,i.GUID=sr();const o=new Nr;o.userAccount=n,o.terminal=i,o.GUID=sr();const r=await this.getactorDaoAsync();await r.save(o,t);const a=this.terminalStore.getTerminalState();this.terminalStore.state.next({...a,frameworkActor:o,terminal:i})}),t)}async updateDomain(e,t){let n=this.terminalStore.getDomainMapByName().get(e.domain);if(n&&this.entityStateManager.getOriginalValues(n))return n;let i,o=await this.domainDao.findByName(e.domain);if(n?o&&(this.entityStateManager.setOriginalValues(this.entityStateManager.getOriginalValues(o),n),i=n):o?i=o:(i={_localId:null,name:e.domain},await this.domainDao.save(i,t)),!i)return n;const r=this.terminalStore.getTerminalState(),a=r.domains.slice();let s=!1;for(let e=0;e<a.length;e++){a[e].name===n.name&&(a.splice(e,1,n),s=!0)}return s||a.push(n),this.terminalStore.state.next({...r,domains:a}),i}};Ws([function(e,t){}],zs.prototype,"actorDao",void 0),Ws([function(e,t){}],zs.prototype,"applicationDao",void 0),Ws([function(e,t){}],zs.prototype,"domainDao",void 0),Ws([function(e,t){}],zs.prototype,"entityStateManager",void 0),Ws([function(e,t){}],zs.prototype,"terminalStore",void 0),Ws([function(e,t){}],zs.prototype,"transactionManager",void 0),zs=Ws([function(e){}],zs);var Js=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ks=class{callApi(e){throw new Error("InternalTransactionalConnector.callApi should never be called.\nInteral Application API requests should be made directly (since\nthey are internal to the AIRport framework).")}async addRepository(e){return await this.transactionalServer.addRepository(this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...e})}async find(e,t,n){return await this.transactionalServer.find(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async findOne(e,t,n){return await this.transactionalServer.findOne(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}search(e,t,n){return this.transactionalServer.search(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}searchOne(e,t,n){return this.transactionalServer.searchOne(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async save(e,t){return await this.transactionalServer.save(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async saveToDestination(e,t,n){return await this.transactionalServer.saveToDestination(e,t,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...n})}async insertValues(e,t,n){return await this.transactionalServer.insertValues(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async insertValuesGetLocalIds(e,t){return await this.transactionalServer.insertValuesGetLocalIds(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async updateValues(e,t){return await this.transactionalServer.updateValues(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async deleteWhere(e,t){return await this.transactionalServer.deleteWhere(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}onMessage(e){}};var Zs,Xs;Js([function(e,t){}],Ks.prototype,"terminalStore",void 0),Js([function(e,t){}],Ks.prototype,"transactionalServer",void 0),Ks=Js([function(e){}],Ks),function(e){e.GO_ONLINE="GO_ONLINE",e.REMOTE="REMOTE",e.LOCAL="LOCAL"}(Zs||(Zs={})),function(e){e.NOT_AIR_ENTITY="NOT_AIR_ENTITY",e.AIR_ENTITY="AIR_ENTITY"}(Xs||(Xs={}));const ec=new io({applicationActors:[],applicationInitializer:{applicationWindowMap:new Map,initializingApplicationMap:new Map},applications:[],domains:[],frameworkActor:null,internalConnector:{dbName:"",internalCredentials:{application:null,domain:"internal://domain",methodName:null,objectName:null},serverUrl:""},lastIds:{columns:0,domains:0,entities:0,properties:0,propertyColumns:0,relations:0,relationColumns:0,applications:0,applicationVersions:0},receiver:{initializedApps:new Set,initializingApps:new Set},sequenceGenerator:{sequences:[],sequenceBlocks:[],generatingSequenceNumbers:!1},terminal:null,transactionManager:{pendingTransactionQueue:[],rootTransactionInProgressMap:new Map,transactionInProgressMap:new Map},webReceiver:{domainPrefix:"",localDomain:"",mainDomainFragments:[],onClientMessageCallback:null,pendingApplicationCounts:new Map,pendingHostCounts:new Map,pendingInterAppApiCallMessageMap:new Map,subsriptionMap:new Map}});var tc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nc=class{constructor(){this.terminalState=ec}};nc=tc([function(e){}],nc);var ic=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let oc=class{get state(){return this.terminalState.terminalState}async init(){this.getTerminalState=this.selectorManager.createRootSelector(this.state),this.getApplicationActors=this.selectorManager.createSelector(this.getTerminalState,(e=>e.applicationActors)),this.getApplicationInitializer=this.selectorManager.createSelector(this.getTerminalState,(e=>e.applicationInitializer)),this.getApplicationActorMapByDomainAndApplication_Names=this.selectorManager.createSelector(this.getApplicationActors,(e=>{const t=new Map;for(const n of e){const e=qe(t,n.application.domain.name);let i=e.get(n.application.name);i||(i=[],e.set(n.application.name,i)),i.push(n)}return t})),this.getDomains=this.selectorManager.createSelector(this.getTerminalState,(e=>e.domains)),this.getDomainMapByName=this.selectorManager.createSelector(this.getDomains,(e=>{const t=new Map;for(const n of e)t.set(n.name,n);return t})),this.getFrameworkActor=this.selectorManager.createSelector(this.getTerminalState,(e=>e.frameworkActor)),this.getInternalConnector=this.selectorManager.createSelector(this.getTerminalState,(e=>e.internalConnector)),this.getLastIds=this.selectorManager.createSelector(this.getTerminalState,(e=>e.lastIds)),this.getLatestApplicationVersionMapByNames=this.selectorManager.createSelector(this.getDomains,(e=>{const t=new Map;for(const n of e){const e=qe(t,n.name);for(const t of n.applications)e.set(t.name,t.currentVersion[0].applicationVersion)}return t})),this.getLatestApplicationVersionMapByFullApplication_Name=this.selectorManager.createSelector(this.getLatestApplicationVersionMapByNames,(e=>{const t=new Map;for(const n of e.values())for(const e of n.values())t.set(e.application.fullName,e);return t})),this.getAllApplicationVersionsByIds=this.selectorManager.createSelector(this.getDomains,(e=>{const t=[];for(const n of e)for(const e of n.applications)for(const n of e.versions)t[n._localId]=n;return t})),this.getLatestApplicationVersionsByApplication_Indexes=this.selectorManager.createSelector(this.getDomains,(e=>{const t=[];for(const n of e)for(const e of n.applications)t[e.index]=e.currentVersion[0].applicationVersion;return t})),this.getApplications=this.selectorManager.createSelector(this.getTerminalState,(e=>e.applications)),this.getAllEntities=this.selectorManager.createSelector(this.getLatestApplicationVersionsByApplication_Indexes,(e=>{const t=[];for(const n of e)if(n)for(const e of n.entities)t[e._localId]=e;return t})),this.getAllColumns=this.selectorManager.createSelector(this.getAllEntities,(e=>{const t=[];for(const n of e)if(n)for(const e of n.columns)t[e._localId]=e;return t})),this.getAllRelations=this.selectorManager.createSelector(this.getAllEntities,(e=>{const t=[];for(const n of e)if(n)for(const e of n.relations)t[e._localId]=e;return t})),this.getReceiver=this.selectorManager.createSelector(this.getTerminalState,(e=>e.receiver)),this.getSequenceGenerator=this.selectorManager.createSelector(this.getTerminalState,(e=>e.sequenceGenerator)),this.getTransactionManager=this.selectorManager.createSelector(this.getTerminalState,(e=>e.transactionManager)),this.getWebReceiver=this.selectorManager.createSelector(this.getTerminalState,(e=>e.webReceiver))}tearDown(){}};var rc,ac;ic([function(e,t){}],oc.prototype,"selectorManager",void 0),ic([function(e,t){}],oc.prototype,"terminalState",void 0),oc=ic([function(e){}],oc),function(e){e.ADD_REPOSITORY="ADD_REPOSITORY",e.APP_INITIALIZING="APP_INITIALIZING",e.APP_INITIALIZED="APP_INITIALIZED",e.CALL_API="CALL_API",e.DELETE_WHERE="DELETE_WHERE",e.FIND="FIND",e.FIND_ONE="FIND_ONE",e.GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME="GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME",e.INSERT_VALUES="INSERT_VALUES",e.INSERT_VALUES_GET_IDS="INSERT_VALUES_GET_IDS",e.RETRIEVE_DOMAIN="RETRIEVE_DOMAIN",e.SEARCH="SEARCH",e.SEARCH_ONE="SEARCH_ONE",e.SEARCH_UNSUBSCRIBE="UNSUBSCRIBE",e.SAVE="SAVE",e.SAVE_TO_DESTINATION="SAVE_TO_DESTINATION",e.UPDATE_VALUES="UPDATE_VALUES"}(rc||(rc={})),function(e){e.NOT_INITIALIED="NOT_INITIALIED",e.START_INITIALIZING="START_INITIALIZING",e.INITIALIZING_IN_PROGRESS="INITIALIZING_IN_PROGRESS",e.INITIALIZED="INITIALIZED"}(ac||(ac={}));const sc={api:null,application:null,appState:ac.NOT_INITIALIED,domain:null,hostServer:"http://localhost:7500",mainDomain:null,observableMessageMap:new Map,pendingMessageMap:new Map,messageCallback:null};var cc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let lc=class{constructor(){this.applicationState=sc}get state(){return this.applicationState}};lc=cc([function(e){}],lc);var pc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let dc=class{createSelector(...e){if(e.length<2||e.length>6)throw new Error("Invalid createSelector call, Expecting 1 to 5 selectors and a callback.");const t=e.slice(0,e.length-1),n=e[e.length-1];let i;i=t.length>1?go(t.map((e=>e.observable))):t[0].observable;let o=i.pipe((void 0===a&&(a=Wi),r=null!=r?r:Oo,Zi((function(e,t){var n,i=!0;e.subscribe(new Xi(t,(function(e){var o=a(e);!i&&r(n,o)||(i=!1,n=o,t.next(e))})))}))),To((e=>n(e))));var r,a;return this.getSelector(o)}createRootSelector(e){return this.getSelector(e)}getSelector(e){let t=function(){let t;return e.subscribe((e=>t=e)).unsubscribe(),t};return t.observable=e,t}};dc=pc([function(e){}],dc);var uc;!function(e){e.ARRAY="ARRAY",e.BOOLEAN="BOOLEAN",e.BOOLEAN_VALUE="BOOLEAN_VALUE",e.DATE="DATE",e.DB_ENTITY="DB_ENTITY",e.NUMBER="NUMBER",e.NUMBER_VALUE="NUMBER_VALUE",e.OBJECT="OBJECT",e.STRING="STRING",e.STRING_VALUE="STRING_VALUE",e.TYPE_UNION="TYPE_UNION"}(uc||(uc={}));const fc=P("check-in"),yc=fc.token({class:null,interface:"IApiRegistry",token:"API_REGISTRY"}),hc=fc.token({class:null,interface:"IApiValidator",token:"API_VALIDATOR"});yc.setDependencies({containerAccessor:H});const mc=P("apron");mc.token({class:null,interface:"IApplicationLoader",token:"APPLICATION_LOADER"});const Ic=mc.token({class:lc,interface:"IApplicationStore",token:"APPLICATION_STORE"}),Rc=mc.token({class:null,interface:"ILocalAPIServer",token:"LOCAL_API_SERVER"}),Ec=mc.token({class:dc,interface:"ISelectorManager",token:"SELECTOR_MANAGER"});Rc.setDependencies({apiRegistry:yc});const _c=P("terminal-map"),gc=_c.token({class:null,interface:"IApplicationInitializer",token:"APPLICATION_INITIALIZER"}),Tc=_c.token({class:null,interface:"IDomainRetriever",token:"DOMAIN_RETRIEVER"}),Oc=_c.token({class:null,interface:"IStoreDriver",token:"STORE_DRIVER"}),Ac=_c.token({class:nc,interface:"ITerminalStateContainer",token:"TERMINAL_STATE"}),Nc=_c.token({class:oc,interface:"ITerminalStore",token:"TERMINAL_STORE"}),xc=_c.token({class:null,interface:"ITransactionManager",token:"TRANSACTION_MANAGER"}),bc=_c.token({class:null,interface:"ITransactionalReceiver",token:"TRANSACTIONAL_RECEIVER"}),wc=_c.token({class:null,interface:"ITransactionalServer",token:"TRANSACTIONAL_SERVER"});gc.setDependencies({airportDatabase:Qo,sequenceGenerator:Ze,terminalStore:Nc}),Tc.setDependencies({transactionalConnector:Xe}),Nc.setDependencies({selectorManager:Ec,terminalState:Ac}),xc.setDependencies({storeDriver:Oc,terminalStore:Nc}),bc.setDependencies({applicationInitializer:gc,dbApplicationUtils:Je}),wc.setDependencies({terminalStore:Nc,transactionManager:xc});var Sc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let vc=class{constructor(){this.online=!1}async goOffline(e={}){this.repositoryManager.goOffline(),this.online=!1}async goOnline(e={}){await this.transactionManager.transactInternal((async()=>{try{this.repositoryManager.setUpdateStateForAll(Zs.GO_ONLINE);const e=await this.repositoryDao.findReposWithDetailsByIds();let t=[];e.forEach((e=>{t.push(this.repositoryGoOnline(e,this.repositoryManager))})),await Promise.all(t),this.online=!0}catch(e){throw e}finally{this.repositoryManager.setUpdateStateForAll(Zs.LOCAL)}}),e)}async repositoryGoOnline(e,t){let n=t.deltaStore[e._localId],i=[];await n.goOnline((async n=>{if(n.length)if(n=n.map((e=>e=new gr(e))),t.getUpdateState(e)===Zs.GO_ONLINE)i.push(n);else try{t.setUpdateState(e,Zs.REMOTE),await this.offlineDeltaStore.addRemoteChanges(e,n)}catch(e){throw e}finally{t.setUpdateState(e,Zs.LOCAL)}}));let o=await n.loadTransactionsSinceLastKnown(e.lastSyncedTransaction),r=[];for(;o.hasNext();)r.push(o.next());for(r.length&&await this.offlineDeltaStore.addRemoteChanges(e,r);i.length;)r=i,i=[],await this.offlineDeltaStore.addRemoteChanges(e,r);let a=await this.repositoryTransactionHistoryDao.findUnsyncedTransactions(e);for(a.length&&(a.forEach((e=>{e.syncStatus=Fe.SYNCHRONIZED})),await n.addChanges(n.config.changeListConfig,a),await this.offlineDeltaStore.markChangesAsSynced(e,null));i.length;)r=i,i=[],await this.offlineDeltaStore.addRemoteChanges(e,r);this.online=!0}isOnline(e={}){return this.online}};Sc([function(e,t){}],vc.prototype,"repositoryDao",void 0),Sc([function(e,t){}],vc.prototype,"repositoryManager",void 0),Sc([function(e,t){}],vc.prototype,"repositoryTransactionHistoryDao",void 0),Sc([function(e,t){}],vc.prototype,"transactionManager",void 0),vc=Sc([function(e){}],vc);var Cc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Dc=class{async processMessage(e){let t,n;try{if("internal://domain"===e.domain)throw new Error("Internal domain cannot be used in external calls");let i={application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName,transactionId:e.transactionId},o={};o.startedAt=new Date;const{theErrorMessage:r,theResult:a}=await this.doProcessMessage(e,i,o);n=r,t=a}catch(e){console.error(e),t=null,n=e.message}return{application:e.application,category:"FromDb",domain:e.domain,errorMessage:n,id:e.id,type:e.type,result:t}}async doProcessMessage(e,t,n){let i=null,o=null;switch(e.type){case rc.APP_INITIALIZING:const r=e.jsonApplication,a=this.dbApplicationUtils.getFullApplication_Name(r);if(a!==this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application)){o=null;break}if(this.terminalStore.getReceiver().initializingApps.has(a))return{theErrorMessage:i,theResult:o};this.terminalStore.getReceiver().initializingApps.add(a),await this.databaseManager.initFeatureApplications({},[r]),await this.internalRecordManager.ensureApplicationRecords(r,{}),o=r.lastIds;break;case rc.APP_INITIALIZED:return this.terminalStore.getReceiver().initializedApps.add(e.fullApplication_Name),{theErrorMessage:i,theResult:o};case rc.GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME:o=this.terminalStore.getLatestApplicationVersionMapByFullApplication_Name().get(e.fullApplication_Name);break;case rc.RETRIEVE_DOMAIN:o=this.terminalStore.getDomainMapByName().get(e.domain);break;case rc.ADD_REPOSITORY:o=await this.transactionalServer.addRepository(t,n);break;case rc.DELETE_WHERE:const s=e;o=await this.transactionalServer.deleteWhere(s.portableQuery,t,n);break;case rc.FIND:const c=e;o=await this.transactionalServer.find(c.portableQuery,t,{...n,repository:c.repository});break;case rc.FIND_ONE:const l=e;o=await this.transactionalServer.findOne(l.portableQuery,t,{...n,repository:l.repository});break;case rc.INSERT_VALUES:const p=e;o=await this.transactionalServer.insertValues(p.portableQuery,t,n);break;case rc.INSERT_VALUES_GET_IDS:const d=e;o=await this.transactionalServer.insertValuesGetLocalIds(d.portableQuery,t,n);break;case rc.SAVE:case rc.SAVE_TO_DESTINATION:{const r=e;if(!r.dbEntity){i="DbEntity id was not passed in";break}const a=r.dbEntity._localId,s=this.terminalStore.getAllEntities()[a];if(!s){i=`Could not find DbEntity with Id ${a}`;break}if(n.dbEntity=s,e.type===rc.SAVE)o=await this.transactionalServer.save(r.entity,t,n);else{const i=e;o=await this.transactionalServer.saveToDestination(i.repositoryDestination,i.entity,t,n)}break}case rc.SEARCH:const u=e;o=await this.transactionalServer.search(u.portableQuery,t,{...n,repository:u.repository});break;case rc.SEARCH_ONE:const f=e;o=await this.transactionalServer.search(f.portableQuery,t,{...n,repository:f.repository});break;case rc.UPDATE_VALUES:const y=e;o=await this.transactionalServer.updateValues(y.portableQuery,t,n);break;default:return{theErrorMessage:i,theResult:o}}return{theErrorMessage:i,theResult:o}}async startApiCall(e,t,n){const i={application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName,transactionId:e.transactionId};if(!await this.transactionalServer.startTransaction(i,t))return!1;const o=t.transaction.initiator;o.application=e.application,o.domain=e.domain,o.methodName=e.methodName,o.objectName=e.objectName,e.transactionId=t.transaction.id;try{await n()}catch(e){return t.errorMessage=e.message,this.transactionalServer.rollback(i,t),!1}return!0}async endApiCall(e,t,n){return t?await this.transactionalServer.rollback(e,n):await this.transactionalServer.commit(e,n)}};Cc([function(e,t){}],Dc.prototype,"databaseManager",void 0),Cc([function(e,t){}],Dc.prototype,"dbApplicationUtils",void 0),Cc([function(e,t){}],Dc.prototype,"internalRecordManager",void 0),Cc([function(e,t){}],Dc.prototype,"terminalStore",void 0),Cc([function(e,t){}],Dc.prototype,"transactionManager",void 0),Cc([function(e,t){}],Dc.prototype,"transactionalServer",void 0),Dc=Cc([function(e){}],Dc);var Mc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vc=class{async init(e={}){return await this.transactionManager.initialize("airport",e)}async addRepository(e,t){(t.transaction||e.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(e,t);const n=await this.getActor(e);let i=0;return await this.transactionManager.transactInternal((async()=>{const e=await this.repositoryManager.createRepository(n,t);i=e._localId}),t),i}async find(e,t,n,i){return(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),await this.queryManager.find(e,n,i)}async findOne(e,t,n,i){return(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),await this.queryManager.findOne(e,n,i)}search(e,t,n,i){return(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),this.queryManager.search(e,n)}searchOne(e,t,n,i){return(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),this.queryManager.searchOne(e,n)}async startTransaction(e,t){try{return await this.transactionManager.startTransaction(e,t),!0}catch(e){return t.errorMessage=e.message,console.error(e),!1}}async commit(e,t){try{return await this.transactionManager.commit(e,t),!0}catch(e){return console.error(e),t.errorMessage=e.message,!1}}async rollback(e,t){try{return await this.transactionManager.rollback(e,t),!0}catch(e){return console.error(e),t.errorMessage=e.message,!1}}async save(e,t,n){if(!e)return null;(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return n.actor=i,await this.transactionManager.transactInternal((async(t,n)=>{o=await this.operationManager.performSave(e,i,t,n.rootTransaction,n)}),n),o}async saveToDestination(e,t,n,i){if(!t)return null;(i.transaction||n.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(n,i);const o=await this.getActor(n);let r;return i.actor=o,await this.transactionManager.transactInternal((async(e,n)=>{r=await this.operationManager.performSave(t,o,e,n.rootTransaction,n)}),i),r}async insertValues(e,t,n,i){(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n);const o=await this.getActor(t);let r;return await this.transactionManager.transactInternal((async(t,n)=>{r=await this.insertManager.insertValues(e,o,t,n.rootTransaction,n,i)}),n),r}async insertValuesGetLocalIds(e,t,n){(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.insertManager.insertValuesGetLocalIds(e,i,t,n.rootTransaction,n)}),n),o}async updateValues(e,t,n){(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.updateManager.updateValues(e,i,t,n.rootTransaction,n)}),n),o}async deleteWhere(e,t,n){(n.transaction||t.transactionId)&&this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.deleteManager.deleteWhere(e,i,t,n.rootTransaction,n)}),n),o}async getActor(e){if(this.tempActor)return this.tempActor;if("internal://domain"===e.domain)return this.terminalStore.getFrameworkActor();let t;const n=this.terminalStore.getApplicationActorMapByDomainAndApplication_Names().get(e.domain);if(!n)throw new Error(`No Actors found for\n\tDomain:\n\t\t${e.domain}\n\t\t\t`);if(t=n.get(e.application),!t)throw new Error(`No Actors found for\n\tDomain:\n\t\t${e.domain}\n\tApplication:\n\t\t${e.application}\n\t\t\t`);const i=this.terminalStore.getFrameworkActor().terminal;if(!i.isLocal)throw new Error("Expecting terminal of the TerminalStore.frameworkActor to be .isLocal");let o;for(const e of t)if(e.terminal.GUID===i.GUID){o=e;break}if(!o)throw new Error(`Could not find actor for\n\tDomain:\n\t\t${e.domain}\n\tApplication:\n\t\t${e.application}\n\t\t\t`);return o}};Mc([function(e,t){}],Vc.prototype,"deleteManager",void 0),Mc([function(e,t){}],Vc.prototype,"insertManager",void 0),Mc([function(e,t){}],Vc.prototype,"operationManager",void 0),Mc([function(e,t){}],Vc.prototype,"queryManager",void 0),Mc([function(e,t){}],Vc.prototype,"repositoryManager",void 0),Mc([function(e,t){}],Vc.prototype,"terminalStore",void 0),Mc([function(e,t){}],Vc.prototype,"transactionManager",void 0),Mc([function(e,t){}],Vc.prototype,"updateManager",void 0),Vc=Mc([function(e){}],Vc);var Pc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Lc=class{getPortableQuery(e,t,n,i){return{applicationIndex:e,tableIndex:t,jsonQuery:n.toJSON(this.queryUtils,this.fieldUtils,this.relationManager),parameterMap:n.getParameters(),queryResultType:i}}async doInsertValues(e,t,n,i){const o=t.__driver__.dbEntity,r=[],a=[];for(const e of o.properties){let t={name:e.name,nested:null};if(e.relation&&e.relation.length){const n=e.relation[0];this.applicationUtils.forEachColumnTypeOfRelation(n,((e,n)=>{if(r[e.index])return;r[e.index]=e.index,a[e.index]=t;const i=n[0];for(let e=1;e<i.length;e++){const n={name:i[e],nested:null};t.nested=n,t=n}}))}else{const n=e.propertyColumns[0].column;if(r[n.index])continue;r[n.index]=n.index,a[n.index]=t}}const s=n.map((e=>a.map((t=>{let n=e[t.name];for(;t.nested&&n instanceof Object;)n=n[(t=t.nested).name];return void 0===n?null:n}))));let c=new An({INSERT_INTO:t,columns:null,VALUES:s},r),l=this.getPortableQuery(o.applicationVersion.application.index,o.index,c,null);return await e.insertValues(l,i)}};Pc([function(e,t){}],Lc.prototype,"applicationUtils",void 0),Pc([function(e,t){}],Lc.prototype,"fieldUtils",void 0),Pc([function(e,t){}],Lc.prototype,"queryUtils",void 0),Pc([function(e,t){}],Lc.prototype,"relationManager",void 0),Lc=Pc([function(e){}],Lc);const Uc=[{domain:"air",index:null,name:"@airport/airport-code",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SEQUENCE_INCREMENT_BY",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"CURRENT_VALUE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1},{index:2}],index:0,isLocal:!0,isAirEntity:!1,name:"Sequence",properties:[{columnRef:{index:0},index:0,isId:!0,name:"applicationIndex",sinceVersion:1},{columnRef:{index:1},index:1,isId:!0,name:"tableIndex",sinceVersion:1},{columnRef:{index:2},index:2,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"incrementBy",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"currentValue",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"SEQUENCES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"SYSTEM_WIDE_OPERATION_LID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isAirEntity:!1,name:"SystemWideOperationId",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"SYSTEM_WIDE_OPERATION_LIDS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"TERMINAL_RUN_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"CREATE_TIMESTAMP",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"RANDOM_NUMBER",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:2,isLocal:!0,isAirEntity:!1,name:"TerminalRun",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"createTimestamp",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"randomNumber",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"TERMINAL_RUNS",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/travel-document-checkpoint",sinceVersion:1,versions:[{api:{apiObjectMap:{UserAccountApi:{operationMap:{addUserAccount:{isAsync:!0,parameters:[]},findUserAccount:{isAsync:!0,parameters:[]}}}}},entities:[{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ABBREVIATION",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:5,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:0,isLocal:!0,isAirEntity:!1,name:"Country",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"abbreviation",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"name",sinceVersion:1},{index:3,isId:!1,name:"continent",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"userAccounts",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:5,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"country"},relationType:"ONE_TO_MANY",propertyRef:{index:4},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"COUNTRIES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"STATE_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ABBREVIATION",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isAirEntity:!1,name:"State",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"abbreviation",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"name",sinceVersion:1},{index:3,isId:!1,name:"country",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"metroAreaStates",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"userAccounts",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"state"},relationType:"ONE_TO_MANY",propertyRef:{index:4},relationTableIndex:1,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"state"},relationType:"ONE_TO_MANY",propertyRef:{index:5},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"STATES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:3,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:2,isLocal:!0,isAirEntity:!1,name:"MetroAreaState",properties:[{index:0,isId:!0,name:"state",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"metroArea",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:1,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"METRO_AREA_STATES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:3,isLocal:!0,isAirEntity:!1,name:"MetroArea",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"country",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"metroAreaStates",relationRef:{index:1},sinceVersion:1},{index:4,isId:!1,name:"userAccounts",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"metroArea"},relationType:"ONE_TO_MANY",propertyRef:{index:3},relationTableIndex:2,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"metroArea"},relationType:"ONE_TO_MANY",propertyRef:{index:4},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"METRO_AREAS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"USER_ACCOUNT_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"EMAIL",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"PASSWORD_HASH",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"RANKING",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"USER_ACCOUNTNAME",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"USER_ACCOUNT_GUID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:0,oneTableIndex:11,oneColumnIndex:0,sinceVersion:1}],name:"DOMAIN_LID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:5,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:0,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"NUMBER"},{index:9,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:1,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:9}],sinceVersion:1,type:"NUMBER"},{index:10,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:3,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:10}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:4,isLocal:!0,isAirEntity:!1,name:"UserAccount",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"email",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"passwordHash",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"ranking",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"username",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"GUID",sinceVersion:1},{index:6,isId:!1,name:"domain",relationRef:{index:0},sinceVersion:1},{index:7,isId:!1,name:"continent",relationRef:{index:1},sinceVersion:1},{index:8,isId:!1,name:"country",relationRef:{index:2},sinceVersion:1},{index:9,isId:!1,name:"state",relationRef:{index:3},sinceVersion:1},{index:10,isId:!1,name:"metroArea",relationRef:{index:4},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:11,relationTableApplication_Index:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:5,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:8},relationTableIndex:0,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:9},relationTableIndex:1,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:10},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:5,isLocal:!0,isAirEntity:!1,name:"Continent",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"countries",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"userAccounts",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"continent"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"continent"},relationType:"ONE_TO_MANY",propertyRef:{index:3},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"CONTINENTS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"CLASSIFICATION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:6,isLocal:!0,isAirEntity:!1,name:"Classification",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"CLASSIFICATIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:6,oneColumnIndex:0,sinceVersion:1}],name:"CLASSIFICATION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:7,isLocal:!0,isAirEntity:!1,name:"TypeClassification",properties:[{index:0,isId:!0,name:"classification",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"type",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:6,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TYPE_CLASSIFICATIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:8,isLocal:!0,isAirEntity:!1,name:"Type",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"typeClassifications",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"type"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:7,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TYPES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:10,oneRelationIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"CLIENT_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:9,isLocal:!0,isAirEntity:!1,name:"ClientType",properties:[{index:0,isId:!0,name:"client",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"type",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:10,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"CLIENT_TYPES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"CLIENT_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"CLIENT_DOMAIN",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"CLIENT_GUID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:10,isLocal:!0,isAirEntity:!1,name:"Client",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"domain",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"GUID",sinceVersion:1},{index:3,isId:!1,name:"continent",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"country",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"state",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"metroArea",relationRef:{index:3},sinceVersion:1},{index:7,isId:!1,name:"clientTypes",relationRef:{index:4},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:5,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:1,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:3,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"client"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:9,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"CLIENTS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:12,oneRelationIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"DATABASE_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:11,isLocal:!0,isAirEntity:!1,name:"DatabaseType",properties:[{index:0,isId:!0,name:"database",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"type",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:12,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"DATABASE_TYPE",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"DATABASE_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"DATABASE_DOMAIN",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"DATABASE_GUID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:12,isLocal:!0,isAirEntity:!1,name:"Database",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"domain",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"GUID",sinceVersion:1},{index:3,isId:!1,name:"continent",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"country",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"state",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"metroArea",relationRef:{index:3},sinceVersion:1},{index:7,isId:!1,name:"databaseTypes",relationRef:{index:4},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:5,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:1,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:3,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"database"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:11,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"DATABASES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:14,oneRelationIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:13,isLocal:!0,isAirEntity:!1,name:"TerminalType",properties:[{index:0,isId:!0,name:"terminal",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"type",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:14,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TERMINAL_TYPES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"TERMINAL_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"GUID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LOCAL",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"BOOLEAN"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"OWNER_USER_ACCOUNT_LID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:14,isLocal:!0,isAirEntity:!1,name:"Terminal",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"GUID",sinceVersion:1},{index:2,isId:!1,name:"owner",relationRef:{index:0},sinceVersion:1},{columnRef:{index:2},index:3,isId:!1,name:"isLocal",sinceVersion:1},{index:4,isId:!1,name:"continent",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"country",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"state",relationRef:{index:3},sinceVersion:1},{index:7,isId:!1,name:"metroArea",relationRef:{index:4},sinceVersion:1},{index:8,isId:!1,name:"terminalTypes",relationRef:{index:5},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:4,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:5,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:0,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:1,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:3,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"terminal"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:13,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TERMINALS",propertyIndexes:[{propertyIndex:1,unique:!0}]},operations:{}}],integerVersion:1,referencedApplications:[{domain:"air",index:0,name:"@airport/airspace",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]}],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/airspace",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_RELATION_COLUMN_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:4,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"MANY_APPLICATION_COLUMN_LID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:4,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"ONE_APPLICATION_COLUMN_LID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:5,oneApplication_Index:null,oneTableIndex:1,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"MANY_APPLICATION_RELATION_LID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:6,oneApplication_Index:null,oneTableIndex:1,oneRelationIndex:7,oneColumnIndex:3,sinceVersion:1}],name:"ONE_APPLICATION_RELATION_LID",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:7,oneApplication_Index:null,oneTableIndex:1,oneColumnIndex:3,sinceVersion:1}],name:"PARENT_RELATION_LID",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:0,isLocal:!0,isAirEntity:!1,name:"ApplicationRelationColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{index:4,isId:!1,name:"manyColumn",relationRef:{index:3},sinceVersion:1},{index:5,isId:!1,name:"oneColumn",relationRef:{index:4},sinceVersion:1},{index:6,isId:!1,name:"manyRelation",relationRef:{index:5},sinceVersion:1},{index:7,isId:!1,name:"oneRelation",relationRef:{index:6},sinceVersion:1},{index:8,isId:!1,name:"parentRelation",relationRef:{index:7},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:4,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:4,sinceVersion:1},{index:5,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:1,sinceVersion:1},{index:6,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:1,sinceVersion:1},{index:7,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:8},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_RELATION_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_RELATION_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"RELATION_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"FOREIGN_KEY",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"JSON"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"MANY_TO_ONE_ELEMENTS",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"ONE_TO_MANY_ELEMENTS",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"JSON"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"RELATION_TYPE",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"STRING"},{index:9,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LID",notNull:!0,propertyRefs:[{index:10}],sinceVersion:1,type:"BOOLEAN"},{index:10,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:2,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_PROPERTY_LID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:11,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:6,oneRelationIndex:7,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:11}],sinceVersion:1,type:"NUMBER"},{index:12,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:5,oneApplication_Index:null,oneTableIndex:6,oneRelationIndex:8,oneColumnIndex:3,sinceVersion:1}],name:"RELATION_APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:12}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:1,isLocal:!0,isAirEntity:!1,name:"ApplicationRelation",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{index:5,isId:!1,name:"property",relationRef:{index:3},sinceVersion:1},{columnRef:{index:5},index:6,isId:!1,name:"foreignKey",sinceVersion:1},{columnRef:{index:6},index:7,isId:!1,name:"manyToOneElems",sinceVersion:1},{columnRef:{index:7},index:8,isId:!1,name:"oneToManyElems",sinceVersion:1},{columnRef:{index:8},index:9,isId:!1,name:"relationType",sinceVersion:1},{columnRef:{index:9},index:10,isId:!1,name:"isId",sinceVersion:1},{index:11,isId:!1,name:"entity",relationRef:{index:4},sinceVersion:1},{index:12,isId:!1,name:"relationEntity",relationRef:{index:5},sinceVersion:1},{index:13,isId:!1,name:"manyRelationColumns",relationRef:{index:6},sinceVersion:1},{index:14,isId:!1,name:"oneRelationColumns",relationRef:{index:7},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:2,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:11},relationTableIndex:6,sinceVersion:1},{index:5,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:12},relationTableIndex:6,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"manyRelation"},relationType:"ONE_TO_MANY",propertyRef:{index:13},relationTableIndex:0,sinceVersion:1},{index:7,isId:!1,oneToManyElems:{mappedBy:"oneRelation"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_RELATIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_PROPERTY_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"PROPERTY_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:6,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:2,isLocal:!0,isAirEntity:!1,name:"ApplicationProperty",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isId",sinceVersion:1},{index:7,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{index:8,isId:!1,name:"propertyColumns",relationRef:{index:4},sinceVersion:1},{index:9,isId:!1,name:"relation",relationRef:{index:5},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:6,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"property"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:3,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"property"},relationType:"ONE_TO_MANY",propertyRef:{index:9},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_PROPERTIES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:4,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_COLUMN_LID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:2,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_PROPERTY_LID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3},{index:4}],index:3,isLocal:!0,isAirEntity:!1,name:"ApplicationPropertyColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{index:3,isId:!0,name:"column",relationRef:{index:3},sinceVersion:1},{index:4,isId:!0,name:"property",relationRef:{index:4},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:4,sinceVersion:1},{index:4,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:2,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_PROPERTY_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_COLUMN_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"ID_INDEX",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_GENERATED",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"ALLOCATION_SIZE",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:8}],sinceVersion:1,type:"STRING"},{index:9,isGenerated:!1,manyRelationColumnRefs:[],name:"NOT_NULL",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"BOOLEAN"},{index:10,isGenerated:!1,manyRelationColumnRefs:[],name:"PRECISION",notNull:!1,propertyRefs:[{index:10}],sinceVersion:1,type:"NUMBER"},{index:11,isGenerated:!1,manyRelationColumnRefs:[],name:"SCALE",notNull:!1,propertyRefs:[{index:11}],sinceVersion:1,type:"NUMBER"},{index:12,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!0,propertyRefs:[{index:12}],sinceVersion:1,type:"STRING"},{index:13,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:6,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:13}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:4,isLocal:!0,isAirEntity:!1,name:"ApplicationColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"idIndex",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isGenerated",sinceVersion:1},{columnRef:{index:7},index:7,isId:!1,name:"allocationSize",sinceVersion:1},{columnRef:{index:8},index:8,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:9},index:9,isId:!1,name:"notNull",sinceVersion:1},{columnRef:{index:10},index:10,isId:!1,name:"precision",sinceVersion:1},{columnRef:{index:11},index:11,isId:!1,name:"scale",sinceVersion:1},{columnRef:{index:12},index:12,isId:!1,name:"type",sinceVersion:1},{index:13,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{index:14,isId:!1,name:"propertyColumns",relationRef:{index:4},sinceVersion:1},{index:15,isId:!1,name:"manyRelationColumns",relationRef:{index:5},sinceVersion:1},{index:16,isId:!1,name:"oneRelationColumns",relationRef:{index:6},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:13},relationTableIndex:6,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"column"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:3,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"manyColumn"},relationType:"ONE_TO_MANY",propertyRef:{index:15},relationTableIndex:0,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"oneColumn"},relationType:"ONE_TO_MANY",propertyRef:{index:16},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!0,manyRelationColumnRefs:[],name:"APPLICATION_OPERATION_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"RULE",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:6,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:5,isLocal:!0,isAirEntity:!1,name:"ApplicationOperation",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"type",sinceVersion:1},{index:5,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{columnRef:{index:5},index:6,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:6},index:7,isId:!1,name:"rule",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:6,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_OPERATIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_ENTITY_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LOCAL",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"BOOLEAN"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_AIR_ENTITY",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"STRING"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_CONFIGURATION",notNull:!0,propertyRefs:[{index:8}],sinceVersion:1,type:"JSON"},{index:9,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:8,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:6,isLocal:!0,isAirEntity:!1,name:"ApplicationEntity",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"isLocal",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isAirEntity",sinceVersion:1},{columnRef:{index:7},index:7,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:8},index:8,isId:!1,name:"tableConfig",sinceVersion:1},{index:9,isId:!1,name:"applicationVersion",relationRef:{index:3},sinceVersion:1},{index:10,isId:!1,name:"columns",relationRef:{index:4},sinceVersion:1},{index:11,isId:!1,name:"operations",relationRef:{index:5},sinceVersion:1},{index:12,isId:!1,name:"properties",relationRef:{index:6},sinceVersion:1},{index:13,isId:!1,name:"relations",relationRef:{index:7},sinceVersion:1},{index:14,isId:!1,name:"relationReferences",relationRef:{index:8},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:9},relationTableIndex:8,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:10},relationTableIndex:4,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:11},relationTableIndex:5,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:12},relationTableIndex:2,sinceVersion:1},{index:7,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:13},relationTableIndex:1,sinceVersion:1},{index:8,isId:!1,oneToManyElems:{mappedBy:"relationEntity"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_ENTITIES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_REFERENCE_INDEX",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:null,oneTableIndex:8,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"OWN_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:null,oneTableIndex:8,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"REFERENCED_APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:4},{index:5}],index:7,isLocal:!0,isAirEntity:!1,name:"ApplicationReference",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{index:3,isId:!0,name:"ownApplicationVersion",relationRef:{index:3},sinceVersion:1},{index:4,isId:!0,name:"referencedApplicationVersion",relationRef:{index:4},sinceVersion:1},{columnRef:{index:3},index:5,isId:!1,name:"index",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:8,sinceVersion:1},{index:4,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_REFERENCES",columnIndexes:[]},operations:{}},{columns:[{allocationSize:100,index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"INTEGER_VERSION",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"VERSION_STRING",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"MAJOR_VERSION",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"MINOR_VERSION",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"PATCH_VERSION",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"JSON_APPLICATION",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:10,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:8,isLocal:!0,isAirEntity:!1,name:"ApplicationVersion",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"integerVersion",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"versionString",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"majorVersion",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"minorVersion",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"patchVersion",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"jsonApplication",sinceVersion:1},{index:7,isId:!1,name:"application",relationRef:{index:0},sinceVersion:1},{index:8,isId:!1,name:"entities",relationRef:{index:1},sinceVersion:1},{index:9,isId:!1,name:"references",relationRef:{index:2},sinceVersion:1},{index:10,isId:!1,name:"referencedBy",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:10,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"applicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:6,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"ownApplicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:9},relationTableIndex:7,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"referencedApplicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:10},relationTableIndex:7,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_VERSIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:10,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_LID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:9,isLocal:!0,isAirEntity:!1,name:"ApplicationCurrentVersion",properties:[{index:0,isId:!0,name:"application",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"applicationVersion",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:10,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_CURRENT_VERSIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"GUID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"SCOPE",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_NAME",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"STRING"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"FULL_APPLICATION_NAME",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"STATUS",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"SIGNATURE",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"STRING"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:11,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"DOMAIN_LID",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:10,isLocal:!0,isAirEntity:!1,name:"Application",properties:[{columnRef:{index:0},index:0,isId:!0,name:"index",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"GUID",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"scope",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"fullName",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"status",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"signature",sinceVersion:1},{index:7,isId:!1,name:"domain",relationRef:{index:0},sinceVersion:1},{index:8,isId:!1,name:"versions",relationRef:{index:1},sinceVersion:1},{index:9,isId:!1,name:"currentVersion",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:11,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"application"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"application"},relationType:"ONE_TO_MANY",propertyRef:{index:9},relationTableIndex:9,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"DOMAIN_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:11,isLocal:!0,isAirEntity:!1,name:"Domain",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"applications",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"domain"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:10,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"DOMAINS",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/holding-pattern",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ACTOR_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"GUID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:0,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"USER_ACCOUNT_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:14,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_LID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:1,oneTableIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:0,oneTableIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"CLIENT_LID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:0,isLocal:!0,isAirEntity:!1,name:"Actor",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"GUID",sinceVersion:1},{index:2,isId:!1,name:"userAccount",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"terminal",relationRef:{index:1},sinceVersion:1},{index:4,isId:!1,name:"application",relationRef:{index:2},sinceVersion:1},{index:5,isId:!1,name:"client",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:4,relationTableApplication_Index:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:14,relationTableApplication_Index:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:10,relationTableApplication_Index:1,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:10,relationTableApplication_Index:0,sinceVersion:1}],sinceVersion:1,tableConfig:{columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NEW_VALUE",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"ANY"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:3,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_RECORD_HISTORY_LID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:2}],index:1,isLocal:!0,isAirEntity:!1,name:"RecordHistoryNewValue",properties:[{index:0,isId:!0,name:"recordHistory",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"newValue",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY_NEW_VALUES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"OLD_VALUE",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"ANY"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:3,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_RECORD_HISTORY_LID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:2}],index:2,isLocal:!0,isAirEntity:!1,name:"RecordHistoryOldValue",properties:[{index:0,isId:!0,name:"recordHistory",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"oldValue",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY_OLD_VALUES",columnIndexes:[]},operations:{}},{columns:[{allocationSize:2e3,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"RECORD_HISTORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ACTOR_RECORD_ID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_LID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:12,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"OPERATION_HISTORY_LID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:3,isLocal:!0,isAirEntity:!1,name:"RecordHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"_actorRecordId",sinceVersion:1},{index:2,isId:!1,name:"actor",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"operationHistory",relationRef:{index:1},sinceVersion:1},{index:4,isId:!1,name:"newValues",relationRef:{index:2},sinceVersion:1},{index:5,isId:!1,name:"oldValues",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:12,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"recordHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:4},relationTableIndex:1,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"recordHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:5},relationTableIndex:2,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY",columnIndexes:[{name:"RCRD_HSTR_TO_OPRTN_HSTR_FX",columnList:["REPOSITORY_OPERATION_HISTORY_LID"],unique:!1}]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"TYPE_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:4,isLocal:!0,isAirEntity:!1,name:"RepositoryType",properties:[{index:0,isId:!0,name:"repository",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"type",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:9,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,relationTableApplication_Index:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_TYPES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:12,oneColumnIndex:0,sinceVersion:1}],name:"DATABASE_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:5,isLocal:!0,isAirEntity:!1,name:"RepositoryDatabase",properties:[{index:0,isId:!0,name:"repository",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"database",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:9,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:12,relationTableApplication_Index:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_DATABASES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:7,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"CLIENT_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:6,isLocal:!0,isAirEntity:!1,name:"RepositoryClient",properties:[{index:0,isId:!0,name:"repository",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"client",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:9,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:10,relationTableApplication_Index:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_CLIENTS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:9,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:14,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:7,isLocal:!0,isAirEntity:!1,name:"RepositoryTerminal",properties:[{index:0,isId:!0,name:"repository",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"terminal",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:9,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:14,relationTableApplication_Index:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_TERMINALS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:1,oneTableIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:6,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:8,isLocal:!0,isAirEntity:!1,name:"RepositoryApplication",properties:[{index:0,isId:!0,name:"application",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"repository",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:10,relationTableApplication_Index:1,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:9,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_APPLICATIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"GUID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"AGE_SUITABILITY",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"CREATED_AT",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"DATE"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"IMMUTABLE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"BOOLEAN"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"SOURCE",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:0,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"OWNER_USER_ACCOUNT_LID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:0,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:0,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"COUNTRY_ID",notNull:!1,propertyRefs:[{index:9}],sinceVersion:1,type:"NUMBER"},{index:9,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:0,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"STATE_ID",notNull:!1,propertyRefs:[{index:10}],sinceVersion:1,type:"NUMBER"},{index:10,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:5,oneApplication_Index:0,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"METRO_AREA_ID",notNull:!1,propertyRefs:[{index:11}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:9,isLocal:!0,isAirEntity:!1,name:"Repository",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"GUID",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"ageSuitability",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"createdAt",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"immutable",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"source",sinceVersion:1},{index:6,isId:!1,name:"owner",relationRef:{index:0},sinceVersion:1},{index:7,isId:!1,name:"repositoryTransactionHistory",relationRef:{index:1},sinceVersion:1},{index:8,isId:!1,name:"continent",relationRef:{index:2},sinceVersion:1},{index:9,isId:!1,name:"country",relationRef:{index:3},sinceVersion:1},{index:10,isId:!1,name:"state",relationRef:{index:4},sinceVersion:1},{index:11,isId:!1,name:"metroArea",relationRef:{index:5},sinceVersion:1},{index:12,isId:!1,name:"repositoryApplications",relationRef:{index:6},sinceVersion:1},{index:13,isId:!1,name:"repositoryClients",relationRef:{index:7},sinceVersion:1},{index:14,isId:!1,name:"repositoryDatabases",relationRef:{index:8},sinceVersion:1},{index:15,isId:!1,name:"repositoryTerminals",relationRef:{index:9},sinceVersion:1},{index:16,isId:!1,name:"repositoryTypes",relationRef:{index:10},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:4,relationTableApplication_Index:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:11,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:8},relationTableIndex:5,relationTableApplication_Index:0,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:9},relationTableIndex:0,relationTableApplication_Index:0,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:10},relationTableIndex:1,relationTableApplication_Index:0,sinceVersion:1},{index:5,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:11},relationTableIndex:3,relationTableApplication_Index:0,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:12},relationTableIndex:8,sinceVersion:1},{index:7,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:13},relationTableIndex:6,sinceVersion:1},{index:8,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:5,sinceVersion:1},{index:9,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:15},relationTableIndex:7,sinceVersion:1},{index:10,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:16},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY",columnIndexes:[]},operations:{}},{columns:[{allocationSize:100,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"TRANSACTION_HISTORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TRANSACTION_TYPE",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:10,isLocal:!0,isAirEntity:!1,name:"TransactionHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"transactionType",sinceVersion:1},{index:2,isId:!1,name:"repositoryTransactionHistories",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"transactionHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:11,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TRANSACTION_HISTORY",columnIndexes:[]}},{columns:[{allocationSize:200,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"REPOSITORY_TRANSACTION_HISTORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"REPOSITORY_TRANSACTION_TYPE",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"SAVE_TIMESTAMP",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SYNC_TIMESTAMP",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"GUID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_REPOSITORY_CREATION",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"BOOLEAN"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:9,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:10,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"TRANSACTION_HISTORY_LID",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:11,isLocal:!0,isAirEntity:!1,name:"RepositoryTransactionHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"repositoryTransactionType",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"saveTimestamp",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"syncTimestamp",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"GUID",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"isRepositoryCreation",sinceVersion:1},{index:6,isId:!1,name:"repository",relationRef:{index:0},sinceVersion:1},{index:7,isId:!1,name:"transactionHistory",relationRef:{index:1},sinceVersion:1},{index:8,isId:!1,name:"operationHistory",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:9,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:10,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"repositoryTransactionHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:12,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_TRANSACTION_HISTORY",columnIndexes:[]},operations:{}},{columns:[{allocationSize:600,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"OPERATION_HISTORY_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ORDER_NUMBER",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"CHANGE_TYPE",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SYSTEM_WIDE_OPERATION_LID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:1,oneTableIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:null,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_LID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:null,oneTableIndex:11,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_TRANSACTION_HISTORY_LID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:12,isLocal:!0,isAirEntity:!1,name:"OperationHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"orderNumber",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"changeType",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"systemWideOperationId",sinceVersion:1},{index:4,isId:!1,name:"entity",relationRef:{index:0},sinceVersion:1},{index:5,isId:!1,name:"actor",relationRef:{index:1},sinceVersion:1},{index:6,isId:!1,name:"repositoryTransactionHistory",relationRef:{index:2},sinceVersion:1},{index:7,isId:!1,name:"recordHistory",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:6,relationTableApplication_Index:1,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:11,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"operationHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_OPERATION_HISTORY",columnIndexes:[]}}],integerVersion:1,referencedApplications:[{domain:"air",index:0,name:"@airport/travel-document-checkpoint",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]},{domain:"air",index:1,name:"@airport/airspace",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]}],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/layover",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMNINDEX",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:null,oneTableIndex:1,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"SYNCHRONIZATION_CONFLICT_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:0,isLocal:!0,isAirEntity:!1,name:"SynchronizationConflictValues",properties:[{index:0,isId:!0,name:"synchronizationConflict",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"SYNCHRONIZATION_CONFLICT_VALUES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"SYNCHRONIZATION_CONFLICT_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"ACKNOWLEDGED",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"BOOLEAN"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:0,oneTableIndex:9,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:0,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"OVERWRITTEN_RECORD_HISTORY_LID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:0,oneTableIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"OVERWRITING_RECORD_HISTORY_LID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isAirEntity:!1,name:"SynchronizationConflict",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"type",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"acknowledged",sinceVersion:1},{index:3,isId:!1,name:"repository",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"overwrittenRecordHistory",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"overwritingRecordHistory",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"values",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:9,relationTableApplication_Index:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:3,relationTableApplication_Index:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:3,relationTableApplication_Index:0,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"synchronizationConflict"},relationType:"ONE_TO_MANY",propertyRef:{index:6},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"SYNCHRONIZATION_CONFLICT",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"RECORD_UPDATE_STAGE_LID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ACTOR_RECORD_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"UPDATED_VALUE",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"ANY"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplication_Index:1,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_LID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplication_Index:1,oneTableIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_LID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplication_Index:0,oneTableIndex:9,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_LID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplication_Index:0,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_LID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplication_Index:1,oneTableIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_COLUMN_LID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:2,isLocal:!0,isAirEntity:!1,name:"RecordUpdateStage",properties:[{columnRef:{index:0},index:0,isId:!0,name:"_localId",sinceVersion:1},{index:1,isId:!1,name:"applicationVersion",relationRef:{index:0},sinceVersion:1},{index:2,isId:!1,name:"entity",relationRef:{index:1},sinceVersion:1},{index:3,isId:!1,name:"repository",relationRef:{index:2},sinceVersion:1},{index:4,isId:!1,name:"actor",relationRef:{index:3},sinceVersion:1},{columnRef:{index:1},index:5,isId:!1,name:"_actorRecordId",sinceVersion:1},{index:6,isId:!1,name:"column",relationRef:{index:4},sinceVersion:1},{columnRef:{index:2},index:7,isId:!1,name:"updatedValue",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,relationTableApplication_Index:1,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:6,relationTableApplication_Index:1,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:9,relationTableApplication_Index:0,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:0,relationTableApplication_Index:0,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:4,relationTableApplication_Index:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"RECORD_UPDATE_STAGE",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[{domain:"air",index:0,name:"@airport/holding-pattern",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]},{domain:"air",index:1,name:"@airport/airspace",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]}],versionString:"1.0.0"}]}];var jc=Object.freeze({__proto__:null,BLUEPRINT:Uc}),Fc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gc=class{constructor(){this.initialized=!1}async initNoDb(e,...t){this.airportDatabase.load(),this.transactionalServer.tempActor=new Nr,await this.installStarterApplication(!0,!1,e),await this.applicationInitializer.stage(t,e),this.transactionalServer.tempActor=null,this.initialized=!0}async initWithDb(e,t){this.airportDatabase.load(),this.transactionalServer.tempActor=new Nr,await this.transactionManager.transactInternal((async(t,n)=>{const i=await this.storeDriver.doesTableExist(this.dbApplicationUtils.getFullApplication_Name(Uc[0]),"PACKAGES",n);await this.installStarterApplication(!1,i,n),i||await this.internalRecordManager.initTerminal(e,n),this.transactionalServer.tempActor=null,this.initialized=!0}),{doNotRecordHistory:!0})}isInitialized(){return this.initialized}async initFeatureApplications(e,t){const n=await this.applicationDao.findAllWithJson(),i=new Map;for(const e of n)i.set(e.fullName,e);const o=[];for(const e of t){const t=i.get(this.dbApplicationUtils.getFullApplication_Name(e));t?e.lastIds=t.versions[0].jsonApplication.lastIds:o.push(e)}this.transactionalServer.tempActor=new Nr,await this.applicationInitializer.initialize(o,e,!0,!0),this.transactionalServer.tempActor=null}async installStarterApplication(e,t,n){const i=await Promise.resolve().then((function(){return jc}));e?await this.applicationInitializer.stage(i.BLUEPRINT,n):t?await this.applicationInitializer.hydrate(i.BLUEPRINT,n):await this.applicationInitializer.initialize(i.BLUEPRINT,n,!1,!1)}};Fc([function(e,t){}],Gc.prototype,"airportDatabase",void 0),Fc([function(e,t){}],Gc.prototype,"applicationDao",void 0),Fc([function(e,t){}],Gc.prototype,"applicationInitializer",void 0),Fc([function(e,t){}],Gc.prototype,"dbApplicationUtils",void 0),Fc([function(e,t){}],Gc.prototype,"internalRecordManager",void 0),Fc([function(e,t){}],Gc.prototype,"storeDriver",void 0),Fc([function(e,t){}],Gc.prototype,"transactionalServer",void 0),Fc([function(e,t){}],Gc.prototype,"transactionManager",void 0),Gc=Fc([function(e){}],Gc);var kc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Bc=class{async deleteWhere(e,t,n,i,o){const r=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],a=n.deleteWhere(e,o);if(r.isLocal||n.isSync)return await a;const s=this.getCascadeSubTree(r),c=e.jsonQuery,l={S:s,F:[c.DF],W:c.W},p={applicationIndex:e.applicationIndex,tableIndex:e.tableIndex,jsonQuery:l,queryResultType:xe.ENTITY_TREE,parameterMap:e.parameterMap},d=await n.find(p,{},o),u=new Map,f=new Set;for(const e of d)this.recordRepositoryIds(e,r,u,f,this.applicationUtils);return await this.recordTreeToDelete(u,t,n,i,o),await a}recordRepositoryIds(e,t,n,i,o){const r=e.repository._localId;i.add(r);const a=qe(n,t.applicationVersion.application.index),s=He(qe(a,t.index),r),c={};s.push(c);for(const r of t.properties)if(r.relation&&r.relation.length){if(!e[r.name])continue;const a=r.relation[0];switch(a.relationType){case ce.MANY_TO_ONE:o.forEachColumnOfRelation(a,e,((e,t,n)=>{this.columnProcessed(r,c,e,t)}),!1);break;case ce.ONE_TO_MANY:if(!a.oneToManyElems)continue;let s=e[a.property.name];if(s&&s.length){const e=a.relationEntity;s.forEach((t=>{this.recordRepositoryIds(t,e,n,i,o)}))}break;default:throw new Error(`Unknown relation type: '${a.relationType}' \n\t\t\t\t\t\t\ton '${t.name}.${a.property.name}'.`)}}else{const t=e[r.name];if(null==t)continue;this.columnProcessed(r,c,r.propertyColumns[0].column,t)}}columnProcessed(e,t,n,i){if(void 0===t[n.name])return t[n.name]=i,!1;if(!this.utils.valuesEqual(t[n.name],i))throw new Error(`Found value mismatch in '${e.entity.name}.${e.name}'\n\t\t\t(column: '${n.name}'): ${t[n.name]} !== ${i}`);return!0}async recordTreeToDelete(e,t,n,i,o){let r;for(const[a,s]of e)for(const[e,c]of s){const s=this.airportDatabase.applications[a].currentVersion[0].applicationVersion.entities[e];r||(r=await Zn(this.airportDatabase,this.sequenceGenerator));for(const[e,a]of c){const c=await this.historyManager.getNewRepositoryTransactionHistory(n.transactionHistory,e,o),l=this.repositoryTransactionHistoryDuo.startOperation(c,r,Ee.DELETE_ROWS,s,t,i);for(const e of a){const t=this.operationHistoryDuo.startRecordHistory(l,e.actor._localId,e._actorRecordId);for(const n of s.properties)if(n.relation&&n.relation.length){const i=n.relation[0];switch(i.relationType){case ce.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(i,e,((e,n,i)=>{switch(e.name){case ae.ACTOR_LID:case ae.REPOSITORY_LID:break;default:this.recordHistoryDuo.addOldValue(t,e,n)}}));break;case ce.ONE_TO_MANY:break;default:throw new Error(`Unknown relation type: '${i.relationType}'\n\t\t\t\t\t\t\t\t\t\ton '${s.name}.${n.name}'.`)}}else{const i=n.propertyColumns[0].column;this.recordHistoryDuo.addOldValue(t,i,e[n.name])}}}}}getCascadeSubTree(e,t={}){for(const n of e.properties){let i;if(n.relation&&n.relation.length&&(i=n.relation[0]),i)switch(i.relationType){case ce.ONE_TO_MANY:if(!i.oneToManyElems)continue;const o={};t[n.name]=o,this.getCascadeSubTree(i.relationEntity,o);break;case ce.MANY_TO_ONE:this.applicationUtils.addRelationToEntitySelectClause(i,t);break;default:throw new Error(`Unknown relation type: '${i.relationType}' \n\t\t\t\t\t\t\ton '${e.name}.${n.name}'.`)}else t[n.name]=tt}return t}};kc([function(e,t){}],Bc.prototype,"airportDatabase",void 0),kc([function(e,t){}],Bc.prototype,"applicationUtils",void 0),kc([function(e,t){}],Bc.prototype,"historyManager",void 0),kc([function(e,t){}],Bc.prototype,"operationHistoryDuo",void 0),kc([function(e,t){}],Bc.prototype,"recordHistoryDuo",void 0),kc([function(e,t){}],Bc.prototype,"repositoryTransactionHistoryDuo",void 0),kc([function(e,t){}],Bc.prototype,"sequenceGenerator",void 0),kc([function(e,t){}],Bc.prototype,"utils",void 0),Bc=kc([function(e){}],Bc);var Hc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $c=class{async getNewTransactionHistory(e=Re.LOCAL){return await this.transactionHistoryDuo.getNewRecord(e)}async getNewRepositoryTransactionHistory(e,t,n){return await this.transactionHistoryDuo.getRepositoryTransaction(e,t,!!n.newRepository)}};Hc([function(e,t){}],$c.prototype,"transactionHistoryDuo",void 0),$c=Hc([function(e){}],$c);var qc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yc=class{async insertValues(e,t,n,i,o,r){return await this.internalInsertValues(e,t,n,i,o,!1,r)}async insertValuesGetLocalIds(e,t,n,i,o){return await this.internalInsertValues(e,t,n,i,o,!0)}verifyNoGeneratedColumns(e,t,n){for(let i=0;i<t.C.length;i++){const o=t.C[i],r=e.columns[o];if(r.isGenerated)throw new Error(n+`You cannot explicitly insert into a @GeneratedValue column '${r.name}'`)}return e.columns.filter((e=>e.isGenerated))}async internalInsertValues(e,t,n,i,o,r=!1,a=!0){const s=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],c=`Error inserting into '${s.name}'.'\n`;this.validateValueRowLength(e,c);const l=e.jsonQuery,p={};let d,u=0;for(const e of l.C){if(e<0||e>=s.columns.length)throw new Error(c+`Invalid column index: ${e}`);if(p[e])throw new Error(c+`Column ${s.name}.${s.columns[e].name} \nappears more than once in the Columns clause`);let t=1;for(let n of l.V){if(void 0===n[u])throw new Error(c+`\n\t'undefined' value in column ${s.name}.${s.columns[e].name} of row ${t}.\n\tAll values in an insert statment must either be null or have a non-null value.`);t++}u++,p[e]=!0}const f=e.jsonQuery;let y,h,m;s.isAirEntity&&(d=this.ensureAirEntityIdValues(t,s,f,c,n,o)),n.isSync&&!o.generateOnSync||(y=this.verifyNoGeneratedColumns(s,e.jsonQuery,c)),s.isLocal||(m=await Zn(this.airportDatabase,this.sequenceGenerator)),n.isSync&&!o.generateOnSync||!a||(h=await this.ensureGeneratedValues(s,f,t,d,y,m,c,this.sequenceGenerator)),s.isLocal||n.isSync||await this.addInsertHistory(s,e,t,m,n,i,o);const I=await n.insertValues(e,o);return r?h:I}async validateValueRowLength(e,t){const n=e.jsonQuery.V;if(!n.length)throw new Error(t+"no colum values provided");const i=n[0];if(!i||!i.length)throw new Error(t+"First row has no values");const o=i.length;for(let e=0;e<n.length;e++){const i=n[e];if(i.length!==o)throw new Error(t+`First row has ${o} values,\n\twhile row ${e+1} has ${i.length} values`)}}async ensureGeneratedValues(e,t,n,i,o,r,a,s){const c=t.V,l=e.idColumns,p=[];for(const e of c)p.push([]);let d,u;e.isLocal||(d=i.actorIdColumn,u=i.sysWideOperationIdColumn);for(const i of l){if(i.isGenerated)continue;let o,r=!1;if(t.C.filter(((e,t)=>{if(e===i.index)return o=t,!0})).length<1){if(i._localId!==d._localId)throw new Error(a+`Could not find @Id column ${e.name}.${i.name} in\n\t\t\t\t\tthe insert statement.  Non-generated @Id columns must be present in the Insert\n\t\t\t\t\tstatement (with exception of Actor ID).`);r=!0,o=t.C.length,t.C.push(d.index)}for(let t=0;t<c.length;t++){const s=c[t],l=p[t];let d;if(r)d=n._localId;else if(d=s[o],!d&&0!==d)throw new Error(a+`No value provided on insert for @Id '${e.name}.${i.name}'.`);l[i.index]=d}}const f=[];for(const e of o)t.C.length,f.push(t.C.length),t.C.push(e.index);const y=o.map((e=>c.length)),h=await s.generateSequenceNumbers(o,y);return o.forEach(((e,t)=>{const n=h[t],i=f[t];c.forEach(((t,o)=>{const r=n[o];t[i]=r,p[o][e.index]=r}))})),e.isLocal||(t.C.push(u.index),c.forEach((e=>{e.push(r)}))),l.length||o.length?p:c.length}ensureAirEntityIdValues(e,t,n,i,o,r){const a=t.idColumnMap[ae.ACTOR_LID],s=t.idColumnMap[ae.ACTOR_RECORD_ID],c=t.idColumnMap[ae.REPOSITORY_LID],l=t.columnMap[ae.SYSTEM_WIDE_OPERATION_ID];let p,d=!1,u=!1,f=!1;for(let e=0;e<n.C.length;e++){switch(n.C[e]){case a.index:if(d=!0,r.isSaveOperation)break;if(!o.isSync)throw new Error(i+"You cannot explicitly provide an ACTOR_LID value for Repository entities.");break;case s.index:if(u=!0,!o.isSync)throw new Error(i+"You cannot explicitly provide an ACTOR_RECORD_ID value for Repository entities.");break;case l.index:if(f=!0,!o.isSync)throw new Error(`Error inserting into '${t.name}'.\nYou cannot explicitly provide a SYSTEM_WIDE_OPERATION_ID value for Repository entities.`);break;case c.index:p=e}}const y=i+`Error inserting into '${t.name}'.\nYou must provide a valid REPOSITORY_LID value for Repository entities.`;if(void 0===p)throw new Error(y);if(o.isSync){if(!d)throw new Error(i+"ACTOR_LID must be provided for sync operations.");if(!u)throw new Error(i+"ACTOR_RECORD_ID must be provided for sync operations.");if(!f)throw new Error(i+"SYSTEM_WIDE_OPERATION_ID must be provided for sync operations.")}for(const s of n.V){if(s.length!==n.C.length)throw new Error(i+`Number of columns (${n.C.length}) does not match number of values (${s.length}).\n\t\t\t\t`);let c=s[p];if("number"!=typeof c||!Number.isInteger(c)||c<1)throw new Error(y);for(let e=0;e<s.length;e++){switch(e){case p:continue}const o=s[e],r=n.C[e],a=t.columns[r];if(a.notNull&&null===o)throw new Error(i+`Column '${a.name}' is NOT NULL\nand cannot have NULL values.`)}r.isSaveOperation||o.isSync||(s[a.index]=e._localId)}return{actorIdColumn:a,sysWideOperationIdColumn:l}}async addInsertHistory(e,t,n,i,o,r,a){const s=t.jsonQuery;let c=[],l=[];const p=e.columnMap[ae.REPOSITORY_LID].index,d=e.columnMap[ae.ACTOR_LID].index,u=e.columnMap[ae.ACTOR_RECORD_ID].index;let f,y,h;for(const e in s.C){switch(s.C[e]){case p:f=e;break;case d:y=e;break;case u:h=e}}for(const t of s.V){const p=t[f];let d=l[p];d||(d=await this.historyManager.getNewRepositoryTransactionHistory(o.transactionHistory,p,a));let u=c[p];u||(u=this.repositoryTransactionHistoryDuo.startOperation(d,i,Ee.INSERT_VALUES,e,n,r),c[p]=u);const m=t[h],I=t[y],R=this.operationHistoryDuo.startRecordHistory(u,I,m);for(const n in s.C){if(n===f||n===y||n===h)continue;const i=s.C[n],o=e.columns[i],r=t[n];this.recordHistoryDuo.addNewValue(R,o,r)}}}};qc([function(e,t){}],Yc.prototype,"airportDatabase",void 0),qc([function(e,t){}],Yc.prototype,"historyManager",void 0),qc([function(e,t){}],Yc.prototype,"operationHistoryDuo",void 0),qc([function(e,t){}],Yc.prototype,"recordHistoryDuo",void 0),qc([function(e,t){}],Yc.prototype,"repositoryTransactionHistoryDuo",void 0),qc([function(e,t){}],Yc.prototype,"sequenceGenerator",void 0),Yc=qc([function(e){}],Yc);var Qc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wc=class{async find(e,t,n){await this.ensureRepositoryPresenceAndCurrentState(t);const i=await this.storeDriver.find(e,{},t,n);return await this.populateEntityGuidEntitiesAndUserAccounts(e,i),i}async findOne(e,t,n){await this.ensureRepositoryPresenceAndCurrentState(t);const i=await this.storeDriver.findOne(e,{},t,n);return await this.populateEntityGuidEntitiesAndUserAccounts(e,[i]),i}search(e,t,n){return this.observableQueryAdapter.wrapInObservable(e,(()=>this.storeDriver.find(e,{},t).then((t=>this.populateEntityGuidEntitiesAndUserAccounts(e,t)))))}searchOne(e,t,n){return this.observableQueryAdapter.wrapInObservable(e,(()=>this.storeDriver.findOne(e,{},t).then((t=>this.populateEntityGuidEntitiesAndUserAccounts(e,[t])[0]))))}async ensureRepositoryPresenceAndCurrentState(e){e.repository&&e.repository.source&&e.repository.GUID&&await this.repositoryLoader.loadRepository(e.repository.source,e.repository.GUID,e)}async populateEntityGuidEntitiesAndUserAccounts(e,t){if(e.queryResultType!==xe.ENTITY_GRAPH&&e.queryResultType!==xe.ENTITY_TREE)return;const n=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],i=new Map,o=new Map,r=new Map;return this.markEntities(t,new Set,i,o,r,n),await this.populateActorsAndUserAccounts(o,r),await this.populateRepositories(i),t}markEntities(e,t,n,i,o,r){for(const a of e)if(!t.has(a)){t.add(a);for(const e of r.properties){let r=a[e.name];if(r&&(e.relation&&e.relation.length)){const a=e.relation[0];let s=r;switch(a.relationType){case ce.MANY_TO_ONE:if(this.processRepositoryOrActor(e,r,n,i,o))continue;s=[r];break;case ce.ONE_TO_MANY:}this.markEntities(s,t,n,i,o,a.relationEntity)}}}}processRepositoryOrActor(e,t,n,i,o){let r=!0;switch(e.name){case"actor":break;case"repository":r=!1;break;default:return!1}if(!t._localId)throw new Error("Actor entity does not have a _localId");return t.GUID?!r||(t.userAccount||o.set(t._localId,t),!0):(r?He(i,t._localId).push(t):He(n,t._localId).push(t),!0)}async populateActorsAndUserAccounts(e,t){const n=new Set;for(const t of e.keys())n.add(t);for(const e of t.keys())n.add(e);const i=Array.from(n),o=await this.actorDao.findWithUserAccountBy_LocalIdIn(i);for(const n of o){const i=e.get(n._localId);if(i)for(const e of i)e.actor=n;const o=t.get(n._localId);o&&(o.userAccount=n.userAccount)}}async populateRepositories(e){const t=Array.from(e.keys()),n=await this.repositoryDao.findWithOwnerBy_LocalIdIn(t);for(const t of n){const n=e.get(t._localId);for(const e of n)e.repository=t}}};Qc([function(e,t){}],Wc.prototype,"actorDao",void 0),Qc([function(e,t){}],Wc.prototype,"airportDatabase",void 0),Qc([function(e,t){}],Wc.prototype,"observableQueryAdapter",void 0),Qc([function(e,t){}],Wc.prototype,"repositoryDao",void 0),Qc([function(e,t){}],Wc.prototype,"repositoryLoader",void 0),Qc([function(e,t){}],Wc.prototype,"storeDriver",void 0),Wc=Qc([function(e){}],Wc);var zc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Jc=class extends Lc{async initialize(e,t){return await this.storeDriver.initialize(e,t)}getInProgressTransactionById(e){return this.terminalStore.getTransactionManager().transactionInProgressMap.get(e)}isServer(e){return this.storeDriver.isServer(e)}async transactInternal(e,t){await this.transact({application:"@airport/terminal",domain:"internal://domain",methodName:null,objectName:null},e,t)}async transact(e,t,n){if(n.transaction)return void await t(n.transaction,n);const i=await this.startTransaction(e,n);try{await t(i,n),await this.commit(e,n)}catch(t){throw console.error(t),await this.rollback(e,n),t}}async startTransaction(e,t){if(t.transaction)return;const n=this.terminalStore.getTransactionManager();let i;if(e.transactionId){if(i=n.transactionInProgressMap.get(e.transactionId),!i)throw new Error(`\nRecieved a startTransaction call (@Api call) with parent transaction id:\n\t${e.transactionId}\nBut, there is no such transaction in progress.`);if(i.id!==e.transactionId)throw new Error(`\nIn-progress transaction id does not match the passed in transaction id:\n${e.transactionId}`);this.checkForCircularDependencies(i,e)}else if(!this.isServer(t)&&n.transactionInProgressMap.size>0)return new Promise(((i,o)=>{n.pendingTransactionQueue.unshift({context:t,credentials:e,reject:o,resolve:i})}));const o=await this.internalStartTransaction(e,i,t);return i||(o.numberOfOperations=0),o}async internalStartTransaction(e,t,n){const i=this.terminalStore.getTransactionManager(),o=await this.storeDriver.setupTransaction(n,t);return await this.storeDriver.startTransaction(o,n),o.credentials=e,await this.setupTransaction(e,o,t,i,n),o}async rollback(e,t){const n=this.getTransactionFromContextOrCredentials(e,t);let i=n.parentTransaction;await n.rollback(null,t),await this.clearTransaction(n,i,e,t)&&await this.resumeParentOrPendingTransaction(i,t)}getTransactionFromContextOrCredentials(e,t){let n=t.transaction;if(!n){if(!e.transactionId)throw new Error("\nNo Transaction Id is passed in Credentials for a transactional operation.\n\t\t\t\t");if(n=this.terminalStore.getTransactionManager().transactionInProgressMap.get(e.transactionId),!n)throw new Error(`\nCould not find Transaction: ${e.transactionId} in Transactons in-progress.\nNOTE: nested/child transactions must be commited or rolled back before their\nparent transactions.\n\t\t\t\t`);t.transaction=n}let i=n;for(;i.parentTransaction;i=i.parentTransaction);return t.rootTransaction=i,n}async resumeParentOrPendingTransaction(e,t){const n=this.terminalStore.getTransactionManager();if(e)await this.setupTransaction(e.credentials,e,e.parentTransaction,n,t);else if(n.pendingTransactionQueue.length){const e=n.pendingTransactionQueue.pop(),t=await this.internalStartTransaction(e.credentials,null,e.context);e.resolve(t)}}async commit(e,t){const n=this.getTransactionFromContextOrCredentials(e,t);let i=n.parentTransaction;try{i?t.doNotRecordHistory||this.copyTransactionHistoryToParentTransaction(n,i):t.doNotRecordHistory||await this.saveRepositoryHistory(n,t),this.activeQueries.rerunQueries(),await n.commit(null,t);let o=n.transactionHistory;t.doNotRecordHistory||!i&&o.allRecordHistory.length&&await this.synchronizationOutManager.synchronizeOut(o.repositoryTransactionHistories)}finally{await this.clearTransaction(n,i,e,t)&&await this.resumeParentOrPendingTransaction(i,t)}}copyTransactionHistoryToParentTransaction(e,t){let n=e.transactionHistory,i=t.transactionHistory;for(const e of n.allOperationHistory){const t=e.repositoryTransactionHistory.repository._localId,n=i.repositoryTransactionHistoryMap[t];n?e.repositoryTransactionHistory=n:(i.repositoryTransactionHistoryMap[t]=e.repositoryTransactionHistory,i.repositoryTransactionHistories.push(e.repositoryTransactionHistory))}i.allOperationHistory=i.allOperationHistory.concat(n.allOperationHistory),i.allRecordHistory=i.allRecordHistory.concat(n.allRecordHistory),i.allRecordHistoryNewValues=i.allRecordHistoryNewValues.concat(n.allRecordHistoryNewValues),i.allRecordHistoryOldValues=i.allRecordHistoryOldValues.concat(n.allRecordHistoryOldValues)}checkForCircularDependencies(e,t){if("internal://domain"!==t.domain)do{if(this.isSameSource(e,t)){let n=this.getApiName(t),i=e;do{n=`${this.getApiName(i.initiator)} ->\n${n}`}while(i=i.parentTransaction);throw new Error(`Circular API call detected:\n\t\t\t\t\n${n}\n\n\t\t\t\t`)}}while(e=e.parentTransaction)}async setupTransaction(e,t,n,i,o){if(o.transaction=t,e.transactionId=t.id,o.doNotRecordHistory||(t.transactionHistory=this.transactionHistoryDuo.getNewRecord()),i.transactionInProgressMap.set(t.id,t),n){i.transactionInProgressMap.delete(n.id);let e=t;for(;e.parentTransaction;e=e.parentTransaction);o.rootTransaction=e}else i.rootTransactionInProgressMap.set(t.id,t),o.rootTransaction=t}isSameSource(e,t){const n=e.initiator;return n.domain===t.domain&&n.application===t.application&&n.objectName===t.objectName&&n.methodName===t.methodName}getApiName(e){return`${e.domain}.${e.application}.${e.objectName}.${e.methodName}`}async clearTransaction(e,t,n,i){const o=this.terminalStore.getTransactionManager();return o.transactionInProgressMap.delete(e.id),t||o.rootTransactionInProgressMap.delete(e.id),i.transaction=null,n.transactionId=null,!0}async saveRepositoryHistory(e,t){let n=e.transactionHistory;if(!n.allRecordHistory.length)return!1;let i=n.applicationMap;const o=await this.idGenerator.generateTransactionHistory_LocalIds(n.repositoryTransactionHistories.length,n.allOperationHistory.length,n.allRecordHistory.length);return i.ensureEntity(kr.TransactionHistory.__driver__.dbEntity,!0),n._localId=o.transactionHistory_LocalId,await this.doInsertValues(e,kr.TransactionHistory,[n],t),i.ensureEntity(kr.RepositoryTransactionHistory.__driver__.dbEntity,!0),n.repositoryTransactionHistories.forEach(((e,t)=>{e._localId=o.repositoryHistory_LocalIds[t],e.transactionHistory=n})),await this.doInsertValues(e,kr.RepositoryTransactionHistory,n.repositoryTransactionHistories,t),i.ensureEntity(kr.OperationHistory.__driver__.dbEntity,!0),n.allOperationHistory.forEach(((e,t)=>{e._localId=o.operationHistory_LocalIds[t]})),await this.doInsertValues(e,kr.OperationHistory,n.allOperationHistory,t),i.ensureEntity(kr.RecordHistory.__driver__.dbEntity,!0),n.allRecordHistory.forEach(((e,t)=>{e._localId=o.recordHistory_LocalIds[t]})),await this.doInsertValues(e,kr.RecordHistory,n.allRecordHistory,t),n.allRecordHistoryNewValues.length&&(i.ensureEntity(kr.RecordHistoryNewValue.__driver__.dbEntity,!0),await this.doInsertValues(e,kr.RecordHistoryNewValue,n.allRecordHistoryNewValues,t)),n.allRecordHistoryOldValues.length&&(i.ensureEntity(kr.RecordHistoryOldValue.__driver__.dbEntity,!0),await this.doInsertValues(e,kr.RecordHistoryOldValue,n.allRecordHistoryOldValues,t)),!0}};zc([function(e,t){}],Jc.prototype,"activeQueries",void 0),zc([function(e,t){}],Jc.prototype,"idGenerator",void 0),zc([function(e,t){}],Jc.prototype,"storeDriver",void 0),zc([function(e,t){}],Jc.prototype,"synchronizationOutManager",void 0),zc([function(e,t){}],Jc.prototype,"terminalStore",void 0),zc([function(e,t){}],Jc.prototype,"transactionHistoryDuo",void 0),Jc=zc([function(e){}],Jc);var Kc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zc=class{async updateValues(e,t,n,i,o){const r=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],a=`Error updating '${r.name}'\n`,s={SET:[]};let c,l,p;r.isLocal||n.isSync||(p=await Zn(this.airportDatabase,this.sequenceGenerator),[c,l]=await this.addUpdateHistory(e,t,p,a,n,i,o),s.SET.push({column:l.systemWideOperationIdColumn,value:p}));const d=await n.updateWhere(e,s,o);if(!r.isLocal&&!n.isSync){const t=o.dbEntity;o.dbEntity=r,await this.addNewValueHistory(e.jsonQuery,c,p,l,a,n,o),o.dbEntity=t}return d}async addUpdateHistory(e,t,n,i,o,r,a){if(!a.dbEntity.isAirEntity)throw new Error(i+"Cannot add update history for a non-AirEntity");const s=this.airportDatabase.qApplications[a.dbEntity.applicationVersion.application.index][a.dbEntity.name],c=e.jsonQuery,l=this.applicationUtils.getSheetSelectFromSetClause(a.dbEntity,s,c.S,i),p={S:new Nn(null).nonDistinctSelectClauseToJSON(l.selectClause,this.queryUtils,this.fieldUtils,this.relationManager),F:[c.U],W:c.W},d={applicationIndex:e.applicationIndex,tableIndex:e.tableIndex,jsonQuery:p,queryResultType:xe.SHEET,parameterMap:e.parameterMap},u=await o.find(d,{},a),{recordsByRepositoryId:f,repositoryIdSet:y}=this.groupRecordsByRepository(u,l),h=Array.from(y),m={};for(const e of h){const i={};m[e]=i;const s=await this.historyManager.getNewRepositoryTransactionHistory(o.transactionHistory,e,a),c=this.repositoryTransactionHistoryDuo.startOperation(s,n,Ee.UPDATE_ROWS,a.dbEntity,t,r),p=f[e];for(const e of p){const t=e[l.actorIdColumnIndex],n=$e(i,t),o=e[l.actorRecordIdColumnIndex],r=this.operationHistoryDuo.startRecordHistory(c,t,o);n[o]=r;for(let t=0;t<e.length;t++){switch(t){case l.actorIdColumnIndex:case l.actorRecordIdColumnIndex:case l.repositoryIdColumnIndex:continue}const n=l.selectClause[t].dbColumn,i=e[t];this.recordHistoryDuo.addOldValue(r,n,i)}}}return[m,l]}async addNewValueHistory(e,t,n,i,o,r,a){const s=this.airportDatabase.qApplications[a.dbEntity.applicationVersion.application.index][a.dbEntity.name],c=new Nn({FROM:[s],SELECT:[],WHERE:s[ae.systemWideOperationId].equals(n)});let l=this.queryFacade.getPortableQuery(c,xe.SHEET,a);const p=new Map,d=[];let u=0;for(const e of i.selectClause){const t=e.dbColumn;d.push(t),p.set(t.index,u),u++}const f={SELECT:d},y=await r.find(l,f,a),{recordsByRepositoryId:h,repositoryIdSet:m}=this.groupRecordsByRepository(y,i);for(const n of m){const r=h[n];for(const n of r){const r=n[p.get(i.repositoryIdColumnIndex)],s=n[p.get(i.actorIdColumnIndex)],c=n[p.get(i.actorRecordIdColumnIndex)],l=t[r][s][c];for(const t in e.S){const e=a.dbEntity.columnMap[t],i=n[p.get(e.index)];if(void 0===i)throw new Error(o+"Values cannot be 'undefined'.");if(e.notNull&&null===i)throw new Error(o+`Column '${e.entity.name}'.'${e.name}' is NOT NULL\n\t\t\t\t\t\tand cannot have NULL values.`);this.recordHistoryDuo.addNewValue(l,e,i)}}}}groupRecordsByRepository(e,t){const n={},i=new Set;for(const o of e){const e=o[t.repositoryIdColumnIndex];i.add(e);He(n,e).push(o)}return{recordsByRepositoryId:n,repositoryIdSet:i}}};Kc([function(e,t){}],Zc.prototype,"airportDatabase",void 0),Kc([function(e,t){}],Zc.prototype,"applicationUtils",void 0),Kc([function(e,t){}],Zc.prototype,"fieldUtils",void 0),Kc([function(e,t){}],Zc.prototype,"historyManager",void 0),Kc([function(e,t){}],Zc.prototype,"operationHistoryDuo",void 0),Kc([function(e,t){}],Zc.prototype,"queryFacade",void 0),Kc([function(e,t){}],Zc.prototype,"queryUtils",void 0),Kc([function(e,t){}],Zc.prototype,"recordHistoryDuo",void 0),Kc([function(e,t){}],Zc.prototype,"relationManager",void 0),Kc([function(e,t){}],Zc.prototype,"repositoryTransactionHistoryDuo",void 0),Kc([function(e,t){}],Zc.prototype,"sequenceGenerator",void 0),Zc=Kc([function(e){}],Zc);var Xc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let el=class{verify(e,t){return e instanceof Array||(e=[e]),e}};el=Xc([function(e){}],el);var tl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nl=class{getOperationsInOrder(e,t){const n=this.getEntitiesToPersist(e,[],[],t);this.resolveCircularDependencies(n,t);const i=this.orderEntitiesToPersist(n,t),o=this.optimizePersistOperations(i,t);return this.ensureUpdatesAreGroupedCorrectly(o,t)}getEntitiesToPersist(e,t,n,i,o,r,a=!1){let s=[];const c=i.dbEntity;for(const l of e){const{isCreate:e,isDelete:p,isParentSchemaId:d,isPassThrough:u,isStub:f,isUpdate:y}=this.entityStateManager.getEntityStateTypeAsFlags(l,c);if(f)continue;const h=this.entityStateManager.getOperationUniqueId(l);if(a&&(e||y))throw new Error(`Cannot do a Create or Update operation on an entity that will be\ndeleted by cascading rules.  Entity: ${c.name}.\nEntity "${this.entityStateManager.getUniqueIdFieldName()}":  ${h}`);let m;if(u){if(n[h])continue;n[h]=!0}else{m=t[h];let n=!1;if(m?n=!0:d||a||(m={circleTraversedFor:{},dbEntity:c,dependsOnByOUID:[],dependsOn:[],entity:l,isCreate:e,isDelete:p},s.push(m),t[h]=m),!d&&!p){if(o&&!p){const e=this.entityStateManager.getOperationUniqueId(o.entity);m.dependsOnByOUID[e]||this.entityStateManager.getOperationUniqueId(m.entity)===e||(m.dependsOnByOUID[e]=o,m.dependsOn.push(o))}r&&(m.dependsOnByOUID[h]||this.entityStateManager.getOperationUniqueId(r.entity)===h||(r.dependsOnByOUID[h]=m,r.dependsOn.push(m)))}if(n)continue}for(const o of i.dbEntity.properties){let f,y=l[o.name];if(!y||"object"!=typeof y||!o.relation||!o.relation.length)continue;let I=null,R=!1,E=a||p;const _=o.relation[0];switch(_.relationType){case ce.MANY_TO_ONE:if(E=!1,c.isAirEntity&&("repository"===o.name||"actor"===o.name)&&!y[this.entityStateManager.getStateFieldName()])continue;const t=this.entityStateManager.getEntityStateTypeAsFlags(y,_.relationEntity);if(t.isParentSchemaId)continue;if(t.isDelete)if(u)this.entityStateManager.markForDeletion(l);else{if(!p)throw new Error(`Cannot delete an entity without removing all references to it.\n\t\t\t\t\t\t\t\tFound a reference in ${c.name}.${o.name}.\n\t\t\t\t\t\t\t\tEntity "${this.entityStateManager.getUniqueIdFieldName()}":  ${h}`);a||(r&&r.dependsOn.pop(),s.pop()),a=!0}t.isCreate&&(R=!0),f=[y];break;case ce.ONE_TO_MANY:e&&(I=m),f=y}if(f){const e=_.relationEntity,o=i.dbEntity;i.dbEntity=e;const r=this.getEntitiesToPersist(f,t,n,i,I,d||p||!R?null:m,E);s=s.concat(r),i.dbEntity=o}}}return s}resolveCircularDependencies(e,t){for(const n of e){const e=this.entityStateManager.getOperationUniqueId(n.entity);this.resolveCircularDependenciesForNode(n,e,n,t)}}resolveCircularDependenciesForNode(e,t,n,i,o=[]){if(n.dependsOn&&!n.circleTraversedFor[t]){n.circleTraversedFor[t]=!0;for(let r=n.dependsOn.length-1;r>=0;r--){const a=n.dependsOn[r];if(this.entityStateManager.getOperationUniqueId(a.entity)===t){let e=[];for(let t of o){let n=t.dbEntity.applicationVersion.application.name+":"+t.dbEntity.name;e.push(n)}let t=a.dbEntity.applicationVersion.application.name+":"+a.dbEntity.name;throw e.push(t),t=o[0].dbEntity.applicationVersion.application.name+":"+o[0].dbEntity.name,new Error(`Found a circular dependency in\n\t\t\t\t\t${e.join(" -> ")}\n\t\t\t\t\t`)}o.push(a),this.resolveCircularDependenciesForNode(e,t,a,i,o),o.pop()}}}orderEntitiesToPersist(e,t){let n=[],i=[];for(;n.length<e.length;)for(const t of e){const e=this.entityStateManager.getOperationUniqueId(t.entity);if(i[e])continue;let o=!0;for(const e of t.dependsOn){if(!i[this.entityStateManager.getOperationUniqueId(e.entity)]){o=!1;break}}o&&(i[e]=t,n.push(t))}return n}optimizePersistOperations(e,t){let n=[],i=[],o=[];for(const t of e){const e=t.dbEntity,r=He(o,e.applicationVersion.application.index);let a=r[e.index];a||(a={create:[],delete:[],update:[]},r[e.index]=a);let s,c=[];c=t.isCreate?a.create:t.isDelete?a.delete:a.update,c.length?s=c[c.length-1]:(s={dbEntity:e,entities:[],isCreate:t.isCreate,isDelete:t.isDelete},c.push(s),n.push(s));let l=!0;for(const e of t.dependsOn){const t=this.entityStateManager.getOperationUniqueId(e.entity);if(this.entityStateManager.getOperationUniqueId(e.entity),!i[t]){l=!1;break}}!l&&s.entities.length&&(s={dbEntity:e,entities:[],isCreate:t.isCreate,isDelete:t.isDelete},c.push(s),n.push(s)),s.entities.push(t.entity)}return n}ensureUpdatesAreGroupedCorrectly(e,t){return e}};tl([function(e,t){}],nl.prototype,"entityStateManager",void 0),nl=tl([function(e){}],nl);var il=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ol=class{restoreEntityGraph(e,t){const n=[],i=new Set,o=this.linkEntityGraph(e,n,i,!1,t);for(let e=1;e<n.length;e++){if(!n[e])throw new Error(`Missing entity for\n"${this.entityStateManager.getUniqueIdFieldName()}": ${e}`)}return t.lastOUID=n.length-1,o}linkEntityGraph(e,t,n,i,o){const r=o.dbEntity,a=[];for(const s of e){if(!s)throw new Error("Null root entities and @OneToMany arrays with null entities are not allowed");const e=this.entityStateManager.getOperationUniqueId(s);if(!e||"number"!=typeof e||e<1)throw new Error(`Invalid entity Unique Id Field\n"${this.entityStateManager.getUniqueIdFieldName()}": ${e}.`);const c=t[e];if(n.has(s)){if(!c)throw new Error("Entity has been processed but is not found by operationUniqueId");a.push(c);continue}n.add(s);let l,{isParentSchemaId:p,isStub:d}=this.entityStateManager.getEntityStateTypeAsFlags(s,r);if(c){if(this.entityStateManager.isStub(c))d||this.entityStateManager.copyEntityState(s,c);else if(!d)throw new Error(`More than 1 non-Stub object found in input\nfor "${this.entityStateManager.getUniqueIdFieldName()}": ${e}`);l=c}else l={},l[this.entityStateManager.getUniqueIdFieldName()]=e,l[this.entityStateManager.getStateFieldName()]=this.entityStateManager.getEntityState(s),this.entityStateManager.copyEntityState(s,l),t[e]=l;i&&(this.entityStateManager.markAsOfParentSchema(l),p=!0);for(const e of r.properties){let a=s[e.name];if(void 0!==a){if(e.relation&&e.relation.length){let i=!1;const s=e.relation[0];let c=a,l=!1;switch(this.assertRelationValueIsAnObject(a,e),s.relationType){case ce.MANY_TO_ONE:l=!0,this.assertManyToOneNotArray(a,e),c=[a];break;case ce.ONE_TO_MANY:if(this.assertOneToManyIsArray(a,e),p)throw new Error("Parent Ids may not contain any @OneToMany relations");break;default:throw new Error(`Unexpected relation type ${s.relationType}\nfor ${r.name}.${e.name}`)}const d=o.dbEntity,u=d.applicationVersion.application,f=s.relationEntity.applicationVersion.application;let y;if("air"!==f.domain.name&&u.fullName!==f.fullName&&(i=!0),o.dbEntity=s.relationEntity,a)if(y=this.linkEntityGraph(c,t,n,i,o),l){if(y=y[0],p&&!this.entityStateManager.isParentSchemaId(y)&&!this.entityStateManager.isPassThrough(y))throw new Error("Parent Ids may only contain @ManyToOne relations\nthat are themselves Parent Ids or Pass-Though objects.")}else if(p)throw new Error("Parent Ids may NOT contain @OneToMany colletions.");a=y,o.dbEntity=d}else if(!e.isId){if(d)throw new Error("Deletes and Stubs may only contain @Id properties or relations.");if(p||i)continue}l[e.name]=a}}a.push(l)}return a}assertRelationValueIsAnObject(e,t){if(null!=e&&("object"!=typeof e||e instanceof Date))throw new Error(`Unexpected value in relation property: ${t.name}, \n\t\t\t\tof entity ${t.entity.name}`)}assertManyToOneNotArray(e,t){if(e instanceof Array)throw new Error(`@ManyToOne relation cannot be an array. Relation property: ${t.name}, \nof entity ${t.entity.name}`)}assertOneToManyIsArray(e,t){if(null!=e&&!(e instanceof Array))throw new Error(`@OneToMany relation must be an array. Relation property: ${t.name}, \nof entity ${t.entity.name}\``)}};il([function(e,t){}],ol.prototype,"entityStateManager",void 0),ol=il([function(e){}],ol);var rl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let al=class{async performSave(e,t,n,i,o){let r;if(o.isSaveOperation=!0,o.internal)r=e instanceof Array?e:[e];else{const t=this.cascadeGraphVerifier.verify(e,o);r=this.entityGraphReconstructor.restoreEntityGraph(t,o)}const a=[];if(this.structuralEntityValidator.validate(r,[],a,o),a.length){const e=await this.repositoryManager.createRepository(o.actor,o);for(const t of a)t.record[t.repositoryPropertyName]=e}const s=this.dependencyGraphResolver.getOperationsInOrder(r,o),c=o.dbEntity;let l,p={_localId:t._localId,GUID:t.GUID,userAccount:t.userAccount?{_localId:t.userAccount._localId}:null};o.newRepository&&(l={_localId:o.newRepository._localId,createdAt:o.newRepository.createdAt,GUID:o.newRepository.GUID,ageSuitability:o.newRepository.ageSuitability,source:o.newRepository.source,ownerActor:{_localId:t._localId,GUID:t.GUID,userAccount:t.userAccount?{_localId:t.userAccount._localId}:null}});const d={actor:p,created:{},deleted:{},newRepository:l,repositoryIdParts:{source:l.source,GUID:l.GUID},updated:{}};for(const e of s)o.dbEntity=e.dbEntity,e.isCreate?await this.internalCreate(e.entities,t,n,i,d,o,!0):e.isDelete?await this.internalDelete(e.entities,t,n,i,d,o):await this.internalUpdate(e.entities,t,n,i,d,o);return o.dbEntity=c,d}async internalCreate(e,t,n,i,o,r,a){const s=this.airportDatabase.qApplications[r.dbEntity.applicationVersion.application.index][r.dbEntity.name];let c={INSERT_INTO:s,columns:this.qMetadataUtils.getAllInsertableColumns(s),VALUES:[]},l=[];c.columns.forEach(((e,t)=>{l[e.dbColumn.index]=t}));for(const t of e)t.createdAt=new Date;for(const t of e){let e=[];for(const n of r.dbEntity.properties){let i=t[n.name];if(void 0===i&&(i=null),n.relation&&n.relation.length){const i=n.relation[0];switch(i.relationType){case ce.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(i,t,((t,n,i)=>{t.isGenerated||(e[l[t.index]]=void 0===n?null:n)}),!1);break;case ce.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${i.relationType}' \n\t\t\t\t\t\tfor '${r.dbEntity.name}.${n.name}'.`)}}else{let t=n.propertyColumns[0].column;t.isGenerated||(e[l[t.index]]=i)}}c.VALUES.push(e)}const p=new An(c);if(c.VALUES.length){const s=r.dbEntity.columns.filter((e=>e.isGenerated));if(s.length&&a){const a=this.queryFacade.getPortableQuery(p,null,r),c=await this.insertManager.insertValuesGetLocalIds(a,t,n,i,r);for(let t=0;t<e.length;t++){const n=e[t],i={};o.created[this.entityStateManager.getOperationUniqueId(n)]=i;for(const e of s){const o=e.propertyColumns[0].property.name,r=c[t][e.index];n[o]=r,i[o]=r}}}else{const s=this.queryFacade.getPortableQuery(p,null,r);await this.insertManager.insertValues(s,t,n,i,r,a);for(let t=0;t<e.length;t++){const n=e[t];o.created[this.entityStateManager.getOperationUniqueId(n)]=!0}}}}async internalUpdate(e,t,n,i,o,r){const a=this.airportDatabase.qApplications[r.dbEntity.applicationVersion.application.index][r.dbEntity.name];for(const s of e){const e={},c=[];let l=!1;const p=this.entityStateManager.getOriginalValues(s);if(p){for(const t of r.dbEntity.properties){const n=s[t.name];if(t.relation&&t.relation.length){const n=t.relation[0];switch(n.relationType){case ce.MANY_TO_ONE:let i=p[t.name];this.applicationUtils.forEachColumnOfRelation(n,s,((n,r,p)=>{let d=i,u=r,f=r;for(const e of p[0])d=d instanceof Object&&d[e]?d[e]:null,u instanceof Object&&u[e]?(u=u[e],f.push(e)):u=null;if(t.isId){let e=a;for(const t of p[0])e=e[t];c.push(e.equals(r))}else if(!this.utils.valuesEqual(d,u)){let t=e;for(let e=0;e<f.length-1;e++){const n=f[e];t[n]||(t[n]={}),t=t[n]}t[f.length-1]=u,o.updated[this.entityStateManager.getOperationUniqueId(s)]=!0,l=!0}}),t.isId);break;case ce.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${n.relationType}' \n\t\t\t\t\t\tfor '${r.dbEntity.name}.${t.name}'.`)}}else{const i=p[t.name];t.isId?c.push(a[t.name].equals(n)):this.utils.valuesEqual(i,n)||(e[t.name]=n,o.updated[this.entityStateManager.getOperationUniqueId(s)]=!0,l=!0)}}if(l){let o;o=c.length>1?Nt(...c):c[0];const s=new wn({UPDATE:a,SET:e,WHERE:o}),l=this.queryFacade.getPortableQuery(s,null,r);await this.updateManager.updateValues(l,t,n,i,r)}}}}async internalDelete(e,t,n,i,o,r){const a=r.dbEntity,s=this.airportDatabase.qApplications[a.applicationVersion.application.index][a.name],c=[],l=[];let p,d=[];for(const t of e){for(let e in t){if(!t.hasOwnProperty(e))continue;const n=a.propertyMap[e];if(!n)continue;const i=t[e];let o;if(n.relation&&n.relation.length&&(o=n.relation[0]),o)switch(o.relationType){case ce.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(o,a,((e,t,i)=>{if(n.isId&&void 0===l[e.index]){let e=s;for(const t of i[0])e=e[t];c.push(e.equals(t))}}),!1);break;case ce.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${o.relationType}' \n\t\t\t\t\t\tfor '${a.name}.${n.name}'.`)}else n.isId&&c.push(s[e].equals(i))}c.length>1?d.push(Nt(...c)):d.push(c[0]),o.deleted[this.entityStateManager.getOperationUniqueId(t)]=!0}p=1===d.length?d[0]:xt(...d);let u=new In({DELETE_FROM:s,WHERE:p}),f=this.queryFacade.getPortableQuery(u,null,r);await this.deleteManager.deleteWhere(f,t,n,i,r)}};rl([function(e,t){}],al.prototype,"airportDatabase",void 0),rl([function(e,t){}],al.prototype,"applicationUtils",void 0),rl([function(e,t){}],al.prototype,"cascadeGraphVerifier",void 0),rl([function(e,t){}],al.prototype,"deleteManager",void 0),rl([function(e,t){}],al.prototype,"dependencyGraphResolver",void 0),rl([function(e,t){}],al.prototype,"entityGraphReconstructor",void 0),rl([function(e,t){}],al.prototype,"entityStateManager",void 0),rl([function(e,t){}],al.prototype,"insertManager",void 0),rl([function(e,t){}],al.prototype,"qMetadataUtils",void 0),rl([function(e,t){}],al.prototype,"queryFacade",void 0),rl([function(e,t){}],al.prototype,"repositoryManager",void 0),rl([function(e,t){}],al.prototype,"structuralEntityValidator",void 0),rl([function(e,t){}],al.prototype,"updateManager",void 0),rl([function(e,t){}],al.prototype,"utils",void 0),al=rl([function(e){}],al);var sl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let cl=class{validate(e,t,n,i,o=!1,r=null,a=null,s=null){const c=i.dbEntity;if(!c.idColumns.length)throw new Error(`Cannot run 'save' for entity '${c.name}' with no @Id(s).\n\t\t\t\t\tPlease use non-entity operations (like 'insert' or 'updateWhere') instead.`);let l=!!a;for(const p of e){l||(a=p);const{isCreate:e,isParentSchemaId:d,isPassThrough:u,isStub:f}=this.entityStateManager.getEntityStateTypeAsFlags(p,c);if(d)continue;const y=this.entityStateManager.getOperationUniqueId(p);if(!!t[y])continue;t[y]=!0;let h=!1;for(const l of c.properties){let u=p[l.name];if(void 0!==u||f||(u=null,p[l.name]=u),l.relation&&l.relation.length){const d=l.relation[0];let f=null,y=!1,m=!0;switch(d.relationType){case ce.MANY_TO_ONE:if(l.isId){let t=!1;this.applicationUtils.forEachColumnOfRelation(d,p,((n,o,r)=>{n.notNull&&(m=!1),this.isRepositoryColumnAndNewRepositoryNeed(c,l,n,e,p,o,i)&&(t=!0)}),!1),t&&(i.newRepository?p[l.name]=i.newRepository:(h=!0,n.push({record:p,repositoryPropertyName:l.name})))}if(o){const e=r.relation[0].oneToManyElems,t=e?e.mappedBy:null,n=d.manyToOneElems?d.manyToOneElems.mappedBy:null;t!==l.name&&n!==r.name||(p[l.name]=s)}if(u)if(u)f=[u];else{if(!m)throw new Error(`Non-nullable relation ${c.name}.${l.name} does not have value assigned`);console.warn(`Probably OK: Nullable @ManyToOne ${c.name}.${l.name} does not have anything assigned.`)}break;case ce.ONE_TO_MANY:y=!0,f=u;break;default:throw new Error(`Unexpected relation type ${d.relationType}\nfor ${c.name}.${l.name}`)}if(f&&f.length){const e=i.dbEntity;i.dbEntity=d.relationEntity,this.validate(f,t,n,i,y,l,a,p),i.dbEntity=e}}else{const t=l.propertyColumns[0].column;if(l.isId){const n=this.applicationUtils.isIdEmpty(u);this.ensureIdValue(c,l,t,e,n)}else if((f||d)&&void 0!==u)throw new Error(`Unexpected non-@Id value Stub|ParentSchemaId|Deleted record.\nProperty: ${c.name}.${l.name}, with "${this.entityStateManager.getUniqueIdFieldName()}":  ${y}`);this.ensureNonRelationalValue(l,t,u)}}u||f||d||this.ensureRepositoryValidity(p,a,s,c,r,e,o,h,i)}}ensureRepositoryValidity(e,t,n,i,o,r,a,s,c){if(!i.isAirEntity)return;if(!n){const t=this.entityStateManager.getOriginalValues(e);if(s&&t&&t.repository&&t.actor&&t._actorRecordId){const n=e;n.originalRepository=t.repository,this.entityStateManager.markAsStub(n.originalRepository),n.originalActor=t.actor,this.entityStateManager.markAsStub(n.originalActor),n.originalActorRecordId=t._actorRecordId}return}if(s)return;let l=e;if(t.repository._localId!==l.repository._localId){if(r)throw new Error(`A newly created ${i.name} via ${i.name} record for repository _localId ${l.repository._localId} (GUID: ${l.repository.GUID})\nis being assigned to repository _localId ${l.repository._localId} (GUID: ${l.repository.GUID})\n\tThis is because it is being referenced via ${o.entity.name}.${o.name},\n\tfrom a record of repository _localId ${l.repository._localId} (GUID: ${l.repository.GUID})\n\t\n\tIf you are manually creating a copy of a record in another repository, there is no need,\n\tAIRport automatically copies all records refrenced via @ManyToOne()s into the created/modified\n\trepository.\n\n\tOtherwise, did you mean to set this record's repository to the same one as the referencing record?`);l.originalRepository=l.repository,l.repository=t.repository,l.originalActor=l.actor,l.originalActorRecordId=l._actorRecordId,l.actor=c.actor,delete l._actorRecordId,l[this.entityStateManager.getStateFieldName()]=ye.CREATE}}isRepositoryColumnAndNewRepositoryNeed(e,t,n,i,o,r,a){if(!n.idIndex&&0!==n.idIndex)return;const s=this.applicationUtils.isIdEmpty(r);if(!e.isAirEntity)return this.ensureIdValue(e,t,n,i,s),!1;if(!s){if(i&&this.applicationUtils.isActorId(n.name))throw new Error("Actor cannot be passed in for create Operations");return!1}if(!i)throw new Error("Ids must be populated in entities for non-Create operations");if(this.applicationUtils.isRepositoryId(n.name))return!0;if(this.applicationUtils.isActorId(n.name))return o[t.name]=a.actor,!1;if(this.applicationUtils.isActorRecordId(n.name))return!1;throw new Error(`Unexpected @Id column '${n.name}' in a AirEntity.`)}ensureIdValue(e,t,n,i,o){if(n.isGenerated){if(i&&!o)throw new Error(`@GeneratedValue() @Id() ${e.name}.${t.name},\ncolumn:  ${n.name}\nmust NOT have a value for entity Insert operation.`);if(!i&&o)throw new Error(`@GeneratedValue() @Id() ${e.name}.${t.name} \ncolumn:  ${n.name}\nmust have a value for entity non-Insert operations.`)}else if(o)throw new Error(`non-@GeneratedValue() @Id() ${e.name}.${t.name},\ncolumn:  ${n.name}\nmust always have a value for all entity operations.`)}ensureNonRelationalValue(e,t,n){if(null!=n)switch(t.type){case fe.ANY:break;case fe.BOOLEAN:"boolean"!=typeof n&&this.throwUnexpectedProperty(e,t,n);break;case fe.DATE:"object"==typeof n&&n instanceof Date||this.throwUnexpectedProperty(e,t,n);break;case fe.JSON:("object"!=typeof n||n instanceof Date)&&this.throwUnexpectedProperty(e,t,n);break;case fe.NUMBER:"number"!=typeof n&&this.throwUnexpectedProperty(e,t,n);break;case fe.STRING:"string"!=typeof n&&this.throwUnexpectedProperty(e,t,n)}}throwUnexpectedProperty(e,t,n){throw new Error(`Unexpected property value '${n.toString()}' in property '${e.entity.name}.${e.name}'\n\t\t(column: '${t.name}').`)}};sl([function(e,t){}],cl.prototype,"applicationUtils",void 0),sl([function(e,t){}],cl.prototype,"entityStateManager",void 0),cl=sl([function(e){}],cl);var ll=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let pl=class{deserialize(e,t,n){if(e.length!==t.jsonQuery.parameters.length)throw new Error(`Wrong number of parameters for ${t.dbEntity.name}.${t.jsonQuery.queryName}\n            Received:  ${e.length}\n            Expecting: ${t.jsonQuery.parameters.length}\n            `);const i=[];for(let o=0;o<e.length;o++){const r=this.deserializeParameter(e[o],t.jsonQuery.parameters[o],o+1,t,n);i.push(r)}return i}deserializeParameter(e,t,n,i,o){switch(t.type){case fe.BOOLEAN:this.checkTypeOfParameter(e,"boolean",n,i);break;case fe.DATE:if(!(e instanceof Object&&e[o.getStateFieldName()]===ye.RESULT_DATE&&e.value))throw new Error(`Invalid Serialized Date format for:\n                    ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                    parameter #: ${n}\n        got: ${JSON.stringify(e)}\n                    `);try{return new Date(e)}catch(t){throw new Error(`Invalid Serialized Date format for:\n                    ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                    parameter #: ${n}\n        got: ${JSON.stringify(e)}\n                    `)}break;case fe.NUMBER:this.checkTypeOfParameter(e,"number",n,i);break;case fe.STRING:this.checkTypeOfParameter(e,"string",n,i);break;default:throw new Error(`Unsupported parameter type for:\n                ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                parameter #: ${n}\n    got: ${t.type}\n                `)}return e}checkTypeOfParameter(e,t,n,i){const o=typeof e;if(o!==t)throw new Error(`Expecting a '${t}' parameter for:\n            ${i.dbEntity.name}.${i.jsonQuery.queryName}\n            parameter #: ${n}\ngot: ${o}\n            `)}};pl=ll([function(e){}],pl);var dl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ul=class{serialize(e,t,n,i){const o={lookupTable:[],sequence:0,stubLookupTable:[]};let r;r=e instanceof Array?e.map((e=>this.doSerialize(e,t,o,n,i))):this.doSerialize(e,t,o,n,i);for(let e=1;e<o.lookupTable.length;e++)delete o.lookupTable[e][n.getUniqueIdFieldName()];return r}doSerialize(e,t,n,i,o){let r=i.getOperationUniqueId(e);if(r)return n.stubLookupTable[r];r=++n.sequence;let a={};a[i.getUniqueIdFieldName()]=r,a[i.getStateFieldName()]=ye.STUB,n.stubLookupTable[r]=a;let s={};n.lookupTable[r]=e,s[i.getUniqueIdFieldName()]=r,s[i.getStateFieldName()]=e[i.getStateFieldName()];for(const r of t.properties){let a,c=e[r.name];if(!o.isEmpty(c)){if(r.relation){const e=r.relation[0];a=c instanceof Array?c.map((t=>{this.doSerialize(t,e.relationEntity,n,i,o)})):this.doSerialize(c,e.relationEntity,n,i,o)}else switch(r.propertyColumns[0].column.type){case fe.JSON:throw new Error("@Json() properties cannot be serialized.");case fe.DATE:a={value:c.toISOString()},a[i.getStateFieldName()]=ye.DATE;break;case fe.ANY:case fe.BOOLEAN:case fe.NUMBER:case fe.STRING:a=c;break;default:throw new Error(`Unsupported data type for property ${t.applicationVersion.application.name}.${t.name}.${r.name}`)}s[r.name]=a}}return s}};ul=dl([function(e){}],ul),(new Date).getTime();var fl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yl=class{};fl([function(e,t){},function(e,t){},function(e,t){}],yl.prototype,"_localId",void 0),fl([function(e,t){}],yl.prototype,"name",void 0),fl([function(e,t){}],yl.prototype,"applications",void 0),yl=fl([function(e){},function(e){}],yl);var hl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ml=class{constructor(){this.versions=[],this.currentVersion=[]}};hl([function(e,t){},function(e,t){},function(e,t){}],ml.prototype,"index",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"scope",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"name",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"fullName",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"status",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"signature",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"domain",void 0),hl([function(e,t){}],ml.prototype,"versions",void 0),hl([function(e,t){}],ml.prototype,"currentVersion",void 0),ml=hl([function(e){},function(e){}],ml);var Il=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Rl=class{};Il([function(e,t){},function(e,t){}],Rl.prototype,"deprecatedSinceVersion",void 0),Il([function(e,t){},function(e,t){}],Rl.prototype,"removedInVersion",void 0),Il([function(e,t){},function(e,t){}],Rl.prototype,"sinceVersion",void 0),Rl=Il([function(e){}],Rl);var El=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _l=class extends Rl{constructor(){super(...arguments),this.propertyColumns=[],this.manyRelationColumns=[],this.oneRelationColumns=[]}};El([function(e,t){},function(e,t){},function(e,t){}],_l.prototype,"_localId",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"index",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"idIndex",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"isGenerated",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"allocationSize",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"name",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"notNull",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"precision",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"scale",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"type",void 0),El([function(e,t){},function(e,t){}],_l.prototype,"entity",void 0),El([function(e,t){}],_l.prototype,"propertyColumns",void 0),El([function(e,t){}],_l.prototype,"manyRelationColumns",void 0),El([function(e,t){}],_l.prototype,"oneRelationColumns",void 0),_l=El([function(e){},function(e){}],_l);var gl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Tl=class{};gl([function(e,t){},function(e,t){},function(e,t){}],Tl.prototype,"application",void 0),gl([function(e,t){},function(e,t){},function(e,t){}],Tl.prototype,"applicationVersion",void 0),Tl=gl([function(e){},function(e){}],Tl);var Ol=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Al=class extends Rl{constructor(){super(...arguments),this.columns=[],this.operations=[],this.properties=[],this.relations=[],this.relationReferences=[],this.columnMap={},this.idColumns=[],this.idColumnMap={},this.propertyMap={}}};Ol([function(e,t){},function(e,t){},function(e,t){}],Al.prototype,"_localId",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"index",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"isLocal",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"isAirEntity",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"name",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"tableConfig",void 0),Ol([function(e,t){},function(e,t){}],Al.prototype,"applicationVersion",void 0),Ol([function(e,t){}],Al.prototype,"columns",void 0),Ol([function(e,t){}],Al.prototype,"operations",void 0),Ol([function(e,t){}],Al.prototype,"properties",void 0),Ol([function(e,t){}],Al.prototype,"relations",void 0),Ol([function(e,t){}],Al.prototype,"relationReferences",void 0),Ol([function(e,t){}],Al.prototype,"columnMap",void 0),Ol([function(e,t){}],Al.prototype,"idColumns",void 0),Ol([function(e,t){}],Al.prototype,"idColumnMap",void 0),Ol([function(e,t){}],Al.prototype,"propertyMap",void 0),Al=Ol([function(e){},function(e){}],Al);var Nl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let xl=class extends Rl{};Nl([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],xl.prototype,"_localId",void 0),Nl([function(e,t){},function(e,t){}],xl.prototype,"type",void 0),Nl([function(e,t){},function(e,t){}],xl.prototype,"entity",void 0),Nl([function(e,t){},function(e,t){}],xl.prototype,"name",void 0),Nl([function(e,t){},function(e,t){}],xl.prototype,"rule",void 0),xl=Nl([function(e){},function(e){}],xl);var bl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wl=class extends Rl{constructor(){super(...arguments),this.propertyColumns=[],this.relation=[]}};bl([function(e,t){},function(e,t){},function(e,t){}],wl.prototype,"_localId",void 0),bl([function(e,t){},function(e,t){}],wl.prototype,"index",void 0),bl([function(e,t){},function(e,t){}],wl.prototype,"name",void 0),bl([function(e,t){},function(e,t){}],wl.prototype,"isId",void 0),bl([function(e,t){},function(e,t){}],wl.prototype,"entity",void 0),bl([function(e,t){}],wl.prototype,"propertyColumns",void 0),bl([function(e,t){}],wl.prototype,"relation",void 0),wl=bl([function(e){},function(e){}],wl);var Sl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let vl=class extends Rl{};Sl([function(e,t){},function(e,t){},function(e,t){}],vl.prototype,"column",void 0),Sl([function(e,t){},function(e,t){},function(e,t){}],vl.prototype,"property",void 0),vl=Sl([function(e){},function(e){}],vl);var Cl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Dl=class extends Rl{};Cl([function(e,t){},function(e,t){},function(e,t){}],Dl.prototype,"ownApplicationVersion",void 0),Cl([function(e,t){},function(e,t){},function(e,t){}],Dl.prototype,"referencedApplicationVersion",void 0),Cl([function(e,t){},function(e,t){}],Dl.prototype,"index",void 0),Dl=Cl([function(e){},function(e){}],Dl);var Ml=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vl=class extends Rl{constructor(){super(...arguments),this.manyRelationColumns=[],this.oneRelationColumns=[]}};Ml([function(e,t){},function(e,t){},function(e,t){}],Vl.prototype,"_localId",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"index",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"property",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"foreignKey",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"manyToOneElems",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"oneToManyElems",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"relationType",void 0),Ml([function(e,t){}],Vl.prototype,"isId",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"entity",void 0),Ml([function(e,t){},function(e,t){}],Vl.prototype,"relationEntity",void 0),Ml([function(e,t){}],Vl.prototype,"manyRelationColumns",void 0),Ml([function(e,t){}],Vl.prototype,"oneRelationColumns",void 0),Vl=Ml([function(e){},function(e){}],Vl);var Pl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ll=class extends Rl{};Pl([function(e,t){},function(e,t){}],Ll.prototype,"_localId",void 0),Pl([function(e,t){},function(e,t){}],Ll.prototype,"manyColumn",void 0),Pl([function(e,t){},function(e,t){}],Ll.prototype,"oneColumn",void 0),Pl([function(e,t){},function(e,t){}],Ll.prototype,"manyRelation",void 0),Pl([function(e,t){},function(e,t){}],Ll.prototype,"oneRelation",void 0),Pl([function(e,t){},function(e,t){}],Ll.prototype,"parentRelation",void 0),Ll=Pl([function(e){},function(e){}],Ll);var Ul=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jl=class{constructor(){this.entities=[],this.references=[],this.referencedBy=[],this.entityMapByName={},this.referencesMapByName={},this.referencedByMapByName={}}};Ul([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],jl.prototype,"_localId",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"integerVersion",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"versionString",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"majorVersion",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"minorVersion",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"patchVersion",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"jsonApplication",void 0),Ul([function(e,t){},function(e,t){}],jl.prototype,"application",void 0),Ul([function(e,t){}],jl.prototype,"entities",void 0),Ul([function(e,t){}],jl.prototype,"references",void 0),Ul([function(e,t){}],jl.prototype,"referencedBy",void 0),Ul([function(e,t){}],jl.prototype,"entityMapByName",void 0),Ul([function(e,t){}],jl.prototype,"referencesMapByName",void 0),Ul([function(e,t){}],jl.prototype,"referencedByMapByName",void 0),jl=Ul([function(e){},function(e){}],jl);const Fl={__constructors__:{Application:ml,ApplicationColumn:_l,ApplicationCurrentVersion:Tl,ApplicationEntity:Al,ApplicationOperation:xl,ApplicationProperty:wl,ApplicationPropertyColumn:vl,ApplicationReference:Dl,ApplicationRelation:Vl,ApplicationRelationColumn:Ll,ApplicationVersion:jl,Domain:yl,VersionedApplicationObject:Rl},domain:"air",name:"@airport/airspace"},Gl=Fl;function kl(e){return oi.ddS(Gl.__dbApplication__,e)}oi.setQApplication(Fl);class Bl extends Vo{constructor(e){super(e,Gl)}}class Hl extends Bl{constructor(){super(10)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(10)}}Hl.Find=new Po,Hl.FindOne=new Po,Hl.Search=new Po,Hl.SearchOne=new Po;class $l extends Bl{constructor(){super(4)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(4)}}$l.Find=new Po,$l.FindOne=new Po,$l.Search=new Po,$l.SearchOne=new Po;class ql extends Bl{constructor(){super(9)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(9)}}ql.Find=new Po,ql.FindOne=new Po,ql.Search=new Po,ql.SearchOne=new Po;class Yl extends Bl{constructor(){super(6)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(6)}}Yl.Find=new Po,Yl.FindOne=new Po,Yl.Search=new Po,Yl.SearchOne=new Po;class Ql extends Bl{constructor(){super(5)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(5)}}Ql.Find=new Po,Ql.FindOne=new Po,Ql.Search=new Po,Ql.SearchOne=new Po;class Wl extends Bl{constructor(){super(2)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(2)}}Wl.Find=new Po,Wl.FindOne=new Po,Wl.Search=new Po,Wl.SearchOne=new Po;class zl extends Bl{constructor(){super(3)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(3)}}zl.Find=new Po,zl.FindOne=new Po,zl.Search=new Po,zl.SearchOne=new Po;class Jl extends Bl{constructor(){super(7)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(7)}}Jl.Find=new Po,Jl.FindOne=new Po,Jl.Search=new Po,Jl.SearchOne=new Po;class Kl extends Bl{constructor(){super(1)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(1)}}Kl.Find=new Po,Kl.FindOne=new Po,Kl.Search=new Po,Kl.SearchOne=new Po;class Zl extends Bl{constructor(){super(0)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(0)}}Zl.Find=new Po,Zl.FindOne=new Po,Zl.Search=new Po,Zl.SearchOne=new Po;class Xl extends Bl{constructor(){super(8)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(8)}}Xl.Find=new Po,Xl.FindOne=new Po,Xl.Search=new Po,Xl.SearchOne=new Po;class ep extends Bl{constructor(){super(11)}static Save(e){return Vo.BaseSave(e)}static diSet(){return kl(11)}}ep.Find=new Po,ep.FindOne=new Po,ep.Search=new Po,ep.SearchOne=new Po;class tp extends Uo{constructor(e){super(e,Gl)}}class np extends tp{static diSet(){return kl(8)}constructor(){super(8)}}var ip=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let op=class extends ep{async findByIdIn(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Gl.Domain],WHERE:t._localId.IN(e)})}async findMapByNameWithNames(e){let t;const n=await this.db.find.tree({SELECT:{},FROM:[t=Gl.Domain],WHERE:t.name.IN(e)}),i=new Map;for(const e of n)i.set(e.name,e);return i}async findOneByName(e){let t;return await this.db.findOne.tree({SELECT:{},FROM:[t=Gl.Domain],WHERE:t.name.equals(e)})}async findByNames(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Gl.Domain],WHERE:t.name.IN(e)})}async findByName(e){let t;return await this.db.findOne.tree({SELECT:{},FROM:[t=Gl.Domain],WHERE:t.name.equals(e)})}async checkAndInsertIfNeeded(e,t){const n=await this.findByIdIn(e.map((e=>e._localId))),i=new Map;for(const e of n)i.set(e._localId,e);const o=[];for(const t of e)i.has(t._localId)||o.push(t);if(!o.length)return;let r;const a=[];for(const e of o)a.push([e._localId,e.name]);await this.db.insertValuesGenerateIds({INSERT_INTO:r=Gl.Domain,columns:[r._localId,r.name],VALUES:a},t)}async insert(e){let t;const n=[];for(const t of e)n.push([t.name]);const i=await this.db.insertValuesGenerateIds({INSERT_INTO:t=Gl.Domain,columns:[t.name],VALUES:n});for(let t=0;t<e.length;t++){e[t]._localId=i[t][0]}}};op=ip([function(e){}],op);var rp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ap=class extends $l{async findAllForEntities(e){let t;return this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationColumn],WHERE:t.entity._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.index,Qe(t.idIndex),t.isGenerated,Qe(t.allocationSize),t.name,t.notNull,Qe(t.precision),Qe(t.scale),t.type,t.entity._localId,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationColumn,columns:[n._localId,n.index,n.idIndex,n.isGenerated,n.allocationSize,n.name,n.notNull,n.precision,n.scale,n.type,n.entity._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};ap=rp([function(e){}],ap);var sp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let cp=class extends Hl{async findAllActive(){return this.db.find.tree({SELECT:{},FROM:[Gl.Application]})}async findAllWithJson(){let e;return this.db.find.tree({SELECT:{...nt,versions:{_localId:tt,jsonApplication:tt}},FROM:[e=Gl.Application,e.versions.INNER_JOIN()]})}async findMapByVersionIds(e){const t=new Map;let n,i;const o=await this.db.find.tree({SELECT:{index:tt,domain:{_localId:tt,name:tt},name:tt,fullName:tt,versions:{_localId:tt,majorVersion:tt,minorVersion:tt,patchVersion:tt}},FROM:[n=Gl.Application,i=n.versions.INNER_JOIN()],WHERE:i._localId.IN(e)});for(const e of o)for(const n of e.versions)t.set(n._localId,e);return t}async findMaxIndex(){const e=Gl.Application;return await this.airportDatabase.findOne.field({SELECT:an(e.index),FROM:[e]})}async findMaxVersionedMapByApplicationAndDomain_Names(e,t){const n=new Map;let i,o,r,a,s;const c=await this.airportDatabase.find.tree({FROM:[s=mt({FROM:[a=mt({FROM:[o=Gl.Application,i=o.versions.INNER_JOIN(),r=o.domain.INNER_JOIN()],SELECT:{index:o.index,domainId:r._localId,domainName:r.name,name:o.name,majorVersion:an(i.majorVersion),minorVersion:i.minorVersion,patchVersion:i.patchVersion},WHERE:Nt(r.name.IN(e),o.name.IN(t)),GROUP_BY:[o.index,r._localId,r.name,o.name,i.minorVersion,i.patchVersion]})],SELECT:{index:a.index,domainId:a.domainId,domainName:a.domainName,name:a.name,majorVersion:a.majorVersion,minorVersion:an(a.minorVersion),patchVersion:a.patchVersion},GROUP_BY:[a.index,a.domainId,a.domainName,a.name,a.majorVersion,a.patchVersion]})],SELECT:{index:s.index,domain:{_localId:s.domainId,name:s.domainName},name:s.name,majorVersion:s.majorVersion,minorVersion:s.minorVersion,patchVersion:an(s.patchVersion)},GROUP_BY:[s.index,s.domainId,s.domainName,s.name,s.majorVersion,s.minorVersion]});for(const e of c)qe(n,e.domain.name).set(e.name,e);return n}async setStatusByIndexes(e,t){let n;await this.db.updateWhere({UPDATE:n=Gl.Application,SET:{status:t},WHERE:n.index.IN(e)})}async findMapByFullNames(e){const t=new Map;let n;const i=await this.db.find.tree({SELECT:{},FROM:[n=Gl.Application],WHERE:n.fullName.IN(e)});for(const e of i)t.set(e.fullName,e);return t}async findByDomain_NamesAndApplication_Names(e,t){let n,i;return await this.db.find.tree({SELECT:{index:tt,domain:{_localId:tt,name:tt},fullName:tt,name:tt},FROM:[n=Gl.Application,i=n.domain.INNER_JOIN()],WHERE:Nt(i.name.IN(e),n.name.IN(t))})}async findByIndex(e){let t;return await this.db.findOne.tree({SELECT:{...nt,domain:{}},FROM:[t=Gl.Application,t.domain.INNER_JOIN()],WHERE:t.index.equals(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.index,t.domain._localId,t.scope,t.fullName,t.name,t.status,t.signature]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.Application,columns:[n.index,n.domain._localId,n.scope,n.fullName,n.name,n.status,n.signature],VALUES:i},t)}};sp([function(e,t){}],cp.prototype,"airportDatabase",void 0),cp=sp([function(e){}],cp);var lp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let pp=class extends Yl{async findAllForApplicationVersions(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationEntity],WHERE:t.applicationVersion._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.index,t.isLocal,t.isAirEntity,t.name,t.tableConfig,t.applicationVersion._localId,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationEntity,columns:[n._localId,n.index,n.isLocal,n.isAirEntity,n.name,n.tableConfig,n.applicationVersion._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};pp=lp([function(e){}],pp);var dp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let up=class extends zl{async findAllForColumns(e){let t;return this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationPropertyColumn],WHERE:t.column._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.column._localId,t.property._localId,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationPropertyColumn,columns:[n.column._localId,n.property._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};up=dp([function(e){}],up);var fp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yp=class extends Wl{async findAllForEntities(e){let t;return this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationProperty],WHERE:t.entity._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.index,t.name,t.isId,t.entity._localId,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationProperty,columns:[n._localId,n.index,n.name,n.isId,n.entity._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};yp=fp([function(e){}],yp);var hp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mp=class extends Jl{async findAllForApplicationVersions(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationReference],WHERE:t.ownApplicationVersion._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.ownApplicationVersion._localId,t.referencedApplicationVersion._localId,t.index,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationReference,columns:[n.ownApplicationVersion._localId,n.referencedApplicationVersion._localId,n.index,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};mp=hp([function(e){}],mp);var Ip=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Rp=class extends Zl{async findAllForColumns(e){let t;return this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationRelationColumn],WHERE:xt(t.oneColumn._localId.IN(e),t.manyColumn._localId.IN(e))})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.manyColumn?t.manyColumn._localId:null,t.oneColumn?t.oneColumn._localId:null,t.manyRelation?t.manyRelation._localId:null,t.oneRelation?t.oneRelation._localId:null,t.parentRelation?t.parentRelation._localId:null,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationRelationColumn,columns:[n._localId,n.manyColumn._localId,n.oneColumn._localId,n.manyRelation._localId,n.oneRelation._localId,n.parentRelation._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};Rp=Ip([function(e){}],Rp);var Ep=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _p=class extends Kl{async findAllForProperties(e){let t;return this.db.find.tree({SELECT:{},FROM:[t=Gl.ApplicationRelation],WHERE:t.property._localId.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.index,t.property._localId,Qe(t.foreignKey),Qe(t.manyToOneElems),Qe(t.oneToManyElems),t.relationType,t.isId,t.entity._localId,t.relationEntity._localId,t.deprecatedSinceVersion?t.deprecatedSinceVersion._localId:null,t.removedInVersion?t.removedInVersion._localId:null,t.sinceVersion?t.sinceVersion._localId:null]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationRelation,columns:[n._localId,n.index,n.property._localId,n.foreignKey,n.manyToOneElems,n.oneToManyElems,n.relationType,n.isId,n.entity._localId,n.relationEntity._localId,n.deprecatedSinceVersion._localId,n.removedInVersion._localId,n.sinceVersion._localId],VALUES:i},t)}};_p=Ep([function(e){}],_p);var gp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Tp=class extends Xl{async findAllActiveOrderByApplication_IndexAndId(){let e;return await this.db.find.tree({FROM:[e=Gl.ApplicationVersion],SELECT:{},ORDER_BY:[e.application.index.asc(),e._localId.desc()]})}async findByDomain_NamesAndApplication_Names(e,t){let n,i,o;return await this.db.find.tree({SELECT:{_localId:tt,integerVersion:tt,application:{domain:{name:tt},fullName:tt,name:tt}},FROM:[n=Gl.ApplicationVersion,i=n.application.INNER_JOIN(),o=i.domain.INNER_JOIN()],WHERE:Nt(o.name.IN(e),i.name.IN(t))})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t._localId,t.integerVersion,t.versionString,t.majorVersion,t.minorVersion,t.patchVersion,t.application.index,t.jsonApplication]);await this.db.insertValuesGenerateIds({INSERT_INTO:n=Gl.ApplicationVersion,columns:[n._localId,n.integerVersion,n.versionString,n.majorVersion,n.minorVersion,n.patchVersion,n.application.index,n.jsonApplication],VALUES:i},t)}};Tp=gp([function(e){}],Tp);var Op=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ap=class extends np{};Ap=Op([function(e){}],Ap);const Np=P("traffic-pattern"),xp=Np.token({class:op,interface:"IDomainDao",token:"DOMAIN_DAO"}),bp=Np.token({class:ap,interface:"IApplicationColumnDao",token:"APPLICATION_COLUMN_DAO"}),wp=Np.token({class:cp,interface:"IApplicationDao",token:"APPLICATION_DAO"}),Sp=Np.token({class:pp,interface:"IApplicationEntityDao",token:"APPLICATION_ENTITY_DAO"}),vp=Np.token({class:up,interface:"IApplicationPropertyColumnDao",token:"APPLICATION_PROPERTY_COLUMN_DAO"}),Cp=Np.token({class:yp,interface:"IApplicationPropertyDao",token:"APPLICATION_PROPERTY_DAO"}),Dp=Np.token({class:mp,interface:"IApplicationReferenceDao",token:"APPLICATION_REFERENCE_DAO"}),Mp=Np.token({class:Rp,interface:"IApplicationRelationColumnDao",token:"APPLICATION_RELATION_COLUMN_DAO"}),Vp=Np.token({class:_p,interface:"IApplicationRelationDao",token:"APPLICATION_RELATION_DAO"}),Pp=Np.token({class:Tp,interface:"IApplicationVersionDao",token:"APPLICATION_VERSION_DAO"});Np.token({class:Ap,interface:"IApplicationVersionDuo",token:"APPLICATION_VERSION_DUO"}),wp.setDependencies({airportDatabase:Qo});const Lp=P("arrivals-n-departures");Lp.token({class:null,interface:"RequestManager",token:"REQUEST_MANAGER"});const Up=Lp.token({class:null,interface:"IOperationDeserializer",token:"OPERATION_DESERIALIZER"}),jp=Lp.token({class:null,interface:"IQueryParameterDeserializer",token:"QUERY_PARAMETER_DESERIALIZER"}),Fp=Lp.token({class:null,interface:"IQueryResultsSerializer",token:"QUERY_RESULTS_SERIALIZER"});var Gp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let kp=class{constructor(){this.queries=new Map}add(e,t){this.queries.set(e,t)}remove(e){this.queries.delete(e)}markQueriesToRerun(e){this.queries.forEach((t=>{e.intersects(t.sqlQuery.getFieldMap())&&(t.rerun=!0)}))}rerunQueries(){setTimeout((()=>{this.queries.forEach((e=>{e.rerun&&(e.rerun=!1,e.runQuery())}))}),100)}};kp=Gp([function(e){}],kp);var Bp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hp=class{wrapInObservable(e,t){let n=new to,i={portableQuery:e,resultsSubject:n,runQuery:()=>{t().then((e=>{n.next(e)}))}};return this.activeQueries.add(e,i),i.runQuery(),n}};Bp([function(e,t){}],Hp.prototype,"activeQueries",void 0),Hp=Bp([function(e){}],Hp);const $p=P("flight-number"),qp=$p.token({class:kp,interface:"IActiveQueries",token:"ACTIVE_QUERIES"}),Yp=$p.token({class:Hp,interface:"IObservableQueryAdapter",token:"OBSERVABLE_QUERY_ADAPTER"});Yp.setDependencies({activeQueries:qp});class Qp extends class{constructor(e,t,n,i,o){this.rootSelectClauseFragment=e,this.airportDatabase=t,this.qValidator=n,this.relationManager=i,this.orderBy=o}getCommonOrderByFragment(e){return e.map((e=>{switch(e.so){case pe.ASCENDING:return`${e.fa} ASC`;case pe.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}{getOrderByFragment(e,t,n){let i=[],o=[];this.orderBy&&(o=this.orderBy.slice());const r=[];let a=this.rootSelectClauseFragment;r.push(a);const s=[];let c=e;for(s.push(c);(a=r.shift())&&(c=s.shift());){const e=this.relationManager.getAlias(c.jsonRelation),n=t[e].__driver__.dbEntity,l=[];o=o.filter((t=>{const i=this.airportDatabase.applications[t.si].currentVersion[0].applicationVersion.entities[t.ti],o=i.columns[t.ci];if(this.isForParentNode(c,t))throw new Error(`Found out of order entry in Order By \n\t\t\t\t\t[${i.applicationVersion.application.name} - ${i.name}.${o.name}].\n\t\t\t\t\tEntries must be ordered hierarchically, in breadth-first order.`);return t.si!==n.applicationVersion.application.index||t.ti!==n.index||(this.qValidator.validateReadProperty(o),t.fa=`${e}.${o.name}`,l.push(t),!1)}));const p=[],d=[];for(const e in a){const t=n.propertyMap[e];if(t.relation&&t.relation.length){for(const e of t.propertyColumns){const n=e.column;p.push(n.name),t.isId&&d.push(n.name)}if(!c.childNodes.length)continue;const n=t.relation[0],i=n.relationEntity;if(!c.childNodes.filter((e=>{const t=e.jsonRelation;return t.si===i.applicationVersion.application.index&&t.ti===i.index})).length)return;r.push(this.rootSelectClauseFragment[e]);const o=c.getEntityRelationChildNode(n);s.push(o)}else{const e=t.propertyColumns[0].column;p.push(e.name),t.isId&&d.push(e.name)}}let u=this.buildOrderByFragmentForEntity(e,p,d,l,t);i=i.concat(u)}if(o.length)throw new Error("\n\t\t\tFound entries in ORDER_BY for tables not found in SELECT clause.  \n\t\t\tEntries must be ordered hierarchically, in breadth-first order.");return i.join(", ")}buildOrderByFragmentForEntity(e,t,n,i,o){const r=[],a={},s=o[e].__driver__.dbEntity;if(i.forEach((e=>{r.push(e);const t=s.columns[e.ci].name;a[t]=!0})),n.length)for(const t of n)a[t]||r.push({fa:`${e}.${t}`,so:pe.ASCENDING});else t.forEach((t=>{a[t]||r.push({fa:`${e}.${t}`,so:pe.ASCENDING})}));return this.getCommonOrderByFragment(r)}isForParentNode(e,t){do{if(!(e=e.parentNode))return!1;if(t.si===e.jsonRelation.si&&t.ti===e.jsonRelation.ti)return!0}while(e.parentNode);return!1}}class Wp{constructor(e){this.validator=e}getOrderByFragment(e,t){return t.map((e=>{switch(this.validator.validateAliasedFieldAccess(e.fa),e.so){case pe.ASCENDING:return`${e.fa} ASC`;case pe.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}class zp{constructor(e){this.validator=e}getOrderByFragment(e,t){let n=[],i=[];t&&(i=t.slice());let o=[],r=e;for(o.push(r);r=o.shift();){let e={};for(let t in r){let n=r[t];n.appliedFunctions?e[n.fa]=!0:o.push(n)}let t=[];i=i.filter((n=>!e[n.fa]||(delete e[n.fa],t.push(n),!1)));for(let n in e)t.push({fa:n,so:pe.ASCENDING});let a=this.buildOrderByFragmentForEntity(t);n=n.concat(a)}if(i.length)throw new Error("Found entries in ORDER_BY for tables not found in SELECT clause.  Entries must be ordered hierarchically, in breadth-first order.");return n.join(", ")}buildOrderByFragmentForEntity(e){return e.map((e=>{switch(this.validator.validateAliasedFieldAccess(e.fa),e.so){case pe.ASCENDING:return`${e.fa} ASC`;case pe.DESCENDING:return`${e.fa} DESC`}}))}}class Jp{constructor(){this.mtoStubReferenceMap=[]}addMtoReference(e,t){const n=e.mtoDbEntity;let i=$e(He(this.mtoStubReferenceMap,n.applicationVersion.application.index),n.index);$e(i,t)[e.mtoRelationField]=e}populateMtos(e){for(const t in this.mtoStubReferenceMap){const n=this.mtoStubReferenceMap[t];for(const t in n){const i=n[t];for(let t in i){let n=i[t];for(let t in n){let i=n[t],o=i.otmDbEntity;if(!e[o.applicationVersion.application.index])continue;let r=e[o.applicationVersion.application.index][o.index];if(!r)continue;let a=r[i.otmEntityId];a&&(i.mtoParentObject[i.mtoRelationField]=a)}}}}}}class Kp{constructor(){this.mtoEntityReferenceMap=[],this.otmEntityReferenceMap=[]}addMtoReference(e,t,n,i){if(!e.otmEntityField)return;const o=e.otmDbEntity;let r=$e(He(this.mtoEntityReferenceMap,o.applicationVersion.application.index),o.index),a=r[e.otmEntityId];a||(a={},r[e.otmEntityId]=a);let s=a[e.otmEntityField];s||(s=[],a[e.otmEntityField]=s),s.push(e.mtoParentObject)}addOtmReference(e,t){const n=e.otmDbEntity;let i=$e(He(this.otmEntityReferenceMap,n.applicationVersion.application.index),n.index),o=i[t];o||(o={},i[t]=o),o[e.otmPropertyName]=e.otmObject}populateOtms(e){for(const t in this.mtoEntityReferenceMap){const n=this.mtoEntityReferenceMap[t];for(const i in n){const o=n[i];if(!e[t])continue;if(!e[t][i])continue;if(!this.otmEntityReferenceMap[t])continue;let r=this.otmEntityReferenceMap[t][i];if(r)for(let e in o){let t=o[e],n=r[e];if(n)for(let e in t){let i=n[e];if(!i)continue;let o=t[e],r=i[e];if(r)for(let e of o)r.push(e);else i[e]=o;n[e]=i[e].slice()}}}}}}class Zp{constructor(e,t,n){this.applicationUtils=e,this.entityStateManager=t,this.utils=n}addManyToOneStub(e,t,n,i){let o={};this.entityStateManager.isStub(o),e[t]=o;let r=!0;return n.forEach((e=>{if(this.applicationUtils.isIdEmpty(e.value))return void(r=!1);let t,n=o,i=1;const a=e.propertyNameChains[0];for(;i<a.length;)n||(n={},this.entityStateManager.markAsStub(n),t[a[i-1]]=n),i<a.length-1?(t=n,n=t[a[i]]):n[a[i]]=e.value,i++})),r}}class Xp extends Zp{constructor(e,t,n,i,o){super(n,i,o),this.config=e,this.rootDbEntity=t,this.entityMapByApplicationAndTableIndexes=[],this.otmStubBuffer=[],this.mtoStubBuffer=[],this.currentResultRow=[],this.otmMapper=new Kp,this.mtoMapper=new Jp}addEntity(e,t,n){return this.applicationUtils.getNewEntity(t)}addProperty(e,t,n,i,o){return t[i]=o,this.utils.objectExists(o)}bufferManyToOneStub(e,t,n,i,o,r,a){if(this.addManyToOneStub(n,i,r,a)){const e=this.applicationUtils.getIdKey(n[i],o);this.bufferManyToOne(t,i,o,e)}}bufferBlankManyToOneStub(e,t,n){t[n]=null}bufferManyToOneObject(e,t,n,i,o,r,a){n[i]=r;const s=this.applicationUtils.getIdKey(n[i],o);this.bufferManyToOne(t,i,o,s)}bufferBlankManyToOneObject(e,t,n){t[n]=null}bufferOneToManyStub(e,t){this.bufferOneToMany(e,t)}bufferOneToManyCollection(e,t,n,i,o,r,a){this.bufferOneToMany(n,i),t[i]=[r]}bufferBlankOneToMany(e,t,n,i,o,r){t[i]=[]}flushEntity(e,t,n,i,o,r){if(!i)throw new Error(`No Id provided for entity \n\t\t\t'${t.applicationVersion.application.name}.${t.name}'`);let a=this.getEntityToFlush(t,n,i,o,r);return this.flushRelationStubBuffers(i,a,t,r),a}flushRow(){}bridge(e,t,n){return this.mtoMapper.populateMtos(this.entityMapByApplicationAndTableIndexes),this.otmMapper.populateOtms(this.entityMapByApplicationAndTableIndexes),e}bufferManyToOne(e,t,n,i){let o;for(const i of n.relations){switch(i.relationType){case ce.ONE_TO_MANY:break;case ce.MANY_TO_ONE:continue;default:throw new Error(`Unknown EntityRelationType: ${i.relationType}`)}i.oneToManyElems&&i.oneToManyElems.mappedBy&&(e._localId!==i.relationEntity._localId&&i.oneToManyElems.mappedBy!==t||(o=i.property.name))}this.mtoStubBuffer.push({otmEntityId:i,otmDbEntity:n,otmEntityField:o,mtoDbEntity:e,mtoRelationField:t,mtoParentObject:null})}bufferOneToMany(e,t){this.otmStubBuffer.push({otmDbEntity:e,otmPropertyName:t,otmObject:null})}getEntityToFlush(e,t,n,i,o){if(!n)throw new Error(`Entity ID not specified for entity \n\t\t\t'${e.applicationVersion.application.name}.${e.name}'.`);let r=$e(He(this.entityMapByApplicationAndTableIndexes,e.applicationVersion.application.index),e.index),a=r[n],s=this.mergeEntities(a,i,e,t,o);return r[n]=s,s}mergeEntities(e,t,n,i,o){if(!e||t===e)return t;const r=this.applicationUtils.getIdKey(t,n);for(let o in i){if(void 0===i[o])continue;const a=n.propertyMap[o];if(a.relation&&a.relation.length){if(null==i[o])e[o]=t[o];else{const i=a.relation[0],s=i.relationEntity;switch(i.relationType){case ce.MANY_TO_ONE:void 0===e[o]&&void 0!==t[o]&&(e[o]=t[o]);break;case ce.ONE_TO_MANY:let c=e[o];const l=t[o];if(this.config&&this.config.strict&&(!c&&l||!l&&c||c.length!=l.length))throw new Error(`One-to-Many child arrays don't match for \n\t\t\t\t\t\t\t\t\t'${n.name}.${a.name}', Id: ${r}`);const p={};c?c.forEach((e=>{const t=this.applicationUtils.getIdKey(e,s);p[t]=e})):(c=[],e[o]=c),l&&l.forEach((e=>{const t=this.applicationUtils.getIdKey(e,s);if(this.config&&this.config.strict&&!p[t])throw new Error(`One-to-Many child arrays don't match for \n\t\t\t\t\t\t\t\t\t\t'${n.name}.${a.name}', Id: ${r}`);p[t]||c.push(e)}));break;default:throw new Error(`Unknown relation type '${i.relationType}' for \n\t\t\t\t\t\t\t'${n.name}.${a.name}'`)}}}else this.applicationUtils.isEmpty(e[o])&&(e[o]=t[o])}return e}flushRelationStubBuffers(e,t,n,i){let o=this.otmStubBuffer;this.otmStubBuffer=[],o.forEach((n=>{n.otmObject=t,this.otmMapper.addOtmReference(n,e)}));let r=this.mtoStubBuffer;this.mtoStubBuffer=[],r.forEach((o=>{o.mtoParentObject=t,this.otmMapper.addMtoReference(o,e,n,i),this.mtoMapper.addMtoReference(o,e)}))}}class ed extends Zp{constructor(){super(...arguments),this.currentRowObjectMap={},this.objectEqualityMap={},this.lastRowObjectMap={},this.currentObjectOneToManys={}}addProperty(e,t,n,i,o){if(t[i]=o,this.isDifferentOrDoesntExist(e,t,i))return this.utils.objectExists(o);let r=this.lastRowObjectMap[e];switch(n){case fe.DATE:this.objectEqualityMap[e]=r[i].getTime()===t[i].getTime();break;default:this.objectEqualityMap[e]=r[i]===t[i]}return!0}flushRow(){this.lastRowObjectMap=this.currentRowObjectMap,this.currentRowObjectMap={}}isDifferentOrDoesntExist(e,t,n){if(!this.objectEqualityMap[e])return!0;let i=this.lastRowObjectMap[e];return i?!t||(i[n]?!t[n]&&(this.objectEqualityMap[e]=!i[n],!0):(this.objectEqualityMap[e]=!t[n],!0)):(this.objectEqualityMap[e]=!1,!0)}addOneToManyCollection(e,t,n){let i=t[n];if(this.currentObjectOneToManys[n]=i,this.isDifferentOrDoesntExist(e,t,n))return;let o=this.lastRowObjectMap[e][n];o.length?i.length||o.length&&(this.objectEqualityMap[e]=!1):i.length&&(this.objectEqualityMap[e]=!1)}mergeEntity(e,t){let n=this.objectEqualityMap[e];this.objectEqualityMap[e]=!0;let i=this.currentObjectOneToManys;if(this.currentObjectOneToManys={},!n)return t;t=this.lastRowObjectMap[e],this.currentRowObjectMap[e]=t;for(let e in i){let n=i[e];if(n&&n.length){let i=n[0],o=t[e];o&&o.length?o[o.length-1]!==i&&o.push(i):t[e]=n}}return t}}class td extends ed{constructor(){super(...arguments),this.currentRowObjectMap={},this.objectEqualityMap={},this.lastRowObjectMap={},this.currentObjectOneToManys={}}addEntity(e,t,n){let i=this.applicationUtils.getNewEntity(t);return this.currentRowObjectMap[e]=i,void 0!==this.objectEqualityMap[e]&&(this.objectEqualityMap[e]=!0),i}bufferManyToOneStub(e,t,n,i,o,r,a){this.addManyToOneStub(n,i,r,a),this.addManyToOneReference(e,n,i)}bufferBlankManyToOneStub(e,t,n){t[n]=null,this.addManyToOneReference(e,t,n)}bufferManyToOneObject(e,t,n,i,o,r,a){if(n[i]=r,this.isDifferentOrDoesntExist(e,n,i))return;let s=this.lastRowObjectMap[e];this.objectEqualityMap[e]=s[i]===n[i]}bufferBlankManyToOneObject(e,t,n){t[n]=null,this.addManyToOneReference(e,null,n)}bufferOneToManyStub(e,t){throw new Error("@OneToMany stubs not allowed in QueryResultType.HIERARCHICAL")}bufferOneToManyCollection(e,t,n,i,o,r,a){t[i]=[r],this.addOneToManyCollection(e,t,i)}bufferBlankOneToMany(e,t,n,i,o,r){t[i]=[],this.addOneToManyCollection(e,t,i)}flushEntity(e,t,n,i,o,r){return this.mergeEntity(e,o)}bridge(e,t,n){return e}addManyToOneReference(e,t,n){if(this.isDifferentOrDoesntExist(e,t,n))return;let i=this.lastRowObjectMap[e][n],o=t[n];this.objectEqualityMap[e]=this.utils.valuesEqual(i,o,!0)}}var nd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let id=class{getObjectResultParser(e,t,n){switch(e){case xe.ENTITY_GRAPH:return new Xp(t,n,this.applicationUtils,this.entityStateManager,this.utils);case xe.ENTITY_TREE:return new td(this.applicationUtils,this.entityStateManager,this.utils);default:throw new Error(`ObjectQueryParser not supported for QueryResultType: ${e}`)}}};nd([function(e,t){}],id.prototype,"applicationUtils",void 0),nd([function(e,t){}],id.prototype,"entityStateManager",void 0),nd([function(e,t){}],id.prototype,"utils",void 0),id=nd([function(e){}],id);class od extends ed{addEntity(e){let t={};return this.currentRowObjectMap[e]=t,t}bufferOneToManyCollection(e,t,n,i){t[n]=[i],this.addOneToManyCollection(e,t,n)}flushEntity(e,t){return this.mergeEntity(e,t)}}var rd,ad=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.MAPPED_SELECT_CLAUSE="MAPPED_SELECT_CLAUSE",e.NON_MAPPED_SELECT_CLAUSE="NON_MAPPED_SELECT_CLAUSE",e.WHERE_CLAUSE="WHERE_CLAUSE",e.FUNCTION_CALL="FUNCTION_CALL"}(rd||(rd={}));let sd=class{constructor(e,t,n,i,o,r,a,s,c,l,p,d){this.dbEntity=e,this.dialect=t,this.airportDatabase=n,this.applicationUtils=i,this.entityStateManager=o,this.qMetadataUtils=r,this.qValidator=a,this.sqlQueryAdapter=s,this.storeDriver=c,this.subStatementSqlGenerator=l,this.utils=p,this.context=d,this.parameterReferences=[],this.fieldMap=new Pe,this.qEntityMapByAlias={},this.jsonRelationMapByAlias={}}getParameters(e,t){return this.parameterReferences.map((t=>{let n=e[t];if(!n){if(null===t||["number","string"].indexOf(typeof t)>-1)return t;throw new Error(`No parameter found for alias '${t}'`)}return this.sqlQueryAdapter.getParameterValue(n)}))}getFunctionCallValue(e,t){return this.getFieldValue(e,rd.FUNCTION_CALL,null,t)}getFieldFunctionValue(e,t,n){let i=e.v;if(this.isParameterReference(i)){let e=i;this.parameterReferences.push(e),i=this.sqlQueryAdapter.getParameterReference(this.parameterReferences,e)}else i=this.getFieldValue(i,rd.FUNCTION_CALL,t,n);return i=this.sqlQueryAdapter.getFunctionAdaptor().getFunctionCalls(e,i,this.qEntityMapByAlias,this,n),this.qValidator.addFunctionAlias(e.fa),i}getFieldValue(e,t,n,i){let o;if(!e)throw new Error("Missing Clause Field definition");if(e instanceof Array)return e.map((e=>this.getFieldValue(e,t,n,i))).join(", ");if(t!==rd.MAPPED_SELECT_CLAUSE&&!e.ot)throw new Error("Object Type is not defined in JSONClauseField");const r=e;let a;switch(e.ot){case ue.FIELD_FUNCTION:return this.getFieldFunctionValue(r,n,i);case ue.DISTINCT_FUNCTION:throw new Error("Distinct function cannot be nested.");case ue.EXISTS_FUNCTION:{if(t!==rd.WHERE_CLAUSE)throw new Error("Exists can only be used as a top function in a WHERE clause.");const{parameterReferences:e,subQuerySql:n}=this.subStatementSqlGenerator.getTreeQuerySql(r.v,this.dialect,i);return e.length&&(this.parameterReferences=this.parameterReferences.concat(e)),`EXISTS(${n})`}case ue.FIELD:return a=this.qEntityMapByAlias[r.ta],this.qValidator.validateReadQEntityProperty(r.si,r.ti,r.ci),o=this.getEntityPropertyColumnName(a,r.ci,i),this.addField(r.si,r.ti,r.ci),this.getComplexColumnFragment(r,o,i);case ue.FIELD_QUERY:{let e=r.fieldSubQuery;r.S&&(e=r);const{parameterReferences:t,subQuerySql:n}=this.subStatementSqlGenerator.getFieldQuerySql(e,this.dialect,this.qEntityMapByAlias,i);return t.length&&(this.parameterReferences=this.parameterReferences.concat(t)),this.qValidator.addSubQueryAlias(r.fa),`(${n})`}case ue.MANY_TO_ONE_RELATION:return a=this.qEntityMapByAlias[r.ta],this.qValidator.validateReadQEntityManyToOneRelation(r.si,r.ti,r.ci),o=this.getEntityManyToOneColumnName(a,r.ci,i),this.addField(r.si,r.ti,r.ci),this.getComplexColumnFragment(r,o,i);default:return rd.MAPPED_SELECT_CLAUSE,n()}}applyOperator(e,t){switch(e){case me.EQUALS:return` = ${t}`;case me.GREATER_THAN:return` > ${t}`;case me.GREATER_THAN_OR_EQUALS:return` >= ${t}`;case me.IS_NOT_NULL:return" IS NOT NULL";case me.IS_NULL:return" IS NULL";case me.IN:return` IN (${t})`;case me.LESS_THAN:return` < ${t}`;case me.LESS_THAN_OR_EQUALS:return` <= ${t}`;case me.NOT_EQUALS:return` != ${t}`;case me.NOT_IN:return` NOT IN (${t})`;case me.LIKE:return` LIKE ${t}`;default:throw new Error(`Unsupported operator ${e}`)}}getWHEREFragment(e,t,n){let i="";if(!e)throw new Error("An operation is missing in WHERE or HAVING clause");switch(t=`${t}\t`,e.c){case he.LOGICAL:return this.getLogicalWhereFragment(e,t,n);case he.BOOLEAN:case he.DATE:case he.NUMBER:case he.STRING:case he.UNTYPED:let o=e,r=this.getFieldValue(o.l,rd.WHERE_CLAUSE,null,n),a=this.getFieldValue(o.r,rd.WHERE_CLAUSE,null,n);i+=`${r}${this.applyOperator(o.o,a)}`;break;case he.FUNCTION:let s=e;i=this.getFieldValue(s.ob,rd.WHERE_CLAUSE,null,n)}return i}getEntityPropertyColumnName(e,t,n){return this.qMetadataUtils.getDbEntity(e).columns[t].name}addFieldFromColumn(e){const t=e.propertyColumns[0].property.entity;this.addField(t.applicationVersion._localId,t.index,e.index)}addField(e,t,n){this.fieldMap.ensure(e,t).ensure(n)}warn(e){console.log(e)}getSimpleColumnFragment(e,t){return`${e}.${t}`}getComplexColumnFragment(e,t,n){let i=`${e.ta}.${t}`;return i=this.sqlQueryAdapter.getFunctionAdaptor().getFunctionCalls(e,i,this.qEntityMapByAlias,this,n),i}getEntityManyToOneColumnName(e,t,n){return this.getEntityPropertyColumnName(e,t,n)}getLogicalWhereFragment(e,t,n){let i;switch(e.o){case me.AND:i="AND";break;case me.OR:i="OR";break;case me.NOT:return` NOT (${this.getWHEREFragment(e.v,t,n)})`;default:throw new Error(`Unknown logical operator: ${e.o}`)}let o=e.v;if(!(o instanceof Array))throw new Error(`Expecting an array of child operations as a value for operator ${i}, \n\t\t\t\tin the WHERE Clause.`);return`( ${o.map((e=>this.getWHEREFragment(e,t,n))).join(`\n${t}${i} `)} )`}isParameterReference(e){if(null===e)return!1;if(void 0===e||""===e||NaN===e)throw new Error(`Invalid query value: ${e}`);switch(typeof e){case"boolean":case"number":throw new Error("Unexpected primitive instance, expecting parameter alias.");case"string":return!0}if(e instanceof Date)throw new Error("Unexpected date instance, expecting parameter alias.");return!1}};sd=ad([function(e){}],sd);class cd extends sd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(e,t,n,i,o,r,a,c,l,p,d,u),this.relationManager=s}getTableFragment(e,t,n=!0){if(!e)throw new Error("Expecting exactly one table in UPDATE/DELETE clause");if(e.ri||e.jt)throw new Error("Table in UPDATE/DELETE clause cannot be joined");const i=this.airportDatabase.applications[e.si].currentVersion[0].applicationVersion.entities[e.ti];let o=this.storeDriver.getEntityTableName(i,t);if(e.si!==this.dbEntity.applicationVersion.application.index||e.ti!==this.dbEntity.index)throw new Error(`Unexpected table in UPDATE/DELETE clause: \n\t\t\t'${o}',\n\t\t\texpecting: '${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}'`);const r=new _t(i,this.applicationUtils,this.relationManager),a=this.relationManager.getAlias(e);this.qEntityMapByAlias[a]=r;let s=`\t${o}`;return n&&(s+=` AS ${a}`),s}}class ld extends cd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(n.applications[e.DF.si].currentVersion[0].applicationVersion.entities[e.DF.ti],t,n,i,o,r,a,s,c,l,p,d,u),this.jsonDelete=e}toSQL(e){let t=this.getTableFragment(this.jsonDelete.DF,e),n="",i=this.jsonDelete;return i.W&&(n=this.getWHEREFragment(i.W,"",e),n=`\nWHERE\n${n}`),`DELETE\nFROM\n${t}${n}`}}class pd extends cd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(n.applications[e.II.si].currentVersion[0].applicationVersion.entities[e.II.ti],t,n,i,o,r,a,s,c,l,p,d,u),this.jsonInsertValues=e}toSQL(e){if(!this.jsonInsertValues.II)throw new Error("Expecting exactly one table in INSERT INTO clause");return this.qValidator.validateInsertQEntity(this.dbEntity),`INSERT INTO\n${this.getTableFragment(this.jsonInsertValues.II,e,!1)} ${this.getColumnsFragment(this.dbEntity,this.jsonInsertValues.C)}\nVALUES\n${this.getValuesFragment(this.jsonInsertValues.V,e)}\n`}getColumnsFragment(e,t){if(!t.length)return"";return`( ${t.map((t=>e.columns[t].name)).join(", \n")} )`}getValuesFragment(e,t){return e.map((e=>`(${e.map((e=>{if(null===e||["number","string"].indexOf(typeof e)>-1)return this.parameterReferences.push(e),this.sqlQueryAdapter.getParameterReference(this.parameterReferences,e);if(void 0===e)throw new Error(`An 'undefined' value was provided when inserting into: ${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}`);return`\n${this.getFieldValue(e,rd.WHERE_CLAUSE,null,t)}\n`})).join(",")})`)).join(",\n")}}var dd;!function(e){e.MYSQL="MYSQL",e.POSTGRESQL="POSTGRESQL",e.SQLITE="SQLITE"}(dd||(dd={}));class ud{constructor(){this.map={}}getForAlias(e){let t=this.map[e];return t||(t={},this.map[e]=t),t}}class fd extends sd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u,f,y){super(t,n,o,r,a,s,c,p,d,u,f,y),this.jsonQuery=e,this.queryResultType=i,this.relationManager=l,this.entityDefaults=new ud}getFieldMap(){return this.fieldMap}getEntityApplicationRelationFromJoin(e,t,n,i,o,r,a,s,c){const l=[],p=e.__driver__.dbEntity,d=t.__driver__.dbEntity,u=p.relations[n.ri];let f;switch(u.relationType){case ce.MANY_TO_ONE:f=u.manyRelationColumns;break;case ce.ONE_TO_MANY:if(u.oneRelationColumns&&u.oneRelationColumns.length)f=u.oneRelationColumns;else{const e=u.relationEntity.relations.filter((e=>e.relationEntity._localId==p._localId&&e.manyToOneElems&&!0!==e.manyToOneElems&&e.manyToOneElems.mappedBy===u.property.name));e.length&&(f=e[0].manyRelationColumns)}break;default:throw new Error(`Unknown relation type ${u.relationType} \non '${p.applicationVersion.application.name}.${p.name}.${u.property.name}'.`)}for(const e of f){let t,n;switch(u.relationType){case ce.MANY_TO_ONE:t=e.manyColumn.name,n=e.oneColumn.name;break;case ce.ONE_TO_MANY:t=e.oneColumn.name,n=e.manyColumn.name;break;default:throw new Error(`Unknown relation type ${u.relationType} \non '${p.applicationVersion.application.name}.${p.name}.${u.property.name}'.`)}l.push({leftColumn:t,rightColumn:n})}let y=l.map((e=>` ${r}.${e.leftColumn} = ${o}.${e.rightColumn}`)).join("\n\t\t\tAND");if(n.joinWhereClause){const e=this.getWHEREFragment(n.joinWhereClause,"\t\t",c);y=`${y}\n\t\t\t${n.joinWhereClauseOperator===me.AND?"AND":"OR"} ${e}`}return`\n\t${a} ${this.storeDriver.getEntityTableName(d,c)} ${o}\n\t\tON ${y}`}}class yd extends cd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(n.applications[e.U.si].currentVersion[0].applicationVersion.entities[e.U.ti],t,n,i,o,r,a,s,c,l,p,d,u),this.jsonUpdate=e}toSQL(e,t){if(!this.jsonUpdate.U)throw new Error("Expecting exactly one table in UPDATE clause");let n=this.getTableFragment(this.jsonUpdate.U,t),i=this.getSetFragment(this.jsonUpdate.S,t);e.SET&&e.SET.length&&(i+=","+e.SET.map((e=>`\n\t${e.column.name} = ${e.value}`)).join(","));let o="",r=this.jsonUpdate;return r.W&&(o=this.getWHEREFragment(r.W,"",t),o=`WHERE\n${o}`),`UPDATE\n${n}\nSET\n${i}\n${o}`}getSetFragment(e,t){let n=[];for(let i in e){let o=e[i];void 0!==o&&(this.qValidator.validateUpdateColumn(this.dbEntity.columnMap[i]),this.addSetFragment(i,o,n,t))}return n.join(", \n")}addSetFragment(e,t,n,i){let o;"number"==typeof t?(this.parameterReferences.push(t),o=this.sqlQueryAdapter.getParameterReference(this.parameterReferences,t)):o=this.getFieldValue(t,rd.WHERE_CLAUSE,null,i),n.push(`\t${e} = ${o}`)}isManyToOneRelation(e){return"object"==typeof e&&e.ot===ue.MANY_TO_ONE_RELATION}addManyToOneMappings(e){let t=[];const n=e.value;if("object"!=typeof n||n.ot&&n.ot!==ue.MANY_TO_ONE_RELATION)t.push(e);else for(const i in n){if("ot"===i&&n[i]===ue.MANY_TO_ONE_RELATION)continue;const o={tableIndex:e.tableIndex,propertyChain:e.propertyChain.concat([i]),value:n[i]},r=this.addManyToOneMappings(o);t=t.concat(r)}return t}}class hd{constructor(e){this.jsonClauseField=e}getValue(e,t){return e.getFieldFunctionValue(this.jsonClauseField,null,t)}}class md extends fd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u,f){super(e,null,t,n,i,o,r,a,s,c,l,p,d,u,f)}addQEntityMapByAlias(e){for(let t in e)this.qEntityMapByAlias[t]=e[t]}toSQL(e,t){let n=this.jsonQuery;this.joinTrees=this.buildFromJoinTree(n.F,{},t);let i=this.getSELECTFragment(!1,n.S,e,t),o=this.getFROMFragments(this.joinTrees,t),r="";n.W&&(r=`\nWHERE\n\t${this.getWHEREFragment(n.W,"",t)}`);let a="";n.GB&&n.GB.length&&(a=`\nGROUP BY\n\t${this.getGroupByFragment(n.GB)}`);let s="";n.H&&(s=`\nHAVING\n\t${this.getWHEREFragment(n.H,"",t)}`);let c="";n.OB&&n.OB.length&&(c=`\nORDER BY\n\t${this.orderByParser.getOrderByFragment(n.S,n.OB)}`);let l="";n.O&&(l=this.sqlQueryAdapter.getOffsetFragment(n.O));return n.L&&(l=this.sqlQueryAdapter.getLimitFragment(n.L)),`SELECT\n\t${i}\nFROM\n${o}${r}${a}${s}${c}${l}\n${this.storeDriver.getSelectQuerySuffix(this.jsonQuery,t)}`}buildFromJoinTree(e,t,n){let i,o=[];if(e.length<1)throw new Error("FROM clause must have entries for non-Entity queries");let r=e[0];switch(r.rt){case le.SUB_QUERY_ROOT:case le.ENTITY_ROOT:break;default:throw new Error("First table in FROM clause cannot be joined")}let a=this.relationManager.getAlias(r);this.qValidator.validateReadFromEntity(r);let s=this.relationManager.createRelatedQEntity(r,n);this.qEntityMapByAlias[a]=s,i=new Tt(r,[],null),o.push(i),t[a]=i;for(let i=1;i<e.length;i++){let r,s=e[i];if(!s.jt)throw new Error(`Table ${i+1} in FROM clause is missing joinType`);switch(this.qValidator.validateReadFromEntity(s),a=this.relationManager.getAlias(s),s.rt){case le.SUB_QUERY_ROOT:let e=this.addFieldsToView(s,a,n);this.qEntityMapByAlias[a]=e;continue;case le.ENTITY_ROOT:let c=this.relationManager.createRelatedQEntity(s,n);this.qEntityMapByAlias[a]=c;let l=new Tt(s,[],null);if(t[a])throw new Error(`Alias '${a}' used more than once in the FROM clause.`);o.push(l),t[a]=l;continue;case le.ENTITY_APPLICATION_RELATION:if(!s.ri)throw new Error(`Table ${i+1} in FROM clause is missing relationPropertyName`);r=this.relationManager.createRelatedQEntity(s,n);break;case le.SUB_QUERY_JOIN_ON:s.joinWhereClause||this.warn(`View ${i+1} in FROM clause is missing joinWhereClause`),r=this.addFieldsToView(s,a,n);break;case le.ENTITY_JOIN_ON:s.joinWhereClause||this.warn(`Table ${i+1} in FROM clause is missing joinWhereClause`),r=this.relationManager.createRelatedQEntity(s,n);break;default:throw new Error(`Unknown JSONRelationType ${s.rt}`)}let c=this.relationManager.getParentAlias(s);if(!t[c])throw new Error(`Missing parent entity for alias ${c}, on table ${i+1} in FROM clause. \n\t\t\t\t\tNOTE: sub-queries in FROM clause cannot reference parent FROM tables.`);let l=t[c],p=new Tt(s,[],l);if(l.addChildNode(p),this.qValidator.validateReadFromEntity(s),this.qEntityMapByAlias[a]=r,!r)throw new Error(`Could not find entity ${s.ti} for table ${i+1} in FROM clause`);if(t[a])throw new Error(`Alias '${a}' used more than once in the FROM clause.`);t[a]=p}return o}addFieldsToView(e,t,n){let i=new Dt(e.fromClausePosition,null);return this.addFieldsToViewForSelect(i,t,e.subQuery.S,"f",null,n),i}addFieldsToViewForSelect(e,t,n,i,o,r){let a=0,s=!1;for(let c in n){let l=`${i}${++a}`,p=n[c];if(p.ot){let n=o||l;s=s&&this.addFieldToViewForSelect(e,t,i,p,n,o,r)}else this.addFieldsToViewForSelect(e,t,p,`${l}_`,null,r)}if(a>1){if(s)throw new Error("DISTINCT clause must be the only property at its level");if(o)throw new Error("Field queries can have only one field in SELECT clause")}}addFieldToViewForSelect(e,t,n,i,o,r=null,a){let s,c,l,p=!1;switch(i.ot){case ue.FIELD_FUNCTION:throw e[o]=new hd(i),new Error("Not implemented");case ue.EXISTS_FUNCTION:throw new Error("Exists function cannot be used in SELECT clause.");case ue.FIELD:switch(s=this.airportDatabase.applications[i.si].currentVersion[0].applicationVersion.entities[i.ti],c=s.properties[i.pi],l=s.columns[i.ci],i.dt){case fe.BOOLEAN:e[o]=new jt(l,c,e);break;case fe.DATE:e[o]=new kt(l,c,e);break;case fe.NUMBER:e[o]=new $t(l,c,e);break;case fe.STRING:e[o]=new Qt(l,c,e);break;default:throw new Error(`Unknown SQLDataType: ${i.dt}.`)}break;case ue.FIELD_QUERY:let d=i;this.addFieldToViewForSelect(e,t,n,d.S,o,o,a);break;case ue.DISTINCT_FUNCTION:this.addFieldsToViewForSelect(e,t,i.v,n,r,a),p=!0;break;case ue.MANY_TO_ONE_RELATION:throw new Error("@ManyToOne fields cannot be directly in a SELECT clause.\n\t\t\t\t\tPlease select a non-relational field within the relation.");default:throw new Error(`Unexpected type property on JSONClauseField: ${i.ot}.`)}return p}getFieldSelectFragment(e,t,n,i,o){let r=this.getFieldValue(e,t,n,o);return void 0!==e.fa&&(r+=` as ${e.fa}`),0===i?`\n\t${r}`:`,\n\t${r}`}getFROMFragments(e,t){return e.map((e=>this.getFROMFragment(null,e,t))).join("\n")}getFROMFragment(e,t,n){let i="\t",o=t.jsonRelation,r=this.relationManager.getAlias(o),a=this.qEntityMapByAlias[r];if(e){let t,s=e.jsonRelation,c=this.relationManager.getAlias(s),l=this.qEntityMapByAlias[c],p=this.qEntityMapByAlias[r];switch(o.jt){case se.FULL_JOIN:t="FULL JOIN";break;case se.INNER_JOIN:t="INNER JOIN";break;case se.LEFT_JOIN:t="LEFT JOIN";break;case se.RIGHT_JOIN:t="RIGHT JOIN";default:throw new Error(`Unsupported join type: ${o.jt}`)}let d,u="Error building FROM: ";switch(o.rt){case le.ENTITY_JOIN_ON:let e=o;d=this.getWHEREFragment(e.joinWhereClause,"\t",n),i+=`\t${t} ${this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n)} ${r} ON\n${d}`;break;case le.ENTITY_APPLICATION_RELATION:i+=this.getEntityApplicationRelationFromJoin(l,p,o,s,r,c,t,u,n);break;case le.SUB_QUERY_JOIN_ON:let f=o;const{parameterReferences:y,subQuerySql:h}=this.subStatementSqlGenerator.getTreeQuerySql(f.subQuery,this.dialect,n);y.length&&(this.parameterReferences=this.parameterReferences.concat(y)),d=this.getWHEREFragment(f.joinWhereClause,"\t",n),i+=`${t} (${h}) ${r} ON\n${d}`;break;default:throw new Error("Nested FROM entries must be Entity JOIN ON\n\t\t\t\t\tor Application Relation, or Sub-Query JOIN ON")}}else switch(o.rt){case le.ENTITY_ROOT:i+=`${this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n)} ${r}`;break;case le.SUB_QUERY_ROOT:let e=o;const{parameterReferences:t,subQuerySql:s}=this.subStatementSqlGenerator.getTreeQuerySql(e.subQuery,this.dialect,n);t.length&&(this.parameterReferences=this.parameterReferences.concat(t)),i+=`(${s}) ${r}`;break;default:throw new Error("Top level FROM entries must be Entity or Sub-Query root")}for(let e=0;e<t.childNodes.length;e++){let o=t.childNodes[e];i+=this.getFROMFragment(t,o,n)}return i}getGroupByFragment(e){return e.map((e=>(this.qValidator.validateAliasedFieldAccess(e.fa),`${e.fa}`))).join(", ")}getOrderByFragment(e){return e.map((e=>{switch(this.qValidator.validateAliasedFieldAccess(e.fa),e.so){case pe.ASCENDING:return`${e.fa} ASC`;case pe.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}class Id extends md{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(e,t,xe.FIELD,n,i,o,r,a,s,c,l,p,d,u),this.orderByParser=new Wp(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let t=this.parseQueryResult(this.jsonQuery.S,e,[0]);r.push(t)})),r):r}getSELECTFragment(e,t,n,i){if(!t)throw new Error("SELECT clause is not defined for a Field Query");{let o=t;if(o.ot==ue.DISTINCT_FUNCTION){return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}}let o=t,r=0;return this.getFieldSelectFragment(o,rd.NON_MAPPED_SELECT_CLAUSE,null,r++,i)}parseQueryResult(e,t,n){let i=e,o=this.sqlQueryAdapter.getResultCellValue(t,i.fa,n[0],i.dt,null);return n[0]++,o}}class Rd extends md{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(e,t,xe.TREE,n,i,o,r,a,s,c,l,p,d,u),this.queryParser=new od(i,o,d),this.orderByParser=new zp(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let t=new ct,n=this.parseQueryResult(this.jsonQuery.S,e,[0],t,t.getFollowingAlias());r.push(n),this.queryParser.flushRow()})),r):r}getSELECTFragment(e,t,n,i){const o=t;if(o.ot==ue.DISTINCT_FUNCTION){if(e)throw new Error("Cannot have DISTINCT specified in a nested SELECT clause");return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}let r=0;for(let e in t){if("*"===e)throw new Error("'*' operator isn't yet implemented in mapped queries");if("id"===e)throw new Error("'id' operator isn't yet implemented in mapped queries");r++}if(0===r){if(e)throw new Error("Mapped query must have fields in a nested-SELECT clause");return"*"}let a=0,s="";for(let e in t){const o=t[e];void 0!==o&&(s+=o instanceof hd?o.getValue(this,i):this.getFieldSelectFragment(o,rd.MAPPED_SELECT_CLAUSE,(()=>this.getSELECTFragment(!0,o,n,i)),a++,i))}return s}parseQueryResult(e,t,n,i,o){if(!t||!(t instanceof Object)||t instanceof Date)return t;{let r=e;if(r.ot==ue.DISTINCT_FUNCTION)return this.parseQueryResult(r.appliedFunctions[0].p[0],t,n,i,o)}let r=this.queryParser.addEntity(o);for(let a in e){if(void 0===e[a])continue;let s=e[a],c=s.dt;if(c){let e=this.sqlQueryAdapter.getResultCellValue(t,s.fa,n[0],c,null);this.queryParser.addProperty(o,r,c,a,e)}else{let e=this.parseQueryResult(s,t,n,i,i.getFollowingAlias());this.queryParser.bufferOneToManyCollection(o,r,a,e)}n[0]++}return this.queryParser.flushEntity(o,r)}}var Ed=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _d=class{getTreeQuerySql(e,t,n){let i=new Rd(e,t,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this.storeDriver,this,this.utils,n);const o=i.toSQL({},n);return{parameterReferences:i.parameterReferences,subQuerySql:o}}getFieldQuerySql(e,t,n,i){let o=new Id(e,t,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this.storeDriver,this,this.utils,i);o.addQEntityMapByAlias(n);const r=o.toSQL({},i);return{parameterReferences:o.parameterReferences,subQuerySql:r}}};Ed([function(e,t){}],_d.prototype,"airportDatabase",void 0),Ed([function(e,t){}],_d.prototype,"applicationUtils",void 0),Ed([function(e,t){}],_d.prototype,"entityStateManager",void 0),Ed([function(e,t){}],_d.prototype,"qMetadataUtils",void 0),Ed([function(e,t){}],_d.prototype,"qValidator",void 0),Ed([function(e,t){}],_d.prototype,"relationManager",void 0),Ed([function(e,t){}],_d.prototype,"sqlQueryAdapter",void 0),Ed([function(e,t){}],_d.prototype,"storeDriver",void 0),Ed([function(e,t){}],_d.prototype,"utils",void 0),_d=Ed([function(e){}],_d);class gd extends fd{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u,f,y,h,m){if(super(e,t,n,i,o,r,a,c,l,p,d,u,f,y,h),this.objectResultParserFactory=s,this.graphQueryConfiguration=m,this.columnAliases=new ct,m&&void 0!==this.graphQueryConfiguration.strict)throw new Error('"strict" configuration is not yet implemented for \n\t\t\tQueryResultType.ENTITY_GRAPH');this.finalSelectTree=this.setupSelectFields(this.jsonQuery.S,t,h),this.orderByParser=new Qp(this.finalSelectTree,o,l,p,e.OB)}toSQL(e,t){this.joinTree=this.buildFromJoinTree(this.jsonQuery.F,{},t);let n=this.getSELECTFragment(this.dbEntity,this.finalSelectTree,this.joinTree,t),i=this.getFROMFragment(null,this.joinTree,t),o="",r=this.jsonQuery;r.W&&(o=`\nWHERE\n${this.getWHEREFragment(r.W,"",t)}`);let a="";return r.OB&&r.OB.length&&(a=`\nORDER BY\n${this.orderByParser.getOrderByFragment(this.joinTree,this.qEntityMapByAlias,t)}`),`SELECT\n\t${n}\nFROM\n${i}${o}${a}\n${this.storeDriver.getSelectQuerySuffix(this.jsonQuery,t)}`}async parseQueryResults(e,t,n,i,o){this.queryParser=this.objectResultParserFactory.getObjectResultParser(this.queryResultType,this.graphQueryConfiguration,this.dbEntity);let r,a=[];if(!e||!e.length)return a;a=[];for(let t=0;t<e.length;t++){let n=e[t],o=this.relationManager.getAlias(this.joinTree.jsonRelation);this.columnAliases.reset();let s=this.parseQueryResult(this.finalSelectTree,o,this.joinTree,n,[0],i);r?r!==s&&a.push(s):a.push(s),r=s,this.queryParser.flushRow()}return this.queryParser.bridge(a,this.jsonQuery.S,i)}buildFromJoinTree(e,t,n){let i;if(e.length<1){let t={currentChildIndex:0,ti:this.dbEntity.index,fromClausePosition:[],jt:null,ri:null,rt:le.ENTITY_ROOT,rep:"r_",si:this.dbEntity.applicationVersion._localId};e.push(t)}let o=e[0];switch(o.rt){case le.ENTITY_ROOT:break;case le.SUB_QUERY_ROOT:case le.SUB_QUERY_JOIN_ON:throw new Error("Entity query's FROM clause cannot contain sub-queries");case le.ENTITY_JOIN_ON:throw new Error("Entity queries cannot use JOIN ON");default:throw new Error("First table in FROM clause cannot be result of a join")}let r=this.relationManager.getAlias(o),a=this.relationManager.createRelatedQEntity(o,n);this.qEntityMapByAlias[r]=a,this.jsonRelationMapByAlias[r]=o;const s=a.__driver__.dbEntity;if(s.applicationVersion.application.index!==this.dbEntity.applicationVersion.application.index||s.index!==this.dbEntity.index)throw new Error(`ERROR: Unexpected first table in FROM clause: \n\t\t\t'${s.applicationVersion.application.name}.${s.name}',\n\t\t\texpecting:\n\t\t\t'${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}'`);i=new Tt(o,[],null),t[r]=i;for(let i=1;i<e.length;i++){let a=e[i];switch(a.rt){case le.ENTITY_ROOT:throw new Error("All Entity query tables after the first must be joined");case le.SUB_QUERY_JOIN_ON:throw new Error("Entity queries FROM clause cannot contain sub-queries");case le.ENTITY_JOIN_ON:throw new Error("Entity queries cannot use JOIN ON")}if(!a.ri&&0!==a.ri)throw new Error(`Table ${i+1} in FROM clause is missing \n\t\t\t\trelationPropertyName`);let s=this.relationManager.getParentAlias(a);if(!t[s])throw new Error(`Missing parent entity for alias ${s}, \n\t\t\t\ton table ${i+1} in FROM clause`);let c=t[s],l=new Tt(a,[],c);c.addChildNode(l),r=this.relationManager.getAlias(a);let p=this.relationManager.createRelatedQEntity(a,n);if(this.qEntityMapByAlias[r]=p,this.jsonRelationMapByAlias[r]=o,!p)throw new Error(`Could not find entity ${a.ti} for \n\t\t\t\ttable ${i+1} in FROM clause`);if(t[r])throw new Error(`Alias '${r}' used more than once in the FROM clause.`);t[r]=l}return i}parseQueryResult(e,t,n,i,o,r){if(!i||!(i instanceof Object)||i instanceof Date)return i;let a=0;const s=this.qEntityMapByAlias[t].__driver__.dbEntity;let c=this.queryParser.addEntity(t,s,r);for(let l in e){const p=s.propertyMap[l];if(p.relation&&p.relation.length){const d=e[l],u=p.relation[0],f=u.relationEntity;if(null===d||d.__state__===ye.STUB)switch(u.relationType){case ce.MANY_TO_ONE:let e=!1,n=[];this.applicationUtils.forEachColumnTypeOfRelation(u,((t,r)=>{const s=this.columnAliases.getFollowingAlias();let c=this.sqlQueryAdapter.getResultCellValue(i,s,o[0],t.type,null);n.push({propertyNameChains:r,sqlDataType:t.type,value:c}),this.utils.objectExists(c)&&(e=!0,a++),o[0]++})),e?this.queryParser.bufferManyToOneStub(t,s,c,l,f,n,r):this.queryParser.bufferBlankManyToOneStub(t,c,l,n);break;case ce.ONE_TO_MANY:this.queryParser.bufferOneToManyStub(s,l);break;default:throw new Error(`Unknown relation type '${u.relationType}' for \n\t\t\t\t\t\t\t\t'${s.name}.${p.name}'`)}else{const e=n.getEntityRelationChildNode(u),a=this.relationManager.getAlias(e.jsonRelation),f=this.qEntityMapByAlias[a].__driver__.dbEntity;let y=this.parseQueryResult(d,a,e,i,o,r);switch(u.relationType){case ce.MANY_TO_ONE:y?this.queryParser.bufferManyToOneObject(t,s,c,l,f,y,r):this.queryParser.bufferBlankManyToOneObject(t,c,l);break;case ce.ONE_TO_MANY:y?this.queryParser.bufferOneToManyCollection(t,c,s,l,f,y,r):this.queryParser.bufferBlankOneToMany(t,c,s.name,l,f,r);break;default:throw new Error(`Unknown relation type '${u.relationType}' for \n\t\t\t\t\t\t\t\t'${s.name}.${p.name}'`)}}}else{const e=this.columnAliases.getFollowingAlias(),n=this.entityDefaults.getForAlias(t)[l],r=p.propertyColumns[0].column,s=this.sqlQueryAdapter.getResultCellValue(i,e,o[0],r.type,n);this.queryParser.addProperty(t,c,r.type,l,s)&&a++,o[0]++}}if(0===a)return null;let l=this.applicationUtils.getIdKey(c,s);return this.queryParser.flushEntity(t,s,e,l,c,r)}setupSelectFields(e,t,n,i){let o,r=!0;if(!e||e instanceof Array){let e="";throw i&&(e=`(of '${i.entity.name}.${i.name}') `),new Error(`'${t.name}' Entity SELECT clause ${e}must be specified as an Object.`)}var a;(a=o)&&"ID"===a.airportSelectField?(o={},r=!1):o={...e};let s=!1;(!0===o.__allFields__||!0===o["*"]||o["*"]&&!0===o["*"].airportSelectField)&&(s=!0,delete o.__allFields__,delete o["*"]);const c=!!t.idColumns.length;for(const e in o){s||(r=!1);const i=t.propertyMap[e];if(!i)throw new Error(`Entity property '${t.name}.${e}' does not exist.`);const a=o[e];if(null==a||ot(a)){if(i.isId)throw new Error("@Id properties cannot be excluded from entity queries.");if(!c)throw new Error(`Cannot exclude property '${e}' from SELECT clause \n\t\t\t\t\tfor '${t.name}' Entity - entity has no @Id so all properties must be included.`);delete o[e]}else i.relation&&i.relation.length?o[e]=this.setupSelectFields(a,i.relation[0].relationEntity,n,i):it(a)||(o[e]=tt)}for(const e of t.properties){if(c&&!e.isId&&!r)continue;const n=c&&!e.isId;if(e.relation&&e.relation.length){const n=e.relation[0];switch(n.relationType){case ce.ONE_TO_MANY:break;case ce.MANY_TO_ONE:if(o[e.name])break;const i={};this.entityStateManager.markAsStub(i),o[e.name]=i;break;default:throw new Error(`Unknown relation type: '${n.relationType}' \n\t\t\t\t\t\ton '${t.name}.${e.name}'.`)}}else{const t=o[e.name];if(null!=t){if(!n&&!it(t))throw new Error((c?"@Id properties":"Entities without @Id")+" \n\t\t\t\t\t\tcannot have default SELECT values.")}else o[e.name]=tt}}return o}getSELECTFragment(e,t,n,i,o){const r=this.relationManager.getAlias(n.jsonRelation);let a=[];this.entityStateManager.isStub(t);const s=this.entityDefaults.getForAlias(r);for(let o in t){if("__state__"===o)continue;const c=t[o];it(c)||(s[o]=c);const l=e.propertyMap[o];if(l.relation&&l.relation.length){const e=l.relation[0];if(this.entityStateManager.isStub(t[o]))for(const t of e.manyRelationColumns){const e=t.manyColumn;this.addFieldFromColumn(e);const n=this.getSimpleColumnFragment(r,e.name);a.push(`${n} ${this.columnAliases.getFollowingAlias()}`)}else{const r=this.getSELECTFragment(e.relationEntity,t[o],n.getEntityRelationChildNode(e),i,l);a=a.concat(r)}}else{const e=l.propertyColumns[0].column;this.addFieldFromColumn(e);const t=this.getSimpleColumnFragment(r,e.name);a.push(`${t} ${this.columnAliases.getFollowingAlias()}`)}}return a}getFROMFragment(e,t,n){let i="\t",o=t.jsonRelation,r=this.relationManager.getAlias(o),a=this.qEntityMapByAlias[r];if(!a)throw new Error(`Select clause doesn't match the from clause.\nPlease make sure that all entities present in the SELECT: {...} clause\nare specified in the FROM: [...] clause, with the SAME nesting pattern as\nin the SELECT: {...} clause.  The non-matching SELECT clause is:\n\n${at(this.jsonQuery.S)}\n\n`);let s=this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n);if(e){let t,a=e.jsonRelation,s=this.relationManager.getAlias(a),c=this.qEntityMapByAlias[s],l=this.qEntityMapByAlias[r];switch(o.jt){case se.FULL_JOIN:throw new Error("Full Joins are not allowed in Entity queries.");case se.INNER_JOIN:t="INNER JOIN";break;case se.LEFT_JOIN:t="LEFT JOIN";break;case se.RIGHT_JOIN:throw new Error("Right Joins are not allowed in Entity queries.");default:throw new Error(`Unsupported join type: ${o.jt}`)}let p="Error building FROM: ";switch(o.rt){case le.ENTITY_APPLICATION_RELATION:i+=this.getEntityApplicationRelationFromJoin(c,l,o,a,r,s,t,p,n);break;default:throw new Error("Only Entity application relations are allowed in Entity query FROM clause.")}}else i+=`${s} ${r}`;for(let e=0;e<t.childNodes.length;e++){let o=t.childNodes[e];i+=this.getFROMFragment(t,o,n)}return i}}class Td extends md{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(e,t,xe.SHEET,n,i,o,r,a,s,c,l,p,d,u),this.orderByParser=new Wp(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let n=this.parseQueryResult(this.jsonQuery.S,e,[0],t);r.push(n)})),r):r}getSELECTFragment(e,t,n,i){if(!t)throw new Error("SELECT clause is not defined for a Flat Query");{let o=t;if(o.ot==ue.DISTINCT_FUNCTION){return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}}if(!(t instanceof Array))throw new Error("SELECT clause for a Flat Query must be an Array");let o=0,r=t.map((e=>this.getFieldSelectFragment(e,rd.NON_MAPPED_SELECT_CLAUSE,null,o++,i))).join("");const a=n.SELECT;return a&&a.length&&(o&&(r+="\n\t,"),r+=a.map((e=>`${e.name}`)).join("\n\t,")),r}parseQueryResult(e,t,n,i){const o=e.map((e=>{let i=this.sqlQueryAdapter.getResultCellValue(t,e.fa,n[0],e.dt,null);return n[0]++,i})),r=i.SELECT;if(r&&r.length)for(const e of r){let i=this.sqlQueryAdapter.getResultCellValue(t,e.name,n[0],e.type,null);o.push(i),n[0]++}return o}}var Od=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ad=class{constructor(){this.transactionHistory_LocalIdColumns=[]}async init(){this.populateTransactionHistory_LocalIdColumns().then()}populateTransactionHistory_LocalIdColumns(){return new Promise(((e,t)=>{this.doPopulateTransactionHistory_LocalIdColumns(e)}))}doPopulateTransactionHistory_LocalIdColumns(e){if(kr.__dbApplication__&&kr.__dbApplication__.currentVersion){const t=this.getHoldingPatternDbEntity("TransactionHistory"),n=this.getHoldingPatternDbEntity("RepositoryTransactionHistory"),i=this.getHoldingPatternDbEntity("OperationHistory"),o=this.getHoldingPatternDbEntity("RecordHistory");this.transactionHistory_LocalIdColumns.push(t.idColumns[0]),this.transactionHistory_LocalIdColumns.push(n.idColumns[0]),this.transactionHistory_LocalIdColumns.push(i.idColumns[0]),this.transactionHistory_LocalIdColumns.push(o.idColumns[0]),e()}else setTimeout((()=>{this.doPopulateTransactionHistory_LocalIdColumns(e)}),100)}async generateTransactionHistory_LocalIds(e,t,n){let i=await this.sequenceGenerator.generateSequenceNumbers(this.transactionHistory_LocalIdColumns,[1,e,t,n]);return{operationHistory_LocalIds:i[2],recordHistory_LocalIds:i[3],repositoryHistory_LocalIds:i[1],transactionHistory_LocalId:i[0][0]}}async generateEntityIds(){}getHoldingPatternDbEntity(e){return kr.__dbApplication__.currentVersion[0].applicationVersion.entityMapByName[e]}};var Nd;Od([function(e,t){}],Ad.prototype,"sequenceGenerator",void 0),Ad=Od([function(e){}],Ad),function(e){e.CREATED="CREATED",e.DELETED="DELETED",e.UPDATED="UPDATED"}(Nd||(Nd={}));var xd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let bd=class{supportsLocalTransactions(e){return!0}getEntityTableName(e,t){return this.getTableName(e.applicationVersion.application,e,t)}getTableName(e,t,n){let i,o=t.name;return t.tableConfig&&t.tableConfig.name&&(o=t.tableConfig.name),i=e.fullName?e.fullName:this.dbApplicationUtils.getFullApplication_Name(e),this.composeTableName(i,o,n)}async internalSetupTransaction(e,t){await this.ensureContext(t)}async tearDownTransaction(e,t){e.childTransaction&&this.tearDownTransaction(e.childTransaction,t),e.parentTransaction&&(e.parentTransaction.childTransaction=null,e.parentTransaction=null)}async startTransaction(e,t){await this.ensureContext(t);try{await this.internalStartTransaction(e)}catch(n){throw await this.tearDownTransaction(e,t),console.error(n),n}}async commit(e,t){await this.ensureContext(t);try{await this.internalCommit(e)}catch(t){console.error(t);try{await this.internalRollback(e)}catch(e){console.error(e)}throw t}finally{await this.tearDownTransaction(e,t)}}async rollback(e,t){await this.ensureContext(t);try{await this.internalRollback(e)}catch(e){console.error(e)}finally{await this.tearDownTransaction(e,t)}}async insertValues(e,t,n){const i=this.splitValues(e.jsonQuery.V,t);let o=0;for(const n of i){let i=new pd({...e.jsonQuery,V:n},this.getDialect(t),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t),r=i.toSQL(t),a=i.getParameters(e.parameterMap,t);o+=await this.executeNative(r,a,t)}return o}async deleteWhere(e,t){let n=new je,i=new ld(e.jsonQuery,this.getDialect(t),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t),o=i.toSQL(t),r=i.getParameters(e.parameterMap,t),a=await this.executeNative(o,r,t);return this.activeQueries.markQueriesToRerun(n),a}async updateWhere(e,t,n){let i=new yd(e.jsonQuery,this.getDialect(n),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,n),o=i.toSQL(t,n),r=i.getParameters(e.parameterMap,n);return await this.executeNative(o,r,n)}async find(e,t,n,i){n=await this.ensureContext(n);const o=this.getSQLQuery(e,n),r=o.toSQL(t,n),a=o.getParameters(e.parameterMap,n);let s=await this.findNative(r,a,n);return s=await o.parseQueryResults(s,t,e.queryResultType,n),s}getSQLQuery(e,t){let n=e.jsonQuery,i=this.getDialect(t),o=e.queryResultType;const r=xe;switch(o){case r.ENTITY_GRAPH:case r.ENTITY_TREE:const a=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex];return new gd(n,a,i,o,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.objectResultParserFactory,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t);case r.FIELD:return new Id(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t);case r.SHEET:return new Td(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t);case r.TREE:return new Rd(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,this.utils,t);case r.RAW:default:throw new Error(`Unknown QueryResultType: ${o}`)}}async findOne(e,t,n,i){let o=await this.find(e,t,n);if(o.length>1)throw new Error(`Expecting a single result, got ${o.length}`);return 1==o.length?o[0]:null}warn(e){console.log(e)}splitValues(e,t){const n=e[0].length;if(e.length*n<=this.maxValues)return[e];let i=Math.floor(this.maxValues/n);const o=[];for(let t=0;t<e.length;t+=i){const n=e.slice(t,t+i);o.push(n)}return o}async ensureContext(e){return pi(e)}};xd([function(e,t){}],bd.prototype,"activeQueries",void 0),xd([function(e,t){}],bd.prototype,"airportDatabase",void 0),xd([function(e,t){}],bd.prototype,"applicationUtils",void 0),xd([function(e,t){}],bd.prototype,"dbApplicationUtils",void 0),xd([function(e,t){}],bd.prototype,"entityStateManager",void 0),xd([function(e,t){}],bd.prototype,"objectResultParserFactory",void 0),xd([function(e,t){}],bd.prototype,"qMetadataUtils",void 0),xd([function(e,t){}],bd.prototype,"qValidator",void 0),xd([function(e,t){}],bd.prototype,"relationManager",void 0),xd([function(e,t){}],bd.prototype,"transactionManager",void 0),xd([function(e,t){}],bd.prototype,"sqlQueryAdapter",void 0),xd([function(e,t){}],bd.prototype,"subStatementQueryGenerator",void 0),xd([function(e,t){}],bd.prototype,"utils",void 0),bd=xd([function(e){}],bd);var wd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sd=class{validateInsertQEntity(e){}validateReadFromEntity(e){}validateReadProperty(e){}validateUpdateProperty(e,t){}validateUpdateColumn(e){}validateReadQEntityProperty(e,t,n){}validateReadQEntityManyToOneRelation(e,t,n){}addFunctionAlias(e){}addSubQueryAlias(e){}validateAliasedFieldAccess(e){}};Sd=wd([function(e){}],Sd);const vd=P("fuel-hydrant-system"),Cd=vd.token({class:_d,interface:"ISubStatementSqlGenerator",token:"SUB_STATEMENT_SQL_GENERATOR"}),Dd=vd.token({class:Ad,interface:"IIdGenerator",token:"ID_GENERATOR"}),Md=vd.token({class:id,interface:"IObjectResultParserFactory",token:"OBJECT_RESULT_PARSER_FACTORY"}),Vd=vd.token({class:Sd,interface:"IValidator",token:"Q_VALIDATOR"}),Pd=vd.token({class:null,interface:"ISQLQueryAdaptor",token:"SQL_QUERY_ADAPTOR"}),Ld=vd.token({class:bd,interface:"class SqlDriver",token:"ABSTRACT_SQL_DRIVER"});Dd.setDependencies({sequenceGenerator:Ze}),Md.setDependencies({applicationUtils:Wo,entityStateManager:Ke,utils:ii}),Ld.setDependencies({activeQueries:qp,airportDatabase:Qo,applicationUtils:Wo,dbApplicationUtils:Je,entityStateManager:Ke,objectResultParserFactory:Md,qMetadataUtils:Ko,qValidator:Vd,relationManager:Zo,transactionManager:xc,sqlQueryAdapter:Pd,subStatementQueryGenerator:Cd,utils:ii}),Cd.setDependencies({airportDatabase:Qo,applicationUtils:Wo,entityStateManager:Ke,qMetadataUtils:Ko,qValidator:Vd,relationManager:Zo,sqlQueryAdapter:Pd,storeDriver:Oc,utils:ii});var Ud=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jd=class{async getTransactionsForRepository(e,t,n){const i=await this.nonhubClient.getRepositoryTransactions(e,t,n),o=[];for(const e of i)if(e.repositoryGUID===t)for(const t of e.messages)t.syncTimestamp=e.syncTimestamp,o.push(t);else console.error(`Got a reponse fragment for repository ${e.repositoryGUID}.\n    Expecting message fragments for repository: ${t}`);return o}async sendTransactions(e,t){let n=!0;for(const[i,o]of t)try{await this.sendTransactionsForRepository(e,i,o)||(n=!1)}catch(e){console.error(e),n=!1}return n}async sendTransactionsForRepository(e,t,n){if(!n||!n.length)return!1;const i=await this.nonhubClient.sendRepositoryTransactions(e,t,n);if(!i)return!1;for(const e of n)e.syncTimestamp=i;return!0}};Ud([function(e,t){}],jd.prototype,"nonhubClient",void 0),jd=Ud([function(e){}],jd);var Fd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gd=class{async load(e){switch(e){case"IPFS":throw new Error("Not Implemented");case"localhost:9000":return this.debugSynchronizationAdapter;default:throw new Error(`Unexpected synchronization source: ${e}`)}}};Fd([function(e,t){}],Gd.prototype,"debugSynchronizationAdapter",void 0),Gd=Fd([function(e){}],Gd);var kd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Bd=class{async ensureActors(e,t){try{let n=[],i=new Map;for(let t=0;t<e.actors.length;t++){const o=e.actors[t];if("string"!=typeof o.GUID||36!==o.GUID.length)throw new Error("Invalid 'terminal.GUID'");this.checkActorApplication(o,e),this.checkActorTerminal(o,e),this.checkActorUserAccount(o,e),n.push(o.GUID),i.set(o.GUID,t),delete o._localId}const o=await this.actorDao.findByGUIDs(n);for(const t of o){const n=i.get(t.GUID);e.actors[n]=t}const r=e.actors.filter((e=>!e._localId));r.length&&await this.actorDao.insert(r,t)}catch(e){return console.error(e),!1}return!0}checkActorApplication(e,t){if("number"!=typeof e.application)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.terminal'");const n=t.applications[e.application];if(!n)throw new Error(`Did not find actor.application with "in-message index" ${e.application}`);e.application=n}checkActorTerminal(e,t){if("number"!=typeof e.terminal)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.terminal'");const n=t.terminals[e.terminal];if(!n)throw new Error(`Did not find actor.terminal with "in-message index" ${e.terminal}`);e.terminal=n}checkActorUserAccount(e,t){if("number"!=typeof e.userAccount)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.userAccount'");const n=t.userAccounts[e.userAccount];if(!n)throw new Error(`Did not find actor.userAccount with "in-message index" ${e.userAccount}`);e.userAccount=n}};kd([function(e,t){}],Bd.prototype,"actorDao",void 0),Bd=kd([function(e){}],Bd);var Hd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $d=class{async ensureApplications(e,t){try{let n=await this.checkApplicationsAndDomains(e,t);for(let t=0;t<e.applications.length;t++){let i=e.applications[t];e.applications[t]=n.get(i.domain.name).get(i.name).application}}catch(e){return console.error(e),!1}return!0}async checkApplicationsAndDomains(e,t){const{allApplication_Names:n,domainCheckMap:i,domainNames:o,applicationCheckMap:r}=this.getNames(e),a=await this.applicationDao.findByDomain_NamesAndApplication_Names(o,n);for(let e of a){let t=e.domain.name,n=e.name;for(let[o,a]of r.get(t))if(a.applicationName===n){let n=i.get(t);n.found=!0,n.domain=e.domain,a.found=!0,a.application=e}}let s=[];for(let[e,t]of i){if(t.found)continue;let n={_localId:null,name:e};t.domain=n,s.push(n)}s.length&&await this.domainDao.insert(s);let c=[];for(let[e,t]of r)for(let[n,o]of t){if(o.found)continue;let t={domain:i.get(e).domain,index:null,name:n,scope:"private",status:ve.STUB,signature:"localhost"};o.application=t,c.push(t)}return c.length&&await this.applicationDao.insert(c,t),r}getNames(e){if(!(e.applications&&e.applications instanceof Array))throw new Error("Did not find applications in RepositorySynchronizationMessage.");const t=new Map,n=new Map;for(let i of e.applications){if("object"!=typeof i)throw new Error("Invalid ApplicationVersion.application");if(!i.name||"string"!=typeof i.name)throw new Error("Invalid ApplicationVersion.Application.name");const e=i.domain;if("object"!=typeof e)throw new Error("Invalid ApplicationVersion.Application.Domain");if(!e.name||"string"!=typeof e.name)throw new Error("Invalid ApplicationVersion.Application.Domain.name");let o=n.get(e.name);o||(o=new Map,n.set(e.name,o)),o.has(i.name)||o.set(i.name,{applicationName:i.name}),t.get(e.name)||t.set(e.name,{domainName:e.name})}const i=[],o=[];for(const[e,t]of n){i.push(e);for(let[e,n]of t)o.push(e)}return{allApplication_Names:o,domainCheckMap:t,domainNames:i,applicationCheckMap:n}}};Hd([function(e,t){}],$d.prototype,"applicationDao",void 0),Hd([function(e,t){}],$d.prototype,"domainDao",void 0),$d=Hd([function(e){}],$d);var qd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yd=class{async ensureApplicationVersions(e,t){try{let n=await this.checkVersionsApplicationsDomains(e,t);for(let t=0;t<e.applicationVersions.length;t++){const i=e.applicationVersions[t];e.applicationVersions[t]=n.get(i.application.domain.name).get(i.application.name).applicationVersion}}catch(e){return console.error(e),!1}return!0}async checkVersionsApplicationsDomains(e,t){const{allApplication_Names:n,domainNames:i,applicationVersionCheckMap:o}=this.getNames(e),r=await this.applicationVersionDao.findByDomain_NamesAndApplication_Names(i,n);let a,s;for(let e of r){let t=e.application.domain.name,n=e.application.name;if(a!==t&&s!==n){let i=e.integerVersion;for(let[r,a]of o.get(t))if(a.applicationName===n){if(a.found=!0,a.applicationVersionNumber>i)throw new Error(`Installed application ${n} for domain ${t}\n\tis at a lower version ${i} than needed in message ${a.applicationVersionNumber}.`);a.applicationVersion=e}a=t,s=n}}for(const[e,t]of o)for(let[n,i]of t)if(!i.found)throw new Error(`Application ${i.applicationName} for domain ${e} is not installed.`);return o}getNames(e){if(!(e.applicationVersions&&e.applicationVersions instanceof Array))throw new Error("Did not find applicationVersions in RepositorySynchronizationMessage.");const t=new Map;for(let n of e.applicationVersions){if(!n.integerVersion||"number"!=typeof n.integerVersion)throw new Error("Invalid ApplicationVersion.integerVersion.");const i=e.applications[n.application];if("object"!=typeof i)throw new Error("Invalid ApplicationVersion.application");n.application=i;const o=i.domain;let r=t.get(o.name);r||(r=new Map,t.set(o.name,r)),r.has(i.name)||r.set(i.name,{applicationName:i.name,applicationVersionNumber:n.integerVersion})}const n=[],i=[];for(const[e,o]of t){n.push(e);for(let[e,t]of o)i.push(e)}return{allApplication_Names:i,domainNames:n,applicationVersionCheckMap:t}}};qd([function(e,t){}],Yd.prototype,"applicationVersionDao",void 0),Yd=qd([function(e){}],Yd);var Qd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wd=class{async checkMessage(e,t){return!!await this.syncInUserAccountChecker.ensureUserAccounts(e,t)&&(!!await this.syncInTerminalChecker.ensureTerminals(e,t)&&(!!await this.syncInApplicationChecker.ensureApplications(e,t)&&(!!await this.syncInActorChecker.ensureActors(e,t)&&(!!await this.syncInRepositoryChecker.ensureRepositories(e,t)&&(!!await this.syncInApplicationVersionChecker.ensureApplicationVersions(e,t)&&!!await this.syncInDataChecker.checkData(e,t))))))}};Qd([function(e,t){}],Wd.prototype,"syncInActorChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInApplicationChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInApplicationVersionChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInDataChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInRepositoryChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInTerminalChecker",void 0),Qd([function(e,t){}],Wd.prototype,"syncInUserAccountChecker",void 0),Wd=Qd([function(e){}],Wd);var zd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Jd=class{async checkData(e,t){const n=e.history;try{if(!n||"object"!=typeof n)throw new Error("Invalid RepositorySynchronizationMessage.history");if("string"!=typeof n.GUID||36!==n.GUID.length)return!1;if(!(n.operationHistory&&n.operationHistory instanceof Array))return!1;if(!n.saveTimestamp||"number"!=typeof n.saveTimestamp)throw new Error("Invalid RepositorySynchronizationMessage.history.saveTimestamp");if(n.transactionHistory)throw new Error("RepositorySynchronizationMessage.history.transactionHistory cannot be specified");if(n.repositoryTransactionType)throw new Error("RepositorySynchronizationMessage.history.repositoryTransactionType cannot be specified");if(n.syncTimestamp)throw new Error("RepositorySynchronizationMessage.history.syncTimestamp cannot be specified");n.repositoryTransactionType=Er.REMOTE,n.syncTimestamp=e.syncTimestamp,delete n._localId;const i=await this.populateApplicationEntityMap(e);await this.checkOperationHistories(e,i,t)}catch(e){return console.error(e),!1}return!0}async populateApplicationEntityMap(e){const t=this.terminalStore.getAllApplicationVersionsByIds(),n=new Map;for(const i of e.applicationVersions){const e=t[i._localId];for(const t of e.entities){let i=n.get(e.application.domain.name);i||(i=new Map,n.set(e.application.domain.name,i));let o=i.get(e.application.name);o||(o=new Map,i.set(e.application.name,o)),o.set(t.index,t)}}return n}async checkOperationHistories(e,t,n){const i=e.history;if(!(i.operationHistory instanceof Array&&i.operationHistory.length))throw new Error("Invalid RepositorySynchronizationMessage.history.operationHistory");const o=Xn(i.operationHistory.length,this.airportDatabase,this.sequenceGenerator);let r=0;for(let a=0;a<i.operationHistory.length;a++){const s=i.operationHistory[a];if("object"!=typeof s)throw new Error("Invalid operationHistory");if(s.orderNumber)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.orderNumber cannot be specified,\n\t\t\t\tthe position of orderHistory record determines it's order");switch(s.orderNumber=++r,s.changeType){case Ee.DELETE_ROWS:case Ee.INSERT_VALUES:case Ee.UPDATE_ROWS:break;default:throw new Error(`Invalid operationHistory.changeType: ${s.changeType}`)}if("object"!=typeof s.entity)throw new Error("Invalid operationHistory.entity");if("number"!=typeof s.entity.applicationVersion)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\t\tin 'operationHistory.entity.applicationVersion'");const c=e.actors[s.actor];if(!c)throw new Error('Cannot find Actor for "in-message id" RepositorySynchronizationMessage.history.actor');s.actor=c;const l=e.applicationVersions[s.entity.applicationVersion];if(!l)throw new Error(`Invalid index into message.applicationVersions [${s.entity.applicationVersion}],\n\t\t\t\tin operationHistory.entity.applicationVersion`);const p=t.get(l.application.domain.name).get(l.application.name).get(s.entity.index);if(!p)throw new Error(`Invalid operationHistory.entity.index: ${s.entity.index}`);if(s.entity=p,s.repositoryTransactionHistory)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.repositoryTransactionHistory cannot be specified");if(s.repositoryTransactionHistory=i,s.systemWideOperationId)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.systemWideOperationId cannot be specified");s.systemWideOperationId=o[a],delete s._localId;let d=new Map,u=new Map;for(const e of s.entity.columns){switch(e.name){case ae.ORIGINAL_ACTOR_ID:d.set(e.index,e);break;case ae.ORIGINAL_REPOSITORY_ID:u.set(e.index,e)}/.*_AID_[\d]+$/.test(e.name)&&e.manyRelationColumns.length&&d.set(e.index,e),/.*_RID_[\d]+$/.test(e.name)&&e.manyRelationColumns.length&&u.set(e.index,e)}await this.checkRecordHistories(s,d,u,e,n)}}async checkRecordHistories(e,t,n,i,o){const r=e.recordHistory;if(!(r instanceof Array&&r.length))throw new Error("Inalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory");for(const a of r){if(!a._actorRecordId||"number"!=typeof a._actorRecordId)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory._actorRecordId");switch(e.changeType){case Ee.INSERT_VALUES:if(a.actor)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.actor\nfor ChangeType.INSERT_VALUES");a.actor=e.actor;break;case Ee.DELETE_ROWS:case Ee.UPDATE_ROWS:if(void 0===a.actor)a.actor=e.actor;else{const e=i.actors[a.actor];if(!e)throw new Error('Did find Actor for "in-message id" in RepositorySynchronizationMessage.history -> operationHistory.actor');a.actor=e}}if(a.operationHistory)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.recordHistory.operationHistory cannot be specified");this.checkNewValues(a,t,n,e,i,o),this.checkOldValues(a,t,n,e,i,o),a.operationHistory=e,delete a._localId}}checkNewValues(e,t,n,i,o,r){switch(i.changeType){case Ee.DELETE_ROWS:if(e.newValues)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues\nfor ChangeType.DELETE_ROWS");return;case Ee.INSERT_VALUES:case Ee.UPDATE_ROWS:if(!(e.newValues instanceof Array&&e.newValues.length))throw new Error("Must specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues\nfor ChangeType.INSERT_VALUES|UPDATE_ROWS")}for(const t of e.newValues){if(t.recordHistory)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.recordHistory");if(t.recordHistory=e,"number"!=typeof t.columnIndex)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.columnIndex");if(void 0===typeof t.newValue)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue")}for(const i of e.newValues){const e=t.get(i.columnIndex);if(e){const t=o.actors[i.newValue];if(!t)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue\nValue is for ${e.name} and could find RepositorySynchronizationMessage.actors[${i.newValue}]`);i.newValue=t._localId}const r=n.get(i.columnIndex);if(r)if(-1===i.newValue)i.newValue=o.history.repository._localId;else{const e=o.referencedRepositories[i.newValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue\n\tValue is for ${r.name} and could find RepositorySynchronizationMessage.referencedRepositories[${i.newValue}]`);i.newValue=e._localId}}}checkOldValues(e,t,n,i,o,r){switch(i.changeType){case Ee.DELETE_ROWS:case Ee.INSERT_VALUES:if(e.oldValues)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues\nfor ChangeType.DELETE_ROWS|INSERT_VALUES");return;case Ee.UPDATE_ROWS:if(!(e.newValues instanceof Array&&e.oldValues.length))throw new Error("Must specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues\nfor ChangeType.UPDATE_ROWS")}for(const t of e.oldValues){if(t.recordHistory)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.recordHistory");if(t.recordHistory=e,"number"!=typeof t.columnIndex)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.columnIndex");if(void 0===typeof t.oldValue)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue")}for(const i of e.oldValues){if(t.get(i.columnIndex)){const e=o.actors[i.oldValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue\nValue is for ORIGINAL_ACTOR_ID and could find RepositorySynchronizationMessage.actors[${i.oldValue}]`);i.oldValue=e._localId}if(n.get(i.columnIndex)){const e=o.referencedRepositories[i.oldValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue\nValue is for ORIGINAL_REPOSITORY_ID and could find RepositorySynchronizationMessage.referencedRepositories[${i.oldValue}]`);i.oldValue=e._localId}}}};zd([function(e,t){}],Jd.prototype,"airportDatabase",void 0),zd([function(e,t){}],Jd.prototype,"sequenceGenerator",void 0),zd([function(e,t){}],Jd.prototype,"terminalStore",void 0),Jd=zd([function(e){}],Jd);var Kd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zd=class{async ensureRepositories(e,t){try{let n=[],i=new Map;for(let t=0;t<e.referencedRepositories.length;t++)this.checkRepository(e.referencedRepositories[t],t,n,i,e);const o=e.history;if(o.isRepositoryCreation){if("object"!=typeof o.repository)throw new Error("Serialized RepositorySynchronizationMessage.history.repository should be an object\n\tif RepositorySynchronizationMessage.history.isRepositoryCreation === true");this.checkRepository(o.repository,null,n,i,e)}else{if("string"!=typeof o.repository)throw new Error("Serialized RepositorySynchronizationMessage.history.repository should be a string\n\tif RepositorySynchronizationMessage.history.isRepositoryCreation === false");n.push(o.repository)}const r=await this.repositoryDao.findByGUIDs(n);for(const t of r){const n=i.get(t.GUID);n||0===n?e.referencedRepositories[n]=t:o.repository=t}const a=e.referencedRepositories.filter((e=>!e._localId));if("object"!=typeof o.repository)throw new Error(`Repository with GUID ${o.repository} is not\n\t\t\t\t\tpresent and cannot be synced\n\tThis RepositorySynchronizationMessage is for an existing repository and that\n\trepository must already be loaded in this database for this message to be\n\tprocessed.`);o.repository._localId||a.push(o.repository),a.length&&await this.repositoryDao.insert(a,t)}catch(e){return console.error(e),!1}return!0}checkRepository(e,t,n,i,o){if("number"!=typeof e.ageSuitability)throw new Error("Invalid 'repository.ageSuitability'");if(!e.createdAt||"string"!=typeof e.createdAt)throw new Error("Invalid 'repository.createdAt'");if(e.createdAt=new Date(e.createdAt),"boolean"!=typeof e.immutable)throw new Error("Invalid 'repository.immutable'");if(!e.source||"string"!=typeof e.source)throw new Error("Invalid 'repository.source'");if("string"!=typeof e.GUID||36!==e.GUID.length)throw new Error("Invalid 'repository.GUID'");if("number"!=typeof e.owner)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\tin 'repository.owner'");const r=o.userAccounts[e.owner];if(!r)throw new Error(`Did not find repository.owner (UserAccount) with "in-message index" ${e.owner}`);e.owner=r,n.push(e.GUID),"number"==typeof t&&i.set(e.GUID,t),delete e._localId}};Kd([function(e,t){}],Zd.prototype,"repositoryDao",void 0),Zd=Kd([function(e){}],Zd);var Xd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let eu=class{async ensureTerminals(e,t){try{let n=[],i=new Map;for(let t=0;t<e.terminals.length;t++){const o=e.terminals[t];if("number"!=typeof o.owner)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\t\tin 'terminal.owner' of RepositorySynchronizationMessage.terminals");if("string"!=typeof o.GUID||36!==o.GUID.length)throw new Error("Invalid 'terminal.GUID' in RepositorySynchronizationMessage.terminals");if(void 0!==o.isLocal)throw new Error("'terminal.isLocal' cannot defined in RepositorySynchronizationMessage.terminals");o.isLocal=!1;const r=e.userAccounts[o.owner];if(!r)throw new Error(`Did not find userAccount for terminal.owner with "in-message index" ${o.owner}\n\t\t\t\t\t\tfor RepositorySynchronizationMessage.terminals`);o.owner=r,n.push(o.GUID),i.set(o.GUID,t),delete o._localId}const o=await this.terminalDao.findByGUIDs(n);for(const t of o){const n=i.get(t.GUID);e.terminals[n]=t}const r=e.terminals.filter((e=>!e._localId));r.length&&await this.addMissingTerminals(r,t)}catch(e){return console.error(e),!1}return!0}async addMissingTerminals(e,t){for(const t of e)t.isLocal=!1;await this.terminalDao.insert(e,t)}};Xd([function(e,t){}],eu.prototype,"terminalDao",void 0),eu=Xd([function(e){}],eu);var tu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nu=class{async ensureUserAccounts(e,t){try{let n=[],i=new Map;for(let t=0;t<e.userAccounts.length;t++){const o=e.userAccounts[t];if("string"!=typeof o.GUID||36!==o.GUID.length)throw new Error("Invalid 'userAccount.GUID'");if("string"!=typeof o.username||o.username.length<3)throw new Error("Invalid 'userAccount.username'");n.push(o.GUID),i.set(o.GUID,t),delete o._localId}const o=await this.userAccountDao.findByGUIDs(n);for(const t of o){const n=i.get(t.GUID);e.userAccounts[n]=t}const r=e.userAccounts.filter((e=>!e._localId));r.length&&await this.addMissingUserAccounts(r,t)}catch(e){return console.error(e),!1}return!0}async addMissingUserAccounts(e,t){for(const t of e)if(!t.username||"string"!=typeof t.username)throw new Error(`Invalid UserAccount.username ${t.username}`);await this.userAccountDao.insert(e,t)}};tu([function(e,t){}],nu.prototype,"userAccountDao",void 0),nu=tu([function(e){}],nu);var iu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ou=class{};var ru;iu([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],ou.prototype,"_localId",void 0),iu([function(e,t){}],ou.prototype,"type",void 0),iu([function(e,t){}],ou.prototype,"acknowledged",void 0),iu([function(e,t){},function(e,t){}],ou.prototype,"repository",void 0),iu([function(e,t){},function(e,t){}],ou.prototype,"overwrittenRecordHistory",void 0),iu([function(e,t){},function(e,t){}],ou.prototype,"overwritingRecordHistory",void 0),iu([function(e,t){}],ou.prototype,"values",void 0),ou=iu([function(e){},function(e){}],ou),function(e){e.LOCAL_UPDATE_REMOTELY_DELETED="LOCAL_UPDATE_REMOTELY_DELETED",e.REMOTE_CREATE_REMOTELY_DELETED="REMOTE_CREATE_REMOTELY_DELETED",e.REMOTE_UPDATE_LOCALLY_DELETED="REMOTE_UPDATE_LOCALLY_DELETED",e.REMOTE_UPDATE_LOCALLY_UPDATED="REMOTE_UPDATE_LOCALLY_UPDATED"}(ru||(ru={}));var au=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let su=class{};var cu,lu;au([function(e,t){},function(e,t){},function(e,t){}],su.prototype,"synchronizationConflict",void 0),au([function(e,t){},function(e,t){}],su.prototype,"columnIndex",void 0),su=au([function(e){},function(e){}],su),function(e){e.LOCAL="LOCAL",e.REMOTE="REMOTE"}(cu||(cu={})),function(e){e.CHANGE_NEEDED="CHANGE_NEEDED",e.CHANGE_COMPLETED="CHANGE_COMPLETED"}(lu||(lu={}));var pu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let du=class{};pu([function(e,t){},function(e,t){},function(e,t){}],du.prototype,"_localId",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"applicationVersion",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"entity",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"repository",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"actor",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"_actorRecordId",void 0),pu([function(e,t){},function(e,t){}],du.prototype,"column",void 0),pu([function(e,t){}],du.prototype,"updatedValue",void 0),du=pu([function(e){},function(e){}],du);const uu={__constructors__:{RecordUpdateStage:du,SynchronizationConflict:ou,SynchronizationConflictValues:su},domain:"air",name:"@airport/layover"},fu=uu;function yu(e){return oi.ddS(fu.__dbApplication__,e)}oi.setQApplication(uu);class hu extends Vo{constructor(e){super(e,fu)}}class mu extends hu{constructor(){super(2)}static Save(e){return Vo.BaseSave(e)}static diSet(){return yu(2)}}mu.Find=new Po,mu.FindOne=new Po,mu.Search=new Po,mu.SearchOne=new Po;class Iu extends hu{constructor(){super(1)}static Save(e){return Vo.BaseSave(e)}static diSet(){return yu(1)}}Iu.Find=new Po,Iu.FindOne=new Po,Iu.Search=new Po,Iu.SearchOne=new Po;class Ru extends hu{constructor(){super(0)}static Save(e){return Vo.BaseSave(e)}static diSet(){return yu(0)}}Ru.Find=new Po,Ru.FindOne=new Po,Ru.Search=new Po,Ru.SearchOne=new Po;var Eu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _u=class extends Iu{async insert(e,t){let n;const i=[];for(const t of e)i.push([t.type,t.acknowledged,t.repository._localId,t.overwrittenRecordHistory._localId,t.overwritingRecordHistory._localId]);const o=await this.db.insertValuesGenerateIds({INSERT_INTO:n=fu.SynchronizationConflict,columns:[n.type,n.acknowledged,n.repository._localId,n.overwrittenRecordHistory._localId,n.overwritingRecordHistory._localId],VALUES:i},t);for(let t=0;t<e.length;t++){e[t]._localId=o[t][0]}}};_u=Eu([function(e){}],_u);var gu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Tu=class extends Ru{async insert(e,t){let n;const i=[];for(const t of e)i.push([t.synchronizationConflict._localId,t.columnIndex]);await this.db.insertValues({INSERT_INTO:n=fu.SynchronizationConflictValues,columns:[n.synchronizationConflict._localId,n.columnIndex],VALUES:i},t)}};Tu=gu([function(e){}],Tu);var Ou=A&&A.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Au=function(e){function t(n){var i=e.call(this,'Cannot determine a class of the requesting service "'+n+'"')||this;return i.name="ServiceNotFoundError",Object.setPrototypeOf(i,t.prototype),i}return Ou(t,e),t}(Error),Nu=Object.defineProperty({MissingProvidedServiceTypeError:Au},"__esModule",{value:!0}),xu=function(e){this.name=e},bu=Object.defineProperty({Token:xu},"__esModule",{value:!0}),wu=A&&A.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Su=function(e){function t(n){var i=e.call(this)||this;return i.name="ServiceNotFoundError","string"==typeof n?i.message='Service "'+n+'" was not found, looks like it was not registered in the container. Register it by calling Container.set("'+n+'", ...) before using service.':n instanceof bu.Token&&n.name?i.message='Service "'+n.name+'" was not found, looks like it was not registered in the container. Register it by calling Container.set before using service.':n instanceof bu.Token&&(i.message="Service with a given token was not found, looks like it was not registered in the container. Register it by calling Container.set before using service."),Object.setPrototypeOf(i,t.prototype),i}return wu(t,e),t}(Error),vu=Object.defineProperty({ServiceNotFoundError:Su},"__esModule",{value:!0}),Cu=Pu,Du=function(){function e(e){this.services=[],this.id=e}return e.prototype.has=function(e){return!!this.findService(e)},e.prototype.get=function(e){var t=Cu.Container.of(void 0),n=t.findService(e),i=this.findService(e);if(n&&!0===n.global)return this.getServiceValue(e,n);if(i)return this.getServiceValue(e,i);if(n&&this!==t){var o=Object.assign({},n);o.value=void 0;var r=this.getServiceValue(e,o);return this.set(e,r),r}return this.getServiceValue(e,n)},e.prototype.getMany=function(e){var t=this;return this.filterServices(e).map((function(n){return t.getServiceValue(e,n)}))},e.prototype.set=function(e,t){var n=this;if(e instanceof Array)return e.forEach((function(e){return n.set(e)})),this;if("string"==typeof e||e instanceof bu.Token)return this.set({id:e,value:t});if("object"==typeof e&&e.service)return this.set({id:e.service,value:t});if(e instanceof Function)return this.set({type:e,id:e,value:t});var i=e,o=this.findService(i.id);return o&&!0!==o.multiple?Object.assign(o,i):this.services.push(i),this},e.prototype.remove=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach((function(t){e.filterServices(t).forEach((function(t){e.services.splice(e.services.indexOf(t),1)}))})),this},e.prototype.reset=function(){return this.services=[],this},e.prototype.filterServices=function(e){return this.services.filter((function(t){return t.id?t.id===e:!!(t.type&&e instanceof Function)&&(t.type===e||e.prototype instanceof t.type)}))},e.prototype.findService=function(e){return this.services.find((function(t){return t.id?e instanceof Object&&t.id instanceof bu.Token&&e.service instanceof bu.Token?t.id===e.service:t.id===e:!!(t.type&&e instanceof Function)&&t.type===e}))},e.prototype.getServiceValue=function(e,t){var n;if(t&&void 0!==t.value)return t.value;if(!(t&&t.type||t&&t.factory||!("string"==typeof e||e instanceof bu.Token)))throw new vu.ServiceNotFoundError(e);var i=void 0;if(t&&t.type?i=t.type:t&&t.id instanceof Function?i=t.id:e instanceof Function&&(i=e),!t){if(!i)throw new Nu.MissingProvidedServiceTypeError(e);t={type:i},this.services.push(t)}var o,r=i&&Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:paramtypes",i):void 0,a=r?this.initializeParams(i,r):[];if(t.factory)a=a.filter((function(e){return void 0!==e})),o=t.factory instanceof Array?(n=this.get(t.factory[0]))[t.factory[1]].apply(n,a):t.factory.apply(t,a.concat([this]));else{if(!i)throw new Nu.MissingProvidedServiceTypeError(e);a.unshift(null),a.push(this),o=new(i.bind.apply(i,a))}return t&&!t.transient&&o&&(t.value=o),i&&this.applyPropertyHandlers(i,o),o},e.prototype.initializeParams=function(e,t){var n=this;return t.map((function(t,i){var o=Cu.Container.handlers.find((function(t){return t.object===e&&t.index===i}));return o?o.value(n):t&&t.name&&!n.isTypePrimitive(t.name)?n.get(t):void 0}))},e.prototype.isTypePrimitive=function(e){return-1!==["string","boolean","number","object"].indexOf(e.toLowerCase())},e.prototype.applyPropertyHandlers=function(e,t){var n=this;Cu.Container.handlers.forEach((function(i){"number"!=typeof i.index&&(i.object.constructor===e||e.prototype instanceof i.object.constructor)&&(t[i.propertyName]=i.value(n))}))},e}(),Mu=Object.defineProperty({ContainerInstance:Du},"__esModule",{value:!0}),Vu=function(){function e(){}return e.of=function(e){if(void 0===e)return this.globalInstance;var t=this.instances.find((function(t){return t.id===e}));return t||(t=new Mu.ContainerInstance(e),this.instances.push(t)),t},e.has=function(e){return this.globalInstance.has(e)},e.get=function(e){return this.globalInstance.get(e)},e.getMany=function(e){return this.globalInstance.getMany(e)},e.set=function(e,t){return this.globalInstance.set(e,t),this},e.remove=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.globalInstance).remove.apply(e,t),this},e.reset=function(e){if(e){var t=this.instances.find((function(t){return t.id===e}));t&&(t.reset(),this.instances.splice(this.instances.indexOf(t),1))}else this.globalInstance.reset(),this.instances.forEach((function(e){return e.reset()}));return this},e.registerHandler=function(e){return this.handlers.push(e),this},e.import=function(e){return this},e.globalInstance=new Mu.ContainerInstance(void 0),e.instances=[],e.handlers=[],e}(),Pu=Object.defineProperty({Container:Vu},"__esModule",{value:!0});var Lu=function(e,t){if(2===arguments.length||e instanceof Function){var n={service:new bu.Token},i=2===arguments.length?e:[],o=2===arguments.length?t:e;return Cu.Container.set({id:n.service,factory:function(e){var t=i.map((function(t){return e.get(t)}));return o.apply(void 0,t)}}),n}return function(t){var n={type:t};"string"==typeof e||e instanceof bu.Token?(n.id=e,n.multiple=e.multiple,n.global=e.global||!1,n.transient=e.transient):e&&(n.id=e.id,n.factory=e.factory,n.multiple=e.multiple,n.global=e.global||!1,n.transient=e.transient),Cu.Container.set(n)}},Uu=Object.defineProperty({Service:Lu},"__esModule",{value:!0}),ju=A&&A.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Fu=function(e){function t(n,i){var o=e.call(this,'Cannot inject value into "'+n.constructor.name+"."+i+"\". Please make sure you setup reflect-metadata properly and you don't use interfaces without service tokens as injection value.")||this;return o.name="ServiceNotFoundError",Object.setPrototypeOf(o,t.prototype),o}return ju(t,e),t}(Error),Gu=Object.defineProperty({CannotInjectError:Fu},"__esModule",{value:!0});var ku=function(e){return function(t,n,i){e||(e=function(){return Reflect.getMetadata("design:type",t,n)}),Cu.Container.registerHandler({object:t,propertyName:n,index:i,value:function(i){var o;if((o="string"==typeof e||e instanceof bu.Token?e:e())===Object)throw new Gu.CannotInjectError(t,n);return i.get(o)}})}},Bu=Object.defineProperty({Inject:ku},"__esModule",{value:!0});var Hu=function(e){return function(t,n,i){e||(e=function(){return Reflect.getMetadata("design:type",t,n)}),Cu.Container.registerHandler({object:t,propertyName:n,index:i,value:function(i){var o;if((o="string"==typeof e||e instanceof bu.Token?e:e())===Object)throw new Gu.CannotInjectError(t,n);return i.getMany(o)}})}},$u=Object.defineProperty({InjectMany:Hu},"__esModule",{value:!0}),qu=x((function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(Uu),n(Bu),n($u);var i=Cu;t.Container=i.Container,t.ContainerInstance=Mu.ContainerInstance,t.Token=bu.Token,t.default=Cu.Container})),Yu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Qu=class extends mu{async insertValues(e){const t=fu.RecordUpdateStage,n=[t.applicationVersion._localId,t.entity._localId,t.repository._localId,t.actor._localId,t._actorRecordId,t.column._localId,t.updatedValue];return await this.db.insertValuesGenerateIds({INSERT_INTO:t,columns:n,VALUES:e},{generateOnSync:!0})}async updateEntityWhereIds(e,t,n,i,o){const r=this.airportDatabase.applications[e].currentVersion[0].applicationVersion.entities[n],a=this.airportDatabase.qApplications[e][r.name],s=[];for(const[e,t]of i){const n=[];for(const[e,i]of t)n.push(Nt(a.actor._localId.equals(e),a._actorRecordId.IN(Array.from(i))));s.push(Nt(a.repository._localId.equals(e),xt(...n)))}const c={};for(const e of o){const n=r.columns[e];let i=fu.RecordUpdateStage,o=Rt({FROM:[i],SELECT:i.updatedValue,WHERE:Nt(i.applicationVersion._localId.equals(t),i.entity._localId.equals(r.index),i.repository._localId.equals(a.repository._localId),i.actor._localId.equals(a.actor._localId),i._actorRecordId.equals(a._actorRecordId),i.column._localId.equals(n.index))});c[n.name]=o}await this.db.updateColumnsWhere({UPDATE:a,SET:c,WHERE:xt(...s)})}async delete(){return await this.db.deleteWhere({DELETE_FROM:fu.RecordUpdateStage})}};Yu([qu.Inject()],Qu.prototype,"airportDatabase",void 0),Qu=Yu([function(e){}],Qu);const Wu=P("layover"),zu=Wu.token({class:Qu,interface:"IRecordUpdateStageDao",token:"RECORD_UPDATE_STAGE_DAO"}),Ju=Wu.token({class:_u,interface:"ISynchronizationConflictDao",token:"SYNCHRONIZATION_CONFLICT_DAO"}),Ku=Wu.token({class:Tu,interface:"ISynchronizationConflictValuesDao",token:"SYNCHRONIZATION_CONFLICT_VALUES_DAO"});zu.setDependencies({airportDatabase:Qo});var Zu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Xu=class{async performStage1DataProcessing(e,t,n){await this.populateSystemWideOperationIds(e);const i=new Map;for(const[t,n]of e){const e={actorRecordIdsByLocalIds:new Map,firstChangeTime:(new Date).getTime()+1e10};i.set(t,e);for(const t of n){t.saveTimestamp<e.firstChangeTime&&(e.firstChangeTime=t.saveTimestamp);for(const n of t.operationHistory){const t=qe(e.actorRecordIdsByLocalIds,n.entity._localId);for(const e of n.recordHistory){Ye(t,e.actor._localId).add(e._actorRecordId);const n=new Map;e.newValueMap=n;for(const t of e.newValues)n.set(t.columnIndex,t)}}}}const o=new Map,r=this.getDeletedRecordIdsAndPopulateAllHistoryMap(o,e),a=await this.repositoryTransactionHistoryDao.findAllLocalChangesForRecordIds(i),s=this.getDeletedRecordIdsAndPopulateAllHistoryMap(o,a,!0),c=new Set;for(const[e,n]of a)for(const e of n)for(const n of e.operationHistory){const e=n.actor._localId;void 0===t.get(e)&&c.add(e)}if(c.size){const e=await this.actorDao.findWithDetailsAndGlobalIdsByIds(Array.from(c));for(const n of e)t.set(n._localId,n)}for(const[e,n]of o)this.repositoryTransactionHistoryDuo.sortRepoTransHistories(n,t);const l=new Map,p=new Map,d=new Map,u=new Map;for(const[e,t]of o)for(const n of t)for(const t of n.operationHistory)switch(t.changeType){case Ee.INSERT_VALUES:this.processCreation(e,t,n.isLocal,l,p,d,r,s,u);break;case Ee.UPDATE_ROWS:this.processUpdate(e,t,n.isLocal,l,p,r,s,u);break;case Ee.DELETE_ROWS:this.processDeletion(e,t,l,p,d,s)}return{recordCreations:l,recordDeletions:d,recordUpdates:p,syncConflictMapByRepoId:u}}async populateSystemWideOperationIds(e){let t=0;for(const[n,i]of e)for(const e of i)t+=e.operationHistory.length;const n=await Xn(t,this.airportDatabase,this.sequenceGenerator);let i=0;for(const[t,o]of e)for(const e of o)for(const t of e.operationHistory)t.systemWideOperationId=n[i],i++}ensureRecordHistoryLocalId(e,t,n=e._actorRecordId){qe(t,e.actor._localId).set(n,e._localId)}getDeletedRecordIdsAndPopulateAllHistoryMap(e,t,n=!1){const i=new Map;for(const[o,r]of t){this.mergeArraysInMap(e,o,r);for(const e of r){e.isLocal=n;for(const t of e.operationHistory)switch(t.changeType){case Ee.DELETE_ROWS:for(const e of t.recordHistory)this.ensureRecordHistoryLocalId(e,this.syncInUtils.ensureRecordMapForRepoInTable(o,t,i))}}}return i}mergeArraysInMap(e,t,n){let i=e.get(t);i=i?i.concat(n):n,e.set(t,i)}processCreation(e,t,n,i,o,r,a,s,c){const l=this.getRecordsForRepoInTable(e,t,o),p=this.getRecordsForRepoInTable(e,t,r),d=this.getRecordsForRepoInTable(e,t,a),u=this.getRecordsForRepoInTable(e,t,s),f=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,i);for(const i of t.recordHistory){if(this.getRecord(i,f))throw new Error(`A record is being created more than once.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);if(n)throw new Error(`Remotely mutated record is being created locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if changes are never sent to originating TMs.\n\t\t\t\t\t`);if(this.hasRecordId(i,p))throw new Error(`\n\t\t\t\tRemotely created record is being deleted remotely before it's been created.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if all server clocks are synced.\n\t\t\t\t\t`);if(this.getRecordHistoryLocalId(i,u))throw new Error(`Remotely created record is being deleted locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);const o=this.getRecordHistoryLocalId(i,d);if(o){this.addSyncConflict(ru.REMOTE_CREATE_REMOTELY_DELETED,e,i,{_localId:o},c);continue}const r=this.ensureColumnValueMap(i,f);if(this.getRecord(i,l))throw new Error(`Remotely created record is being updated BEFORE it is created.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if all server clocks are synced.\n\t\t\t\t\t`);for(const e of i.newValues)r.set(e.columnIndex,e.newValue)}}processUpdate(e,t,n,i,o,r,a,s){const c=this.getRecordsForRepoInTable(e,t,i),l=this.getRecordsForRepoInTable(e,t,r),p=this.getRecordsForRepoInTable(e,t,a),d=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,o);for(const i of t.recordHistory){const o=this.getRecordHistoryLocalId(i,p);if(o){n||this.addSyncConflict(ru.REMOTE_UPDATE_LOCALLY_DELETED,e,i,{_localId:o},s);continue}const r=this.getRecordHistoryLocalId(i,l);if(r){n&&this.addSyncConflict(ru.LOCAL_UPDATE_REMOTELY_DELETED,e,i,{_localId:r},s);continue}let a=this.getRecord(i,c);if(a){if(n)throw new Error(`Remotely created records are being updated locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);for(const e of i.newValues)a.set(e.columnIndex,e.newValue);continue}let u,f=this.ensureRecord(i,d);for(const t of i.newValues)if(n){const n=t.columnIndex,i=f.get(n);i&&(u||(u=this.addSyncConflict(ru.REMOTE_UPDATE_LOCALLY_UPDATED,e,{_localId:i.recordHistoryLocalId},{_localId:r},s),u.values=[]),u.values.push({columnIndex:n,synchronizationConflict:u}),f.delete(t.columnIndex))}else f.set(t.columnIndex,{newValue:t.newValue,recordHistoryLocalId:i._localId})}}processDeletion(e,t,n,i,o,r){const a=this.getRecordsForRepoInTable(e,t,n),s=this.getRecordsForRepoInTable(e,t,i),c=this.getRecordsForRepoInTable(e,t,r),l=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,o);for(const e of t.recordHistory){let t=this.getRecordsForActor(e,a);if(t&&t.get(e._actorRecordId)){t.delete(e._actorRecordId);continue}let n=this.getRecordsForActor(e,s);n&&n.get(e._actorRecordId)&&n.delete(e._actorRecordId),this.getRecordHistoryLocalId(e,c)||Ye(l,e.actor._localId).add(e._actorRecordId)}}getRecordsForRepoInTable(e,t,n){const i=n.get(t.entity.applicationVersion._localId);let o,r;return i&&(o=i.get(t.entity._localId)),o&&(r=o.get(e)),r}getRecord(e,t){let n=this.getRecordsForActor(e,t);return n?n.get(e._actorRecordId):null}hasRecordId(e,t){let n=this.getRecordsForActor(e,t);return!!n&&n.has(e._actorRecordId)}getRecordHistoryLocalId(e,t){let n=this.getRecordsForActor(e,t);return n?n.get(e._actorRecordId):null}getRecordsForActor(e,t){let n;return t&&(n=t.get(e.actor._localId)),n}getRecordInfo(e,t,n){return`\n\t\tApplication Version ID: ${t.entity.applicationVersion._localId}\n\t\tEntity ID:         ${t.entity._localId}\n\t\tRepository ID:     ${e}\n\t\tActor ID:          ${n.actor._localId}\n\t\tActor Record ID:   ${n._actorRecordId}\n\t\t`}addSyncConflict(e,t,n,i,o){const r=this.createSynchronizationConflict(e,t,n,i);return He(o,t).push(r),r}createSynchronizationConflict(e,t,n,i){return{_localId:null,overwrittenRecordHistory:n,overwritingRecordHistory:i,repository:{_localId:t},type:e}}ensureColumnValueMap(e,t){return qe(qe(t,e.actor._localId),e._actorRecordId)}ensureRecord(e,t){return qe(qe(t,e.actor._localId),e._actorRecordId)}};Zu([function(e,t){}],Xu.prototype,"actorDao",void 0),Zu([function(e,t){}],Xu.prototype,"airportDatabase",void 0),Zu([function(e,t){}],Xu.prototype,"repositoryTransactionHistoryDao",void 0),Zu([function(e,t){}],Xu.prototype,"repositoryTransactionHistoryDuo",void 0),Zu([function(e,t){}],Xu.prototype,"sequenceGenerator",void 0),Zu([function(e,t){}],Xu.prototype,"syncInUtils",void 0),Xu=Zu([function(e){}],Xu);var ef=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let tf=class{async applyChangesToDb(e,t){const n={};await this.performCreates(e.recordCreations,t,n),await this.performUpdates(e.recordUpdates,t,n),await this.performDeletes(e.recordDeletions,t,n)}async performCreates(e,t,n){for(const[i,o]of e)for(const[e,r]of o){const o=t.get(i).index,a=this.airportDatabase.applications[o].currentVersion[0].applicationVersion.entities[e],s=this.airportDatabase.qApplications[o][a.name],c=[s.repository._localId,s.actor._localId,s._actorRecordId],l=this.getNonIdColumnsInIndexOrder(a);let p=!0,d=0;const u=[];for(const[e,t]of r)for(const[n,i]of t)for(const[t,o]of i){const i=[e,n,t],r=[];for(const[e,t]of o)r.push([e,t]);r.length&&d++,r.sort(((e,t)=>this.utils.compareNumbers(e[0],t[0])));let a=0;for(const[e,t]of r){let n=l[a];for(;n.index<e;)p&&c.push(s.__driver__.allColumns[n.index]),i.push(null),a++,n=l[a];p&&c.push(s.__driver__.allColumns[e]),i.push(t),a++}r.length&&u.push(i),p=!1}if(d){const e=n.dbEntity;n.dbEntity=s.__driver__.dbEntity;try{await this.databaseFacade.insertValues({INSERT_INTO:s,columns:c,VALUES:u},n)}finally{n.dbEntity=e}}}}getNonIdColumnsInIndexOrder(e){const t=[];for(const n of e.columns){switch(n.name){case ae.ACTOR_LID:case ae.ACTOR_RECORD_ID:case ae.REPOSITORY_LID:continue}t.push(n)}return t.sort(((e,t)=>this.utils.compareNumbers(e.index,t.index))),t}async performUpdates(e,t,n){const i=new Map,o=[];for(const[t,n]of e){const e=qe(i,t);for(const[i,r]of n){const n=qe(e,i);for(const[e,a]of r)for(const[r,s]of a)for(const[a,c]of s){Ye(qe(this.getRecordKeyMap(c,n),e),r).add(a);for(const[n,s]of c)o.push([t,i,e,r,a,n,s.newValue])}}}if(o.length){await this.recordUpdateStageDao.insertValues(o);for(const[e,n]of i){const i=t.get(e);for(const[t,o]of n)await this.runUpdatesForTable(i.index,e,t,o)}await this.recordUpdateStageDao.delete()}}async performDeletes(e,t,n){for(const[i,o]of e){const e=t.get(i);for(const[t,i]of o){const o=this.airportDatabase.applications[e.index].currentVersion[0].applicationVersion.entities[t],r=this.airportDatabase.qApplications[e.index][o.name];let a=0,s=[];for(const[e,t]of i){let n=[];for(const[e,i]of t)a++,n.push(Nt(r._actorRecordId.IN(Array.from(i)),r.actor._localId.equals(e)));s.push(Nt(r.repository._localId.equals(e),xt(...n)))}if(a){const e=n.dbEntity;n.dbEntity=r.__driver__.dbEntity;try{await this.databaseFacade.deleteWhere({DELETE_FROM:r,WHERE:xt(...s)},n)}finally{n.dbEntity=e}}}}}getRecordKeyMap(e,t){const n=[];for(const t of e.keys())n.push(t);let i;n.sort(this.utils.compareNumbers);let o=t;for(const e of n)i=o.get(e),i||(i={childColumnUpdateKeyMap:new Map,recordKeyMap:new Map,updatedColumns:null},o.set(e,i)),o=i.childColumnUpdateKeyMap;return i.updatedColumns=n,i.recordKeyMap}async runUpdatesForTable(e,t,n,i){for(const o of i.values()){const i=o.updatedColumns;i&&await this.recordUpdateStageDao.updateEntityWhereIds(e,t,n,o.recordKeyMap,i),await this.runUpdatesForTable(e,t,n,o.childColumnUpdateKeyMap)}}};ef([function(e,t){}],tf.prototype,"airportDatabase",void 0),ef([function(e,t){}],tf.prototype,"databaseFacade",void 0),ef([function(e,t){}],tf.prototype,"recordUpdateStageDao",void 0),ef([function(e,t){}],tf.prototype,"utils",void 0),tf=ef([function(e){}],tf);var nf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let of=class{async receiveMessages(e,t){const n=(new Date).getTime(),i=await this.repositoryTransactionHistoryDao.findWhereGUIDsIn([...e.keys()]);for(const t of i)e.delete(t.GUID);if(!e.size)return;let o=[];const r=this.timeOrderMessages(e);for(const e of r){if(!this.isValidLastChangeTime(n,e.syncTimestamp,"Sync Timestamp"))continue;if(!this.isValidLastChangeTime(e.syncTimestamp,e.history.saveTimestamp,"Sync Timestamp","Save Timestamp"))continue;let i=!0;await this.transactionManager.transactInternal((async n=>{if(!await this.syncInChecker.checkMessage(e,t))return n.rollback(null,t),void(i=!1)}),t),i&&o.push(e)}await this.transactionManager.transactInternal((async(e,t)=>{e.isSync=!0,await this.twoStageSyncedInDataProcessor.syncMessages(o,e,t)}),t)}timeOrderMessages(e){const t=[...e.values()];return t.sort(((e,t)=>{if(e.syncTimestamp<t.syncTimestamp)return-1;if(e.syncTimestamp>t.syncTimestamp)return 1;let n=e.history,i=t.history;return n.saveTimestamp<i.saveTimestamp?-1:n.saveTimestamp>i.saveTimestamp?1:0})),t}isValidLastChangeTime(e,t,n,i="Reception Time:"){return!(e<t)||(console.error(`Message ${i} is less than\n\t\t\tthe ${n} in received message:\n\t\t\t\t${i}:               ${e}\n\t\t\t\t${n}:           ${t}\n\t\t\t`),!1)}};nf([function(e,t){}],of.prototype,"repositoryTransactionHistoryDao",void 0),nf([function(e,t){}],of.prototype,"syncInChecker",void 0),nf([function(e,t){}],of.prototype,"transactionManager",void 0),nf([function(e,t){}],of.prototype,"twoStageSyncedInDataProcessor",void 0),of=nf([function(e){}],of);var rf,af=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e[e.MESSAGE_APPLICATION_VERSION_IS_LOWER=-1]="MESSAGE_APPLICATION_VERSION_IS_LOWER",e[e.MESSAGE_APPLICATION_VERSION_IS_EQUAL=0]="MESSAGE_APPLICATION_VERSION_IS_EQUAL",e[e.MESSAGE_APPLICATION_VERSION_IS_HIGHER=1]="MESSAGE_APPLICATION_VERSION_IS_HIGHER"}(rf||(rf={}));let sf=class{ensureRecordMapForRepoInTable(e,t,n){return qe(qe(qe(n,t.entity.applicationVersion._localId),t.entity.index),e)}};sf=af([function(e){}],sf);var cf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let lf=class{async syncMessages(e,t,n){this.aggregateHistoryRecords(e,t);const{actorMapById:i,repositoryTransactionHistoryMapByRepositoryId:o,applicationsByApplicationVersion_LocalIdMap:r}=await this.getDataStructures(e);await this.updateLocalData(o,i,r,n)}aggregateHistoryRecords(e,t){const n=t.transactionHistory;n.transactionType=Re.REMOTE_SYNC;for(const t of e){const e=t.history;n.repositoryTransactionHistories.push(e),e.repositoryTransactionType=Er.REMOTE,n.allOperationHistory=n.allOperationHistory.concat(e.operationHistory),e.operationHistory.forEach((e=>{n.allRecordHistory=n.allRecordHistory.concat(e.recordHistory),e.recordHistory.forEach((e=>{e.newValues&&e.newValues.length&&(n.allRecordHistoryNewValues=n.allRecordHistoryNewValues.concat(e.newValues)),e.oldValues&&e.oldValues.length&&(n.allRecordHistoryOldValues=n.allRecordHistoryOldValues.concat(e.oldValues))}))}))}}async getDataStructures(e){const t=new Map,n=new Map,i=new Map,o=[];for(const r of e){o.push(r.history),t.set(r.history.repository._localId,o);for(const e of r.actors)i.set(e._localId,e);for(const e of r.applicationVersions)n.set(e._localId,e.application)}for(const[e,n]of t)this.repositoryTransactionHistoryDuo.sortRepoTransHistories(n,i);return{actorMapById:i,repositoryTransactionHistoryMapByRepositoryId:t,applicationsByApplicationVersion_LocalIdMap:n}}async updateLocalData(e,t,n,i){const o=await this.stage1SyncedInDataProcessor.performStage1DataProcessing(e,t,i);let r=[],a=[];for(const[e,t]of o.syncConflictMapByRepoId){r=r.concat(t);for(const e of t)e.values.length&&(a=a.concat(e.values))}await this.stage2SyncedInDataProcessor.applyChangesToDb(o,n),r.length&&await this.synchronizationConflictDao.insert(r,i),a.length&&await this.synchronizationConflictValuesDao.insert(a,i)}};cf([function(e,t){}],lf.prototype,"repositoryTransactionHistoryDuo",void 0),cf([function(e,t){}],lf.prototype,"stage1SyncedInDataProcessor",void 0),cf([function(e,t){}],lf.prototype,"stage2SyncedInDataProcessor",void 0),cf([function(e,t){}],lf.prototype,"synchronizationConflictDao",void 0),cf([function(e,t){}],lf.prototype,"synchronizationConflictValuesDao",void 0),lf=cf([function(e){}],lf);var pf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};const df={},uf={},ff={};let yf=class{async serialize(e){let t=[];const n=[];for(const i of e){if(i.repositoryTransactionType!==Er.LOCAL)continue;const e=await this.serializeMessage(i);t.push(i),n.push(e)}return{historiesToSend:t,messages:n}}async serializeMessage(e){const t={actorInMessageIndexesById:new Map,applicationVersionInMessageIndexesById:new Map,applicationVersions:[],lastInMessageActorIndex:-1,lastInMessageApplicationVersionIndex:-1,lastInMessageRepositoryIndex:-1,messageRepository:e.repository,repositoryInMessageIndexesById:new Map},n={inMessageIndexesById:new Map,lastInMessageIndex:-1},i={actors:[],applicationVersions:[],applications:[],history:null,referencedRepositories:[],userAccounts:[],terminals:[]};i.history=this.serializeRepositoryTransactionHistory(e,i,t,n),await this.serializeRepositories(e,i,t,n);const o=await this.serializeActorsUserAccountsAndTerminals(i,t,n);return await this.serializeApplicationsAndVersions(i,o,t),i}async serializeActorsUserAccountsAndTerminals(e,t,n){let i=[];for(let e of t.actorInMessageIndexesById.keys())i.push(e);const o=await this.actorDao.findWithDetailsAndGlobalIdsByIds(i);this.serializeUserAccounts(o,e,n);const r=this.serializeTerminals(o,e,n),a={lastInMessageIndex:-1,inMessageIndexesById:new Map};for(const i of o){const o=this.serializeApplication(i.application,a,e),s=t.actorInMessageIndexesById.get(i._localId);e.actors[s]={...df,application:o,terminal:r.get(i.terminal._localId),userAccount:n.inMessageIndexesById.get(i.userAccount._localId),GUID:i.GUID}}return a}serializeTerminals(e,t,n){let i=-1;const o=new Map;for(const r of e){let e=r.terminal;if(o.has(e._localId))continue;const a=++i;o.set(e._localId,a),t.terminals[a]={...df,GUID:e.GUID,owner:n.inMessageIndexesById.get(e.owner._localId)}}return o}serializeUserAccounts(e,t,n){for(const i of e)this.addUserAccountToMessage(i.userAccount,t,n),this.addUserAccountToMessage(i.terminal.owner,t,n)}addUserAccountToMessage(e,t,n){let i=this.getUserAccountInMessageIndex(e,n);return t.userAccounts[i]={...df,username:e.username,GUID:e.GUID},i}getUserAccountInMessageIndex(e,t){if(t.inMessageIndexesById.has(e._localId))return t.inMessageIndexesById.get(e._localId);let n=++t.lastInMessageIndex;return t.inMessageIndexesById.set(e._localId,n),n}async serializeRepositories(e,t,n,i){let o=[];for(let e of n.repositoryInMessageIndexesById.keys())o.push(e);o.push(e._localId);const r=await this.repositoryDao.findWithOwnerBy_LocalIds(o);for(const e of r){let o=this.getUserAccountInMessageIndex(e.owner,i);if(n.repositoryInMessageIndexesById.has(e._localId)){const i=n.repositoryInMessageIndexesById.get(e._localId);t.referencedRepositories[i]=this.serializeRepository(e,o)}else"string"!=typeof t.history.repository&&(t.history.repository.owner=o,t.history.repository._localId=e._localId)}}serializeApplicationsAndVersions(e,t,n){for(let i=0;i<n.applicationVersions.length;i++){const o=n.applicationVersions[i],r=this.serializeApplication(o.application,t,e);e.applicationVersions[i]={...df,application:r,integerVersion:o.integerVersion}}}serializeApplication(e,t,n){let i;return t.inMessageIndexesById.has(e.index)?i=t.inMessageIndexesById.get(e.index):(i=++t.lastInMessageIndex,t.inMessageIndexesById.set(e.index,i),n.applications[i]={...ff,domain:{...df,name:e.domain.name},name:e.name}),i}serializeRepositoryTransactionHistory(e,t,n,i){e.operationHistory.sort(((e,t)=>e.orderNumber<t.orderNumber?-1:e.orderNumber>t.orderNumber?1:0));const o=[];for(const t of e.operationHistory)o.push(this.serializeOperationHistory(t,n));return{...df,isRepositoryCreation:e.isRepositoryCreation,repository:this.serializeHistoryRepository(e,t,i),operationHistory:o,saveTimestamp:e.saveTimestamp,GUID:e.GUID}}serializeHistoryRepository(e,t,n){if(e.isRepositoryCreation){const i=e.repository;let o=this.addUserAccountToMessage(i.owner,t,n);return this.serializeRepository(i,o)}return e.repository.GUID}serializeOperationHistory(e,t){const n=e.entity,i=[];for(const o of e.recordHistory)i.push(this.serializeRecordHistory(e,o,n,t));const o=e.entity.applicationVersion;let r;return t.applicationVersionInMessageIndexesById.has(o._localId)?r=t.applicationVersionInMessageIndexesById.get(o._localId):(r=++t.lastInMessageApplicationVersionIndex,t.applicationVersionInMessageIndexesById.set(o._localId,r)),t.applicationVersions[r]=o,{...df,actor:this.getActorInMessageIndex(e.actor,t),changeType:e.changeType,entity:{...df,applicationVersion:r,index:e.entity.index},recordHistory:i}}serializeRecordHistory(e,t,n,i){const o=new Map;for(const e of n.columns)o.set(e.index,e);const r=[];for(const e of t.newValues){const t=o.get(e.columnIndex);r.push(this.serializeNewValue(e,t,i))}const a=[];for(const e of t.oldValues){const t=o.get(e.columnIndex);a.push(this.serializeOldValue(e,t,i))}const s=t.actor,c={...df};return s._localId!==e.actor._localId&&(c.actor=this.getActorInMessageIndex(s,i)),r.length&&(c.newValues=r),a.length&&(c.oldValues=a),{...c,_actorRecordId:t._actorRecordId}}getActorInMessageIndex(e,t){return e?this.getActorInMessageIndexById(e._localId,t):null}getActorInMessageIndexById(e,t){let n;return t.actorInMessageIndexesById.has(e)?n=t.actorInMessageIndexesById.get(e):(n=++t.lastInMessageActorIndex,t.actorInMessageIndexesById.set(e,n)),n}serializeNewValue(e,t,n){return this.serializeValue(e,t,n,"newValue")}serializeOldValue(e,t,n){return this.serializeValue(e,t,n,"oldValue")}serializeValue(e,t,n,i){let o=e[i],r=o;switch(t.name){case ae.ORIGINAL_ACTOR_ID:r=this.getActorInMessageIndexById(o,n);break;case ae.ORIGINAL_REPOSITORY_ID:r=this.getSerializedRepositoryId(o,n)}return/.*_AID_[\d]+$/.test(t.name)&&t.manyRelationColumns.length&&(r=this.getActorInMessageIndexById(o,n)),/.*_RID_[\d]+$/.test(t.name)&&t.manyRelationColumns.length&&(r=this.getSerializedRepositoryId(o,n)),{...uf,columnIndex:e.columnIndex,[i]:r}}getSerializedRepositoryId(e,t){if(e===t.messageRepository._localId)return-1;let n=t.repositoryInMessageIndexesById.get(e);return void 0===n&&(t.lastInMessageRepositoryIndex++,n=t.lastInMessageRepositoryIndex,t.repositoryInMessageIndexesById.set(e,n)),n}serializeRepository(e,t){return{...df,ageSuitability:e.ageSuitability,createdAt:e.createdAt,immutable:e.immutable,owner:t,source:e.source,GUID:e.GUID}}};pf([function(e,t){}],yf.prototype,"actorDao",void 0),pf([function(e,t){}],yf.prototype,"repositoryDao",void 0),yf=pf([function(e){}],yf);var hf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mf=class{async synchronizeOut(e){await this.loadHistoryRepositories(e);const{historiesToSend:t,messages:n}=await this.syncOutDataSerializer.serialize(e),i=this.groupMessagesBySourceAndRepository(n,t);for(const[e,t]of i){const n=await this.synchronizationAdapterLoader.load(e);await n.sendTransactions(e,t)}await this.updateRepositoryTransactionHistories(n,t)}async loadHistoryRepositories(e){const t=new Set,n=new Map;for(const n of e)t.add(n.repository._localId);if(!t.size)return;const i=await this.repositoryDao.findWithOwnerBy_LocalIds([...t.values()]);for(const e of i)n.set(e._localId,e);for(const t of e)t.repository=n.get(t.repository._localId)}async ensureGlobalRepositoryIdentifiers(e,t){const n=new Set,i=new Map;for(const t of e){const e=t.repository;e.source&&e.GUID?i.set(e._localId,e):n.add(e._localId)}if(!n.size)return;const o=await this.repositoryDao.findWithOwnerBy_LocalIds([...n.values()]);for(const e of o)i.set(e._localId,e);for(const e of t){const t=e.history.repository;if(!t.source||!t.GUID){const e=i.get(t._localId);t.source=e.source,t.GUID=e.GUID,delete t._localId}}}groupMessagesBySourceAndRepository(e,t){const n=new Map;for(let i=0;i<e.length;i++){const o=t[i].repository;He(qe(n,o.source),o.GUID).push(e[i])}return n}async updateRepositoryTransactionHistories(e,t){for(let n=0;n<e.length;n++){const i=e[n],o=t[n];i.syncTimestamp&&(o.syncTimestamp=i.syncTimestamp,await this.repositoryTransactionHistoryDao.updateSyncTimestamp(o))}}};hf([function(e,t){}],mf.prototype,"repositoryDao",void 0),hf([function(e,t){}],mf.prototype,"repositoryTransactionHistoryDao",void 0),hf([function(e,t){}],mf.prototype,"synchronizationAdapterLoader",void 0),hf([function(e,t){}],mf.prototype,"syncOutDataSerializer",void 0),mf=hf([function(e){}],mf);class If extends Vo{constructor(e){super(e,Ys)}}class Rf extends If{constructor(){super(6)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(6)}}Rf.Find=new Po,Rf.FindOne=new Po,Rf.Search=new Po,Rf.SearchOne=new Po;class Ef extends If{constructor(){super(10)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(10)}}Ef.Find=new Po,Ef.FindOne=new Po,Ef.Search=new Po,Ef.SearchOne=new Po;class _f extends If{constructor(){super(9)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(9)}}_f.Find=new Po,_f.FindOne=new Po,_f.Search=new Po,_f.SearchOne=new Po;class gf extends If{constructor(){super(5)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(5)}}gf.Find=new Po,gf.FindOne=new Po,gf.Search=new Po,gf.SearchOne=new Po;class Tf extends If{constructor(){super(0)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(0)}}Tf.Find=new Po,Tf.FindOne=new Po,Tf.Search=new Po,Tf.SearchOne=new Po;class Of extends If{constructor(){super(12)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(12)}}Of.Find=new Po,Of.FindOne=new Po,Of.Search=new Po,Of.SearchOne=new Po;class Af extends If{constructor(){super(11)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(11)}}Af.Find=new Po,Af.FindOne=new Po,Af.Search=new Po,Af.SearchOne=new Po;class Nf extends If{constructor(){super(3)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(3)}}Nf.Find=new Po,Nf.FindOne=new Po,Nf.Search=new Po,Nf.SearchOne=new Po;class xf extends If{constructor(){super(2)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(2)}}xf.Find=new Po,xf.FindOne=new Po,xf.Search=new Po,xf.SearchOne=new Po;class bf extends If{constructor(){super(1)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(1)}}bf.Find=new Po,bf.FindOne=new Po,bf.Search=new Po,bf.SearchOne=new Po;class wf extends If{constructor(){super(14)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(14)}}wf.Find=new Po,wf.FindOne=new Po,wf.Search=new Po,wf.SearchOne=new Po;class Sf extends If{constructor(){super(13)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(13)}}Sf.Find=new Po,Sf.FindOne=new Po,Sf.Search=new Po,Sf.SearchOne=new Po;class vf extends If{constructor(){super(8)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(8)}}vf.Find=new Po,vf.FindOne=new Po,vf.Search=new Po,vf.SearchOne=new Po;class Cf extends If{constructor(){super(7)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(7)}}Cf.Find=new Po,Cf.FindOne=new Po,Cf.Search=new Po,Cf.SearchOne=new Po;class Df extends If{constructor(){super(4)}static Save(e){return Vo.BaseSave(e)}static diSet(){return Qs(4)}}Df.Find=new Po,Df.FindOne=new Po,Df.Search=new Po,Df.SearchOne=new Po;var Mf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vf=class extends wf{async findByOwnerIdsAndGUIDs(e,t){let n;return await this.db.find.tree({SELECT:{},FROM:[n=Ys.Terminal],WHERE:Nt(n.owner._localId.IN(e),n.GUID.IN(t))})}async findByGUIDs(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Ys.Terminal],WHERE:t.GUID.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.GUID,t.owner._localId,!1]);const o=await this.db.insertValuesGenerateIds({INSERT_INTO:n=Ys.Terminal,columns:[n.GUID,n.owner._localId,n.isLocal],VALUES:i},t);for(let t=0;t<e.length;t++){e[t]._localId=o[t][0]}}};Vf=Mf([function(e){}],Vf);var Pf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Lf=class extends Df{async findByUserAccountNames(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Ys.UserAccount],WHERE:t.username.IN(e)})}async findByGUIDs(e){let t;return await this.db.find.tree({SELECT:{},FROM:[t=Ys.UserAccount],WHERE:t.GUID.IN(e)})}async insert(e,t){let n;const i=[];for(const t of e)i.push([t.GUID,t.username]);const o=await this.db.insertValuesGenerateIds({INSERT_INTO:n=Ys.UserAccount,columns:[n.GUID,n.username],VALUES:i},t);for(let t=0;t<e.length;t++){e[t]._localId=o[t][0]}}};Lf=Pf([function(e){}],Lf);var Uf,jf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.EMAIL_TAKEN="EMAIL_TAKEN",e.INVALID_BIRTH_MONTH="INVALID_BIRTH_MONTH",e.INVALID_COUNTRY="INVALID_COUNTRY",e.INVALID_EMAIL="INVALID_EMAIL",e.INVALID_USERNAME="INVALID_USERNAME",e.USER_ACCOUNTNAME_TAKEN="USER_ACCOUNTNAME_TAKEN"}(Uf||(Uf={}));let Ff=class{async addUserAccount(e,t){const n=await this.userAccountDao.findByUserAccountNames([e]);for(const t of n)if(t.username===e)return{errorCode:Uf.USER_ACCOUNTNAME_TAKEN};const i={_localId:null,GUID:sr(),username:e};return await this.userAccountDao.save(i),{userAccount:i}}async findUserAccount(e){const t=await this.userAccountDao.findByGUIDs([e]);return t.length?t[0]:null}};jf([function(e,t,n){return null}],Ff.prototype,"addUserAccount",null),jf([function(e,t,n){return null}],Ff.prototype,"findUserAccount",null),Ff=jf([function(e){}],Ff);const Gf=Ba.token({class:Vf,interface:"ITerminalDao",token:"TERMINAL_DAO"}),kf=Ba.token({class:Lf,interface:"IUserAccountDao",token:"USER_ACCOUNT_DAO"});Ha.setClass(Ff),Ha.setDependencies({userAccountDao:kf});var Bf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hf=class{constructor(){this.serverLocationProtocol="http://"}async getRepositoryTransactions(e,t,n=null){try{const i=await this.sendMessage(e+"/read",{repositoryGUID:t,syncTimestamp:n});return i.error?(console.error(i.error),[]):i.fragments}catch(e){return console.error(e),[]}}async sendRepositoryTransactions(e,t,n){try{const i=await this.sendMessage(e+"/write",{messages:n,repositoryGUID:t});return i.error?(console.error(i.error),0):i.syncTimestamp}catch(e){return console.error(e),0}}async sendMessage(e,t){let n=JSON.stringify(t);return(await fetch(this.serverLocationProtocol+e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:n})).json()}};Hf=Bf([function(e){}],Hf);const $f=P("nonhub-client").token({class:Hf,interface:"INonhubClient",token:"INonhubClient"}),qf=P("ground-transport"),Yf=qf.token({class:Xu,interface:"IStage1SyncedInDataProcessor",token:"STAGE1_SYNCED_IN_DATA_PROCESSOR"}),Qf=qf.token({class:tf,interface:"IStage2SyncedInDataProcessor",token:"STAGE2_SYNCED_IN_DATA_PROCESSOR"}),Wf=qf.token({class:Bd,interface:"ISyncInActorChecker",token:"SYNC_IN_ACTOR_CHECKER"}),zf=qf.token({class:Wd,interface:"ISyncInChecker",token:"SYNC_IN_CHECKER"}),Jf=qf.token({class:Jd,interface:"ISyncInDataChecker",token:"SYNC_IN_DATA_CHECKER"}),Kf=qf.token({class:eu,interface:"ISyncInTerminalChecker",token:"SYNC_IN_TERMINAL_CHECKER"}),Zf=qf.token({class:Zd,interface:"ISyncInRepositoryChecker",token:"SYNC_IN_REPOSITORY_CHECKER"}),Xf=qf.token({class:$d,interface:"ISyncInApplicationChecker",token:"SYNC_IN_APPLICATION_CHECKER"}),ey=qf.token({class:Yd,interface:"ISyncInApplicationVersionChecker",token:"SYNC_IN_APPLICATION_VERSION_CHECKER"}),ty=qf.token({class:nu,interface:"ISyncInUserAccountChecker",token:"SYNC_IN_USER_ACCOUNT_CHECKER"}),ny=qf.token({class:sf,interface:"ISyncInUtils",token:"SYNC_IN_UTILS"}),iy=qf.token({class:of,interface:"ISynchronizationInManager",token:"SYNCHRONIZATION_IN_MANAGER"}),oy=qf.token({class:mf,interface:"ISynchronizationOutManager",token:"SYNCHRONIZATION_OUT_MANAGER"}),ry=qf.token({class:yf,interface:"ISyncOutDataSerializer",token:"SYNC_OUT_DATA_SERIALIZER"}),ay=qf.token({class:lf,interface:"ITwoStageSyncedInDataProcessor",token:"TWO_STAGE_SYNCED_IN_DATA_PROCESSOR"}),sy=qf.token({class:jd,interface:"ISynchronizationAdapter",token:"DEBUG_SYNCHRONIZATION_ADAPTER"}),cy=qf.token({class:Gd,interface:"ISynchronizationAdapterLoader",token:"SYNCHRONIZATION_ADAPTER_LOADER"});sy.setDependencies({nonhubClient:$f}),Yf.setDependencies({actorDao:Ma,airportDatabase:Qo,repositoryTransactionHistoryDao:Fa,repositoryTransactionHistoryDuo:Ga,sequenceGenerator:Ze,syncInUtils:ny}),Qf.setDependencies({airportDatabase:Qo,databaseFacade:Go,recordUpdateStageDao:zu,utils:ii}),Wf.setDependencies({actorDao:Ma}),Xf.setDependencies({applicationDao:wp,domainDao:xp}),ey.setDependencies({applicationVersionDao:Pp}),zf.setDependencies({syncInActorChecker:Wf,syncInApplicationChecker:Xf,syncInApplicationVersionChecker:ey,syncInDataChecker:Jf,syncInRepositoryChecker:Zf,syncInTerminalChecker:Kf,syncInUserAccountChecker:ty}),Jf.setDependencies({airportDatabase:Qo,sequenceGenerator:Ze,terminalStore:Nc}),Zf.setDependencies({repositoryDao:ja}),Kf.setDependencies({terminalDao:Gf}),ty.setDependencies({userAccountDao:kf}),ry.setDependencies({actorDao:Ma,repositoryDao:ja}),cy.setDependencies({debugSynchronizationAdapter:sy}),iy.setDependencies({repositoryTransactionHistoryDao:Fa,syncInChecker:zf,transactionManager:xc,twoStageSyncedInDataProcessor:ay}),oy.setDependencies({repositoryDao:ja,repositoryTransactionHistoryDao:Fa,synchronizationAdapterLoader:cy,syncOutDataSerializer:ry}),ay.setDependencies({repositoryTransactionHistoryDuo:Ga,stage1SyncedInDataProcessor:Yf,stage2SyncedInDataProcessor:Qf,synchronizationConflictDao:Ju,synchronizationConflictValuesDao:Ku});const ly=P("terminal");Xo.setClass(J),Xe.setClass(Ks),Xe.setDependencies({terminalStore:Nc,transactionalServer:wc}),wc.setClass(Vc),xc.setClass(Jc),jp.setClass(pl),Fp.setClass(ul);const py=ly.token({class:Lc,interface:"class AbstractMutationManager",token:"ABSTRACT_MUTATION_MANAGER"}),dy=ly.token({class:Dc,interface:"class TransactionalReceiver",token:"ABSTRACT_TRANSACTIONAL_RECIEVER"}),uy=ly.token({class:el,interface:"ICascadeGraphVerifier",token:"CASCADE_GRAPH_VERIFIER"}),fy=ly.token({class:Gc,interface:"IDatabaseManager",token:"DATABASE_MANAGER"}),yy=ly.token({class:Bc,interface:"IDeleteManager",token:"DELETE_MANAGER"}),hy=ly.token({class:nl,interface:"IDependencyGraphResolver",token:"DEPENDENCY_GRAPH_RESOLVER"}),my=ly.token({class:ol,interface:"IEntityGraphReconstructor",token:"ENTITY_GRAPH_RECONSTRUCTOR"}),Iy=ly.token({class:$c,interface:"IHistoryManager",token:"HISTORY_MANAGER"}),Ry=ly.token({class:Yc,interface:"IInsertManager",token:"INSERT_MANAGER"}),Ey=ly.token({class:zs,interface:"IInternalRecordManager",token:"INTERNAL_RECORD_MANAGER"}),_y=ly.token({class:vc,interface:"IOnlineManager",token:"ONLINE_MANAGER"}),gy=ly.token({class:al,interface:"IOperationManager",token:"OPERATION_MANAGER"}),Ty=ly.token({class:Wc,interface:"IQueryManager",token:"QUERY_MANAGER"}),Oy=ly.token({class:lr,interface:"IRepositoryManager",token:"REPOSITORY_MANAGER"}),Ay=ly.token({class:cl,interface:"IStructuralEntityValidator",token:"STRUCTURAL_ENTITY_VALIDATOR"}),Ny=ly.token({class:Zc,interface:"IUpdateManager",token:"UPDATE_MANAGER"});py.setDependencies({applicationUtils:Wo,fieldUtils:Jo,queryUtils:ht,relationManager:Zo}),dy.setDependencies({terminalStore:Nc,transactionalServer:wc}),fy.setDependencies({airportDatabase:Qo,applicationDao:wp,applicationInitializer:gc,dbApplicationUtils:Je,internalRecordManager:Ey,storeDriver:Oc,transactionalServer:wc,transactionManager:xc}),yy.setDependencies({airportDatabase:Qo,applicationUtils:Wo,historyManager:Iy,operationHistoryDuo:Va,recordHistoryDuo:Pa,repositoryTransactionHistoryDuo:Ga,sequenceGenerator:Ze,utils:ii}),hy.setDependencies({entityStateManager:Ke}),my.setDependencies({entityStateManager:Ke}),Iy.setDependencies({transactionHistoryDuo:ka}),Ry.setDependencies({airportDatabase:Qo,historyManager:Iy,operationHistoryDuo:Va,recordHistoryDuo:Pa,repositoryTransactionHistoryDuo:Ga,sequenceGenerator:Ze}),Ey.setDependencies({actorDao:Ma,applicationDao:wp,domainDao:xp,entityStateManager:Ke,terminalStore:Nc,transactionManager:xc}),_y.setDependencies({repositoryDao:ja,repositoryManager:Oy,repositoryTransactionHistoryDao:Fa,transactionManager:xc}),gy.setDependencies({airportDatabase:Qo,applicationUtils:Wo,cascadeGraphVerifier:uy,deleteManager:yy,dependencyGraphResolver:hy,entityGraphReconstructor:my,entityStateManager:Ke,insertManager:Ry,qMetadataUtils:Ko,queryFacade:Yo,repositoryManager:Oy,structuralEntityValidator:Ay,updateManager:Ny,utils:ii}),Ty.setDependencies({actorDao:Ma,airportDatabase:Qo,observableQueryAdapter:Yp,repositoryDao:ja,repositoryLoader:Xo,storeDriver:Oc}),Xo.setDependencies({repositoryDao:ja,synchronizationAdapterLoader:cy,synchronizationInManager:iy}),Oy.setDependencies({repositoryDao:ja}),Ay.setDependencies({applicationUtils:Wo,entityStateManager:Ke}),xc.setDependencies({activeQueries:qp,idGenerator:Dd,synchronizationOutManager:oy,transactionHistoryDuo:ka}),bc.setDependencies({databaseManager:fy,dbApplicationUtils:Je,internalRecordManager:Ey,terminalStore:Nc,transactionManager:xc,transactionalServer:wc}),wc.setDependencies({deleteManager:yy,insertManager:Ry,operationManager:gy,queryManager:Ty,repositoryManager:Oy,updateManager:Ny}),Ny.setDependencies({airportDatabase:Qo,applicationUtils:Wo,fieldUtils:Jo,historyManager:Iy,operationHistoryDuo:Va,queryFacade:Yo,queryUtils:ht,recordHistoryDuo:Pa,relationManager:Zo,repositoryTransactionHistoryDuo:Ga,sequenceGenerator:Ze}),Y.isFramework=!0;var xy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let by=class{initialize(e){this.applicationStore.state.api=e}async findApiObjectAndOperation(e,t,n,i){const o=this.applicationStore.state.api.apiObjectMap[n];if(!o)throw new Error(`Could not find API object for\n        Domain:\n            ${e}\n        Application:\n            ${t}\n        Interface:\n            ${n}\n            \n            ---===<<<((( Please remember, generator must be run after API modifications )))>>>===---\n\n            `);const r=o.operationMap[i];if(!r)throw new Error(`Could not find API object method for \n        Domain:\n            ${e}\n        Application:\n            ${t}\n        Interface:\n            ${n}\n        Method name:\n            ${i}\n            \n            ---===<<<((( Please remember, generator must be run after API modifications )))>>>===---\n\n            `);return{apiObject:await this.containerAccessor.getContainer(this).getByNames(e,t,n),apiOperation:r}}};xy([function(e,t){}],by.prototype,"containerAccessor",void 0),xy([function(e,t){}],by.prototype,"applicationStore",void 0),by=xy([function(e){}],by);var wy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sy=class{validate(e,t){}};Sy=wy([function(e){}],Sy);var vy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Cy=class{async handleRequest(e){let t,n;try{const{apiObject:n,apiOperation:i}=await this.apiRegistry.findApiObjectAndOperation(e.domain,e.application,e.objectName,e.methodName),o=n[e.methodName].apply(n,e.args);t=i.isAsync?await o:o}catch(e){n=e.message?e.message:e,console.error(e)}return{application:e.application,args:e.args,category:"ToClient",domain:e.domain,errorMessage:n,id:e.id,hostDomain:e.hostDomain,hostProtocol:e.hostProtocol,methodName:e.methodName,objectName:e.objectName,protocol:e.protocol,payload:t,transactionId:e.transactionId}}};vy([function(e,t){}],Cy.prototype,"apiRegistry",void 0),Cy=vy([function(e){}],Cy);var Dy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let My=class{deserialize(e,t,n,i){const o={lookupTable:[]};let r;return r=e instanceof Array?e.map((e=>this.doDeserialize(e,t,o,n,i))):this.doDeserialize(e,t,o,n,i),r}doDeserialize(e,t,n,i,o){let r=i.getEntityState(e),a=i.getOperationUniqueId(e);if(!a||"number"!=typeof a||a<1||a%1==0)throw new Error(`Invalid or missing ${i.getUniqueIdFieldName()} field.`);let s=n.lookupTable[a];switch(r){case ye.STUB:{let e=n.lookupTable[a];if(!e)throw new Error(`Could not find an already present entity for\n\t\t\t\t\t${i.getUniqueIdFieldName()} of ${a}`);return e}default:if(s)throw new Error(`Entity appears more than once for\n\t\t\t\t\t${i.getUniqueIdFieldName()} of ${a}`)}let c={};n.lookupTable[a]=c,c[i.getStateFieldName()]=r;for(const r of t.properties){let a,s=e[r.name];if(!o.isEmpty(s)){if(r.relation){const e=r.relation[0];switch(e.relationType){case ce.ONE_TO_MANY:if(!(s instanceof Array))throw new Error("Expecting @OneToMany for an array entity relation");a=s.map((t=>this.doDeserialize(t,e.entity,n,i,o)));break;case ce.MANY_TO_ONE:if(!(s instanceof Object)||s instanceof Array)throw new Error("Expecting @ManyToOne for a non-array entity relation");a=this.doDeserialize(s,e.entity,n,i,o);break;default:throw new Error(`Unknown relation type: ${e.relationType}`)}}else{switch(r.propertyColumns[0].column.type){case fe.JSON:throw new Error("Json properties cannot be deserialized");case fe.DATE:if(!(s instanceof Object&&s[i.getStateFieldName()]===ye.DATE&&s.value))throw new Error(`Invalid Serialized Date format for ${t.name}.${r.name}`);try{a=new Date(s)}catch(e){throw new Error(`Invalid Serialized Date format for ${t.name}.${r.name}`)}break;case fe.ANY:case fe.BOOLEAN:case fe.NUMBER:case fe.STRING:a=s;break;default:throw new Error(`Unexpected data type for ${t.name}.${r.name}`)}}c[r.name]=a}}return c}cleanJsonObject(e,t,n){let i;if(e instanceof Object)if(e instanceof Array)i=e.map((e=>this.cleanJsonObject(e,t,n)));else{if(i={},e[n.getStateFieldName()]===ye.STUB)throw new Error(`Interlinked object graphs are not supported in @Json() columns \n                    ${t.entity.name}.${t.name}`);delete e[n.getStateFieldName()],delete e[n.getUniqueIdFieldName()];for(const o in e){const r=e[o];i[o]=this.cleanJsonObject(r,t,n)}}else i=e;return i}};My=Dy([function(e){}],My);var Vy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Py=class{copyEntityForProcessing(e,t,n,i){const o={processedEntityMap:new Map,sequence:i.lastOUID?i.lastOUID:0},r=this.doCopyEntityForProcessing(e,t,n,o);return i.lastOUID=o.sequence,r}doCopyEntityForProcessing(e,t,n,i){if(e instanceof Array)return e.map((e=>this.doCopyEntityForProcessing(e,t,n,i)));{let o={};if(i.processedEntityMap.has(e))return i.processedEntityMap.get(e);i.processedEntityMap.set(e,o);const r=++i.sequence;o[n.getUniqueIdFieldName()]=r,e[n.getUniqueIdFieldName()]=r,n.setOriginalValues(n.getOriginalValues(e),o);for(let r of t.properties){const t=e[r.name];r.relation&&r.relation.length&&t?o[r.name]=this.doCopyEntityForProcessing(t,r.relation[0].relationEntity,n,i):o[r.name]=t}return o[n.getStateFieldName()]=e[n.getStateFieldName()],o}}};Py=Vy([function(e){}],Py);var Ly=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Uy=class{saveOriginalValues(e,t){this.doSaveOriginalValues(e,t,new Set)}doSaveOriginalValues(e,t,n){if(e instanceof Array){for(let i=0;i<e.length;i++)this.doSaveOriginalValues(e[i],t,n);return}if(!e)return;if(n.has(e))return;n.add(e);const i={};this.entityStateManager.setOriginalValues(i,e);for(let o of t.properties){const t=e[o.name];if(o.relation&&o.relation.length){if(!t)continue;o.relation[0].relationType===ce.MANY_TO_ONE&&this.applicationUtils.forEachColumnTypeOfRelation(o.relation[0],((t,n)=>{for(let t of n){let n=e,o=i;for(let e=0;e<t.length;e++){const i=t[e];if(n instanceof Object){let r;n=n[i],r=e===t.length-1?n:{},o[i]=r,o=o[i]}else o[i]=n}}})),this.doSaveOriginalValues(t,o.relation[0].relationEntity,n)}else i[o.name]=e[o.name]}}setOperationState(e,t,n){if(e instanceof Array){for(var i=0;i<e.length;i++)this.setOperationState(e[i],t,n);return}if(n.has(e))return;n.add(e);const o=this.entityStateManager.getOriginalValues(e);let r=e[this.entityStateManager.getStateFieldName()],a=!0,s=!1;for(const n of t.properties)if(n.isId){for(const e of n.propertyColumns)e.column.isGenerated&&(s=!0);n.relation&&n.relation.length?this.applicationUtils.forEachColumnTypeOfRelation(n.relation[0],((t,n)=>{for(let t of n){let n=e;for(let e=0;e<t.length;e++){const i=t[e];n&&(n=n[i])}if(!n){if(r===ye.DELETE)throw new Error(`Entity is marked for deletion but does not have an @Id() property:\n            ${t.join(".")}\n                                    `);return r=ye.CREATE,a=!1,!0}}})):e[n.name]||0===e[n.name]||(a=!1)}if(o)for(const n of t.properties){const t=e[n.name];if(n.relation&&n.relation.length){if(!t)continue;const i=n.relation[0];this.entityStateManager.getOriginalValues(t),this.applicationUtils.forEachColumnTypeOfRelation(i,((n,i)=>{const o=this.entityStateManager.getOriginalValues(t);for(const t of i){let n=e,i=o;for(let e=0;e<t.length;e++){const o=t[e];n=n[o],0!==e&&(i=i[o]);let a=null==i;if(null==n){if(i)return r=ye.UPDATE,!0;break}if(a){if(n)return r=ye.UPDATE,!0;break}if("object"==typeof n){if("object"!=typeof i)return r=ye.UPDATE,!0}else{if("object"==typeof i)return r=ye.UPDATE,!0;if(n!==i)return r=ye.UPDATE,!0}}}}))}else{if(r)continue;let e,i=o[n.name];switch(n.propertyColumns[0].column.type){case fe.DATE:i&&(i=i.getTime()),t&&(e=t.getTime());break;case fe.JSON:i&&(i=JSON.stringify(i)),t&&(e=JSON.stringify(t));break;default:e=t}e!==i&&(r=ye.UPDATE)}}for(const i of t.properties){const t=e[i.name];t&&i.relation&&i.relation.length&&this.setOperationState(t,i.relation[0].relationEntity,n)}r||(r=a&&s||o?ye.PASS_THROUGH:ye.CREATE),e[this.entityStateManager.getStateFieldName()]=r}afterSaveModifications(e,t,n,i){this.updateOriginalValuesAfterSave(e,t,n,new Set),this.removeDeletedEntities(e,t,n,i)}updateOriginalValuesAfterSave(e,t,n,i){if(e instanceof Array)for(let o=0;o<e.length;o++)this.updateOriginalValuesAfterSave(e[o],t,n,i);else{if(i.has(e))return;i.add(e);let o=this.entityStateManager.getOperationUniqueId(e,!1,t),r={};r=this.doUpdateOriginalValuesAfterSave(e,t,n,i,o),this.entityStateManager.setOriginalValues(r,e)}}doUpdateOriginalValuesAfterSave(e,t,n,i,o){let r=n.created[o];if(r){if(!0!==r){for(const t in r)e[t]=r[t];if(t.isAirEntity){let t=e;t.repository&&t.repository._localId||(t.repository=n.newRepository),t.actor=n.actor}}}else if(n.deleted[o])return this.entityStateManager.setIsDeleted(!0,e),void this.entityStateManager.setOriginalValues(null,e);let a={};for(const o of t.properties){const t=e[o.name];t&&o.relation&&o.relation.length?(o.relation[0].relationType===ce.MANY_TO_ONE&&this.applicationUtils.forEachColumnTypeOfRelation(o.relation[0],((t,n)=>{for(let t of n){let n=e,i=a;for(let e=0;e<t.length;e++){const o=t[e];if(n instanceof Object){let r;n=n[o],r=e===t.length-1?n:{},i[o]=r,i=i[o]}else i[o]=n}}})),this.updateOriginalValuesAfterSave(t,o.relation[0].relationEntity,n,i)):a[o.name]=t}return a}removeDeletedEntities(e,t,n,i){if(e instanceof Array){for(let o=e.length-1;o>=0;o--)this.removeDeletedEntities(e[o],t,n,i)&&e.splice(o,1);return!e.length}if(i.has(e))return this.entityStateManager.isDeleted(e);i.add(e);for(const o of t.relations){const t=o.property,r=e[t.name];if(r)switch(o.relationType){case ce.MANY_TO_ONE:this.removeDeletedEntities(r,o.relationEntity,n,i)&&(e[t.name]=null);break;case ce.ONE_TO_MANY:this.removeDeletedEntities(r,o.relationEntity,n,i)}}return this.entityStateManager.isDeleted(e)}};Ly([function(e,t){}],Uy.prototype,"entityStateManager",void 0),Ly([function(e,t){}],Uy.prototype,"applicationUtils",void 0),Uy=Ly([function(e){}],Uy);var jy,Fy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gy=jy=class{isStub(e){return this.getEntityState(e)===ye.STUB}isParentSchemaId(e){return this.getEntityState(e)===ye.PARENT_SCHEMA_ID}isPassThrough(e){return this.getEntityState(e)===ye.PASS_THROUGH}markAsOfParentSchema(e){e[jy.STATE_FIELD]=ye.PARENT_SCHEMA_ID}markForDeletion(e){e[jy.STATE_FIELD]=ye.DELETE}markToCreate(e){e[jy.STATE_FIELD]=ye.CREATE}markToUpdate(e){e[jy.STATE_FIELD]=ye.UPDATE}getEntityState(e){return e[jy.STATE_FIELD]}getOriginalValues(e){return e[jy.ORIGINAL_VALUES_PROPERTY]}setOriginalValues(e,t){t[jy.ORIGINAL_VALUES_PROPERTY]=e}copyEntityState(e,t){t[jy.STATE_FIELD]=e[jy.STATE_FIELD],t[jy.ORIGINAL_VALUES_PROPERTY]=e[jy.ORIGINAL_VALUES_PROPERTY]}getStateFieldName(){return jy.STATE_FIELD}getEntityStateTypeAsFlags(e,t){let n,i,o,r,a,s,c;const l=this.getEntityState(e);switch(l){case ye.CREATE:n=!0;break;case ye.DELETE:i=!0;break;case ye.PARENT_SCHEMA_ID:o=!0;break;case ye.PASS_THROUGH:r=!0;break;case ye.DATE:a=!0;break;case ye.STUB:s=!0;break;case ye.UPDATE:c=!0;break;default:throw new Error(`Unexpected entity state\n"${this.getStateFieldName()}" for ${t.name}: ${l}`)}return{isCreate:n,isDelete:i,isParentSchemaId:o,isPassThrough:r,isResultDate:a,isStub:s,isUpdate:c}}setIsDeleted(e,t){t[jy.STATE_FIELD]=ye.DELETE}isDeleted(e){return e[jy.STATE_FIELD]===ye.DELETE}getOperationUniqueId(e,t=!0,n=null){const i=e[jy.OPERATION_UNIQUE_ID_FIELD];if((!i||"number"!=typeof i||i<1)&&t){let t;throw t=n?n.applicationVersion.application.name+"."+n.name:JSON.stringify(e),new Error(`Could not find "${jy.OPERATION_UNIQUE_ID_FIELD}" property on DTO:\n        \n        ${t}`)}return i}copyOperationUniqueId(e,t){const n=e[jy.OPERATION_UNIQUE_ID_FIELD];t[jy.OPERATION_UNIQUE_ID_FIELD]=n}markAsStub(e){e[jy.STATE_FIELD]=ye.STUB}getUniqueIdFieldName(){return jy.OPERATION_UNIQUE_ID_FIELD}};Gy.DELETED_PROPERTY="__deleted__",Gy.ORIGINAL_VALUES_PROPERTY="__originalValues__",Gy.STATE_FIELD="__state__",Gy.OPERATION_UNIQUE_ID_FIELD="__OUID__",Gy=jy=Fy([function(e){}],Gy);var ky=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let By=class{async addRepository(e){return await this.transactionalConnector.addRepository(e)}async insertColumnValues(e,t){if(!e)return 0;e instanceof Function&&(e=e());const n=new On(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValues(o,t)}async insertValues(e,t){if(!e)return 0;e instanceof Function&&(e=e());const n=new An(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValues(o,t)}async insertColumnValuesGenerateIds(e,t){if(!e)return[];e instanceof Function&&(e=e());const n=new On(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValuesGetLocalIds(o,t)}async insertValuesGenerateIds(e,t){if(!e)return[];e instanceof Function&&(e=e());const n=new An(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValuesGetLocalIds(o,t)}async deleteWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new In(e);const i=await this.ensureQueryContext(t);let o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.deleteWhere(o,t)}async save(e,t){if(!e)return null;const n=await this.preSaveOperations(e,t),i=await this.transactionalConnector.save(n,t);return this.updateCacheManager.afterSaveModifications(e,t.dbEntity,i,new Set),i}async saveToDestination(e,t,n){if(!t)return null;const i=await this.preSaveOperations(t,n),o=await this.transactionalConnector.saveToDestination(e,i,n);return this.updateCacheManager.afterSaveModifications(t,n.dbEntity,o,new Set),o}async preSaveOperations(e,t){if(!e)return null;const n=t.dbEntity,i=this.entityCopier.copyEntityForProcessing(e,n,this.entityStateManager,t);return this.updateCacheManager.setOperationState(i,n,new Set),i}async updateColumnsWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new bn(e);const i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.updateValues(o,t)}async updateWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new wn(e);const i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.updateValues(o,t)}prepare(e){return new Hy(e)}async ensureQueryContext(e){return e}};ky([function(e,t){}],By.prototype,"entityCopier",void 0),ky([function(e,t){}],By.prototype,"entityStateManager",void 0),ky([function(e,t){}],By.prototype,"queryFacade",void 0),ky([function(e,t){}],By.prototype,"transactionalConnector",void 0),ky([function(e,t){}],By.prototype,"updateCacheManager",void 0),By=ky([function(e){}],By);class Hy{constructor(e){throw new Error("Not Implemented")}find(...e){}}var $y=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let qy=class{async find(e,t,n){await this.ensureContext(n);return await this.transactionalConnector.find(this.getPortableQuery(e,t,n),n)}async findOne(e,t,n){await this.ensureContext(n);return await this.transactionalConnector.findOne(this.getPortableQuery(e,t,n),n)}getPortableQuery(e,t,n){return{jsonQuery:e.toJSON(this.queryUtils,this.fieldUtils,this.relationManager),parameterMap:e.getParameters(),queryResultType:t,applicationIndex:n.dbEntity.applicationVersion.application.index,tableIndex:n.dbEntity.index}}async search(e,t,n){return await this.ensureContext(n),await this.transactionalConnector.search(this.getPortableQuery(e,t,n),n)}async searchOne(e,t,n){return await this.ensureContext(n),await this.transactionalConnector.searchOne(this.getPortableQuery(e,t,n),n)}async ensureContext(e){}};$y([function(e,t){}],qy.prototype,"fieldUtils",void 0),$y([function(e,t){}],qy.prototype,"queryUtils",void 0),$y([function(e,t){}],qy.prototype,"relationManager",void 0),$y([function(e,t){}],qy.prototype,"transactionalConnector",void 0),qy=$y([function(e){}],qy);var Yy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};class Qy{constructor(e,t,n){this.applicationDomain=e,this.applicationName=t,this.entityMap=n}add(e,t){this.entityMap.set(e,{entity:{index:t,name:e.name},application:{domain:this.applicationDomain,name:this.applicationName}})}}let Wy=class{get entityMap(){return this.databaseStore.entityMap}get F(){return this.databaseStore.functions}get functions(){return this.databaseStore.functions}get A(){return this.databaseStore.applications}get applications(){return this.databaseStore.applications}get qApplications(){return this.databaseStore.qApplications}get Q(){return this.databaseStore.qApplications}get QM(){return this.databaseStore.QM}async load(){}setQApplication(e){const t=this.dbApplicationUtils.getFullApplication_Name(e),n=this.QM[t];if(n){const t=n.__dbApplication__;e.__dbApplication__=t,Hn(t,e,this.qApplications,this.appliationUtils,this.relationManager),this.Q[t.index]=e}this.QM[t]=e}getAccumulator(e,t){return new Qy(e,t,this.entityMap)}async addRepository(e){return await this.databaseFacade.addRepository(e)}async insertColumnValues(e,t){return await this.databaseFacade.insertColumnValues(e,t)}async insertValues(e,t){return await this.databaseFacade.insertValues(e,t)}async insertColumnValuesGenerateIds(e,t){return await this.databaseFacade.insertColumnValuesGenerateIds(e,t)}async insertValuesGenerateIds(e,t){return await this.databaseFacade.insertValuesGenerateIds(e,t)}async deleteWhere(e,t){return await this.databaseFacade.deleteWhere(e,t)}async save(e,t,n){return await this.databaseFacade.save(e,t)}async updateColumnsWhere(e,t){return await this.databaseFacade.updateColumnsWhere(e,t)}async updateWhere(e,t){return await this.databaseFacade.updateWhere(e,t)}};Yy([function(e,t){}],Wy.prototype,"appliationUtils",void 0),Yy([function(e,t){}],Wy.prototype,"databaseFacade",void 0),Yy([function(e,t){}],Wy.prototype,"databaseStore",void 0),Yy([function(e,t){}],Wy.prototype,"dbApplicationUtils",void 0),Yy([function(e,t){}],Wy.prototype,"find",void 0),Yy([function(e,t){}],Wy.prototype,"findOne",void 0),Yy([function(e,t){}],Wy.prototype,"relationManager",void 0),Yy([function(e,t){}],Wy.prototype,"search",void 0),Yy([function(e,t){}],Wy.prototype,"searchOne",void 0),Wy=Yy([function(e){}],Wy);const zy=P("tower").token({class:Py,interface:"IEntityCopier",token:"ENTITY_COPIER"});Qo.setClass(Wy),Ke.setClass(Gy),yc.setClass(by),yc.setDependencies({applicationStore:Ic}),hc.setClass(Sy),Rc.setClass(Cy),Up.setClass(My),et.setClass(Uy),Go.setClass(By),Go.setDependencies({entityCopier:zy,queryFacade:Yo}),Yo.setClass(qy);var Jy=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=t.PROMISE_RESOLVED_VOID=t.PROMISE_RESOLVED_TRUE=t.PROMISE_RESOLVED_FALSE=void 0,t.isPromise=function(e){return!(!e||"function"!=typeof e.then)},t.microSeconds=function(){var e=(new Date).getTime();return e===r?(a++,1e3*e+a):(r=e,a=0,1e3*e)},t.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},t.randomToken=function(){return Math.random().toString(36).substring(2)},t.sleep=function(e,t){e||(e=0);return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))};var n=Promise.resolve(!1);t.PROMISE_RESOLVED_FALSE=n;var i=Promise.resolve(!0);t.PROMISE_RESOLVED_TRUE=i;var o=Promise.resolve();t.PROMISE_RESOLVED_VOID=o;var r=0,a=0;var s="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);t.isNode=s})),Ky=x((function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}));x((function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}));var Zy=Jy,Xy=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=l,t.canBeUsed=c,t.close=r,t.create=o,t.microSeconds=t.default=void 0,t.onMessage=s,t.postMessage=a,t.type=void 0;var n=Zy.microSeconds;t.microSeconds=n;var i="native";function o(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function r(e){e.bc.close(),e.subFns=[]}function a(e,t){try{return e.bc.postMessage(t,!1),Zy.PROMISE_RESOLVED_VOID}catch(e){return Promise.reject(e)}}function s(e,t){e.messagesCallback=t}function c(){if(Zy.isNode&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function l(){return 150}t.type=i;var p={create:o,close:r,onMessage:s,postMessage:a,canBeUsed:c,type:i,averageResponseTime:l,microSeconds:n};t.default=p})),eh=function(){function e(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(e){return this.set.has(e)},e.prototype.add=function(e){var t=this;this.timeMap.set(e,nh()),this.set.add(e),setTimeout((function(){th(t)}),0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function th(e){for(var t=nh()-e.ttl,n=e.set[Symbol.iterator]();;){var i=n.next().value;if(!i)return;if(!(e.timeMap.get(i)<t))return;e.timeMap.delete(i),e.set.delete(i)}}function nh(){return(new Date).getTime()}var ih=Object.freeze({__proto__:null,ObliviousSet:eh,removeTooOldValues:th,now:nh}),oh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0);t.idb||(t.idb={});t.idb.ttl||(t.idb.ttl=45e3);t.idb.fallbackInterval||(t.idb.fallbackInterval=150);e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose);t.localstorage||(t.localstorage={});t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4);e.methods&&(t.methods=e.methods);t.node||(t.node={});t.node.ttl||(t.node.ttl=12e4);t.node.maxParallelWrites||(t.node.maxParallelWrites=2048);void 0===t.node.useFastPath&&(t.node.useFastPath=!0);return t};var rh=Object.defineProperty({fillOptionsWithDefaults:oh},"__esModule",{value:!0}),ah=N(ih),sh=rh,ch=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=R,t.canBeUsed=I,t.cleanOldMessages=p,t.close=y,t.create=d,t.createDatabase=r,t.default=void 0,t.getAllMessages=function(e){var t=e.transaction(i).objectStore(i),n=[];return new Promise((function(e){t.openCursor().onsuccess=function(t){var i=t.target.result;i?(n.push(i.value),i.continue()):e(n)}}))},t.getIdb=o,t.getMessagesHigherThan=s,t.getOldMessages=l,t.microSeconds=void 0,t.onMessage=m,t.postMessage=h,t.removeMessageById=c,t.type=void 0,t.writeMessage=a;var n=Zy.microSeconds;t.microSeconds=n;var i="messages";function o(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function r(e){var t="pubkey.broadcast-channel-0-"+e,n=o().open(t,1);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(i,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}function a(e,t,n){var o={uuid:t,time:(new Date).getTime(),data:n},r=e.transaction([i],"readwrite");return new Promise((function(e,t){r.oncomplete=function(){return e()},r.onerror=function(e){return t(e)},r.objectStore(i).add(o)}))}function s(e,t){var n=e.transaction(i).objectStore(i),o=[];return new Promise((function(e){(function(){try{var e=IDBKeyRange.bound(t+1,1/0);return n.openCursor(e)}catch(e){return n.openCursor()}}()).onsuccess=function(n){var i=n.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):e(o)}}))}function c(e,t){var n=e.transaction([i],"readwrite").objectStore(i).delete(t);return new Promise((function(e){n.onsuccess=function(){return e()}}))}function l(e,t){var n=(new Date).getTime()-t,o=e.transaction(i).objectStore(i),r=[];return new Promise((function(e){o.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var o=i.value;if(!(o.time<n))return void e(r);r.push(o),i.continue()}else e(r)}}))}function p(e,t){return l(e,t).then((function(t){return Promise.all(t.map((function(t){return c(e,t.id)})))}))}function d(e,t){return t=(0,sh.fillOptionsWithDefaults)(t),r(e).then((function(n){var i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:(0,Zy.randomToken)(),eMIs:new ah.ObliviousSet(2*t.idb.ttl),writeBlockPromise:Zy.PROMISE_RESOLVED_VOID,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},u(i),i}))}function u(e){e.closed||f(e).then((function(){return(0,Zy.sleep)(e.options.idb.fallbackInterval)})).then((function(){return u(e)}))}function f(e){return e.closed?Zy.PROMISE_RESOLVED_VOID:e.messagesCallback?s(e.db,e.lastCursorId).then((function(t){return t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time})).forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Zy.PROMISE_RESOLVED_VOID})):Zy.PROMISE_RESOLVED_VOID}function y(e){e.closed=!0,e.db.close()}function h(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return a(e.db,e.uuid,t)})).then((function(){0===(0,Zy.randomInt)(0,10)&&p(e.db,e.options.idb.ttl)})),e.writeBlockPromise}function m(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,f(e)}function I(){return!Zy.isNode&&!!o()}function R(e){return 2*e.idb.fallbackInterval}t.type="idb";var E={create:d,close:y,onMessage:m,postMessage:h,canBeUsed:I,type:"idb",averageResponseTime:R,microSeconds:n};t.default=E})),lh=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.addStorageEventListener=s,t.averageResponseTime=f,t.canBeUsed=u,t.close=p,t.create=l,t.default=void 0,t.getLocalStorage=o,t.microSeconds=void 0,t.onMessage=d,t.postMessage=a,t.removeStorageEventListener=c,t.storageKey=r,t.type=void 0;var n=Zy.microSeconds;t.microSeconds=n;var i="localstorage";function o(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function r(e){return"pubkey.broadcastChannel-"+e}function a(e,t){return new Promise((function(n){(0,Zy.sleep)().then((function(){var i=r(e.channelName),a={token:(0,Zy.randomToken)(),time:(new Date).getTime(),data:t,uuid:e.uuid},s=JSON.stringify(a);o().setItem(i,s);var c=document.createEvent("Event");c.initEvent("storage",!0,!0),c.key=i,c.newValue=s,window.dispatchEvent(c),n()}))}))}function s(e,t){var n=r(e),i=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",i),i}function c(e){window.removeEventListener("storage",e)}function l(e,t){if(t=(0,sh.fillOptionsWithDefaults)(t),!u())throw new Error("BroadcastChannel: localstorage cannot be used");var n=(0,Zy.randomToken)(),i=new ah.ObliviousSet(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:i};return o.listener=s(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!i.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(i.add(e.token),o.messagesCallback(e.data)))})),o}function p(e){c(e.listener)}function d(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function u(){if(Zy.isNode)return!1;var e=o();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function f(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}t.type=i;var y={create:l,close:p,onMessage:d,postMessage:a,canBeUsed:u,type:i,averageResponseTime:f,microSeconds:n};t.default=y})),ph=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=p,t.canBeUsed=l,t.close=a,t.create=r,t.microSeconds=t.default=void 0,t.onMessage=c,t.postMessage=s,t.type=void 0;var n=Zy.microSeconds;t.microSeconds=n;var i="simulate";t.type=i;var o=new Set;function r(e){var t={name:e,messagesCallback:null};return o.add(t),t}function a(e){o.delete(e)}function s(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(o).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))}function c(e,t){e.messagesCallback=t}function l(){return!0}function p(){return 5}var d={create:r,close:a,onMessage:c,postMessage:s,canBeUsed:l,type:i,averageResponseTime:p,microSeconds:n};t.default=d})),dh=function(e){var t=[].concat(e.methods,mh).filter(Boolean);if(e.type){if("simulate"===e.type)return hh.default;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||Zy.isNode||(t=t.filter((function(e){return"idb"!==e.type})));var i=t.find((function(e){return e.canBeUsed()}));if(i)return i;throw new Error("No useable method found in "+JSON.stringify(mh.map((function(e){return e.type}))))},uh=Ky(Xy),fh=Ky(ch),yh=Ky(lh),hh=Ky(ph),mh=[uh.default,fh.default,yh.default];var Ih=Object.defineProperty({chooseMethod:dh},"__esModule",{value:!0}),Rh=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OPEN_BROADCAST_CHANNELS=t.BroadcastChannel=void 0,t.clearNodeFolder=function(e){e=(0,sh.fillOptionsWithDefaults)(e);var t=(0,Ih.chooseMethod)(e);return"node"===t.type?t.clearNodeFolder().then((function(){return!0})):Zy.PROMISE_RESOLVED_FALSE},t.enforceOptions=function(e){i=e};var n=new Set;t.OPEN_BROADCAST_CHANNELS=n;var i,o=0,r=function(e,t){var r,a;this.id=o++,n.add(this),this.name=e,i&&(t=i),this.options=(0,sh.fillOptionsWithDefaults)(t),this.method=(0,Ih.chooseMethod)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,a=(r=this).method.create(r.name,r.options),(0,Zy.isPromise)(a)?(r._prepP=a,a.then((function(e){r._state=e}))):r._state=a};function a(e,t,n){var i={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:Zy.PROMISE_RESOLVED_VOID).then((function(){var t=e.method.postMessage(e._state,i);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function s(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function c(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&s(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=1e5,i=e.time-n;t.time>=i&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function l(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!s(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}t.BroadcastChannel=r,r._pubkey=!0,r.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return a(this,"message",e)},postInternal:function(e){return a(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};l(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,c(this,"message",t)):this._onML=null},addEventListener:function(e,t){c(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){l(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){n.delete(this),this.closed=!0;var t=this._prepP?this._prepP:Zy.PROMISE_RESOLVED_VOID;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}}}));var Eh={add:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}}},_h=new Set,gh=!1;function Th(){var e=[];return _h.forEach((function(t){e.push(t()),_h.delete(t)})),Promise.all(e)}var Oh=N(Object.freeze({__proto__:null,add:function(e){if(gh||(gh=!0,Eh.add(Th)),"function"!=typeof e)throw new Error("Listener is no function");return _h.add(e),{remove:function(){return _h.delete(e)},run:function(){return _h.delete(e),e()}}},runAll:Th,removeAll:function(){_h.clear()},getSize:function(){return _h.size}})),Ah=wh,Nh=function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){e||(e={});(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3);e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options));return e}(t,e);var n=new xh(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n},xh=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=(0,Zy.randomToken)(),this._aplQ=Zy.PROMISE_RESOLVED_VOID,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var i=function(e){"leader"===e.context&&("death"===e.action&&(n.hasLeader=!1),"tell"===e.action&&(n.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",i),this._lstns.push(i)};function bh(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function wh(e){e.isLeader=!0,e.hasLeader=!0;var t=(0,Oh.add)((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&bh(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),bh(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),bh(e,"tell")}xh.prototype={applyOnce:function(e){var t=this;if(this.isLeader)return(0,Zy.sleep)(0,!0);if(this.isDead)return(0,Zy.sleep)(0,!1);if(this._aplQC>1)return this._aplQ;return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return Zy.PROMISE_RESOLVED_TRUE;var n,i=!1,o=new Promise((function(e){n=function(){i=!0,e()}})),r=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t.hasLeader=!0))};t.broadcastChannel.addEventListener("internal",r);var a=e?4*t._options.responseTime:t._options.responseTime;return bh(t,"apply").then((function(){return Promise.race([(0,Zy.sleep)(a),o.then((function(){return Promise.reject(new Error)}))])})).then((function(){return bh(t,"apply")})).then((function(){return Promise.race([(0,Zy.sleep)(a),o.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",r),!i&&wh(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){if(e.isLeader)return Zy.PROMISE_RESOLVED_VOID;return new Promise((function(t){var n=!1;function i(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",o),t(!0))}e.applyOnce().then((function(){e.isLeader&&i()})),function t(){return(0,Zy.sleep)(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void i():e.applyOnce(!0).then((function(){e.isLeader?i():t()}))}))}();var o=function(t){"leader"===t.context&&"death"===t.action&&(e.hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&i()})))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,bh(this,"death")}};var Sh=Rh,vh=Object.defineProperty({beLeader:Ah,createLeaderElection:Nh},"__esModule",{value:!0}),Ch=x((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BroadcastChannel",{enumerable:!0,get:function(){return Sh.BroadcastChannel}}),Object.defineProperty(t,"OPEN_BROADCAST_CHANNELS",{enumerable:!0,get:function(){return Sh.OPEN_BROADCAST_CHANNELS}}),Object.defineProperty(t,"beLeader",{enumerable:!0,get:function(){return vh.beLeader}}),Object.defineProperty(t,"clearNodeFolder",{enumerable:!0,get:function(){return Sh.clearNodeFolder}}),Object.defineProperty(t,"createLeaderElection",{enumerable:!0,get:function(){return vh.createLeaderElection}}),Object.defineProperty(t,"enforceOptions",{enumerable:!0,get:function(){return Sh.enforceOptions}})})),Dh={BroadcastChannel:Ch.BroadcastChannel,createLeaderElection:Ch.createLeaderElection,clearNodeFolder:Ch.clearNodeFolder,enforceOptions:Ch.enforceOptions,beLeader:Ch.beLeader},Mh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vh=class{init(){this.isNativeBroadcastChannel="function"==typeof BroadcastChannel;const e=()=>{this.communicationChannel=new Dh.BroadcastChannel("clientCommunication",{idb:{onclose:()=>{this.communicationChannel.close(),e()}}}),this.communicationChannel.onmessage=e=>{this.transactionalReceiver.handleClientRequest(e)}};e(),window.addEventListener("message",(e=>{const t=e.data;this.transactionalReceiver.handleAppRequest(t,e.origin,e.source)}),!1)}needMessageSerialization(){return!this.isNativeBroadcastChannel}sendMessageToClient(e){this.communicationChannel.postMessage(e)}sendMessageToApp(){}};Mh([function(e,t){}],Vh.prototype,"transactionalReceiver",void 0),Vh=Mh([function(e){}],Vh);var Ph=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Lh=class{async retrieveDomain(e,t,n,i){return t.get(e)}};Lh=Ph([function(e){}],Lh);var Uh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jh=class{async build(e,t,n,i){await this.createApplication(e,i);for(const n of e.versions[e.versions.length-1].entities)await this.buildTable(e,n,t,i);const o=new Map;for(const r of e.versions[e.versions.length-1].entities)await this.buildForeignKeys(e,r,t,n,o,i)}async buildTable(e,t,n,i){const o=[],r=t.columns.map((n=>{let i=`${n.name} ${this.getColumnSuffix(e,t,n)}`;return this.isPrimaryKeyColumn(t,n)&&o.push(n.name),i})),a=this.getCreateTableSuffix(e,t),s=this.storeDriver.getTableName(e,t,i);let c="";o.length&&(c=this.getPrimaryKeyStatement(o));const l=`CREATE TABLE ${s} (\n\t\t${r.join(",\n")}${c}\n\t\t)${a}`;await this.storeDriver.query(ge.DDL,l,[],i,!1);let p=0;if(t.tableConfig.columnIndexes)for(const e of t.tableConfig.columnIndexes){const t=this.getIndexSql("idx_"+s+"_"+ ++p,s,e.columnList,e.unique);await this.storeDriver.query(ge.DDL,t,[],i,!1)}if(t.tableConfig.propertyIndexes)for(const e of t.tableConfig.propertyIndexes){const n=[];for(const i of t.columns)for(const t of i.propertyRefs)if(t.index===e.propertyIndex){n.push(i.name);break}const o=this.getIndexSql("idx_"+s+"_"+ ++p,s,n,e.unique);await this.storeDriver.query(ge.DDL,o,[],i,!1)}}async buildForeignKeys(e,t,n,i,o,r){if(!t.relations||!t.relations.length)return;const a=e.versions[e.versions.length-1],s=this.storeDriver.getTableName(e,t,r);for(const c of t.relations){if(c.relationType!==ce.MANY_TO_ONE)continue;let l,p;if(c.relationTableApplication_Index||0===c.relationTableApplication_Index){const e=a.referencedApplications[c.relationTableApplication_Index];let t=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.name);if(l=o.get(t),!l){const e=n.get(t);if(l=e?e.versions[0].jsonApplication:i.get(t),!l)throw new Error(`Could not find related application ${t}\n            in either existing applications or newly installing applications.`);o.set(t,l)}p=l.versions[l.versions.length-1].entities[c.relationTableIndex]}else l=e,p=a.entities[c.relationTableIndex];let d=[];for(const e of t.columns)for(const t of e.propertyRefs)if(t.index===c.propertyRef.index){d.push(e.name);break}const u=this.storeDriver.getTableName(l,p,r);let f=[];for(const e of p.idColumnRefs)f.push(p.columns[e.index].name);const y=this.getForeignKeySql(s,"fk_"+s+"_foreignKeyNumber",d,u,f);y&&await this.storeDriver.query(ge.DDL,y,[],r,!1)}}async buildForeignKeysForTable(){}isPrimaryKeyColumn(e,t){return t.propertyRefs.some((t=>{if(e.properties[t.index].isId)return!0}))}getPrimaryKeyStatement(e){return`,\n\t\t\tPRIMARY KEY (\n\t\t\t${e.join(",\n")}\n\t\t\t)`}};Uh([function(e,t){}],jh.prototype,"airportDatabase",void 0),Uh([function(e,t){}],jh.prototype,"dbApplicationUtils",void 0),Uh([function(e,t){}],jh.prototype,"sequenceDao",void 0),Uh([function(e,t){}],jh.prototype,"storeDriver",void 0),jh=Uh([function(e){}],jh);var Fh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gh=class{async check(e){if(!e)throw new Error("Json Application not provided");if(!(e.versions instanceof Array))throw new Error("application.versions is not an array");if(1!==e.versions.length)throw new Error("Currently only 1 version of application is supported");await this.checkDomain(e)}async checkDomain(e){}async checkDependencies(e){const t=new Map,n=new Map;for(const i of e){const e=i.versions[i.versions.length-1],o=qe(qe(n,i.domain),i.name);for(const n of e.referencedApplications)qe(t,n.domain).set(n.name,n),qe(o,n.domain).set(n.name,n)}this.pruneInGroupReferences(e,t,n),await this.pruneReferencesToExistingApplications(e,t,n);const i=[],o=[],r=[];for(const e of t.values())for(const t of e.values())r.push(t);for(const t of e){const e=n.get(t.domain).get(t.name);this.hasReferences(e)?o.push(t):i.push(t)}return{applicationsWithValidDependencies:i,applicationsInNeedOfAdditionalDependencies:o,neededDependencies:r}}pruneInGroupReferences(e,t,n){for(const i of e){for(const[e,t]of n)for(const[e,n]of t){const e=n.get(i.domain);e&&e.delete(i.name)}const e=t.get(i.domain);e&&e.delete(i.name)}}async pruneReferencesToExistingApplications(e,t,n){const i=await this.findExistingApplications(t);for(const e of i.existingApplicationMapByName.keys()){const o=i.coreDomainAndApplication_NamesByApplication_Name.get(e);for(const e of n.values())for(const t of e.values()){const e=t.get(o.domain);e&&e.delete(o.application)}const r=t.get(o.domain);r&&r.delete(o.application)}}async findExistingApplications(e){const t=[],n=new Map;for(const[i,o]of e)for(const[e,r]of o){const o=this.dbApplicationUtils.getFullApplication_Name(r);t.push(o),n.set(o,{domain:i,application:e})}let i;return i=t.length?await this.applicationDao.findMapByFullNames(t):new Map,{coreDomainAndApplication_NamesByApplication_Name:n,existingApplicationMapByName:i}}hasReferences(e){for(const t of e.values())for(const e of t)return!0;return!1}};Fh([function(e,t){}],Gh.prototype,"applicationDao",void 0),Fh([function(e,t){}],Gh.prototype,"dbApplicationUtils",void 0),Gh=Fh([function(e){}],Gh);var kh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Bh=class{locateExistingApplicationVersionRecord(e,t){const n=t.getLatestApplicationVersionMapByNames().get(e.domain);if(!n)return null;const i=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.name),o=n.get(i),r=e.versions[0];if(o&&o.integerVersion!==r.integerVersion)throw new Error("Multiple versions of applications are not yet supported");return o}async locateLatestApplicationVersionByApplication_Name(e,t){return t.getLatestApplicationVersionMapByFullApplication_Name().get(e)}};kh([function(e,t){}],Bh.prototype,"dbApplicationUtils",void 0),Bh=kh([function(e){}],Bh);var Hh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $h=class{async compose(e,t){const n=new Map,i=t.terminalStore,o=i.getDomains().slice(),r=new Map;for(const e of o)r.set(e.name,e);const a=i.getApplications().slice(),s=new Map;for(const e of a)s.set(e.fullName,e);const c=[],l=new Map,p=new Map,d=new Map,u=new Map,f=new Map,y={columns:[],domains:[],entities:[],latestApplicationVersions:[],properties:[],propertyColumns:[],relationColumns:[],relations:[],applicationReferences:[],applications:[],applicationVersions:[]},h=[...i.getAllApplicationVersionsByIds()],m={columns:[],domains:[],entities:[],latestApplicationVersions:[],properties:[],propertyColumns:[],relationColumns:[],relations:[],applicationReferences:[],applications:[],applicationVersions:[]},I={all:m,allApplicationVersionsByIds:h,added:y};for(const t of e){n.set(this.dbApplicationUtils.getFullApplication_Name(t),t);const e=await this.composeDomain(t.domain,o,y.domains,r),i=this.composeApplication(e,t,a,y.applications,s);this.composeApplicationVersion(t,i,c,y.applicationVersions,l)}const{newApplicationReferenceMap:R,newApplicationReferences:E}=await this.composeApplicationReferences(n,l,i,I,t.deepTraverseReferences);y.applicationReferences=E;for(const e of h)e&&this.addApplicationVersionObjects(e,m);for(const t of e){const e=this.dbApplicationUtils.getFullApplication_Name(t);n.set(e,t);const o=r.get(t.domain),a=s.get(this.dbApplicationUtils.getFullApplication_Name(t));a.index||(t.lastIds={...this.terminalStore.getLastIds()},a.index=++this.terminalStore.getLastIds().applications),o._localId||(o._localId=++this.terminalStore.getLastIds().domains);const c=l.get(a.fullName);c._localId||(c._localId=++this.terminalStore.getLastIds().applicationVersions,c.jsonApplication=t),this.composeApplicationEntities(t,c,p,y.entities),this.composeApplicationProperties(t,y.properties,d,p),await this.composeApplicationRelations(t,y.relations,u,p,d,R,i,I),this.composeApplicationColumns(t,y.columns,f,y.propertyColumns,p,d),await this.composeApplicationRelationColumns(t,y.relationColumns,l,R,u,f,i,I)}this.addObjects(I.added,I.all);for(const e of I.all.applicationVersions)I.allApplicationVersionsByIds[e._localId]=e;return I}async getExistingLatestApplicationVersion(e,t){for(const n of t.all.latestApplicationVersions)if(n.application.fullName==e)return n;throw new Error(`Cannot find application "${e}".`)}addApplicationVersionObjects(e,t){let n=!1;for(const i of t.domains)if(i.name===e.application.domain.name){n=!0;break}n||t.domains.push(e.application.domain);let i=!1;for(const n of t.applications)if(n.domain===e.application.domain&&n.name===e.application.name){i=!0;break}i||t.applications.push(e.application),t.applicationVersions.push(e),t.latestApplicationVersions.push(e),t.applicationReferences=t.applicationReferences.concat(e.references),t.entities=t.entities.concat(e.entities);for(const n of e.entities){t.columns=t.columns.concat(n.columns),t.properties=t.properties.concat(n.properties);let e=[];for(const t of n.properties)e=e.concat(t.propertyColumns);t.propertyColumns=t.propertyColumns.concat(e),t.relations=t.relations.concat(n.relations);let i=[];for(const e of n.relations)i=i.concat(e.manyRelationColumns);t.relationColumns=t.relationColumns.concat(i)}}addObjects(e,t){t.columns=t.columns.concat(e.columns);for(const n of e.domains){let e=!1;for(const i of t.domains)if(i.name===n.name){e=!0;break}e||t.domains.push(n)}t.entities=t.entities.concat(e.entities),t.latestApplicationVersions=t.latestApplicationVersions.concat(e.latestApplicationVersions),t.properties=t.properties.concat(e.properties),t.propertyColumns=t.propertyColumns.concat(e.propertyColumns),t.relationColumns=t.relationColumns.concat(e.relationColumns),t.relations=t.relations.concat(e.relations);for(const n of e.applications){let e=!1;for(const i of t.applications)if(i.domain===n.domain&&i.name===n.name){e=!0;break}e||t.applications.push(n)}t.applicationReferences=t.applicationReferences.concat(e.applicationReferences),t.applicationVersions=t.applicationVersions.concat(e.applicationVersions)}async composeDomain(e,t,n,i){let o=await this.domainRetriever.retrieveDomain(e,i,t,n);return o||(o={_localId:null,name:e,applications:[]},t.push(o),n.push(o),i.set(e,o)),o}composeApplication(e,t,n,i,o){const r=this.dbApplicationUtils.getFullApplication_Name(t);let a=o.get(r);return a||(a={domain:e,index:null,fullName:r,name:t.name,scope:"public",signature:"localhost",status:ve.CURRENT},n.push(a),i.push(a),o.set(r,a)),a}composeApplicationVersion(e,t,n,i,o){let r;for(const n of e.versions){const o=n.versionString.split(".");r={_localId:null,integerVersion:n.integerVersion,versionString:n.versionString,majorVersion:parseInt(o[0]),minorVersion:parseInt(o[1]),patchVersion:parseInt(o[2]),application:t,jsonApplication:e,entities:[],references:[],referencedBy:[],entityMapByName:{},referencesMapByName:{},referencedByMapByName:{}},t.versions?t.versions.push(r):t.versions=[r],i.push(r)}let a={application:t,applicationVersion:r};return t.currentVersion=[a],n.push(r),o.set(t.fullName,r),r}async composeApplicationReferences(e,t,n,i,o){const r=new Map,a=new Map,s=[];for(const[c,l]of t){const p=l.application,d=e.get(p.fullName),u=d.versions[d.versions.length-1],f=He(r,c),y=Ye(a,c);for(const r of u.referencedApplications){const a=this.dbApplicationUtils.getFullApplication_Name(r);let c=t.get(a);if(!c){if(c=await this.applicationLocator.locateLatestApplicationVersionByApplication_Name(a,n),!c)throw new Error(`Could not locate application:\n\t\t\t\t\t\t${a}\n\t\t\t\t\t\tin either existing applications or applications being currently processed`);this.addApplicationVersionObjects(c,i.all),o&&(e.set(a,c.jsonApplication),t.set(a,c))}const p={index:r.index,ownApplicationVersion:l,referencedApplicationVersion:c};y.has(r.index)||(y.add(r.index),s.push(p),f.push(p))}}return{newApplicationReferenceMap:r,newApplicationReferences:s}}composeApplicationEntities(e,t,n,i){const o=this.dbApplicationUtils.getFullApplication_Name(e);let r=0;const a=e.versions[e.versions.length-1].entities,s=[];for(const e of a){const n={_localId:++this.terminalStore.getLastIds().entities,index:r++,applicationVersion:t,isLocal:e.isLocal,isAirEntity:e.isAirEntity,name:e.name,tableConfig:e.tableConfig};s.push(n),i.push(n)}n.set(o,s),t.entities=s}composeApplicationProperties(e,t,n,i){const o=this.dbApplicationUtils.getFullApplication_Name(e),r=e.versions[e.versions.length-1].entities,a=i.get(o),s=He(n,o);r.forEach(((e,n)=>{const i=a[n],o=[];s[n]=o;let r=0;for(const n of e.properties){const e={_localId:++this.terminalStore.getLastIds().properties,index:r,entity:i,name:n.name,isId:n.isId};o[r]=e,r++,t.push(e)}}))}async composeApplicationRelations(e,t,n,i,o,r,a,s){const c=this.dbApplicationUtils.getFullApplication_Name(e),l=e.versions[e.versions.length-1].entities,p=i.get(c),d=o.get(c),u=He(n,c),f=r.get(c);for(let e=0;e<l.length;e++){const n=l[e],o=d[e],r=[];u[e]=r;const y=p[e];let h=0;for(const e of n.relations){const n=o[e.propertyRef.index];let l=c;if(e.relationTableApplication_Index||0===e.relationTableApplication_Index){l=f[e.relationTableApplication_Index].referencedApplicationVersion.application.fullName}let p=i.get(l);if(!p){p=(await this.getExistingLatestApplicationVersion(l,s)).entities}const d=p[e.relationTableIndex],u={entity:y,_localId:++a.getLastIds().relations,index:h,foreignKey:e.foreignKey,isId:n.isId,manyToOneElems:e.manyToOneElems,property:n,oneToManyElems:e.oneToManyElems,relationEntity:d,relationType:e.relationType};r[h]=u,h++,t.push(u)}}}composeApplicationColumns(e,t,n,i,o,r){const a=this.dbApplicationUtils.getFullApplication_Name(e),s=[];n.set(a,s);const c=o.get(a),l=e.versions[e.versions.length-1].entities,p=r.get(a);l.forEach(((e,n)=>{const o=c[n],r=[];s[n]=r;const a=[];e.idColumnRefs.forEach(((e,t)=>{a[e.index]=t}));const l=p[n];e.columns.forEach(((e,n)=>{const s=a[n],c={allocationSize:e.allocationSize,entity:o,_localId:++this.terminalStore.getLastIds().columns,idIndex:s,index:n,isGenerated:e.isGenerated,manyRelationColumns:[],name:e.name,notNull:e.notNull,oneRelationColumns:[],precision:e.precision,propertyColumns:[],scale:e.scale,type:e.type};r[n]=c,t.push(c),e.propertyRefs.forEach((e=>{const t=l[e.index],n={column:c,property:t};i.push(n)}))}))}))}async composeApplicationRelationColumns(e,t,n,i,o,r,a,s){const c=this.dbApplicationUtils.getFullApplication_Name(e),l=e.versions[e.versions.length-1].entities,p=r.get(c),d=o.get(c),u=i.get(c);for(let e=0;e<l.length;e++){const i=l[e],f=p[e],y=d[e];for(let e=0;e<i.columns.length;e++){const l=i.columns[e],p=f[e];for(const e of l.manyRelationColumnRefs){const i=y[e.manyRelationIndex];let l;if(e.oneApplication_Index||0===e.oneApplication_Index){l=u[e.oneApplication_Index].referencedApplicationVersion}else l=n.get(c);const d=l.application.fullName,f=r.get(d);let h,m;if(f)h=f[e.oneTableIndex],m=o.get(l.application.fullName)[e.oneTableIndex];else{const t=(await this.getExistingLatestApplicationVersion(d,s)).entities[e.oneTableIndex];h=t.columns,m=t.relations}const I=h[e.oneColumnIndex],R=m[e.oneRelationIndex],E={_localId:++a.getLastIds().relationColumns,manyColumn:p,manyRelation:i,oneColumn:I,oneRelation:R,parentRelation:i};t.push(E)}p.manyRelationColumns=[]}}}};Hh([function(e,t){}],$h.prototype,"applicationLocator",void 0),Hh([function(e,t){}],$h.prototype,"dbApplicationUtils",void 0),Hh([function(e,t){}],$h.prototype,"domainRetriever",void 0),Hh([function(e,t){}],$h.prototype,"terminalStore",void 0),$h=Hh([function(e){}],$h);var qh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yh=class{async record(e,t){await this.transactionManager.transactInternal((async()=>{this.setDefaultVersioning(e);const n=await this.getdomainDaoAsync();await n.checkAndInsertIfNeeded(e.domains,t),await this.applicationDao.insert(e.applications,t),await this.applicationVersionDao.insert(e.applicationVersions,t),await this.applicationReferenceDao.insert(e.applicationReferences,t),await this.applicationEntityDao.insert(e.entities,t),await this.applicationPropertyDao.insert(e.properties,t),await this.applicationRelationDao.insert(e.relations,t),await this.applicationColumnDao.insert(e.columns,t),await this.applicationPropertyColumnDao.insert(e.propertyColumns,t),await this.applicationRelationColumnDao.insert(e.relationColumns,t)}),t)}setDefaultVersioning(e){for(const t of e.applicationReferences)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.ownApplicationVersion;for(const t of e.entities)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.applicationVersion;for(const t of e.properties)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.relations)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.columns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.propertyColumns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.property.entity.applicationVersion;for(const t of e.relationColumns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.parentRelation.entity.applicationVersion}async bulkCreate(e,t,n){await e.save(t,n)}};qh([function(e,t){}],Yh.prototype,"applicationColumnDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationEntityDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationPropertyColumnDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationPropertyDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationReferenceDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationRelationColumnDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationRelationDao",void 0),qh([function(e,t){}],Yh.prototype,"applicationVersionDao",void 0),qh([function(e,t){}],Yh.prototype,"domainDao",void 0),qh([function(e,t){}],Yh.prototype,"transactionManager",void 0),Yh=qh([function(e){}],Yh);var Qh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wh=class{};Qh([function(e,t){},function(e,t){},function(e,t){}],Wh.prototype,"applicationIndex",void 0),Qh([function(e,t){},function(e,t){},function(e,t){}],Wh.prototype,"tableIndex",void 0),Qh([function(e,t){},function(e,t){},function(e,t){}],Wh.prototype,"columnIndex",void 0),Qh([function(e,t){}],Wh.prototype,"incrementBy",void 0),Qh([function(e,t){}],Wh.prototype,"currentValue",void 0),Wh=Qh([function(e){},function(e){}],Wh);var zh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Jh=class{};zh([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Jh.prototype,"_localId",void 0),Jh=zh([function(e){},function(e){}],Jh);var Kh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zh=class{};Kh([function(e,t){},function(e,t){},function(e,t){}],Zh.prototype,"_localId",void 0),Kh([function(e,t){}],Zh.prototype,"createTimestamp",void 0),Kh([function(e,t){}],Zh.prototype,"randomNumber",void 0),Zh=Kh([function(e){},function(e){}],Zh);const Xh={__constructors__:{Sequence:Wh,SystemWideOperationId:Jh,TerminalRun:Zh},domain:"air",name:"@airport/airport-code"},em=Xh;function tm(e){return oi.ddS(em.__dbApplication__,e)}oi.setQApplication(Xh);class nm extends Vo{constructor(e){super(e,em)}}class im extends nm{constructor(){super(0)}static Save(e){return Vo.BaseSave(e)}static diSet(){return tm(0)}}im.Find=new Po,im.FindOne=new Po,im.Search=new Po,im.SearchOne=new Po;class om extends nm{constructor(){super(1)}static Save(e){return Vo.BaseSave(e)}static diSet(){return tm(1)}}om.Find=new Po,om.FindOne=new Po,om.Search=new Po,om.SearchOne=new Po;class rm extends nm{constructor(){super(2)}static Save(e){return Vo.BaseSave(e)}static diSet(){return tm(2)}}rm.Find=new Po,rm.FindOne=new Po,rm.Search=new Po,rm.SearchOne=new Po;var am=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let sm=class extends rm{};sm=am([function(e){}],sm);var cm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let lm=class extends im{static diSet(){return em.__dbApplication__&&em.__dbApplication__.currentVersion[0].applicationVersion.entities[0]}async incrementCurrentValues(e){const t=em.Sequence;await this.db.updateWhere({UPDATE:t,SET:{currentValue:sn(t.currentValue,t.incrementBy)}},e)}async incrementSequence(e){const t=em.Sequence;await this.db.updateWhere({UPDATE:t,SET:{currentValue:sn(t.currentValue,t.incrementBy)}},e)}};lm=cm([function(e){}],lm);const pm=P("airport-code"),dm=pm.token({class:lm,interface:"ISequenceDao",token:"SEQUENCE_DAO"});pm.token({class:sm,interface:"ITerminalRunDao",token:"TERMINAL_RUN_DAO"});var um=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let fm=class{populate(){}};fm=um([function(e){}],fm);var ym=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let hm=class{link(e){const{all:t,allApplicationVersionsByIds:n,added:i}=e,{latestApplicationVersions:o,properties:r,relations:a,applicationReferences:s,applications:c}=i;this.linkDomainsAndApplicationsAndVersions(n,t.domains,c,o,s);const l=this.linkEntities(n,t.entities,i.entities),{propertyMapById:p,relationMapById:d}=this.linkPropertiesAndRelations(r,a,l);this.linkColumns(p,d,e,l)}linkDomainsAndApplicationsAndVersions(e,t,n,i,o){const r=new Map;t.forEach((e=>{r.set(e._localId,e)}));const a=new Map;n.forEach((e=>{a.set(e.index,e);const t=r.get(e.domain._localId);e.domain=t,t.applications.push(e)})),i.forEach((e=>{const t=a.get(e.application.index);let n={application:t,applicationVersion:e};t.currentVersion=[n],t.versions=[e],e.application=t,e.entities=[],e.references=[],e.referencedBy=[],e.entityMapByName={},e.referencesMapByName={},e.referencedByMapByName={}})),o.forEach((t=>{const n=e[t.ownApplicationVersion._localId],i=e[t.referencedApplicationVersion._localId];n.references[t.index]=t,n.referencesMapByName[i.application.fullName]=t,i.referencedBy.push(t),i.referencedByMapByName[n.application.fullName]=t,t.ownApplicationVersion=n,t.referencedApplicationVersion=i}))}linkEntities(e,t,n){const i=[];return t.forEach((e=>{i[e._localId]=e})),n.forEach((t=>{const n=e[t.applicationVersion._localId];t.applicationVersion=n,n.entities[t.index]=t,n.entityMapByName[t.name]=t,i[t._localId]=t,t.columns=[],t.properties=[],t.relations=[],t.relationReferences=[],t.columnMap={},t.idColumns=[],t.idColumnMap={},t.propertyMap={}})),i}linkPropertiesAndRelations(e,t,n){const i=new Map;e.forEach((e=>{const t=n[e.entity._localId];t.properties[e.index]=e,t.propertyMap[e.name]=e,e.entity=t,e.propertyColumns=[],i.set(e._localId,e)}));const o=new Map;return t.forEach((e=>{const t=n[e.entity._localId];t.relations[e.index]=e;let r=n[e.relationEntity._localId];r||(r=this.terminalStore.getAllEntities()[e.relationEntity._localId]),r.relationReferences.push(e);const a=i.get(e.property._localId);e.property=a,a.relation=[e],e.entity=t,e.relationEntity=r,e.manyRelationColumns=[],e.oneRelationColumns=[],o.set(e._localId,e)})),{propertyMapById:i,relationMapById:o}}linkColumns(e,t,n,i){const o=new Map;n.all.columns.forEach((e=>{o.set(e._localId,e)})),n.added.columns.forEach((e=>{o.set(e._localId,e);const t=i[e.entity._localId];t.columns[e.index]=e,t.columnMap[e.name]=e,(e.idIndex||0===e.idIndex)&&(t.idColumns[e.idIndex]=e,t.idColumnMap[e.name]=e),e.entity=t})),n.added.propertyColumns.forEach((t=>{const n=o.get(t.column._localId);n.propertyColumns.push(t);const i=e.get(t.property._localId);i.propertyColumns.push(t),t.column=n,t.property=i})),n.added.relationColumns.forEach((e=>{let n=o.get(e.manyColumn._localId);n||(n=this.terminalStore.getAllColumns()[e.manyColumn._localId]),n.manyRelationColumns.push(e);let i,r,a=o.get(e.oneColumn._localId);a||(a=this.terminalStore.getAllColumns()[e.oneColumn._localId]),a.oneRelationColumns.push(e),e.manyRelation&&e.manyRelation._localId&&(i=t.get(e.manyRelation._localId),i||(i=this.terminalStore.getAllRelations()[e.manyRelation._localId]),i.manyRelationColumns.push(e)),e.oneRelation&&e.oneRelation._localId&&(r=t.get(e.oneRelation._localId),r||(r=this.terminalStore.getAllRelations()[e.oneRelation._localId]),r.oneRelationColumns.push(e)),e.manyColumn=n,e.manyRelation=i,e.oneColumn=a,e.oneRelation=r}))}};ym([function(e,t){}],hm.prototype,"terminalStore",void 0),hm=ym([function(e){}],hm);var mm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Im=class{async retrieveDdlObjects(){const e=await this.applicationDao.findAllActive(),t=[],n=new Set;e.forEach((e=>{t.push(e.index),n.add(e.domain._localId)})),e.sort(((e,t)=>e.index-t.index));const i=await this.domainDao.findByIdIn(Array.from(n)),o=await this.applicationVersionDao.findAllActiveOrderByApplication_IndexAndId();let r;const a=[],s=[];for(const e of o)e.application.index!==r&&a.push(e),r=e.application.index,s.push(e);const c=a.map((e=>e._localId)),l=await this.applicationReferenceDao.findAllForApplicationVersions(c),p=await this.applicationEntityDao.findAllForApplicationVersions(c),d=p.map((e=>e._localId)),u=await this.applicationPropertyDao.findAllForEntities(d),f=u.map((e=>e._localId)),y=await this.applicationRelationDao.findAllForProperties(f),h=await this.applicationColumnDao.findAllForEntities(d),m=h.map((e=>e._localId)),I=await this.applicationPropertyColumnDao.findAllForColumns(m),R=await this.applicationRelationColumnDao.findAllForColumns(m),E=this.terminalStore.getTerminalState(),_={columns:h.length,domains:i.length,entities:p.length,properties:u.length,propertyColumns:I.length,relationColumns:R.length,relations:y.length,applications:e.length,applicationVersions:s.length};return this.terminalStore.state.next({...E,lastIds:_}),{columns:h,domains:i,entities:p,latestApplicationVersions:a,properties:u,propertyColumns:I,relationColumns:R,relations:y,applicationReferences:l,applications:e,applicationVersions:s}}};mm([function(e,t){}],Im.prototype,"applicationColumnDao",void 0),mm([function(e,t){}],Im.prototype,"applicationDao",void 0),mm([function(e,t){}],Im.prototype,"applicationEntityDao",void 0),mm([function(e,t){}],Im.prototype,"applicationPropertyColumnDao",void 0),mm([function(e,t){}],Im.prototype,"applicationPropertyDao",void 0),mm([function(e,t){}],Im.prototype,"applicationReferenceDao",void 0),mm([function(e,t){}],Im.prototype,"applicationRelationColumnDao",void 0),mm([function(e,t){}],Im.prototype,"applicationRelationDao",void 0),mm([function(e,t){}],Im.prototype,"applicationVersionDao",void 0),mm([function(e,t){}],Im.prototype,"domainDao",void 0),mm([function(e,t){}],Im.prototype,"terminalStore",void 0),Im=mm([function(e){}],Im);var Rm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Em=class{createAll(e){(function(e){const t=new Map,n=e.map((e=>{const n=new Set;for(const t of e.currentVersion[0].applicationVersion.references)n.add(t.referencedApplicationVersion.application.index);const i={application:e,dependencies:n};return t.set(e.index,i),i}));return n.sort(((e,t)=>$n(e,t.application.index)?1:$n(t,e.application.index)?-1:0)),n.map((e=>e.application))})(e).map((e=>this.create(e)))}create(e){let t=this.airportDatabase.QM[e.fullName];return t?t.__dbApplication__=e:(t={__constructors__:{},__qConstructors__:{},__dbApplication__:e,name:e.name,domain:e.domain.name},this.airportDatabase.QM[e.fullName]=t),this.airportDatabase.Q[e.index]=t,Hn(e,t,this.airportDatabase.qApplications,this.applicationUtils,this.relationManager),t}};Rm([function(e,t){}],Em.prototype,"airportDatabase",void 0),Rm([function(e,t){}],Em.prototype,"applicationUtils",void 0),Rm([function(e,t){}],Em.prototype,"relationManager",void 0),Em=Rm([function(e){}],Em);var _m=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gm=class{generateQObjectsAndPopulateStore(e){this.ddlObjectLinker.link(e),this.queryEntityClassCreator.createAll(e.all.applications);const t=this.terminalStore.getTerminalState(),n={};for(const e of t.domains)n[e.name]=e;for(const t of e.added.domains)delete n[t.name];const i=[];for(const e in n)i.push(n[e]);const o={};for(const e of t.applications)o[e.fullName]=e;for(const t of e.added.applications)delete o[t.fullName];const r=[];for(const e in o)r.push(o[e]);this.terminalStore.state.next({...t,domains:[...i,...e.added.domains],applications:[...r,...e.added.applications]})}async initialize(){const e=await this.ddlObjectRetriever.retrieveDdlObjects(),t=[];for(const n of e.applicationVersions)t[n._localId]=n;let n={all:e,allApplicationVersionsByIds:t,added:e};return this.generateQObjectsAndPopulateStore(n),n}};_m([function(e,t){}],gm.prototype,"ddlObjectLinker",void 0),_m([function(e,t){}],gm.prototype,"ddlObjectRetriever",void 0),_m([function(e,t){}],gm.prototype,"queryEntityClassCreator",void 0),_m([function(e,t){}],gm.prototype,"terminalStore",void 0),gm=_m([function(e){}],gm);const Tm=P("takeoff");Tm.token({class:fm,interface:"IAirportDatabasePopulator",token:"AIRPORT_DATABASE_POPULATOR"});const Om=Tm.token({class:hm,interface:"IDdlObjectLinker",token:"DDL_OBJECT_LINKER"}),Am=Tm.token({class:Im,interface:"IDdlObjectRetriever",token:"DDL_OBJECT_RETRIEVER"}),Nm=Tm.token({class:Em,interface:"IQueryEntityClassCreator",token:"QUERY_ENTITY_CLASS_CREATOR"}),xm=Tm.token({class:gm,interface:"IQueryObjectInitializer",token:"QUERY_OBJECT_INITIALIZER"});Om.setDependencies({terminalStore:Nc}),Am.setDependencies({applicationColumnDao:bp,applicationDao:wp,applicationEntityDao:Sp,applicationPropertyColumnDao:vp,applicationPropertyDao:Cp,applicationReferenceDao:Dp,applicationRelationColumnDao:Mp,applicationRelationDao:Vp,applicationVersionDao:Pp,domainDao:xp}),Nm.setDependencies({airportDatabase:Qo,applicationUtils:Wo,relationManager:Zo}),xm.setDependencies({ddlObjectLinker:Om,ddlObjectRetriever:Am,queryEntityClassCreator:Nm,terminalStore:Nc});var bm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wm=class{addNewApplicationVersionsToAll(e){for(const t of e.added.applicationVersions)e.allApplicationVersionsByIds[t._localId]=t}async hydrate(e,t){await this.stage(e,t);const n=await this.queryObjectInitializer.initialize();this.addNewApplicationVersionsToAll(n),this.setAirDbApplications(n),await this.sequenceGenerator.initialize(t)}async initialize(e,t,n,i){const o=await this.getApplicationsWithValidDependencies(e,n),r=new Map;if(i){const e=await this.applicationDao.findAllWithJson();for(const t of e)r.set(t.fullName,t)}const a=new Map;for(const t of e){const e=r.get(this.dbApplicationUtils.getFullApplication_Name(t));e?t.lastIds=e.versions[0].jsonApplication.lastIds:a.set(this.dbApplicationUtils.getFullApplication_Name(t),t)}let s=[];for(const e of o){r.get(this.dbApplicationUtils.getFullApplication_Name(e))||(s.push(e),await this.applicationBuilder.build(e,r,a,t))}const c=await this.applicationComposer.compose(s,{terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(c),this.queryObjectInitializer.generateQObjectsAndPopulateStore(c),this.setAirDbApplications(c),await this.transactionManager.transactInternal((async(e,t)=>{const n=await this.applicationBuilder.buildAllSequences(o,t);await this.sequenceGenerator.initialize(t,n),await this.applicationRecorder.record(c.added,t)}),t)}async initializeForAIRportApp(e){const t=await this.getApplicationsWithValidDependencies([e],!1),n=await this.applicationComposer.compose(t,{deepTraverseReferences:!0,terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(n),this.queryObjectInitializer.generateQObjectsAndPopulateStore(n),this.setAirDbApplications(n)}async stage(e,t){const n=await this.applicationComposer.compose(e,{terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(n),this.queryObjectInitializer.generateQObjectsAndPopulateStore(n),this.setAirDbApplications(n);const i=await this.applicationBuilder.stageSequences(e,t);await this.sequenceGenerator.tempInitialize(t,i)}async wait(e){return new Promise(((t,n)=>{setTimeout((()=>{t()}),e)}))}async getApplicationsWithValidDependencies(e,t){const n=[];for(const t of e){await this.applicationChecker.check(t);this.applicationLocator.locateExistingApplicationVersionRecord(t,this.terminalStore)||n.push(t)}let i;if(t){const e=await this.applicationChecker.checkDependencies(n);if(e.applicationsInNeedOfAdditionalDependencies.length)for(let t=0;t<e.neededDependencies.length;t++){const n=e.neededDependencies[t],i=this.dbApplicationUtils.getFullApplication_Name(n);await this.nativeInitializeApplication(n.domain,n.name,i)}i=[...e.applicationsWithValidDependencies,...e.applicationsInNeedOfAdditionalDependencies]}else i=n;return i}setAirDbApplications(e){for(let t of e.all.applications)this.airportDatabase.applications[t.index]=t}};bm([function(e,t){}],wm.prototype,"airportDatabase",void 0),bm([function(e,t){}],wm.prototype,"applicationBuilder",void 0),bm([function(e,t){}],wm.prototype,"applicationChecker",void 0),bm([function(e,t){}],wm.prototype,"applicationComposer",void 0),bm([function(e,t){}],wm.prototype,"applicationDao",void 0),bm([function(e,t){}],wm.prototype,"applicationLocator",void 0),bm([function(e,t){}],wm.prototype,"applicationRecorder",void 0),bm([function(e,t){}],wm.prototype,"dbApplicationUtils",void 0),bm([function(e,t){}],wm.prototype,"queryObjectInitializer",void 0),bm([function(e,t){}],wm.prototype,"sequenceGenerator",void 0),bm([function(e,t){}],wm.prototype,"terminalStore",void 0),bm([function(e,t){}],wm.prototype,"transactionManager",void 0),wm=bm([function(e){}],wm);const Sm=P("landing"),vm=Sm.token({class:wm,interface:"class ApplicationInitializer",token:"ABSTRACT_APPLICATION_INITIALIZER"}),Cm=Sm.token({class:null,interface:"ISchemaBuilder",token:"APPLICATION_BUILDER"}),Dm=Sm.token({class:Gh,interface:"IApplicationChecker",token:"APPLICATION_CHECKER"}),Mm=Sm.token({class:$h,interface:"IApplicationComposer",token:"APPLICATION_COMPOSER"}),Vm=Sm.token({class:Bh,interface:"IApplicationLocator",token:"APPLICATION_LOCATOR"}),Pm=Sm.token({class:Yh,interface:"IApplicationRecorder",token:"APPLICATION_RECORDER"}),Lm=Sm.token({class:jh,interface:"class SqlSchemaBuilder",token:"SQL_SCHEMA_BUILDER"});vm.setDependencies({airportDatabase:Qo,applicationBuilder:Cm,applicationChecker:Dm,applicationComposer:Mm,applicationDao:wp,applicationLocator:Vm,applicationRecorder:Pm,dbApplicationUtils:Je,queryObjectInitializer:xm,sequenceGenerator:Ze,terminalStore:Nc,transactionManager:xc}),Cm.setDependencies({airportDatabase:Qo}),Dm.setDependencies({applicationDao:wp,dbApplicationUtils:Je}),Mm.setDependencies({applicationLocator:Vm,dbApplicationUtils:Je,domainRetriever:Tc,terminalStore:Nc}),Vm.setDependencies({dbApplicationUtils:Je}),Pm.setDependencies({applicationColumnDao:bp,applicationDao:wp,applicationEntityDao:Sp,applicationPropertyColumnDao:vp,applicationPropertyDao:Cp,applicationRecorder:Pm,applicationReferenceDao:Dp,applicationRelationColumnDao:Mp,applicationRelationDao:Vp,applicationVersionDao:Pp,domainDao:xp,transactionManager:xc}),Lm.setDependencies({airportDatabase:Qo,dbApplicationUtils:Je,sequenceDao:dm,storeDriver:Oc});var Um=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jm=class extends wm{async nativeInitializeApplication(e,t,n){if(this.terminalStore.getReceiver().initializedApps.has(n))return;let i,o=document.getElementsByName(n);for(o.length?i=o[0]:(i=document.createElement("iframe"),i.src="http://"+e+"/AIRport/apps/"+t+"/index.html",i.name=n,i.style.display="none",document.body.appendChild(i));!this.terminalStore.getReceiver().initializedApps.has(n);)await this.wait(100);this.terminalStore.getApplicationInitializer().applicationWindowMap.set(n,i.contentWindow),this.terminalStore.getApplicationInitializer().initializingApplicationMap.set(n,!1)}};Um([function(e,t){}],jm.prototype,"terminalStore",void 0),jm=Um([function(e){}],jm);var Fm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gm=class extends Dc{init(){const e=window.location.hostname.split(".");("www"===e[0]||e[0].startsWith("random_"))&&e.splice(0,1);const t="."+e.join(".");"localhost"!==document.domain&&(document.domain="random_"+Math.random()+"_"+Math.random()+t);const n=this.terminalStore.getWebReceiver();n.domainPrefix=t,n.mainDomainFragments=e}handleClientRequest(e){if(e.__received__)return;if(e.__received__=!0,!this.hasValidApplicationInfo(e))return;if(this.webMessageReciever.needMessageSerialization())throw new Error("Deserialization is not yet implemented.");const t=this.terminalStore.getWebReceiver();if(t.onClientMessageCallback){const n=new Date;e.__receivedTime__=n.getTime(),t.onClientMessageCallback(e)}switch(e.category){case"FromClient":const t={...e,__received__:!1,__receivedTime__:null,category:"FromClientRedirected"};this.handleFromClientRequest(t).then();break;case"IsConnectionReady":this.ensureConnectionIsReady(e).then()}}handleAppRequest(e,t,n){if(e.__received__)return;if(e.__received__=!0,!this.hasValidApplicationInfo(e))return;const i=this.terminalStore.getWebReceiver();if(i.onClientMessageCallback){const t=new Date;e.__receivedTime__=t.getTime(),i.onClientMessageCallback(e)}switch(e.category){case"ToDb":this.handleIsolateMessage(e,t,n).then();break;case"ToClient":const o=i.pendingInterAppApiCallMessageMap.get(e.id),r={};this.endApiCall({application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName,transactionId:e.transactionId},e.errorMessage,r).then((n=>{if(o)o.resolve(e);else{const i={...e,__received__:!1,__receivedTime__:null,application:e.application,args:e.args,category:"ToClientRedirected",domain:e.domain,errorMessage:e.errorMessage,methodName:e.methodName,objectName:e.objectName,payload:e.payload,protocol:e.protocol,transactionId:e.transactionId};n||(i.errorMessage=r.errorMessage,i.payload=null),this.handleToClientRequest(i,t).then()}}))}}onMessage(e){this.terminalStore.getWebReceiver().onClientMessageCallback=e}async nativeStartApiCall(e,t){return await this.startApiCall(e,t,(async()=>{const t=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application),n=this.getFrameWindow(t);if(!n)throw new Error(`No Application IFrame found for: ${t}`);n.postMessage(e,"*")}))}async nativeHandleApiCall(e,t){const n={...e};if(delete n.__received__,delete n.__receivedTime__,n.category="FromClientRedirected",!await this.nativeStartApiCall(n,t))throw new Error(t.errorMessage);const i=await new Promise((e=>{this.terminalStore.getWebReceiver().pendingInterAppApiCallMessageMap.set(n.id,{message:{...n,category:"FromDb",type:rc.CALL_API},resolve:e})}));return{...n,category:"FromDb",args:i.args,errorMessage:i.errorMessage,payload:i.payload,transactionId:i.transactionId}}async ensureConnectionIsReady(e){const t=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application);if(this.terminalStore.getApplicationInitializer().initializingApplicationMap.get(t))return;this.terminalStore.getApplicationInitializer().applicationWindowMap.get(t)||(this.terminalStore.getApplicationInitializer().initializingApplicationMap.set(t,!0),await this.applicationInitializer.nativeInitializeApplication(e.domain,e.application,t));const n={application:e.application,args:e.args,category:"ConnectionIsReady",domain:e.domain,errorMessage:null,id:e.id,hostDomain:e.hostDomain,hostProtocol:e.hostProtocol,methodName:e.methodName,objectName:e.objectName,protocol:window.location.protocol,payload:null,transactionId:e.transactionId};this.webMessageReciever.needMessageSerialization(),this.webMessageReciever.sendMessageToClient(n)}hasValidApplicationInfo(e){return"string"==typeof e.domain&&e.domain.length>=3&&"string"==typeof e.application&&e.application.length>=3}async handleFromClientRequest(e){const t=this.terminalStore.getWebReceiver();let n=t.pendingHostCounts.get(e.domain);if(n||(n=0),n>4)return;const i=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application);let o=t.pendingApplicationCounts.get(i);if(o||(o=0),-1===o)return;if(t.pendingHostCounts.set(e.domain,n+1),t.pendingApplicationCounts.set(i,o+1),!await this.ensureApplicationIsInstalled(i))return void this.relyToClientWithError(e,"Application is not installed");const r={};await this.nativeStartApiCall(e,r)||this.relyToClientWithError(e,r.errorMessage)}relyToClientWithError(e,t){const n={__received__:!1,__receivedTime__:null,application:e.application,args:e.args,category:"ToClientRedirected",domain:e.domain,errorMessage:t,id:e.id,hostDomain:e.hostDomain,hostProtocol:e.hostProtocol,methodName:e.methodName,objectName:e.objectName,payload:null,protocol:e.protocol,transactionId:e.transactionId};this.replyToClientRequest(n)}getFrameWindow(e){const t=document.getElementsByName(e);return t&&t[0]?t[0].contentWindow:null}async handleToClientRequest(e,t){await this.messageIsFromValidApp(e,t)&&this.replyToClientRequest(e)}replyToClientRequest(e){const t=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application),n=this.terminalStore.getWebReceiver();let i=n.pendingHostCounts.get(e.domain);i>0&&n.pendingHostCounts.set(e.domain,i-1);let o=n.pendingApplicationCounts.get(t);o>0&&n.pendingApplicationCounts.set(e.domain,o-1),this.webMessageReciever.needMessageSerialization(),this.webMessageReciever.sendMessageToClient(e)}async ensureApplicationIsInstalled(e){return!!e&&!!this.terminalStore.getApplicationInitializer().applicationWindowMap.get(e)}async messageIsFromValidApp(e,t){const n=t.split("//")[1],i=n.split(".");if("localhost"===n.split(":")[0])return!0;const o=this.terminalStore.getWebReceiver(),r=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application);if(!t.startsWith("https")||n!==r+o.domainPrefix)return!1;if(i.length!==o.mainDomainFragments.length+1)return!1;if("www"===i[0])return!1;return i[0]===r&&!!this.terminalStore.getApplicationInitializer().applicationWindowMap.get(r)}async handleIsolateMessage(e,t,n){if(!await this.messageIsFromValidApp(e,t))return;const i=this.terminalStore.getWebReceiver(),o=this.dbApplicationUtils.getFullApplication_NameFromDomainAndName(e.domain,e.application);switch(e.type){case rc.SEARCH_UNSUBSCRIBE:let t=i.subsriptionMap.get(o);if(!t)return;let n=t.get(e.id);if(!n)return;return n.unsubscribe(),void t.delete(e.id)}let r;if(r=e.type===rc.CALL_API?await this.nativeHandleApiCall(e,{startedAt:new Date}):await this.processMessage(e),!r)return;let a=o+"."+i.localDomain;switch(e.type){case rc.SEARCH:case rc.SEARCH_ONE:const t=r;t.result.pipe(To((e=>{window.postMessage(e,a)})));const n=t.result.subscribe();let s=i.subsriptionMap.get(o);return s||(s=new Map,i.subsriptionMap.set(o,s)),void s.set(e.id,n)}n.postMessage(r,"*")}};Fm([function(e,t){}],Gm.prototype,"applicationInitializer",void 0),Fm([function(e,t){}],Gm.prototype,"dbApplicationUtils",void 0),Fm([function(e,t){}],Gm.prototype,"terminalStore",void 0),Fm([function(e,t){}],Gm.prototype,"webMessageReciever",void 0),Gm=Fm([function(e){}],Gm);const km=P("web-terminal");Tc.setClass(Lh),gc.setClass(jm);const Bm=km.token({class:Vh,interface:"IWebMessageReceiver",token:"WEB_MESSAGE_RECEIVER"});gc.setDependencies({terminalStore:Nc}),Bm.setDependencies({transactionalReceiver:bc}),bc.setClass(Gm),bc.setDependencies({databaseManager:fy,dbApplicationUtils:Je,internalRecordManager:Ey,terminalStore:Nc,webMessageReciever:Bm});var Hm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $m=class{get sequences(){return this.terminalStore.getSequenceGenerator().sequences}get sequenceBlocks(){return this.terminalStore.getSequenceGenerator().sequenceBlocks}get generatingSequenceNumbers(){return this.terminalStore.getSequenceGenerator().generatingSequenceNumbers}set generatingSequenceNumbers(e){this.terminalStore.getSequenceGenerator().generatingSequenceNumbers=e}exists(e){const t=e.columns.filter((e=>e.isGenerated));if(!t.length)return!0;const n=this.sequences[e.applicationVersion.application.index];if(!n)return!1;const i=n[e.index];return!!i&&t.every((e=>!!i[e.index]))}async initialize(e,t){t||(t=await this.sequenceDao.findAll()),this.addSequences(t),await this.sequenceDao.incrementCurrentValues(e),We(this)}async tempInitialize(e,t){this.addSequences(t),We(this)}async generateSequenceNumbers(e,t){if(!e.length)return[];await this.waitForPreviousGeneration(),this.generatingSequenceNumbers=!0;try{return await this.doGenerateSequenceNumbers(e,t)}finally{this.generatingSequenceNumbers=!1}}async doGenerateSequenceNumbers(e,t){const n=[];for(let i=0;i<e.length;i++){const o=e[i];let r=t[i];const a=He(n,i),s=o.propertyColumns[0].property.entity,c=s.applicationVersion.application;let l=this.sequenceBlocks[c.index][s.index][o.index];const p=this.sequences[c.index][s.index][o.index];for(;r&&l;)a.push(p.currentValue-l+1),r--,l--;if(this.sequenceBlocks[c.index][s.index][o.index]=l,r){const e=p.incrementBy+r,t={...p};for(t.currentValue+=e,await this.sequenceDao.save(t),this.sequences[c.index][s.index][o.index]=t,l=e;r;)a.push(p.currentValue-l+1),r--,l--;this.sequenceBlocks[c.index][s.index][o.index]=l}}return n}waitForPreviousGeneration(){return new Promise((e=>{this.isDoneGeneratingSeqNums(e)}))}isDoneGeneratingSeqNums(e){this.generatingSequenceNumbers?setTimeout((()=>{this.isDoneGeneratingSeqNums(e)}),20):e()}addSequences(e){for(const t of e)He(He(this.sequences,t.applicationIndex),t.tableIndex)[t.columnIndex]=t,t.currentValue+=t.incrementBy,He(He(this.sequenceBlocks,t.applicationIndex),t.tableIndex)[t.columnIndex]=t.incrementBy}};Hm([function(e,t){}],$m.prototype,"sequenceDao",void 0),Hm([function(e,t){}],$m.prototype,"terminalStore",void 0),$m=Hm([function(e){}],$m),Ze.setClass($m),Ze.setDependencies({sequenceDao:dm,terminalStore:Nc});class qm extends bd{constructor(){super(),this.maxValues=999}composeTableName(e,t){return`${e}__${t}`}async doesTableExist(e,t,n){const i=await this.findNative(`SELECT\n\ttbl_name\nfrom\n\tsqlite_master\nWHERE\n\ttype = 'table'\n\tAND tbl_name = '${e}__${t}'`,[],n);return 1===this.getNumberOfRows(i)}getSelectQuerySuffix(e,t){return""}getNumberOfRows(e){return this.getRows(e).length}async dropTable(e,t,n){return 1===(await this.findNative(`DROP TABLE '${e}__${t}'`,[],n)).length}async findNative(e,t,n){let i=t.map((e=>this.convertValueIn(e)));return await this.query(ge.SELECT,e,i,n)}async executeNative(e,t,n){return await this.query(ge.MUTATE,e,t,n)}convertValueIn(e){switch(typeof e){case"boolean":return e?1:0;case"number":case"string":return e;case"undefined":return null;case"object":if(e){if(e instanceof Date)return e.getTime();throw new Error(`Unexpected non-date object ${e}`)}return null;default:throw new Error("Unexpected typeof value: "+typeof e)}}isValueValid(e,t,n){throw new Error("Method not implemented.")}async initTables(e){for(let t=0;t<e.length;t++){let n=e[t];await n}}getDialect(){return dd.SQLITE}isServer(){return!1}}class Ym extends class{getFunctionCalls(e,t,n,i,o){return e.appliedFunctions.forEach((e=>{t=this.getFunctionCall(e,t,n,i,o)})),t}}{getFunctionCall(e,t,n,i,o){let r;switch(e.ft){case de.ABS:return`ABS(${t})`;case de.AVG:return`AVG(${t})`;case de.COUNT:return`COUNT(${t})`;case de.MAX:return`MAX(${t})`;case de.MIN:return`MIN(${t})`;case de.SUM:return`SUM(${t})`;case de.UCASE:return`UPPER(${t})`;case de.LCASE:return`LOWER(${t})`;case de.MID:return`SUBSTR(${t}, ${i.getFunctionCallValue(e.p[0],o)}, ${i.getFunctionCallValue(e.p[1],o)})`;case de.LEN:return`LENGTH(${t})`;case de.ROUND:return`ROUND(${t}, ${i.getFunctionCallValue(e.p[0],o)})`;case de.NOW:return"DATE('now')";case de.FORMAT:let n=`FORMAT('${t}', `;for(let t=0;t<e.p.length;t++){let r=e.p[t];r=i.getFunctionCallValue(r,o),n=`${n}, ${r}`}return n+=")",n;case de.REPLACE:let a=i.getFunctionCallValue(e.p[0],o);return r=i.getFunctionCallValue(e.p[1],o),`REPLACE('${t}', ${a}, ${r})`;case de.TRIM:return`TRIM(${t})`;case de.DISTINCT:throw new Error("Invalid placement of a distinct function");case de.EXISTS:throw new Error("Invalid placement of an exists function");case de.DIVIDE:return r=i.getFunctionCallValue(e.p[0],o),`${t} / ${r}`;case de.MINUS:return r=i.getFunctionCallValue(e.p[0],o),`${t} - ${r}`;case de.MULTIPLY:return r=i.getFunctionCallValue(e.p[0],o),`${t} * ${r}`;case de.PLUS:return r=i.getFunctionCallValue(e.p[0],o),`${t} + ${r}`;case de.CONCATENATE:return e.p.reduce(((e,t)=>(this.toString(i.getFunctionCallValue(t,o)),e+t)),this.toString(t));case de.COALESCE:throw new Error("Not Implemented");default:throw new Error(`Unknown function type: ${e.ft}`)}}toString(e){switch(typeof e){case"string":return e;case"boolean":case"number":return e.toString();case"undefined":return"null";case"object":if(null===e)return"null";if(e instanceof Date)return e.toJSON();throw new Error("Unsupported value for conversion to string.");default:throw new Error("Unsupported value for conversion to string.")}}}var Qm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wm=class extends jh{async createApplication(e,t){}getColumnSuffix(e,t,n){let i="";(n.notNull||this.isPrimaryKeyColumn(t,n))&&(i=" NOT NULL");const o=i;switch(n.type){case fe.ANY:return o;case fe.BOOLEAN:return`INTEGER ${o}`;case fe.DATE:return`REAL ${o}`;case fe.JSON:return`TEXT ${o}`;case fe.NUMBER:return o?`INTEGER ${o}`:"REAL";case fe.STRING:return`TEXT ${o}`;default:throw new Error(`Unexpected data type for ${e.name}.${t.name}.${n.name}`)}}getCreateTableSuffix(e,t){return" WITHOUT ROWID"}async buildAllSequences(e,t){console.log("buildAllSequences");let n=[];for(const t of e){const e=this.airportDatabase.QM[this.dbApplicationUtils.getFullApplication_Name(t)];for(const i of t.versions[t.versions.length-1].entities)n=n.concat(this.buildSequences(e.__dbApplication__,i))}return await this.sequenceDao.save(n,t),n}stageSequences(e,t){console.log("stageSequences");let n=[];for(const t of e){const e=this.airportDatabase.QM[this.dbApplicationUtils.getFullApplication_Name(t)];for(const i of t.versions[t.versions.length-1].entities)n=n.concat(this.buildSequences(e.__dbApplication__,i))}return n}buildSequences(e,t){const n=[];for(const i of t.columns){if(!i.isGenerated)continue;let o=i.allocationSize;o||(o=100),n.push({applicationIndex:e.index,tableIndex:t.index,columnIndex:i.index,incrementBy:o,currentValue:0})}return n}getIndexSql(e,t,n,i){let o;return o=i?" UNIQUE":"",`CREATE${o} INDEX ${e}\n    ON ${t} (\n    ${n.join(", ")}\n    )`}getForeignKeySql(e,t,n,i,o){return null}};Qm([function(e,t){}],Wm.prototype,"airportDatabase",void 0),Wm=Qm([function(e){}],Wm),Cm.setClass(Wm);class zm extends class{constructor(e,t){this.driver=e,this.parentTransaction=t,this.isSync=!1,this.initiator={application:"",domain:"",methodName:"",objectName:""},this.__container__=e.__container__,this.id=sr(),this.type=e.type,t&&(t.childTransaction=this)}async query(e,t,n=[],i,o=!1){return this.driver.query(e,t,n,i,o)}async doesTableExist(e,t,n){return await this.driver.doesTableExist(e,t,n)}async dropTable(e,t,n){return await this.driver.dropTable(e,t,n)}getEntityTableName(e,t){return this.driver.getEntityTableName(e,t)}getSelectQuerySuffix(e,t){return this.driver.getSelectQuerySuffix(e,t)}getTableName(e,t,n){return this.driver.getTableName(e,t,n)}async initialize(e,t){}async startTransaction(e,t){throw new Error("Nested transactions are not supported")}async setupTransaction(e,t){throw new Error("Nested transactions are not supported")}async tearDownTransaction(e,t){throw new Error("Nested transactions are not supported")}async commit(e,t){await this.driver.commit(this,t)}async rollback(e,t){await this.driver.rollback(this,t)}async deleteWhere(e,t){return await this.driver.deleteWhere(e,t)}async find(e,t,n,i){return await this.driver.find(e,t,n,i)}async findOne(e,t,n,i){return await this.driver.findOne(e,t,n,i)}async findNative(e,t,n){return await this.driver.findNative(e,t,n)}async insertValues(e,t,n){return await this.driver.insertValues(e,t,n)}async updateWhere(e,t,n){return await this.driver.updateWhere(e,t,n)}isValueValid(e,t,n){return this.driver.isValueValid(e,t,n)}}{isServer(e){return!1}}var Jm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Km=class extends qm{constructor(){super(),this.type=Oe.SQLJS}async initialize(){const e=await initSqlJs({locateFile:e=>`./${e}`});this._db=new e.Database}async setupTransaction(e,t){const n=new zm(this,t);return await this.internalSetupTransaction(n,e),n}async internalStartTransaction(e,t){for(;!this._db;)await this.wait(50);const n=`SAVEPOINT '${e.id}'`;console.warn(n),this._db.exec(n)}async internalCommit(e,t){for(;!this._db;)await this.wait(50);const n=`RELEASE SAVEPOINT '${e.id}'`;console.warn(n),this._db.exec(n)}async internalRollback(e,t){for(;!this._db;)await this.wait(50);const n=`ROLLBACK TO SAVEPOINT '${e.id}'`;console.warn(n),this._db.exec(n)}async query(e,t,n=[],i,o=!1){for(;!this._db;)await this.wait(50);return new Promise(((e,i)=>{let o;try{["TQ_BOOLEAN_FIELD_CHANGE","TQ_DATE_FIELD_CHANGE","TQ_NUMBER_FIELD_CHANGE","TQ_STRING_FIELD_CHANGE","TQ_ENTITY_CHANGE","TQ_ENTITY_WHERE_CHANGE","TQ_TRANSACTION"].some((e=>t.indexOf(e)>-1))||(console.debug(t),console.debug(n)),o=this._db.prepare(t),o.bind(n);let i=[];for(;o.step();)i.push(o.get());console.debug(i),e(i)}catch(e){i(e)}finally{o&&o.free()}}))}handleError(e){throw e}getRows(e){return e}wait(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}getReturnValue(e,t){switch(e){case ge.MUTATE:return t.rowsAffected;case ge.SELECT:return t.rows;default:return null}}getDialect(){return dd.SQLITE}};Km=Jm([function(e){}],Km);var Zm=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Xm=class extends class{constructor(){this.functionAdaptor=new Ym}getParameterReference(e,t){return"?"}dateToDbQuery(e){return""+e.getTime()}getResultArray(e){return e.res.rows}getResultCellValue(e,t,n,i,o){let r=this.getResultCellRawValue(e,t,n,i,o);switch(i){case fe.BOOLEAN:if(null!==r)return!!r;break;case fe.DATE:if(null!==r)return new Date(r);break;case fe.JSON:if(null!==r)return JSON.parse(r);break;case fe.ANY:case fe.NUMBER:case fe.STRING:return r;default:throw new Error(`Unexpected data type for column ${t}`)}}getFunctionAdaptor(){return this.functionAdaptor}getOffsetFragment(e){return`\nOFFSET\n\t${e}`}getLimitFragment(e){return`\nLIMIT\n\t${e}`}getParameterValue(e){return this.getValue(e.value)}getValue(e,t=!0){switch(typeof e){case"boolean":return e?"1":"0";case"number":case"string":return e;case"object":if(e instanceof Date)return e.getTime();if(e instanceof Array)return e.map((e=>this.getValue(e,!1)));throw new Error("Unexpected object as a parameter.");default:throw new Error(`Unexpected type of parameter '${typeof e}.'`)}}}{getResultCellRawValue(e,t,n,i,o){return e[n]}};Xm=Zm([function(e){}],Xm),Oc.setClass(Km),Pd.setClass(Xm),console.log("injecting SequenceGenerator"),console.log("Injecting TransactionalReceiver"),console.log("Injecting TransactionalConnector"),console.log("Injecting AirportDatabase"),console.log("Injecting TransactionalServer"),console.log("inject EntityStateManager"),W.getSync(Nc).getWebReceiver().localDomain="localhost:31717";const eI=new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),O(this,e,w,null,r,{})}}({target:document.body,props:{}});(async function(){await async function(e){const t=await W.get(fy);await t.initWithDb(e,{})}("AIRportA-demo-demo-demo-functionalty"),await W.get(Bm)})().then();export{eI as default};
//# sourceMappingURL=main.js.map
