function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e){e.parentNode.removeChild(e)}let s;function c(e){s=e}function l(e){(function(){if(!s)throw new Error("Function called outside component initialization");return s})().$$.on_mount.push(e)}const p=[],d=[],u=[],f=[],y=Promise.resolve();let h=!1;function m(e){u.push(e)}let R=!1;const I=new Set;function E(){if(!R){R=!0;do{for(let e=0;e<p.length;e+=1){const t=p[e];c(t),g(t.$$)}for(c(null),p.length=0;d.length;)d.pop()();for(let e=0;e<u.length;e+=1){const t=u[e];I.has(t)||(I.add(t),t())}u.length=0}while(p.length);for(;f.length;)f.pop()();h=!1,R=!1,I.clear()}}function g(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(m)}}const O=new Set;function T(e,t){-1===e.$$.dirty[0]&&(p.push(e),h||(h=!0,y.then(E)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function w(r,l,p,d,u,f,y,h=[-1]){const R=s;c(r);const I=r.$$={fragment:null,ctx:null,props:f,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(R?R.$$.context:l.context||[]),callbacks:n(),dirty:h,skip_bound:!1,root:l.target||R.$$.root};y&&y(I.root);let g=!1;if(I.ctx=p?p(r,l.props||{},((e,t,...n)=>{const i=n.length?n[0]:t;return I.ctx&&u(I.ctx[e],I.ctx[e]=i)&&(!I.skip_bound&&I.bound[e]&&I.bound[e](i),g&&T(r,e)),t})):[],I.update(),g=!0,i(I.before_update),I.fragment=!!d&&d(I.ctx),l.target){if(l.hydrate){const e=(N=l.target,Array.from(N.childNodes));I.fragment&&I.fragment.l(e),e.forEach(a)}else I.fragment&&I.fragment.c();l.intro&&((w=r.$$.fragment)&&w.i&&(O.delete(w),w.i(b))),function(e,n,r,a){const{fragment:s,on_mount:c,on_destroy:l,after_update:p}=e.$$;s&&s.m(n,r),a||m((()=>{const n=c.map(t).filter(o);l?l.push(...n):i(n),e.$$.on_mount=[]})),p.forEach(m)}(r,l.target,l.anchor,l.customElement),E()}var w,b,N;c(R)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function b(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})})),t}function N(e){var t={exports:{}};return e(t,t.exports),t.exports}var _=N((function(e,t){e.exports=function(){var e=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},t=I,n=s,i=c,o=l,r=R,a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function s(e){for(var t,n=[],i=0,o=0,r="";null!=(t=a.exec(e));){var s=t[0],c=t[1],l=t.index;if(r+=e.slice(o,l),o=l+s.length,c)r+=c[1];else{r&&(n.push(r),r="");var p=t[2],u=t[3],f=t[4],y=t[5],h=t[6],m=t[7],R="+"===h||"*"===h,I="?"===h||"*"===h,E=p||"/",g=f||y||(m?".*":"[^"+E+"]+?");n.push({name:u||i++,prefix:p||"",delimiter:E,optional:I,repeat:R,pattern:d(g)})}}return o<e.length&&(r+=e.substr(o)),r&&n.push(r),n}function c(e){return l(s(e))}function l(t){for(var n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof t[i]&&(n[i]=new RegExp("^"+t[i].pattern+"$"));return function(i){for(var o="",r=i||{},a=0;a<t.length;a++){var s=t[a];if("string"!=typeof s){var c,l=r[s.name];if(null==l){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to be defined')}if(e(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received "'+l+'"');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(c=encodeURIComponent(l[p]),!n[a].test(c))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received "'+c+'"');o+=(0===p?s.prefix:s.delimiter)+c}}else{if(c=encodeURIComponent(l),!n[a].test(c))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+c+'"');o+=s.prefix+c}}else o+=s}return o}}function p(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function d(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function u(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function y(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u(e,t)}function h(e,t,n){for(var i=[],o=0;o<e.length;o++)i.push(I(e[o],t,n).source);return u(new RegExp("(?:"+i.join("|")+")",f(n)),t)}function m(e,t,n){for(var i=s(e),o=R(i,n),r=0;r<i.length;r++)"string"!=typeof i[r]&&t.push(i[r]);return u(o,t)}function R(e,t){for(var n=(t=t||{}).strict,i=!1!==t.end,o="",r=e[e.length-1],a="string"==typeof r&&/\/$/.test(r),s=0;s<e.length;s++){var c=e[s];if("string"==typeof c)o+=p(c);else{var l=p(c.prefix),d=c.pattern;c.repeat&&(d+="(?:"+l+d+")*"),o+=d=c.optional?l?"(?:"+l+"("+d+"))?":"("+d+")?":l+"("+d+")"}}return n||(o=(a?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=i?"$":n&&a?"":"(?=\\/|$)",new RegExp("^"+o,f(t))}function I(t,n,i){return e(n=n||[])?i||(i={}):(i=n,n=[]),t instanceof RegExp?y(t,n):e(t)?h(t,n,i):m(t,n,i)}t.parse=n,t.compile=i,t.tokensToFunction=o,t.tokensToRegExp=r;var E,g="undefined"!=typeof document,O="undefined"!=typeof window,T="undefined"!=typeof history,w="undefined"!=typeof process,b=g&&document.ontouchstart?"touchstart":"click",N=O&&!(!window.history.location&&!window.location);function _(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function x(){var e=new _;function t(){return A.apply(e,arguments)}return t.callbacks=e.callbacks,t.exits=e.exits,t.base=e.base.bind(e),t.strict=e.strict.bind(e),t.start=e.start.bind(e),t.stop=e.stop.bind(e),t.show=e.show.bind(e),t.back=e.back.bind(e),t.redirect=e.redirect.bind(e),t.replace=e.replace.bind(e),t.dispatch=e.dispatch.bind(e),t.exit=e.exit.bind(e),t.configure=e.configure.bind(e),t.sameOrigin=e.sameOrigin.bind(e),t.clickHandler=e.clickHandler.bind(e),t.create=x,Object.defineProperty(t,"len",{get:function(){return e.len},set:function(t){e.len=t}}),Object.defineProperty(t,"current",{get:function(){return e.current},set:function(t){e.current=t}}),t.Context=C,t.Route=D,t}function A(e,t){if("function"==typeof e)return A.call(this,"*",e);if("function"==typeof t)for(var n=new D(e,null,this),i=1;i<arguments.length;++i)this.callbacks.push(n.middleware(arguments[i]));else"string"==typeof e?this["string"==typeof t?"redirect":"show"](e,t):this.start(e)}function v(e){if(!e.handled){var t=this,n=t._window;(t._hashbang?N&&this._getBase()+n.location.hash.replace("#!",""):N&&n.location.pathname+n.location.search)!==e.canonicalPath&&(t.stop(),e.handled=!1,N&&(n.location.href=e.canonicalPath))}}function S(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function C(e,t,n){var i=this.page=n||A,o=i._window,r=i._hashbang,a=i._getBase();"/"===e[0]&&0!==e.indexOf(a)&&(e=a+(r?"#!":"")+e);var s=e.indexOf("?");this.canonicalPath=e;var c=new RegExp("^"+S(a));if(this.path=e.replace(c,"")||"/",r&&(this.path=this.path.replace("#!","")||"/"),this.title=g&&o.document.title,this.state=t||{},this.state.path=e,this.querystring=~s?i._decodeURLEncodedURIComponent(e.slice(s+1)):"",this.pathname=i._decodeURLEncodedURIComponent(~s?e.slice(0,s):e),this.params={},this.hash="",!r){if(!~this.path.indexOf("#"))return;var l=this.path.split("#");this.path=this.pathname=l[0],this.hash=i._decodeURLEncodedURIComponent(l[1])||"",this.querystring=this.querystring.split("#")[0]}}function D(e,n,i){var o=this.page=i||M,r=n||{};r.strict=r.strict||o._strict,this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=t(this.path,this.keys=[],r)}_.prototype.configure=function(e){var t=e||{};this._window=t.window||O&&window,this._decodeURLComponents=!1!==t.decodeURLComponents,this._popstate=!1!==t.popstate&&O,this._click=!1!==t.click&&g,this._hashbang=!!t.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):O&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(b,this.clickHandler,!1):g&&n.document.removeEventListener(b,this.clickHandler,!1),this._hashbang&&O&&!T?n.addEventListener("hashchange",this._onpopstate,!1):O&&n.removeEventListener("hashchange",this._onpopstate,!1)},_.prototype.base=function(e){if(0===arguments.length)return this._base;this._base=e},_.prototype._getBase=function(){var e=this._base;if(e)return e;var t=O&&this._window&&this._window.location;return O&&this._hashbang&&t&&"file:"===t.protocol&&(e=t.pathname),e},_.prototype.strict=function(e){if(0===arguments.length)return this._strict;this._strict=e},_.prototype.start=function(e){var t=e||{};if(this.configure(t),!1!==t.dispatch){var n;if(this._running=!0,N){var i=this._window.location;n=this._hashbang&&~i.hash.indexOf("#!")?i.hash.substr(2)+i.search:this._hashbang?i.search+i.hash:i.pathname+i.search+i.hash}this.replace(n,null,!0,t.dispatch)}},_.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var e=this._window;this._click&&e.document.removeEventListener(b,this.clickHandler,!1),O&&e.removeEventListener("popstate",this._onpopstate,!1),O&&e.removeEventListener("hashchange",this._onpopstate,!1)}},_.prototype.show=function(e,t,n,i){var o=new C(e,t,this),r=this.prevContext;return this.prevContext=o,this.current=o.path,!1!==n&&this.dispatch(o,r),!1!==o.handled&&!1!==i&&o.pushState(),o},_.prototype.back=function(e,t){var n=this;if(this.len>0){var i=this._window;T&&i.history.back(),this.len--}else e?setTimeout((function(){n.show(e,t)})):setTimeout((function(){n.show(n._getBase(),t)}))},_.prototype.redirect=function(e,t){var n=this;"string"==typeof e&&"string"==typeof t&&A.call(this,e,(function(e){setTimeout((function(){n.replace(t)}),0)})),"string"==typeof e&&void 0===t&&setTimeout((function(){n.replace(e)}),0)},_.prototype.replace=function(e,t,n,i){var o=new C(e,t,this),r=this.prevContext;return this.prevContext=o,this.current=o.path,o.init=n,o.save(),!1!==i&&this.dispatch(o,r),o},_.prototype.dispatch=function(e,t){var n=0,i=0,o=this;function r(){var e=o.exits[i++];if(!e)return a();e(t,r)}function a(){var t=o.callbacks[n++];if(e.path===o.current)return t?void t(e,a):v.call(o,e);e.handled=!1}t?r():a()},_.prototype.exit=function(e,t){if("function"==typeof e)return this.exit("*",e);for(var n=new D(e,null,this),i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},_.prototype.clickHandler=function(e){if(1===this._which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var t=e.target,n=e.path||(e.composedPath?e.composedPath():null);if(n)for(var i=0;i<n.length;i++)if(n[i].nodeName&&"A"===n[i].nodeName.toUpperCase()&&n[i].href){t=n[i];break}for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(t&&"A"===t.nodeName.toUpperCase()){var o="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(!t.hasAttribute("download")&&"external"!==t.getAttribute("rel")){var r=t.getAttribute("href");if((this._hashbang||!this._samePath(t)||!t.hash&&"#"!==r)&&!(r&&r.indexOf("mailto:")>-1)&&!(o?t.target.baseVal:t.target)&&(o||this.sameOrigin(t.href))){var a=o?t.href.baseVal:t.pathname+t.search+(t.hash||"");a="/"!==a[0]?"/"+a:a,w&&a.match(/^\/[a-zA-Z]:\//)&&(a=a.replace(/^\/[a-zA-Z]:\//,"/"));var s=a,c=this._getBase();0===a.indexOf(c)&&(a=a.substr(c.length)),this._hashbang&&(a=a.replace("#!","")),(!c||s!==a||N&&"file:"===this._window.location.protocol)&&(e.preventDefault(),this.show(s))}}}}},_.prototype._onpopstate=(E=!1,O?(g&&"complete"===document.readyState?E=!0:window.addEventListener("load",(function(){setTimeout((function(){E=!0}),0)})),function(e){if(E){var t=this;if(e.state){var n=e.state.path;t.replace(n,e.state)}else if(N){var i=t._window.location;t.show(i.pathname+i.search+i.hash,void 0,void 0,!1)}}}):function(){}),_.prototype._which=function(e){return null==(e=e||O&&this._window.event).which?e.button:e.which},_.prototype._toURL=function(e){var t=this._window;if("function"==typeof URL&&N)return new URL(e,t.location.toString());if(g){var n=t.document.createElement("a");return n.href=e,n}},_.prototype.sameOrigin=function(e){if(!e||!N)return!1;var t=this._toURL(e),n=this._window.location;return n.protocol===t.protocol&&n.hostname===t.hostname&&(n.port===t.port||""===n.port&&(80==t.port||443==t.port))},_.prototype._samePath=function(e){if(!N)return!1;var t=this._window.location;return e.pathname===t.pathname&&e.search===t.search},_.prototype._decodeURLEncodedURIComponent=function(e){return"string"!=typeof e?e:this._decodeURLComponents?decodeURIComponent(e.replace(/\+/g," ")):e},C.prototype.pushState=function(){var e=this.page,t=e._window,n=e._hashbang;e.len++,T&&t.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},C.prototype.save=function(){var e=this.page;T&&e._window.history.replaceState(this.state,this.title,e._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},D.prototype.middleware=function(e){var t=this;return function(n,i){if(t.match(n.path,n.params))return n.routePath=t.path,e(n,i);i()}},D.prototype.match=function(e,t){var n=this.keys,i=e.indexOf("?"),o=~i?e.slice(0,i):e,r=this.regexp.exec(decodeURIComponent(o));if(!r)return!1;delete t[0];for(var a=1,s=r.length;a<s;++a){var c=n[a-1],l=this.page._decodeURLEncodedURIComponent(r[a]);void 0===l&&hasOwnProperty.call(t,c.name)||(t[c.name]=l)}return!0};var M=x(),V=M,P=M;return V.default=P,V}()}));function x(e){var t=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};return _("/:uiPath",(e=>{console.log(e)})),_(),l((()=>t(void 0,void 0,void 0,(function*(){})))),[]}class A{constructor(e){this.name=e,this.applicationMap={}}app(e){if(this.applicationMap[e])throw new Error(`\n\t\t\tApplication already defined.\n\t\t\tDomain:      ${this.name}\n\t\t\tApplication: ${e}\n\t\t\t`);const t=new M(e,this);return this.applicationMap[e]=t,t}getApp(e){return this.applicationMap[e]}}const v={};function S(e){if(v[e])return v[e];const t=new A(e);return v[e]=t,t}const C=S("turbase.app");class D{constructor(e,t){this.application=e,this.descriptor=t}get dependencyConfiguration(){return this.getInheritedDependencyConfiguration(this.descriptor.class)}getPath(){return this.application.domain.name+":"+this.application.name+":"+this.descriptor.token}setDependencies(e){this._dependencyConfiguration?this._dependencyConfiguration={...this._dependencyConfiguration,...e}:this._dependencyConfiguration=e,this.descriptor.class&&(this.descriptor.class.dependencyConfiguration?this.descriptor.class.dependencyConfiguration={...this.descriptor.class.dependencyConfiguration,...e}:this.descriptor.class.dependencyConfiguration=e)}setClass(e){this.descriptor.class=e,e.dependencyConfiguration=this._dependencyConfiguration}getInheritedDependencyConfiguration(e){const t=Object.getPrototypeOf(e);let n={};t&&(n=this.getInheritedDependencyConfiguration(t));const i=e.dependencyConfiguration;return i&&(n={...n,...i}),n}}class M{constructor(e,t){this.name=e,this.domain=t,this.tokenMap=new Map,this.autopilot=!1}token(e){if(this.tokenMap.get(e.token))throw new Error(`Token with name '${name}' has already been created`);const t=new D(this,e);return this.tokenMap.set(e.token,t),t}}function V(e){return C.app(e)}var P;!function(e){e.DB="DB",e.UI="UI"}(P||(P={}));class L{constructor(e,t){this.id=e,this.type=t}}const U=V("direction-indicator").token({class:null,interface:"IAutopilotApiLoader",token:"AUTOPILOT_API_LOADER"});class j{}class F extends j{constructor(e,t){super(),this.rootContainer=e,this.context=t,this.objectMap=new Map}doEventuallyGet(e,t,n){let{firstDiNotSetClass:i,firstMissingClassToken:o,objects:r}=this.doGetCore(e);o||i?setTimeout((()=>{this.doEventuallyGet(e,t,n)}),100):r.length>1?t(r):t(r[0])}doGet(e,t,n){const{firstDiNotSetClass:i,firstMissingClassToken:o,objects:r}=this.doGetCore(e);if(i)return console.log(`Dependency Injection is not ready for token ${o.getPath()}\n\t\t\t, class: ${i.name}. Delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100);if(r.filter((e=>e&&!e.__initialized__)).length){const i=r.map(((e,t)=>e.__initialized__?-1:t)).filter((e=>-1!==e)),o=[];for(const t of i)o.push(e[t].getPath());return console.log(`Dependency Injection is not ready for tokens:\n\t\t\t\t ${o.join("\n")}\n\t\t\t, these classes are not yet initialized, delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100)}if(o){const e="Dependency Injection could not find class for token: "+o.getPath();console.log(e),n(e)}else r.length>1?t(r):t(r[0])}doGetCore(e){let t,n;const i=e.map((e=>{if(t||n)return;let i=this.objectMap.get(e.descriptor.token);if(!i){if(!this.rootContainer.isFramework&&e.application.autopilot)i=this.getSync(U).loadApiAutopilot(e);else{const o=e.descriptor.class;if(!o)return void(t=e);if(o.diSet&&!o.diSet())return t=e,void(n=o);i=new o,this.setDependencyGetters(i,e)}if(i.__container__=this,this.objectMap.set(e.descriptor.token,i),!e.application.autopilot&&i.init){const t=i.init();t instanceof Promise?t.then((t=>{i.__initialized__=!0,console.log(`${e.getPath()} initialized.`)})):(i.__initialized__=!0,console.log(`${e.getPath()} initialized.`))}else i.__initialized__=!0}return i}));return{firstDiNotSetClass:n,firstMissingClassToken:t,objects:i}}setDependencyGetters(e,t){if(!t.dependencyConfiguration)return;const n=t.dependencyConfiguration;for(let t in n){delete e[t];const i=n[t];Object.defineProperty(e,t,{get(){return this.__container__,this.__container__.getSync(i)}}),e["get"+t+"Async"]=async function(){await this.get(i)}}}async getByNames(e,t,n){if(!S(e))throw new Error(`Could nof find\n\tDomain:\n\t\t${e}\n\t\t`);const i=S(e).getApp(t);if(!i)throw new Error(`Could not find\n\tDomain:\n\t\t${e}\n\tApplication:\n\t\t${t}\n\t\t`);const o=i.tokenMap.get(n);if(!o)throw new Error(`Could not find token: ${n}\n\tin Domain:\n\t\t${e}\n \tApplication:\n\t\t\t${t}\n\t\t`);return await this.get(o)}get(...e){return new Promise(((t,n)=>{this.doGet(e,t,n)}))}eventuallyGet(...e){return new Promise(((t,n)=>{this.doEventuallyGet(e,t,n)}))}getSync(...e){const{firstDiNotSetClass:t,firstMissingClassToken:n,objects:i}=this.doGetCore(e);if(n)throw new Error("Dependency Injection could not find class for token: "+n.getPath());if(t)throw new Error("Dependency Injection is not ready for class: "+t.name);return i.length>1?i:i[0]}}const k=new class extends j{constructor(){super(...arguments),this.isFramework=!1,this.uiContainers=new Set}db(e=null){let t=this.dbContainerMap.get(e);return t||(t=new F(this,new L(e,P.DB)),this.dbContainerMap.set(e,t)),t}remove(e){if(!e)return;this.dbContainerMap.get(e.context.id)?this.dbContainerMap.delete(e.context.id):this.uiContainers.delete(e)}ui(e){const t=new L(e,P.UI),n=new F(this,t);return this.uiContainers.add(n),n}};function B(e){const t=e.__container__;if(!t)throw new Error('"container" is not set on injectable object.');if(!(t instanceof j))throw new Error('"container" property of injectable is not aninstance of @airport/direction-indicator Container');return t}"undefined"!=typeof window&&(window.DEPENDENCY_INJECTION=k,window.lib=V,window.domain=S);const H=new class{async get(...e){return await k.db().get(...e)}async eventuallyGet(...e){return await k.db().eventuallyGet(...e)}getSync(...e){return k.db().getSync(...e)}};var $,G;!function(e){e.GO_ONLINE="GO_ONLINE",e.REMOTE="REMOTE",e.LOCAL="LOCAL"}($||($={})),function(e){e.NOT_REPOSITORY_ENTITY="NOT_REPOSITORY_ENTITY",e.REPOSITORY_ENTITY="REPOSITORY_ENTITY"}(G||(G={}));class q{constructor(e,t={}){this.applicationVersionId=e,this.tableMap=t}ensure(e,t=!1,n=Y){let i=this.tableMap[e];return i||(i=new n(e,t),this.tableMap[e]=i),i}existsByStructure(e,t){let n=this.tableMap[e];return!!n&&!!n.columnMap[t]}}class Y{constructor(e,t=!1){this.tableIndex=e,this.columnMap={},t&&(this.columnMap.A=!0)}ensure(e){this.columnMap[e]=!0}}function Q({domain:e,name:t}){return e.name&&(e=e.name),J(e,t)}function J(e,t){if(e.indexOf("___")>-1)throw new Error('Domain Name cannot contain "___" (3 consecutive underscores) in it.');if(e.endsWith(".")||e.endsWith("-")||e.endsWith(":")||e.endsWith("__"))throw new Error('Domain Name cannot end with ".", "-", ":" or "__"');const n=e.replace(/\./g,"_dot_").replace(/-/g,"_dash_").replace(/:/g,"_colon_");if(n.indexOf("___")>-1)throw new Error('Domain Name cannot have with ".", "-", ":", or "_" right next to each other.');if(t.indexOf("_")>-1)throw new Error('Application Name cannot contain "_" in it.');if(t.indexOf("@")!==t.lastIndexOf("@"))throw new Error('Application Name cannot have more than one "@" in it.');if(t.indexOf("@")>0)throw new Error('Application Name cannot contain "@" after the first character in it.');if(t.indexOf("/")!==t.lastIndexOf("/"))throw new Error('Application Name cannot have more than one "/" in it.');const i=t.replace(/@/g,"_at_").replace(/\//g,"_slash_").replace(/-/g,"_dash_");if(i.endsWith("_"))throw new Error('Application Name cannot end with "@", "/" or "."');if(i.indexOf("___")>-1)throw new Error('Application Name cannot have with "@", "/", "." or "_" right next to each other.');return`${n}___${i}`}class W{constructor(e={}){this.applicationMap=e}ensureEntity(e,t=!1,n=q){return this.ensure(e.applicationVersion.id,e.index,t,n)}ensure(e,t,n=!1,i=q){let o=this.applicationMap[e];return o||(o=new i(e),this.applicationMap[e]=o),o.ensure(t,n)}existsByStructure(e,t,n){let i=this.applicationMap[e];return!!i&&i.existsByStructure(t,n)}}class z extends Y{constructor(e,t=!1){super(e,t)}}class K extends q{constructor(e,t){super(e,t)}ensureEntity(e,t=!1){return super.ensure(e,t,z)}intersects(e){for(let t in this.tableMap)if(e.tableMap[t]){let n=this.tableMap[t],i=e.tableMap[t];if(n.A||n.A)return!0;for(let e in n.columnMap)if(i.columnMap[e])return!0}return!1}}class X extends W{constructor(e){super(e)}ensureEntity(e,t=!1){return super.ensureEntity(e,t,K)}intersects(e){for(const t in this.applicationMap)if(e.applicationMap[t]){if(new K(parseInt(t),this.applicationMap[t].tableMap).intersects(e.applicationMap[t]))return!0}return!1}}var Z,ee,te,ne,ie,oe,re,ae,se,ce,le,pe,de,ue,fe,ye,he,me,Re,Ie,Ee,ge,Oe,Te,we,be,Ne,_e,xe,Ae,ve,Se,Ce,De,Me,Ve,Pe;function Le(e,t){let n;return n=e instanceof Map?e.get(t):e[t],n||(n=[],e instanceof Map?e.set(t,n):e[t]=n),n}function Ue(e,t){let n;return e instanceof Map?(n=e.get(t),n||(n={},e.set(t,n))):(n=e[t],n||(n={},e[t]=n)),n}function je(e,t){let n=e.get(t);return n||(n=new Map,e.set(t,n)),n}function Fe(e,t){let n=e.get(t);return n||(n=new Set,e.set(t,n)),n}function ke(e){return void 0===e?null:e}!function(e){e.SYNCHRONIZING="SYNCHRONIZING",e.SYNCHRONIZED="SYNCHRONIZED",e.REQUESTING_SYNC_STATUS="REQUESTING_SYNC_STATUS",e.RESYNC_REQUESTED="RESYNC_REQUESTED"}(Z||(Z={})),function(e){e.ACTIVE="ACTIVE",e.PENDING="PENDING",e.DELAYED="DELAYED",e.SUSPENDED="SUSPENDED",e.TEMPORARILY_REROUTED="TEMPORARILY_REROUTED",e.PERMANENTLY_REROUTED="PERMANENTLY_REROUTED"}(ee||(ee={})),function(e){e.ACTIVE="ACTIVE",e.SUSPENDED="SUSPENDED"}(te||(te={})),function(e){var t;e.NAME="name",(t=e.type||(e.type={})).ANY="any",t.BOOLEAN="boolean",t.DATE="Date",t.NUMBER="number",t.STRING="string"}(ne||(ne={})),function(e){e.ENTITY="Entity",e.TABLE="Table"}(ie||(ie={})),function(e){e.DATABASES="databases"}(oe||(oe={})),function(e){e.DEFINITION="foreignKeyDefinition",e.NAME="name",e.VALUE="value"}(re||(re={})),function(e){e.COLUMN_LIST="columnList",e.NAME="name",e.UNIQUE="unique"}(ae||(ae={})),function(e){e.FOREIGN_KEY="foreignKey",e.REFERENCED_COLUMN_NAME="referencedColumnName",e.VALUE="value"}(se||(se={})),function(e){e.COLUMN="Column",e.ENUM_TYPE="Enum",e.ID="Id",e.JOIN_COLUMN="JoinColumn",e.JOIN_COLUMNS="JoinColumns",e.JSON_TYPE="Json",e.MANY_TO_ONE="ManyToOne",e.ONE_TO_MANY="OneToMany",e.SUB_QUERY="SubQuery"}(ce||(ce={})),function(e){e.MAPPED_BY="mappedBy"}(le||(le={})),function(e){e.INDEXES="indexes",e.NAME="name",e.PRIMARY_KEY="primaryKey",e.APPLICATION="application"}(pe||(pe={})),function(e){e.ACTOR_ID="ACTOR_ID",e.ACTOR_RECORD_ID="ACTOR_RECORD_ID",e.ENTITY_NAME="RepositoryEntity",e.FOREIGN_KEY="REPOSITORY_ID",e.LOCAL_ENTITY_NAME="LocalRepositoryEntity",e.REPOSITORY_ID="REPOSITORY_ID",e.ORIGINAL_ACTOR_ID="ORIGINAL_ACTOR_ID",e.ORIGINAL_ACTOR_RECORD_ID="ORIGINAL_ACTOR_RECORD_ID",e.ORIGINAL_REPOSITORY_ID="ORIGINAL_REPOSITORY_ID",e.SYS_WIDE_OP_ID_APPLICATION="air____at_airport_slash_airport_dash_code",e.SYS_WIDE_OP_ID_ENTITY="SystemWideOperationId",e.systemWideOperationId="systemWideOperationId",e.SYSTEM_WIDE_OPERATION_ID="SYSTEM_WIDE_OPERATION_ID"}(de||(de={})),function(e){e.FULL_JOIN="FULL_JOIN",e.INNER_JOIN="INNER_JOIN",e.LEFT_JOIN="LEFT_JOIN",e.RIGHT_JOIN="RIGHT_JOIN"}(ue||(ue={})),function(e){e.ONE_TO_MANY="ONE_TO_MANY",e.MANY_TO_ONE="MANY_TO_ONE"}(fe||(fe={})),function(e){e.ENTITY_JOIN_ON="ENTITY_JOIN_ON",e.ENTITY_APPLICATION_RELATION="ENTITY_APPLICATION_RELATION",e.ENTITY_ROOT="ENTITY_ROOT",e.SUB_QUERY_JOIN_ON="SUB_QUERY_JOIN_ON",e.SUB_QUERY_ROOT="SUB_QUERY_ROOT"}(ye||(ye={})),function(e){e.ASCENDING="ASCENDING",e.DESCENDING="DESCENDING"}(he||(he={})),function(e){e.ABS="ABS",e.AVG="AVG",e.COUNT="COUNT",e.MAX="MAX",e.MIN="MIN",e.SUM="SUM",e.UCASE="UCASE",e.LCASE="LCASE",e.MID="MID",e.LEN="LEN",e.ROUND="ROUND",e.NOW="NOW",e.FORMAT="FORMAT",e.REPLACE="REPLACE",e.TRIM="TRIM",e.DISTINCT="DISTINCT",e.EXISTS="EXISTS",e.DIVIDE="DIVIDE",e.MINUS="MINUS",e.MODULUS="MODULUS",e.MULTIPLY="MULTIPLY",e.PLUS="PLUS",e.CONCATENATE="CONCATENATE",e.COALESCE="COALESCE"}(me||(me={})),function(e){e.FIELD="FIELD",e.FIELD_FUNCTION="FIELD_FUNCTION",e.FIELD_QUERY="FIELD_QUERY",e.DISTINCT_FUNCTION="DISTINCT_FUNCTION",e.EXISTS_FUNCTION="EXISTS_FUNCTION",e.MANY_TO_ONE_RELATION="MANY_TO_ONE_RELATION"}(Re||(Re={})),function(e){e.ANY="ANY",e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.JSON="JSON",e.NUMBER="NUMBER",e.STRING="STRING"}(Ie||(Ie={})),function(e){e.CREATE="CREATE",e.DATE="DATE",e.DELETE="DELETE",e.PARENT_ID="PARENT_ID",e.PASS_THROUGH="PASS_THROUGH",e.STUB="STUB",e.UPDATE="UPDATE"}(Ee||(Ee={})),function(e){e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.FUNCTION="FUNCTION",e.LOGICAL="LOGICAL",e.NUMBER="NUMBER",e.STRING="STRING",e.UNTYPED="UNTYPED"}(ge||(ge={})),function(e){e.AND="AND",e.EQUALS="EQUALS",e.EXISTS="EXISTS",e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUALS="GREATER_THAN_OR_EQUALS",e.IN="IN",e.IS_NOT_NULL="IS_NOT_NULL",e.IS_NULL="IS_NULL",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUALS="LESS_THAN_OR_EQUALS",e.LIKE="LIKE",e.OR="OR",e.NOT="NOT",e.NOT_EQUALS="NOT_EQUALS",e.NOT_IN="NOT_IN"}(Oe||(Oe={})),function(e){e.CREATE="CREATE",e.READ="READ",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Te||(Te={})),function(e){e.LOCAL="LOCAL",e.REMOTE_SYNC="REMOTE_SYNC"}(we||(we={})),function(e){e.DELETE_ROWS="DELETE_ROWS",e.INSERT_VALUES="INSERT_VALUES",e.UPDATE_ROWS="UPDATE_ROWS"}(be||(be={})),function(e){e.S3_SECURE_POLL="S3_SECURE_POLL",e.S3_DISTIBUTED_PUSH="S3_DISTIBUTED_PUSH"}(Ne||(Ne={})),function(e){e.DDL="DDL",e.SELECT="SELECT",e.MUTATE="MUTATE"}(_e||(_e={})),function(e){e.GOOGLE_DOCS="GOOGLE_DOCS",e.IN_MEMORY="IN_MEMORY",e.OFFLINE="OFFLINE",e.STUB="STUB"}(xe||(xe={})),function(e){e.COCKROACHDB="COCKROACHDB",e.MYSQL="MYSQL",e.POSTGRESQL="POSTGRESQL",e.REMOTE="REMOTE",e.SQLITE="SQLITE",e.SQLJS="SQLJS",e.WEB_SQL="WEB_SQL"}(Ae||(Ae={})),function(e){e.ENTITY_CHANGE_ID="ENTITY_CHANGE_ID"}(ve||(ve={})),function(e){e.ENTITY_QUERY="ENTITY_QUERY",e.NON_ENTITY_QUERY="NON_ENTITY_QUERY"}(Se||(Se={})),function(e){e.ENTITY_GRAPH="ENTITY_GRAPH",e.ENTITY_TREE="ENTITY_TREE",e.TREE="TREE",e.SHEET="SHEET",e.FIELD="FIELD",e.RAW="RAW",e.MAPPED_ENTITY_GRAPH="MAPPED_ENTITY_GRAPH",e.MAPPED_ENTITY_TREE="MAPPED_ENTITY_TREE"}(Ce||(Ce={})),function(e){e.DELETE="DELETE",e.FIND_ONE_GRAPH="FIND_ONE_GRAPH",e.FIND_ONE_TREE="FIND_ONE_TREE",e.FIND_GRAPH="FIND_GRAPH",e.FIND_TREE="FIND_TREE",e.SAVE="SAVE",e.SEARCH_ONE_GRAPH="SEARCH_ONE_GRAPH",e.SEARCH_ONE_TREE="SEARCH_ONE_TREE",e.SEARCH_GRAPH="SEARCH_GRAPH",e.SEARCH_TREE="SEARCH_TREE"}(De||(De={})),function(e){e.PARAMETER="PARAMETER",e.Q="Q",e.QENTITY="QENTITY"}(Me||(Me={})),function(e){e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.NUMBER="NUMBER",e.STRING="STRING"}(Ve||(Ve={})),function(e){e.CURRENT="CURRENT",e.MISSING="MISSING",e.NEEDS_UPGRADES="NEEDS_UPGRADES",e.STUB="STUB"}(Pe||(Pe={}));const Be=V("ground-control"),He=Be.token({class:null,interface:"IEntityStateManager",token:"ENTITY_STATE_MANAGER"});Be.token({class:null,interface:"IInterAppAPIClient",token:"INTER_APP_API_CLIENT"});const $e=Be.token({class:null,interface:"IOperationContextLoader",token:"OPERATION_CONTEXT_LOADER"}),Ge=Be.token({class:null,interface:"ITransactionalConnector",token:"TRANSACTIONAL_CONNECTOR"});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var qe=function(e,t){return(qe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Ye(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}qe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Qe(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function Je(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function We(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ze(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function Ke(e,t){for(var n=0,i=t.length,o=e.length;n<i;n++,o++)e[o]=t[n];return e}function Xe(e){return this instanceof Xe?(this.v=e,this):new Xe(e)}function Ze(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=n.apply(e,t||[]),r=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){o[e]&&(i[e]=function(t){return new Promise((function(n,i){r.push([e,t,n,i])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof Xe?Promise.resolve(n.value.v).then(c,l):p(r[0][2],n)}catch(e){p(r[0][3],e)}var n}function c(e){s("next",e)}function l(e){s("throw",e)}function p(e,t){e(t),r.shift(),r.length&&s(r[0][0],r[0][1])}}function et(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=We(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,o){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,o,(t=e[n](t)).done,t.value)}))}}}function tt(e){return"function"==typeof e}function nt(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var it=nt((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ot(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var rt=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,i,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=We(r),s=a.next();!s.done;s=a.next()){s.value.remove(this)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else r.remove(this);var c=this.initialTeardown;if(tt(c))try{c()}catch(e){o=e instanceof it?e.errors:[e]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var p=We(l),d=p.next();!d.done;d=p.next()){var u=d.value;try{ct(u)}catch(e){o=null!=o?o:[],e instanceof it?o=Ke(Ke([],ze(o)),ze(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new it(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ct(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ot(t,e)},e.prototype.remove=function(t){var n=this._teardowns;n&&ot(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),at=rt.EMPTY;function st(e){return e instanceof rt||e&&"closed"in e&&tt(e.remove)&&tt(e.add)&&tt(e.unsubscribe)}function ct(e){tt(e)?e():e.unsubscribe()}var lt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},pt={setTimeout:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=pt.delegate;return((null==n?void 0:n.setTimeout)||setTimeout).apply(void 0,Ke([],ze(e)))},clearTimeout:function(e){var t=pt.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function dt(e){pt.setTimeout((function(){var t=lt.onUnhandledError;if(!t)throw e;t(e)}))}function ut(){}var ft=yt("C",void 0,void 0);function yt(e,t,n){return{kind:e,value:t,error:n}}var ht=null;function mt(e){if(lt.useDeprecatedSynchronousErrorHandling){var t=!ht;if(t&&(ht={errorThrown:!1,error:null}),e(),t){var n=ht,i=n.errorThrown,o=n.error;if(ht=null,i)throw o}}else e()}function Rt(e){lt.useDeprecatedSynchronousErrorHandling&&ht&&(ht.errorThrown=!0,ht.error=e)}var It=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,st(t)&&t.add(n)):n.destination=wt,n}return Ye(t,e),t.create=function(e,t,n){return new Et(e,t,n)},t.prototype.next=function(e){this.isStopped?Tt(function(e){return yt("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Tt(yt("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Tt(ft,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(rt),Et=function(e){function t(t,n,i){var o,r=e.call(this)||this;if(tt(t))o=t;else if(t){var a;o=t.next,n=t.error,i=t.complete,r&&lt.useDeprecatedNextContext?(a=Object.create(t)).unsubscribe=function(){return r.unsubscribe()}:a=t,o=null==o?void 0:o.bind(a),n=null==n?void 0:n.bind(a),i=null==i?void 0:i.bind(a)}return r.destination={next:o?gt(o):ut,error:gt(null!=n?n:Ot),complete:i?gt(i):ut},r}return Ye(t,e),t}(It);function gt(e,t){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{e.apply(void 0,Ke([],ze(t)))}catch(e){lt.useDeprecatedSynchronousErrorHandling?Rt(e):dt(e)}}}function Ot(e){throw e}function Tt(e,t){var n=lt.onStoppedNotification;n&&pt.setTimeout((function(){return n(e,t)}))}var wt={closed:!0,next:ut,error:Ot,complete:ut},bt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Nt(e){return e}function _t(e){return 0===e.length?Nt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var xt=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i,o=this,r=(i=e)&&i instanceof It||function(e){return e&&tt(e.next)&&tt(e.error)&&tt(e.complete)}(i)&&st(i)?e:new Et(e,t,n);return mt((function(){var e=o,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?o._subscribe(r):o._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=At(t))((function(t,i){var o;o=n.subscribe((function(t){try{e(t)}catch(e){i(e),null==o||o.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[bt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=At(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function At(e){var t;return null!==(t=null!=e?e:lt.Promise)&&void 0!==t?t:Promise}function vt(e){return function(t){if(function(e){return tt(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var St=function(e){function t(t,n,i,o,r){var a=e.call(this,t)||this;return a.onFinalize=r,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Ye(t,e),t.prototype.unsubscribe=function(){var t,n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(It),Ct=nt((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Dt=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ye(t,e),t.prototype.lift=function(e){var t=new Mt(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ct},t.prototype.next=function(e){var t=this;mt((function(){var n,i;if(t._throwIfClosed(),!t.isStopped){var o=t.observers.slice();try{for(var r=We(o),a=r.next();!a.done;a=r.next()){a.value.next(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;mt((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;mt((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=t.hasError,i=t.isStopped,o=t.observers;return n||i?at:(o.push(e),new rt((function(){return ot(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,o=t.isStopped;n?e.error(i):o&&e.complete()},t.prototype.asObservable=function(){var e=new xt;return e.source=this,e},t.create=function(e,t){return new Mt(e,t)},t}(xt),Mt=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return Ye(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:at},t}(Dt),Vt=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Ye(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Dt),Pt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Lt(e){return tt(null==e?void 0:e.then)}function Ut(e){return tt(e[bt])}function jt(e){return Symbol.asyncIterator&&tt(null==e?void 0:e[Symbol.asyncIterator])}function Ft(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var kt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Bt(e){return tt(null==e?void 0:e[kt])}function Ht(e){return Ze(this,arguments,(function(){var t,n,i;return Je(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Xe(t.read())];case 3:return n=o.sent(),i=n.value,n.done?[4,Xe(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Xe(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function $t(e){return tt(null==e?void 0:e.getReader)}function Gt(e){if(e instanceof xt)return e;if(null!=e){if(Ut(e))return o=e,new xt((function(e){var t=o[bt]();if(tt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Pt(e))return i=e,new xt((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if(Lt(e))return n=e,new xt((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,dt)}));if(jt(e))return qt(e);if(Bt(e))return t=e,new xt((function(e){var n,i;try{for(var o=We(t),r=o.next();!r.done;r=o.next()){var a=r.value;if(e.next(a),e.closed)return}}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}e.complete()}));if($t(e))return qt(Ht(e))}var t,n,i,o;throw Ft(e)}function qt(e){return new xt((function(t){(function(e,t){var n,i,o,r;return Qe(this,void 0,void 0,(function(){var a,s;return Je(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=et(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(a=i.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),o={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Yt(e,t,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!1);var r=t.schedule((function(){n(),o?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(r),!o)return r}function Qt(e,t){return void 0===t&&(t=0),vt((function(n,i){n.subscribe(new St(i,(function(n){return Yt(i,e,(function(){return i.next(n)}),t)}),(function(){return Yt(i,e,(function(){return i.complete()}),t)}),(function(n){return Yt(i,e,(function(){return i.error(n)}),t)})))}))}function Jt(e,t){return void 0===t&&(t=0),vt((function(n,i){i.add(e.schedule((function(){return n.subscribe(i)}),t))}))}function Wt(e,t){if(!e)throw new Error("Iterable cannot be null");return new xt((function(n){Yt(n,t,(function(){var i=e[Symbol.asyncIterator]();Yt(n,t,(function(){i.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function zt(e,t){if(null!=e){if(Ut(e))return function(e,t){return Gt(e).pipe(Jt(t),Qt(t))}(e,t);if(Pt(e))return function(e,t){return new xt((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}(e,t);if(Lt(e))return function(e,t){return Gt(e).pipe(Jt(t),Qt(t))}(e,t);if(jt(e))return Wt(e,t);if(Bt(e))return function(e,t){return new xt((function(n){var i;return Yt(n,t,(function(){i=e[kt](),Yt(n,t,(function(){var e,t,o;try{t=(e=i.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return tt(null==i?void 0:i.return)&&i.return()}}))}(e,t);if($t(e))return function(e,t){return Wt(Ht(e),t)}(e,t)}throw Ft(e)}function Kt(e,t){return t?zt(e,t):Gt(e)}function Xt(e,t){return vt((function(n,i){var o=0;n.subscribe(new St(i,(function(n){i.next(e.call(t,n,o++))})))}))}function Zt(e,t){return e===t}const en=new Vt({applicationActors:[],applications:[],domains:[],frameworkActor:null,internalConnector:{dbName:"",internalCredentials:{application:null,domain:"internal://domain",methodName:null,objectName:null},serverUrl:""},lastIds:{columns:0,domains:0,entities:0,properties:0,propertyColumns:0,relations:0,relationColumns:0,applications:0,applicationVersions:0},receiver:{initializedApps:new Set,initializingApps:new Set},terminal:null,transactionManager:{pendingTransactionQueue:[],rootTransactionInProgressMap:new Map,transactionInProgressMap:new Map},webReceiver:{domainPrefix:"",localDomain:"",mainDomainFragments:[],onClientMessageCallback:null,pendingApplicationCounts:new Map,pendingHostCounts:new Map,pendingInterAppApiCallMessageMap:new Map,subsriptionMap:new Map}});var tn=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nn=class{async init(){this.state=en,this.getTerminalState=this.selectorManager.createRootSelector(this.state),this.getApplicationActors=this.selectorManager.createSelector(this.getTerminalState,(e=>e.applicationActors)),this.getApplicationActorMapByDomainAndApplicationNames=this.selectorManager.createSelector(this.getApplicationActors,(e=>{const t=new Map;for(const n of e){const e=je(t,n.application.domain.name);let i=e.get(n.application.name);i||(i=[],e.set(n.application.name,i)),i.push(n)}return t})),this.getDomains=this.selectorManager.createSelector(this.getTerminalState,(e=>e.domains)),this.getDomainMapByName=this.selectorManager.createSelector(this.getDomains,(e=>{const t=new Map;for(const n of e)t.set(n.name,n);return t})),this.getFrameworkActor=this.selectorManager.createSelector(this.getTerminalState,(e=>e.frameworkActor)),this.getInternalConnector=this.selectorManager.createSelector(this.getTerminalState,(e=>e.internalConnector)),this.getLastIds=this.selectorManager.createSelector(this.getTerminalState,(e=>e.lastIds)),this.getLatestApplicationVersionMapByNames=this.selectorManager.createSelector(this.getDomains,(e=>{const t=new Map;for(const n of e){const e=je(t,n.name);for(const t of n.applications)e.set(t.name,t.currentVersion[0].applicationVersion)}return t})),this.getLatestApplicationVersionMapByFullApplicationName=this.selectorManager.createSelector(this.getLatestApplicationVersionMapByNames,(e=>{const t=new Map;for(const n of e.values())for(const e of n.values())t.set(e.application.fullName,e);return t})),this.getAllApplicationVersionsByIds=this.selectorManager.createSelector(this.getDomains,(e=>{const t=[];for(const n of e)for(const e of n.applications)for(const n of e.versions)t[n.id]=n;return t})),this.getLatestApplicationVersionsByApplicationIndexes=this.selectorManager.createSelector(this.getDomains,(e=>{const t=[];for(const n of e)for(const e of n.applications)t[e.index]=e.currentVersion[0].applicationVersion;return t})),this.getApplications=this.selectorManager.createSelector(this.getTerminalState,(e=>e.applications)),this.getAllEntities=this.selectorManager.createSelector(this.getLatestApplicationVersionsByApplicationIndexes,(e=>{const t=[];for(const n of e)if(n)for(const e of n.entities)t[e.id]=e;return t})),this.getAllColumns=this.selectorManager.createSelector(this.getAllEntities,(e=>{const t=[];for(const n of e)if(n)for(const e of n.columns)t[e.id]=e;return t})),this.getAllRelations=this.selectorManager.createSelector(this.getAllEntities,(e=>{const t=[];for(const n of e)if(n)for(const e of n.relations)t[e.id]=e;return t})),this.getReceiver=this.selectorManager.createSelector(this.getTerminalState,(e=>e.receiver)),this.getTransactionManager=this.selectorManager.createSelector(this.getTerminalState,(e=>e.transactionManager)),this.getWebReceiver=this.selectorManager.createSelector(this.getTerminalState,(e=>e.webReceiver))}tearDown(){}};tn([function(e,t){}],nn.prototype,"selectorManager",void 0),nn=tn([function(e){}],nn);const on=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];class rn{constructor(e=""){this.aliasPrefix=e,this.reset()}getFollowingAlias(){let e=this.lastAlias;for(var t=2;t>=0;t--){let n=e[t];if(n=(n+1)%26,e[t]=n,0!==n)break}let n=this.aliasPrefix;for(t=0;t<3;t++)n+=on[e[t]];return"add"===n&&(n=this.getFollowingAlias()),n}reset(){this.lastAlias=[-1,-1,-1]}}class an{constructor(e){this.aliasCache=e,this.aliasMap=new Map}getNextAlias(e){if(this.hasAliasFor(e))return this.getExistingAlias(e);let t=this.aliasCache.getFollowingAlias();return this.aliasMap.set(e,t),t}hasAliasFor(e){return this.aliasMap.has(e)}}class sn extends an{constructor(e=new rn("E"),t=new rn("C"),n=new rn("P")){super(e),this.columnAliasCache=t,this.parameterAliases=new cn(n)}getParams(){return this.parameterAliases}getNewFieldColumnAliases(){return new ln(this,this.columnAliasCache)}getExistingAlias(e){if(!this.hasAliasFor(e))throw new Error(`No alias found for entity ${e.__driver__.dbEntity.name}`);return this.aliasMap.get(e)}getOnlyAlias(){return 1!==this.aliasMap.size?"Expecting only 1 entry in Field's alias map":this.aliasMap.get(this.aliasMap.keys().next().value)}}class cn extends an{constructor(e){super(e)}getNextAlias(e){if(this.hasAliasFor(e))return this.getExistingAlias(e).alias;let t=this.aliasCache.getFollowingAlias(),n={alias:t,value:e.value};return this.aliasMap.set(e,n),t}getExistingAlias(e){if(!this.hasAliasFor(e))throw new Error("No alias found for a parameter");return this.aliasMap.get(e)}getParameters(){let e={};return this.aliasMap.forEach(((t,n)=>{e[t.alias]=t})),e}}class ln extends an{constructor(e,t){super(t),this._entityAliases=e}get entityAliases(){return this._entityAliases}getExistingAlias(e){if(!this.hasAliasFor(e)){const t=e;throw new Error(`No alias found for property ${t.dbProperty.entity.name}.${t.dbProperty.name}`)}return this.aliasMap.get(e)}}class pn{constructor(e){this.category=e}}class dn extends pn{constructor(e){super(e),this.category=e}equals(e,t){return{c:this.category,l:e,o:Oe.EQUALS,r:t}}greaterThan(e,t){return{c:this.category,l:e,o:Oe.GREATER_THAN,r:t}}greaterThanOrEquals(e,t){return{c:this.category,l:e,o:Oe.GREATER_THAN_OR_EQUALS,r:t}}isNotNull(e){return{c:this.category,l:e,o:Oe.IS_NOT_NULL}}isNull(e){return{c:this.category,l:e,o:Oe.IS_NULL}}in(e,t){return{c:this.category,l:e,o:Oe.IN,r:t}}lessThan(e,t){return{c:this.category,l:e,o:Oe.LESS_THAN,r:t}}lessThanOrEquals(e,t){return{c:this.category,l:e,o:Oe.LESS_THAN_OR_EQUALS,r:t}}notEquals(e,t){return{c:this.category,l:e,o:Oe.NOT_EQUALS,r:e}}notIn(e,t){return{c:this.category,l:e,o:Oe.NOT_IN,r:t}}}const un=function(...e){return(new yn).and(e)},fn=function(...e){return(new yn).or(e)};class yn extends pn{constructor(){super(null)}static verifyChildOps(e){if(!e||!e.length)throw new Error("No child operations provided")}and(e){return{c:ge.LOGICAL,o:Oe.AND,v:e}}or(e){return{c:ge.LOGICAL,o:Oe.OR,v:e}}not(e){return{c:ge.LOGICAL,o:Oe.NOT,v:e}}}function hn(e,t,n,i){this.dbRelation=e,this.parentQ=t,this.appliationUtils=n,this.relationManager=i}function mn(e,t){mn.base.constructor.call(this,e,t)}hn.prototype.innerJoin=function(){return this.getNewQEntity(ue.INNER_JOIN)},hn.prototype.leftJoin=function(){return this.getNewQEntity(ue.LEFT_JOIN)},hn.prototype.getNewQEntity=function(e){const t=this.dbRelation.relationEntity;let n=new(this.applicationUtils.getQEntityConstructor(this.dbRelation.relationEntity))(t,this.appliationUtils,this.relationManager,this.relationManager.getNextChildJoinPosition(this.parentQ.__driver__),this.dbRelation,e,this.appliationUtils,this.relationManager);return n.__driver__.parentJoinEntity=this.parentQ,n},mn.prototype.equals=function(e){let t=this,n=e;return un(t.actor.id.equals(n.actor.id),t.actorRecordId.equals(n.actorRecordId),t.id.equals(n.repository.id))},Vn(hn,mn,{});class Rn extends dn{constructor(){super(ge.BOOLEAN)}}class In{constructor(e,t){this.field=e,this.sortOrder=t}toJSON(e){if(!e.hasAliasFor(this.field))throw new Error("Field used in order by clause is not present in select clause");return{fa:e.getExistingAlias(this.field),so:this.sortOrder}}toEntityJSON(){let e=this.field;return{fa:void 0,ci:e.dbColumn.index,pi:e.dbProperty.index,ti:e.dbProperty.entity.index,si:e.dbProperty.entity.applicationVersion.id,so:this.sortOrder}}}class En{constructor(e,t,n,i){this.dbColumn=e,this.dbProperty=t,this.q=n,this.objectType=i,this.__appliedFunctions__=[]}applySqlFunction(e){let t=this.getInstance();return t.__appliedFunctions__.push(e),t}toJSON(e,t,n,i,o){let r,a;t&&(r=e.getNextAlias(this)),a=this.__fieldSubQuery__?e.entityAliases.getOnlyAlias():e.entityAliases.getExistingAlias(this.q.__driver__.getRootJoinEntity());let s={appliedFunctions:this.appliedFunctionsToJson(this.__appliedFunctions__,e,n,i,o),si:this.dbProperty.entity.applicationVersion.id,ti:this.dbProperty.entity.index,fa:r,pi:this.dbProperty.index,ci:this.dbColumn.index,ta:o.getPositionAlias(a,this.q.__driver__.fromClausePosition),ot:this.objectType,dt:this.dbColumn.type};return this.__fieldSubQuery__&&(s.fieldSubQuery=i.getFieldQueryJson(this.__fieldSubQuery__,e.entityAliases,n),s.ot=Re.FIELD_QUERY),s}asc(){return new In(this,he.ASCENDING)}desc(){return new In(this,he.DESCENDING)}addSubQuery(e){let t=this.getInstance();return t.__fieldSubQuery__=e,t}operableFunctionToJson(e,t,n,i,o,r){let a;return n&&(a=t.getNextAlias(this)),{appliedFunctions:this.appliedFunctionsToJson(this.__appliedFunctions__,t,i,o,r),fa:a,ot:this.objectType,dt:this.dbColumn.type,v:this.valueToJSON(e,t,!1,!0,i,o,r)}}copyFunctions(e){return e.__appliedFunctions__=this.__appliedFunctions__.slice(),e}appliedFunctionsToJson(e,t,n,i,o){return e?e.map((e=>this.functionCallToJson(e,t,n,i,o))):e}functionCallToJson(e,t,n,i,o){let r;return e.p&&(r=e.p.map((e=>this.valueToJSON(e,t,!1,!1,n,i,o)))),{ft:e.ft,p:r}}valueToJSON(e,t,n,i,o,r,a){if(!e)throw new Error("Function object must be provided to valueToJSON function.");if(!i&&e instanceof En)return e.toJSON(t,n,o,r,a);let s=e.value;switch(typeof s){case"boolean":case"number":case"string":return t.entityAliases.getParams().getNextAlias(e);case"object":if(s instanceof Date)return t.entityAliases.getParams().getNextAlias(e);if(s instanceof Array)return t.entityAliases.getParams().getNextAlias(e);if(null===s)return t.entityAliases.getParams().getNextAlias(e);throw new Error("Unexpected query parameter type allowed types are:\nboolean | Date | Date[] | number | number[] | string | string[]\n");case"undefined":throw new Error("Undefined is not allowed as a query parameter");default:throw new Error("Unexpected query parameter type allowed types are:\nboolean | Date | Date[] | number | number[] | string | string[]\n")}}}class gn extends En{constructor(e,t,n,i,o){super(e,t,n,i),this.operation=o}equals(e){return e instanceof Function&&(e=e()),this.operation.equals(this,e)}greaterThan(e){return e instanceof Function&&(e=e()),this.operation.greaterThan(this,e)}greaterThanOrEquals(e){return e instanceof Function&&(e=e()),this.operation.greaterThanOrEquals(this,e)}isNotNull(){return this.operation.isNotNull(this)}isNull(){return this.operation.isNull(this)}in(e){return e instanceof Function&&(e=e()),this.operation.in(this,e)}lessThan(e){return e instanceof Function&&(e=e()),this.operation.lessThan(this,e)}lessThanOrEquals(e){return e instanceof Function&&(e=e()),this.operation.lessThanOrEquals(this,e)}notEquals(e){return e instanceof Function&&(e=e()),this.operation.notEquals(this,e)}notIn(e){return e=e.map((e=>e instanceof Function?e():e)),this.operation.notIn(this,e)}}class On extends gn{constructor(e,t,n,i=Re.FIELD){super(e,t,n,i,new Rn)}getInstance(e=this.q){return this.copyFunctions(new On(this.dbColumn,this.dbProperty,e,this.objectType))}}class Tn extends On{constructor(e,t=!1){super({type:Ie.BOOLEAN},null,null,Re.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Tn(this.value))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class wn extends dn{constructor(){super(ge.DATE)}}class bn extends gn{constructor(e,t,n,i=Re.FIELD){super(e,t,n,i,new wn)}getInstance(e=this.q){return this.copyFunctions(new bn(this.dbColumn,this.dbProperty,e,this.objectType))}}class Nn extends bn{constructor(e,t=!1){super({type:Ie.DATE},null,null,Re.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Nn(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class _n extends dn{constructor(){super(ge.NUMBER)}}class xn extends gn{constructor(e,t,n,i=Re.FIELD){super(e,t,n,i,new _n)}getInstance(e=this.q){return this.copyFunctions(new xn(this.dbColumn,this.dbProperty,e,this.objectType))}}class An extends xn{constructor(e,t=!1){super({type:Ie.NUMBER},null,null,Re.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new An(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class vn extends dn{constructor(){super(ge.STRING)}like(e,t){return{c:this.category,l:e,o:Oe.LIKE,r:t}}}class Sn extends gn{constructor(e,t,n,i=Re.FIELD){super(e,t,n,i,new vn)}getInstance(e=this.q){return this.copyFunctions(new Sn(this.dbColumn,this.dbProperty,e,this.objectType))}like(e){return e instanceof Function&&(e=e()),this.operation.like(this,e)}}class Cn extends Sn{constructor(e,t=!1){super({type:Ie.STRING},null,null,Re.FIELD_FUNCTION),this.value=e,this.isQueryParameter=t}getInstance(){return this.copyFunctions(new Cn(this.value,this.isQueryParameter))}toJSON(e,t,n,i,o){let r=this.operableFunctionToJson(this,e,t,n,i,o);return this.isQueryParameter&&(this.parameterAlias=r.v),r}}class Dn extends dn{constructor(){super(ge.UNTYPED)}like(e,t){return{c:this.category,l:e,o:Oe.LIKE,r:t}}}class Mn extends gn{constructor(e,t,n,i=Re.FIELD){super(e,t,n,i,new Dn)}getInstance(e=this.q){return this.copyFunctions(new Mn(this.dbColumn,this.dbProperty,e,this.objectType))}like(e){return e instanceof Function&&(e=e()),this.operation.like(this,e)}}function Vn(e,t,n){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.base=e.prototype;for(const e in n)t.prototype[e]=n[e];return t}function Pn(e,t,n,i){switch(i.type){case Ie.ANY:return new Mn(i,t,n);case Ie.BOOLEAN:return new On(i,t,n);case Ie.DATE:return new bn(i,t,n);case Ie.NUMBER:return new xn(i,t,n);case Ie.JSON:case Ie.STRING:return new Sn(i,t,n);default:throw new Error(`Unsupported data type for property ${e.applicationVersion.application.name}.${e.name}.${t.name}`)}}function Ln(e){var t=function(n,i,o,r,a,s){t.base.constructor.call(this,n,r,a,s),n.properties.forEach((t=>{let r;if(t.relation&&t.relation.length){r=function(e,t,n,i,o,r){const a=t.relation[0];switch(a.relationType){case fe.MANY_TO_ONE:const t=a.relationEntity;return new(0,i[t.applicationVersion.application.index].__qIdRelationConstructors__[t.index])(a.relationEntity,a,n);case fe.ONE_TO_MANY:return e.isRepositoryEntity?new Hn(a,n,o,r):new Bn(a,n,o,r);default:throw new Error(`Unknown EntityRelationType: ${a.relationType}.`)}}(n,t,this,e,i,o);for(const e of t.propertyColumns)Un(n,t,this,e.column)}else r=Un(n,t,this,t.propertyColumns[0].column);this[t.name]=r}))};return Vn(yi,t,{}),t}function Un(e,t,n,i){const o=Pn(e,t,n,i);return n.__driver__.allColumns[i.index]=o,(i.idIndex||0===i.idIndex)&&(n.__driver__.idColumns[i.idIndex]=o),o}function jn(e){function t(e,n,i){t.base.constructor.call(this,n,i),Fn(this,e,i,n.property)}return e.isRepositoryEntity?Vn(mn,t,{}):Vn(hn,t,{}),t}function Fn(e,t,n,i,o){if(!o){const e=i.relation[0].manyRelationColumns;o=new Map;for(const t of e)o.set(t.oneColumn,t.manyColumn)}return t.properties.forEach((r=>{if(!r.isId)return;let a;if(r.relation&&r.relation.length){const e=r.relation[0],t=e.manyRelationColumns;for(const e of t){const t=o.get(e.manyColumn);o.delete(e.manyColumn),o.set(e.oneColumn,t)}a=Fn({},e.relationEntity,n,i,o)}else{const e=o.get(r.propertyColumns[0].column);a=Pn(t,i,n,e)}e[r.name]=a})),e}function kn(e,t,n){return!!e.dependencies.has(t)}function Bn(e,t,n,i){Bn.base.constructor.call(this,e,t,n,i)}function Hn(e,t,n,i){Hn.base.constructor.call(this,e,t,n,i)}Vn(hn,Bn,{}),Vn(mn,Hn,{});class $n extends En{constructor(){super(null,null,null,Re.FIELD_FUNCTION),this.value=null}getInstance(){return this.copyFunctions(new $n)}toJSON(e,t,n,i,o){return this.operableFunctionToJson(this,e,t,n,i,o)}}const Gn=function(e){if("boolean"!=typeof e)throw new Error("bool() accepts booleans only.");return new Tn(e)},qn=function(e){if(!(e instanceof Date))throw new Error("date() accepts Dates only.");return new Nn(e)},Yn=function(e){if("number"!=typeof e)throw new Error("num() accepts numbers only.");return new An(e)},Qn=function(e){if("string"!=typeof e)throw new Error("str() accepts strings only.");return new Cn(e)};function Jn(e){switch(typeof e){case"boolean":return Gn(e);case"number":return Yn(e);case"string":return Qn(e);case"undefined":throw new Error("Cannot use an 'undefined' value in an operation.")}return null===e?new $n:e instanceof Date?qn(e):e}function Wn(e,t,n,i){if(e.indexOf(typeof i)<-1){const i=e.join(", ");throw new Error(`Unexpected typeof value for row: ${n+1}, column: ${zn(t)}.  Expecting: ${i}`)}}function zn(e){return e.name?e.name:e.propertyColumns[0].property.name}function Kn(e,t){return t&&(t=t.map((e=>{switch(typeof e){case"boolean":return Gn(e);case"number":return Yn(e);case"string":return Qn(e);case"undefined":throw new Error("'undefined' cannot be used as a function parameter")}return e instanceof Date?qn(e):e}))),{ft:e,p:t}}function Xn(e){switch(typeof e){case"boolean":return new Tn(e);case"number":return new An(e);case"string":return new Cn(e)}if(e instanceof Date)return new Nn(e);let t=e.select;if(t instanceof ni&&(t=t.getSelectClause()),t instanceof On)return new Tn(e);if(t instanceof bn)return new Nn(e);if(t instanceof xn)return new An(e);if(t instanceof Sn)return new Cn(e);throw new Error("Function rValue must be a primitive, Date, Field or Field query")}const Zn=function(e){return e instanceof gn?e.applySqlFunction(Kn(me.MAX)):Xn(e).applySqlFunction(Kn(me.MAX))},ei=function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.PLUS,[t])):new An(e).applySqlFunction(Kn(me.PLUS,[t]))};class ti{}class ni extends ti{constructor(e){super(),this.selectClause=e,this.__appliedFunctions__=[]}static getSelect(e){return e.__appliedFunctions__[0].p[0]}applySqlFunction(e){return this.__appliedFunctions__.push(e),this}getSelectClause(){return this.selectClause}toJSON(e){if(1!=this.__appliedFunctions__.length)throw new Error('Not expecting and parent or child functions on "distinct"');if(!this.selectClause)throw new Error('SELECT clause is missing in "distinct" function.');return{appliedFunctions:[Kn(me.DISTINCT)],dt:null,fa:null,ot:Re.DISTINCT_FUNCTION,v:e}}}class ii extends ti{constructor(e){super(),this.subQuery=e,this.__appliedFunctions__=[],this.operator=Oe.EXISTS,this.o=Oe.EXISTS,this.category=ge.FUNCTION,this.c=ge.FUNCTION}applySqlFunction(e){return this.__appliedFunctions__.push(e),this}getQuery(){return this.subQuery}toJSON(e){if(1!=this.__appliedFunctions__.length)throw new Error('Not expecting and parent or child functions on "exists"');if(!this.subQuery)throw new Error('Subquery is not defined in "exists" function.');let t=[Kn(me.EXISTS)];return{c:this.category,ob:{appliedFunctions:t,dt:null,ot:Re.EXISTS_FUNCTION,v:e},o:this.operator}}}const oi=function(...e){throw new Error("not implemented")};class ri{constructor(e=new sn,t=e.getNewFieldColumnAliases()){this.entityAliases=e,this.columnAliases=t,this.isEntityQuery=!1}getParameters(){return this.entityAliases.getParams().getParameters()}getNonEntityQuery(e,t,n,i,o,r){let a=this.fromClauseToJSON(e.from,i,o,r);return t.F=a,n&&n(t),t.W=i.whereClauseToJSON(e.where,this.columnAliases),t.GB=this.groupByClauseToJSON(e.groupBy),t.H=i.whereClauseToJSON(e.having,this.columnAliases),t.OB=this.orderByClauseToJSON(e.orderBy),t.L=e.limit,t.O=e.offset,t}fromClauseToJSON(e,t,n,i){if(!e){if(this.isEntityQuery)return[];throw new Error("From clause must be present in a non-Entity based query.")}return e.map((e=>{if(!(e instanceof yi))throw new Error("FROM clause can contain only Views or Entities.");if(this.isEntityQuery&&e instanceof mi)throw new Error("Entity FROM clauses can contain only Entities.");return e.__driver__.getRelationJson(this.columnAliases,t,n,i)}))}groupByClauseToJSON(e){return e&&e.length?e.map((e=>{if(!this.columnAliases.hasAliasFor(e))throw new Error("Field used in group by clause is not present in select clause");return{fa:this.columnAliases.getExistingAlias(e)}})):null}orderByClauseToJSON(e){return e&&e.length?e.map((e=>e.toJSON(this.columnAliases))):null}}const ai='Unsupported entry in Non-Entity SELECT clause, must be a(n): Entity Field | ManyToOne Relation | primitive wrapped by "bool","date","num","str" | query wrapped by "field"';class si extends ri{constructor(e){super(e),this.isHierarchicalEntityQuery=!1}selectClauseToJSON(e,t,n,i){if(e instanceof ni){if(this.isHierarchicalEntityQuery)throw new Error("Distinct cannot be used in SELECT of Hierarchical/Bridged Entity queries.");let o=e.getSelectClause(),r=this.nonDistinctSelectClauseToJSON(o,t,n,i);return e.toJSON(r)}return this.nonDistinctSelectClauseToJSON(e,t,n,i)}}class ci extends si{nonDistinctSelectClauseToJSON(e,t,n,i){let o={};for(let r in e){let a=e[r];if(a instanceof En){if(this.isEntityQuery)throw new Error("Entity SELECT clauses can only contain fields assigned: null | undefined | boolean | Date | number | string | Relation SELECT");o[r]=a.toJSON(this.columnAliases,!0,t,n,i)}else{if(a instanceof Bn||a instanceof Hn)throw new Error("@OneToMany relation objects can cannot be used in SELECT clauses");{let e=!1;try{switch(typeof a){case"boolean":case"number":case"string":case"undefined":continue;case"object":a instanceof Date||null===a||(e=!0,o[r]=this.nonDistinctSelectClauseToJSON(a,t,n,i))}}finally{if(!e&&!this.isEntityQuery)throw new Error(ai)}}}}return o}}class li extends ci{constructor(e,t=new sn){super(t),this.rawQuery=e}toJSON(e,t,n){return this.getNonEntityQuery(this.rawQuery,{},(i=>{i.S=this.selectClauseToJSON(this.rawQuery.select,e,t,n)}),e,t,n)}}function pi(e){let t;t=e instanceof Function?e():e;let n=new mi([],t);return n=di(t.select,t,n,n,"f"),n}function di(e,t,n,i,o){let r=0;for(let a in e){let s=`${o}${++r}`,c=e[a];if(c instanceof En){let e=c.getInstance(n);e.alias=s,e.q=n,i[a]=e}else{if(!(c instanceof Object)||c instanceof Date)throw new Error("All SELECT clause entries of a Mapped query must be Fields or Functions");i[c]=di(c,t,n,{},`${s}_`)}}return n}function ui(e){let t;t=e instanceof Function?e():e;let n=t.select;return n=n.addSubQuery(t),n}class fi{constructor(e){if(this.joinTo=e,!(this.joinTo instanceof yi))throw new Error("Right value in join must be a View or an Entity")}on(e){return this.joinTo.__driver__.joinWhereClause=e(this.joinTo),this.joinTo}}function yi(e,t,n,i=[],o=null,r=null,a=hi){this.__driver__=new a(e,i,o,r,this,t,n)}yi.prototype.fullJoin=function(e){return this.__driver__.join(e,ue.FULL_JOIN)},yi.prototype.innerJoin=function(e){return this.__driver__.join(e,ue.INNER_JOIN)},yi.prototype.leftJoin=function(e){return this.__driver__.join(e,ue.LEFT_JOIN)},yi.prototype.rightJoin=function(e){return this.__driver__.join(e,ue.RIGHT_JOIN)};class hi{constructor(e,t,n,i=[],o=null,r=null,a){this.dbEntity=e,this.applicationUtils=t,this.relationManager=n,this.fromClausePosition=i,this.dbRelation=o,this.joinType=r,this.qEntity=a,this.entityFieldMap={},this.entityRelations=[],this.idColumns=[],this.allColumns=[],this.relations=[],this.currentChildIndex=-1}getInstance(){let e=new(this.applicationUtils.getQEntityConstructor(this.dbEntity))(this.dbEntity,this.applicationUtils,this.relationManager,this.fromClausePosition,this.dbRelation,this.joinType);return e.__driver__.currentChildIndex=this.currentChildIndex,e.__driver__.joinWhereClause=this.joinWhereClause,e.__driver__.entityFieldMap=this.entityFieldMap,e.__driver__.entityRelations=this.entityRelations,e}getRelationJson(e,t,n,i){let o={currentChildIndex:this.currentChildIndex,ti:this.dbEntity.index,fromClausePosition:this.fromClausePosition,jt:this.joinType,rt:null,rep:e.entityAliases.getNextAlias(this.getRootJoinEntity()),si:this.dbEntity.applicationVersion.application.index};return this.joinWhereClause?this.getJoinRelationJson(o,e,t,n,i):this.dbRelation?this.getEntityRelationJson(o):this.getRootRelationJson(o,e,t,n,i),o}getJoinRelationJson(e,t,n,i,o){return e.rt=ye.ENTITY_JOIN_ON,e.joinWhereClause=n.whereClauseToJSON(this.joinWhereClause,t),e}getEntityRelationJson(e){return e.rt=ye.ENTITY_APPLICATION_RELATION,e.ri=this.dbRelation.index,e}getRootRelationJson(e,t,n,i,o){return e.rt=this instanceof Ri?ye.SUB_QUERY_ROOT:ye.ENTITY_ROOT,e}getQ(){return this.qEntity}join(e,t){let n=e.__driver__.getInstance();n.__driver__.currentChildIndex=0;let i=this.relationManager.getNextChildJoinPosition(this);return n.__driver__.fromClausePosition=i,n.__driver__.joinType=t,n.__driver__.parentJoinEntity=this.qEntity,new fi(n)}isRootEntity(){return!this.parentJoinEntity}getRootJoinEntity(){let e=this.qEntity;for(;e.__driver__.parentJoinEntity;)e=e.__driver__.parentJoinEntity;return e}}function mi(e=[],t){mi.base.constructor.call(this,null,e,null,null,Ri),this.__driver__.subQuery=t}Vn(yi,mi,{});class Ri extends hi{getInstance(){let e=super.getInstance();return e.__driver__.subQuery=this.subQuery,e}getJoinRelationJson(e,t,n,i,o){return(e=super.getJoinRelationJson(e,t,n,i,o)).rt=ye.SUB_QUERY_JOIN_ON,e.subQuery=new li(this.subQuery,t.entityAliases).toJSON(n,i,o),e}getRootRelationJson(e,t,n,i,o){return(e=super.getJoinRelationJson(e,t,n,i,o)).rt=ye.SUB_QUERY_ROOT,e.subQuery=new li(this.subQuery,t.entityAliases).toJSON(n,i,o),e}}class Ii{constructor(e,t,n){this.jsonRelation=e,this.childNodes=t,this.parentNode=n}addChildNode(e){let t=e.jsonRelation.fromClausePosition,n=t[t.length-1];this.childNodes[n]=e}getEntityRelationChildNode(e){return this.getEntityRelationChildNodeByIndexes(e.property.entity.applicationVersion.id,e.property.entity.index,e.index)}getEntityRelationChildNodeByIndexes(e,t,n){let i=this.childNodes.filter((e=>e.jsonRelation.ri===n));switch(i.length){case 0:break;case 1:return i[0];default:throw new Error(`More than one child node matched relation property index '${n}'`)}let o,r=this.jsonRelation.fromClausePosition.slice();r.push(this.childNodes.length),o=this.parentNode?this.parentNode.jsonRelation.rep:this.jsonRelation.rep;let a={currentChildIndex:0,fromClausePosition:r,ti:t,jt:ue.LEFT_JOIN,rt:ye.ENTITY_APPLICATION_RELATION,rep:o,ri:n,si:e},s=new Ii(a,[],this);return this.addChildNode(s),s}}var Ei=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gi=class{getPositionAlias(e,t){return`${e}_${t.join("_")}`}getAlias(e){return this.getPositionAlias(e.rep,e.fromClausePosition)}getParentAlias(e){let t=e.fromClausePosition;if(0===t.length)throw new Error("Cannot find alias of a parent entity for the root entity");return this.getPositionAlias(e.rep,t.slice(0,t.length-1))}createRelatedQEntity(e,t){const n=this.applicationUtils.getDbEntity(e.si,e.ti);return new(this.applicationUtils.getQEntityConstructor(n))(n,this.applicationUtils,this,e.fromClausePosition,n.relations[e.ri],e.jt)}getNextChildJoinPosition(e){let t=e.fromClausePosition.slice();return t.push(++e.currentChildIndex),t}};Ei([function(e,t){}],gi.prototype,"applicationUtils",void 0),gi=Ei([function(e){}],gi);var Oi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ti=class{ensureContext(e){return wi(e)}async lookup(e,t,n,i,o,r,a){let s,c;if(o){s=new o(this.entityUtils.getQuery(e))}else s=this.entityUtils.getEntityQuery(e),t=this.getQueryResultType(t,a);c=n?i?this.queryFacade.searchOne:this.queryFacade.search:i?this.queryFacade.findOne:this.queryFacade.find;let l=await c.call(this.queryFacade,s,this.getQueryResultType(t,a),r);return i||l||(l=[]),l}getQueryResultType(e,t){switch(e){case Ce.ENTITY_GRAPH:return t?Ce.MAPPED_ENTITY_GRAPH:Ce.ENTITY_GRAPH;case Ce.ENTITY_TREE:return t?Ce.MAPPED_ENTITY_TREE:Ce.ENTITY_TREE;case Ce.FIELD:case Ce.RAW:case Ce.TREE:case Ce.SHEET:return e;default:throw new Error(`Unexpected Base Query ResultType: '${e}'.`)}}};function wi(e){return e||(e={}),e.startedAt||(e.startedAt=new Date),e}Oi([function(e,t){}],Ti.prototype,"entityUtils",void 0),Oi([function(e,t){}],Ti.prototype,"queryFacade",void 0),Ti=Oi([function(e){}],Ti);class bi extends class{constructor(e){this.dao=e}ensureContext(e){return wi(e)}async lookup(e,t,n,i,o,r,a){return await this.dao.lookup.lookup(e,t,n,i,o,r,a)}}{constructor(e,t,n=bi.mapResults){super(t),this.dbEntity=e,this.mapResults=n}setMap(e,t=!0){return new e(this.dbEntity,this.dao,t)}setNoCache(e){return new e(this.dbEntity,this.dao,this.mapResults)}async entityLookup(e,t,n,i,o){o.dbEntity=this.dbEntity;const r=await this.lookup(e,t,n,i,null,o,this.mapResults);if(n)throw new Error("Search operations are not yet supported");return this.dao.updateCacheManager.saveOriginalValues(r,o.dbEntity),r}}bi.mapResults=!1;class Ni extends bi{async graph(e,t){return await this.find(e,Ce.ENTITY_GRAPH,t)}async tree(e,t){return await this.find(e,Ce.ENTITY_TREE,t)}async find(e,t,n){return await this.entityLookup(e,t,!1,!1,this.ensureContext(n))}map(e){return this.setMap(Ni,e)}noCache(){return this.setNoCache(Ni)}}class _i extends bi{async graph(e,t){return await this.findOne(e,Ce.ENTITY_GRAPH,t)}async tree(e,t){return await this.findOne(e,Ce.ENTITY_TREE,t)}async findOne(e,t,n){return await this.entityLookup(e,t,!1,!0,this.ensureContext(n))}map(e){return this.setMap(_i,e)}noCache(){return this.setNoCache(_i)}}class xi extends si{constructor(e,t=new sn){super(t),this.rawQuery=e}nonDistinctSelectClauseToJSON(e,t,n,i){if(!(this.rawQuery.select instanceof En))throw new Error(ai);return this.columnAliases.entityAliases.getNextAlias(this.rawQuery.select.q.__driver__.getRootJoinEntity()),this.rawQuery.select.toJSON(this.columnAliases,!0,t,n,i)}toJSON(e,t,n){let i={S:this.selectClauseToJSON(this.rawQuery.select,e,t,n),ot:Re.FIELD_QUERY,dt:this.getClauseDataType()};return this.getNonEntityQuery(this.rawQuery,i,null,e,t,n)}getClauseDataType(){let e=this.rawQuery.select;if(e instanceof ni&&(e=e.getSelectClause()),e instanceof On)return Ie.BOOLEAN;if(e instanceof bn)return Ie.DATE;if(e instanceof xn)return Ie.NUMBER;if(e instanceof Sn)return Ie.STRING;if(e instanceof Mn)return Ie.ANY;throw new Error("Unsupported type of select field in Field Query")}}class Ai extends si{constructor(e){super(),this.rawQuery=e}nonDistinctSelectClauseToJSON(e,t,n,i){if(!(e instanceof Array))throw new Error("Flat Queries an array of fields in SELECT clause.");return e.map((e=>{if(!(e instanceof En))throw new Error(ai);return this.columnAliases.entityAliases.getNextAlias(e.q.__driver__.getRootJoinEntity()),e.toJSON(this.columnAliases,!0,t,n,i)}))}toJSON(e,t,n){let i={S:this.selectClauseToJSON(this.rawQuery.select,e,t,n)};return this.getNonEntityQuery(this.rawQuery,i,null,e,t,n)}}var vi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Si=class extends Ti{field(e,t){return this.find(e,Ce.FIELD,xi,t)}sheet(e,t,n,i){if(t||n)throw new Error("Implement!");return this.find(e,Ce.SHEET,Ai,i)}tree(e,t){return this.find(e,Ce.TREE,li,t)}find(e,t,n,i){return this.lookup(e,t,!1,!1,n,this.ensureContext(i))}};Si=vi([function(e){}],Si);var Ci=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Di=class extends Ti{field(e,t){return this.findOne(e,Ce.FIELD,xi,t)}sheet(e,t){return this.findOne(e,Ce.SHEET,Ai,t)}tree(e,t){return this.findOne(e,Ce.TREE,li,t)}findOne(e,t,n,i){return this.lookup(e,t,!1,!0,n,this.ensureContext(i))}};Di=Ci([function(e){}],Di);var Mi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vi=class extends Ti{field(e,t){return Kt(this.search(e,Ce.FIELD,xi,t))}sheet(e,t){return Kt(this.search(e,Ce.SHEET,Ai,t))}tree(e,t){return Kt(this.search(e,Ce.TREE,li,t))}search(e,t,n,i){return this.lookup(e,t,!0,!1,n,this.ensureContext(i))}};Vi=Mi([function(e){}],Vi);var Pi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Li=class extends Ti{field(e,t){return Kt(this.searchOne(e,Ce.FIELD,xi,t))}sheet(e,t){return Kt(this.searchOne(e,Ce.SHEET,Ai,t))}tree(e,t){return Kt(this.searchOne(e,Ce.TREE,li,t))}searchOne(e,t,n,i){return this.lookup(e,t,!0,!0,n,this.ensureContext(i))}};Li=Pi([function(e){}],Li);class Ui extends ri{constructor(e,t){super(),this.rawInsertValues=e,this.columnIndexes=t}validateColumn(e,t,n){if(!e)throw new Error(`\n\t\tCould not find column ${n} in entity: ${t.name}\n\t\t\t\t(table: ${t.tableConfig.name})\n\t\t\t\t\t\t`);if(e.entity.applicationVersion.application.index!==t.applicationVersion.application.index||e.entity.index!==t.index){const n=e.entity.applicationVersion.application,i=t.applicationVersion.application;throw new Error(`Unexpected entity for column ${e.name}.\n\t\t\tExpecting:\n\t\t\t\tDomain: ${i.domain.name}\n\t\t\t\tApplication: ${i.name}\n\t\t\t\tEntity: ${t.name}\n\t\t\tFound:\n\t\t\t\tDomain: ${n.domain.name}\n\t\t\t\tApplication: ${n.name}\n\t\t\t\tEntity: ${e.entity.name}`)}}valuesToJSON(e,t,n,i,o){return e.map(((e,r)=>e.map(((e,a)=>{if(void 0===e)throw new Error("Cannot use 'undefined' in VALUES clause.");return e instanceof En?e.toJSON(this.columnAliases,!1,n,i,o):function(e,t,n,i=!0){switch(t.type){case Ie.ANY:Wn(["boolean","number","object","string"],t,n,e);break;case Ie.BOOLEAN:Wn(["boolean"],t,n,e);break;case Ie.DATE:Wn(["number","object"],t,n,e);break;case Ie.JSON:Wn(["object"],t,n,e);break;case Ie.NUMBER:Wn(["number"],t,n,e);break;case Ie.STRING:Wn(["string"],t,n,e);break;default:throw new Error("Unexpected SQLDataType: "+t.type)}switch(typeof e){case"boolean":return e?1:0;case"number":case"string":return e;case"object":if(null===e)return e;if(e instanceof Date){if(t.type!==Ie.DATE)throw new Error(`Unexpected Date object for row: ${n+1}, column: ${zn(t)}`);return i?e.getTime():e}if(t.type!==Ie.JSON)throw new Error(`Unexpected Json object for row: ${n+1}, column: ${zn(t)}`);return JSON.stringify(e);case"undefined":throw new Error("Cannot use an 'undefined' value in an operation.");default:throw new Error("Unexpected object in operation.")}}(e,t[a],r)}))))}}class ji extends ri{constructor(e){super(),this.rawUpdate=e}toJSON(e,t,n){return{U:this.rawUpdate.update.__driver__.getRelationJson(this.columnAliases,e,t,n),S:this.setToJSON(this.rawUpdate.set,e,t,n),W:e.whereClauseToJSON(this.rawUpdate.where,this.columnAliases)}}}class Fi extends ri{constructor(e){super(),this.rawDelete=e}toJSON(e,t,n){return{DF:this.rawDelete.deleteFrom.__driver__.getRelationJson(this.columnAliases,e,t,n),W:e.whereClauseToJSON(this.rawDelete.where,this.columnAliases)}}}class ki extends ci{constructor(e){super(),this.rawQuery=e,this.isEntityQuery=!0,this.isHierarchicalEntityQuery=!0}toJSON(e,t,n){return{S:this.selectClauseToJSON(this.rawQuery.select,e,t,n),F:this.fromClauseToJSON(this.rawQuery.from,e,t,n),W:e.whereClauseToJSON(this.rawQuery.where,this.columnAliases),OB:this.orderByClauseToJSON(this.rawQuery.orderBy)}}nonDistinctSelectClauseToJSON(e){for(let t in e){let n=e[t];if(n instanceof En)throw new Error("Field References cannot be used in Entity Queries");n instanceof Object&&!(n instanceof Date)&&this.nonDistinctSelectClauseToJSON(n)}return e}orderByClauseToJSON(e){return e&&e.length?e.map((e=>e.toEntityJSON())):null}}class Bi extends Ui{toJSON(e,t,n){const i=this.rawInsertValues.insertInto.__driver__,o=i.getRelationJson(this.columnAliases,e,t,n),r=i.dbEntity.columnMap,a=[];return{II:o,C:this.columnIndexes?this.columnIndexes:this.rawInsertValues.columns.map((e=>{const t=r[e];return this.validateColumn(t,i.dbEntity,e),a.push(t),t.index})),V:this.valuesToJSON(this.rawInsertValues.values,a,e,t,n)}}}class Hi extends Ui{toJSON(e,t,n){const i=this.rawInsertValues.insertInto.__driver__,o=i.getRelationJson(this.columnAliases,e,t,n),r=[];let a;if(this.columnIndexes){a=this.columnIndexes;for(let e=0;e<a.length;e++){const t=i.dbEntity.columns[a[e]];this.validateColumn(t,i.dbEntity),r.push(t)}}else a=this.rawInsertValues.columns.map((e=>{const t=e.dbColumn;return this.validateColumn(t,i.dbEntity),r.push(t),t.index}));return{II:o,C:a,V:this.valuesToJSON(this.rawInsertValues.values,r,e,t,n)}}}class $i extends ji{constructor(e){super(e)}setToJSON(e,t,n,i){const o={},r=this.rawUpdate.update.__driver__.dbEntity,a=r.columnMap,s=r.idColumnMap;for(const c in e){let l=e[c];if(void 0!==l){if(!a[c])throw new Error(`\n\tUnknown column: '${c}' for entity: '${r.name}'\n\t\t\t(table: '${r.tableConfig.name}').\n\t\t\t\t`);if(s[c])throw new Error(`\n\tCannot update @Id columns:\n\tColumn: '${c}' for entity: '${r.name}'\n\t\t\t(table: '${r.tableConfig.name}').\n\t\t\t\t`);if(l=Jn(l),!l.toJSON)throw`Unexpected value ${JSON.stringify(l)} for property ${c} of entity ${this.rawUpdate.update.__driver__.dbEntity.name}`;o[c]=l.toJSON(this.columnAliases,!1,t,n,i)}else delete e[c]}return o}}class Gi extends ji{constructor(e){super(e)}toJSON(e,t,n){return{U:this.rawUpdate.update.__driver__.getRelationJson(this.columnAliases,e,t,n),S:this.setToJSON(this.rawUpdate.set,e,t),W:e.whereClauseToJSON(this.rawUpdate.where,this.columnAliases)}}setToJSON(e,t,n){const i={},o=this.rawUpdate.update.__driver__.dbEntity.propertyMap;return this.setEntityFragmentsToJSON(e,i,[],o,[],t,n),i}setEntityFragmentsToJSON(e,t,n,i,o,r,a){const s=!i.length;for(const c in e){const l=i[c],p=l.entity;if(!l)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tUnknown property: '${c}' for entity: '${p.name}'\n\t\t\t(table: '${p.tableConfig.name}').\n\t\t\t\t`);if(s&&l.isId)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update @Id properties:\n\tProperty: '${c}' for entity: '${p.name}'\n\t\t\t(table: '${p.tableConfig.name}').\n\t\t\t\t`);if(!s&&!l.isId)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tUpdated properties of nested entities must be @Id properties:\n\tProperty: '${c}' for entity: '${p.name}'\n\t\t\t(table: '${p.tableConfig.name}').\n\t\t\t\t`);const d=[...n];d.push(l),this.setFragmentToJSON(e,t,d,c,o,r,a)}}setFragmentToJSON(e,t,n,i,o,r,a){const s=n[n.length-1],c=s.entity;let l=e[i];if(void 0!==l){if(l=Jn(l),l.toJSON){if(1!==s.propertyColumns.length)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update multi-column property to a single value:\n\tProperty: '${i}' for entity: '${c.name}'\n\t\t\t(table: '${c.tableConfig.name}')\n\t\t\thas ${s.propertyColumns.length+1} columns \n\t\t\tbut is being updates to a single value.\n\t\t\t\t`);{let e=s.propertyColumns[0].column;if(o.length)for(let t=o.length-1;t>=0;t--){const n=o[t].manyRelationColumns.filter((t=>t.manyColumn.index===e.index))[0];e=n.oneColumn}if(t[e.name]){const t=n[0];throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\tCannot update the same column multiple times in the same statement:\n\tProperty: '${i}' for entity: '${c.name}'\n\t\t\t(table: '${c.tableConfig.name}')\n\tmaps to table: ${t.entity.tableConfig.name}, column: ${e.name}\n\t\twhich has already been set in this update statement (above).\n\t\t\t\t`)}return void(t[e.name]=l.toJSON(this.columnAliases,!1,r,a))}}if("object"!=typeof l)throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tUnexpected value ${JSON.stringify(l)} \n\t\t\t\t\tfor property: '${i}' of entity: '${this.rawUpdate.update.__driver__.dbEntity.name}'\n\t\t\t\tExpecting a nested property definition.\n\t\t\t\t`);{const e=s.relation[0],c=[...o];switch(c.push(e),e.relationType){case fe.MANY_TO_ONE:this.setEntityFragmentsToJSON(l,t,n,e.relationEntity.propertyMap,c,r,a);break;case fe.ONE_TO_MANY:throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tCannot update @OneToMany properties:\n\t\t\t\t\tProperty: '${i}' of entity: '${this.rawUpdate.update.__driver__.dbEntity.name}\n\t\t\t\t\tis a @OneToMany relation and cannot be updated since it is\n\t\t\t\t\tassumed to be based on @Id columns (which cannot be updated).'\n\t\t\t\t`);default:throw new Error(`\n${this.getPropertyChainDesription(n)}\n\n\t\t\t\tUndefined relation type: \n\t\t\t\t\tProperty: '${i}' of entity: '${this.rawUpdate.update.__driver__.dbEntity.name}'\n\t\t\t\t\tis defined with an unknown type of a relation.  Expecting either\n\t\t\t\t\t@ManyToOne(...)\n\t\t\t\t\tor\n\t\t\t\t\t@OneToMany(...)\n\t\t\t\t`)}}}else delete e[i]}getPropertyChainDesription(e){let t="    ",n="",i="...\n}",o=`\nUpdated Entity: ${e[0].entity.name}, property chain:\n{`;const r=e.length;for(let a=0;a<r;a++){o+=`${t}${e[a].name}: `,o+=a+1<r?": {\n":"VALUE",i=t+`...\n${n}}`,n=t,t+="    "}return`${o}\n${i}`}}function qi(e){return null!=e}function Yi(e,t,n=!1){if("object"==typeof e){if(e instanceof Date)return t instanceof Date&&e.getTime()===t.getTime();{if("object"!=typeof t)return!1;if(!n)return!0;let i={};for(let o in e)if(i[o]=!0,!Yi(e[o],t[o],n))return!1;for(let e in t)if(!i[e])return!1;return!0}}return e?!!t&&e===t:""===e?""===t:!1===e?!1===t:0===e?0===t:""!==t&&!1!==t&&0!==t&&!t}function Qi(e,t){return e<t?-1:e>t?1:0}var Ji=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wi=class{getObjectClassName(e){if("object"!=typeof e||null===e)throw new Error("Not an object instance");return this.getClassName(e.constructor)}getClassName(e){if("function"!=typeof e)throw new Error("Not a constructor function");return e.name}exists(e){return qi(e)}isAppliable(e){return e instanceof gn}getQuery(e){return this.getRawQuery(e)}getRawQuery(e){return e instanceof Function?e():e}getEntityQuery(e){return new ki(this.getRawQuery(e))}};Wi=Ji([function(e){}],Wi);var zi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ki=class{getFieldQueryJson(e,t,n){return new xi(e,t).toJSON(n,this,this.relationManager)}};zi([function(e,t){}],Ki.prototype,"relationManager",void 0),Ki=zi([function(e){}],Ki);var Xi=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zi=class{getAllColumns(e){return e.__driver__.allColumns}getAllNonGeneratedColumns(e){return this.getAllColumns(e).filter((e=>!e.dbColumn.isGenerated))}getAllInsertableColumns(e){return this.getAllColumns(e).filter((t=>{if(t.dbColumn.isGenerated)return!1;if(e.__driver__.dbEntity.isRepositoryEntity)switch(t.dbColumn.name){case de.SYSTEM_WIDE_OPERATION_ID:return!1}return!0}))}getDbEntity(e){return e.__driver__.dbEntity}getNewEntity(e,t){const n=e.__driver__.dbEntity,i=t.qApplications[n.applicationVersion.application.index].__constructors__[n.name];return i?new i:{}}};Zi=Xi([function(e){}],Zi);var eo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let to=class{whereClauseToJSON(e,t){if(!e)return null;let n=e,i={c:n.c,o:n.o};switch(n.c){case ge.LOGICAL:let e=n,o=i;switch(n.o){case Oe.NOT:o.v=this.whereClauseToJSON(e.v,t);break;case Oe.AND:case Oe.OR:o.v=e.v.map((e=>this.whereClauseToJSON(e,t)));break;default:throw new Error(`Unsupported logical operation '${n.o}'`)}break;case ge.FUNCTION:let r=n,a=r.getQuery(),s=new li(a,t.entityAliases).toJSON(this,this.fieldUtils,this.relationManager);i=r.toJSON(s);break;case ge.BOOLEAN:case ge.DATE:case ge.NUMBER:case ge.STRING:case ge.UNTYPED:let c=n,l=i;l.l=this.convertLRValue(c.l,t);let p=c.r;l.r=p instanceof Array?p.map((e=>this.convertLRValue(e,t))):this.convertLRValue(p,t)}return i}convertLRValue(e,t){switch(typeof(e=Jn(e))){case"undefined":throw new Error("'undefined' is not a valid L or R value");default:if(e instanceof gn)return e.toJSON(t,!1,this,this.fieldUtils,this.relationManager);{let n=e;return this.fieldUtils.getFieldQueryJson(n,t.entityAliases,this)}}}};eo([function(e,t){}],to.prototype,"fieldUtils",void 0),eo([function(e,t){}],to.prototype,"relationManager",void 0),to=eo([function(e){}],to);const no={airportSelectField:!0,insert:!0,update:!1},io={__allFields__:!0};function oo(e){return e&&!0===e.airportSelectField}function ro(e){return e&&!1===e.airportSelectField}var ao,so=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let co=ao=class{getDbEntity(e,t){return this.airportDatabase.applications[e].currentVersion[0].applicationVersion.entities[t]}isActorId(e){return e===de.ACTOR_ID}isActorRecordId(e){return e===de.ACTOR_RECORD_ID}isRepositoryId(e){return e===de.REPOSITORY_ID}doCascade(e,t){if(e.relationType!==fe.ONE_TO_MANY)return!1;if(!e.oneToManyElems)return!1;switch(t){case Te.CREATE:case Te.UPDATE:case Te.DELETE:return!0;default:throw new Error(`Unsupported CRUDOperation '${t}' for cascade check.`)}}getQEntityConstructor(e){return this.airportDatabase.qApplications[e.applicationVersion.application.index].__qConstructors__[e.index]}getEntityConstructor(e){return this.airportDatabase.qApplications[e.applicationVersion.application.index].__constructors__[e.name]}getNewEntity(e){const t=this.getEntityConstructor(e);return t?new t:{}}isIdEmpty(e){return!e&&0!==e}isEmpty(e){return this.isIdEmpty(e)&&!1!==e&&""!==e}isRelationColumn(e){return this.isManyRelationColumn(e)||this.isOneRelationColumn(e)}isManyRelationColumn(e){return!(!e.manyRelationColumns||!e.manyRelationColumns.length)}isOneRelationColumn(e){return!(!e.oneRelationColumns||!e.oneRelationColumns.length)}getIdKey(e,t,n=!0,i){return this.getIdKeyInfo(e,t,n,i).arrayByIdColumnIndex.join("|")}getIdKeyInfo(e,t,n=!0,i){if(!t.idColumns.length){if(n)throw new Error(`@Id is not defined on entity '${t.name}'.`);return null}const o={arrayByIdColumnIndex:[],mapByIdColumnName:{}};for(const r of t.idColumns){const[a,s]=this.getColumnPropertyNameChainsAndValue(t,r,e,!0,n);i&&i(r,s,a),o.arrayByIdColumnIndex.push(s),o.mapByIdColumnName[r.name]=s}return o}getColumnPropertyNameChainsAndValue(e,t,n,i=!1,o=!0){const r=this.getColumnValuesAndPaths(t,n,[],i,o),a=r[0],s=[a.path],c=a.value;return r.reduce(((n,i)=>{if(!Yi(n.value,i.value,!0))throw new Error(`Values differ for ${e.name}.${t.name}:\n\t\t\t\t\t\t'${n.path.join(".")}' = ${n.value}\n\t\t\t\t\t\t'${i.path.join(".")}' = ${i.value}`);return s.push(i.path),i})),[s,c]}addRelationToEntitySelectClause(e,t,n=!1){this.forEachColumnTypeOfRelation(e,((i,o)=>{let r=!0,a=t;const s=o[0];s.forEach(((t,i)=>{let o=a[t];if(o)if(i<s.length-1){if(!(o instanceof Object)||o instanceof Date)throw new Error(`Invalid entry:\n\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t\t${t}: ${o}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tin '${e.property.entity.name}.${e.property.name}',\n\t\t\t\t\t\t\t\tProperty must be an Object.`)}else{if(!n&&!oo(o)){const n=e.property.isId?`'${e.property.entity.name}.${e.property.name}' is an @Id property`:`'${e.property.entity.name}' has no @Id - all properties are treated as @Ids`;throw new Error(`Defaults are not allowed in:\n\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t\t${t}: ${o}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t${n}.`)}r=!1}else o={},this.entityStateManager.markAsStub(o),a[t]=o;a=o})),r&&(a.airportSelectField=!0)}))}forEachColumnOfRelation(e,t,n,i=!0){const o=e.property.entity;for(const i of e.manyRelationColumns){const e=i.manyColumn,[r,a]=this.getColumnPropertyNameChainsAndValue(o,e,t);if(n(e,a,r))return}}forEachColumnTypeOfRelation(e,t){for(const n of e.manyRelationColumns){const e=n.manyColumn;if(t(e,this.getColumnPaths(e,[])))return}}getSheetSelectFromSetClause(e,t,n,i){const o=[];let r,a,s,c;for(const l in e.columns){const p=e.columns[l];let d;let u=!1;if(p.propertyColumns.some((e=>(d=e.property,d.isId)))){if(n[p.name])throw new Error(i+`Cannot update @Id column '${p.name}' \nof property '${e.name}.${d.name}'.`);this.addColumnToSheetSelect(p,t,o)}else n[p.name]&&(u=!0,this.addColumnToSheetSelect(p,t,o));const f=o.length-1;switch(p.name){case de.ACTOR_ID:r=f;break;case de.ACTOR_RECORD_ID:a=f;break;case de.REPOSITORY_ID:s=f;break;case de.SYSTEM_WIDE_OPERATION_ID:if(u)throw new Error(i+"Cannot update 'systemWideOperationId' of Repository Entities.");c=p}}return{actorIdColumnIndex:r,actorRecordIdColumnIndex:a,repositoryIdColumnIndex:s,selectClause:o,systemWideOperationIdColumn:c}}getColumnValuesAndPaths(e,t,n,i=!1,o=!0){if(this.isManyRelationColumn(e)){let o=[];for(const r of e.manyRelationColumns){const e=r.manyRelation.property,a=[...n],s=e.name;a.push(s);const c=t[s];if(c){const e=r.oneColumn,t=this.getColumnValuesAndPaths(e,c,a,i);o=o.concat(t)}else{if(i)throw new Error(`Cannot retrieve composite Id value, value chain '${a.join(".")}' is : ${c}.`);o.push({path:a,value:c})}}return o}{const r=e.propertyColumns[0].property,a=[...n],s=r.name;a.push(s);let c=t[s];if(i&&this.isIdEmpty(c)){if(!e.isGenerated)throw new Error(`Cannot retrieve composite Id value, value chain '${a.join(".")}' is : ${c}.`);c=o?--ao.TEMP_ID:null,t[s]=c}return[{path:a,value:c}]}}getColumnPaths(e,t){let n=[];if(this.isManyRelationColumn(e))for(const i of e.manyRelationColumns){const e=i.manyRelation.property,o=[...t];o.push(e.name);const r=i.oneColumn,a=this.getColumnPaths(r,o);n=n.concat(a)}else{const i=e.propertyColumns[0].property,o=[...t];o.push(i.name),n.push(o)}return n}addColumnToSheetSelect(e,t,n){if(this.isManyRelationColumn(e)){const i=this.getColumnPaths(e,[])[0];let o=t[i[0]];i.reduce(((e,t)=>(o=o[t],t))),n.push(o)}else n.push(t[e.propertyColumns[0].property.name])}handleNoId(e,t,n,i,o){if(!o)throw new Error(`Cannot retrieve composite Id value, value chain '${n.join(".")}' is : ${i}.`);return!o(e,i,n)}};var lo,po,uo;co.TEMP_ID=0,so([function(e,t){}],co.prototype,"airportDatabase",void 0),so([function(e,t){}],co.prototype,"entityStateManager",void 0),co=ao=so([function(e){}],co),function(e){e.DB_ID_FIELD="createDbId"}(lo||(lo={})),function(e){e.CURRENT_DB=void 0,e.DEFAULT_DB="air-default_db",e.ALL_DBS="air-all_dbs",e.OWN_DB_FACADE="air-own_db_facade"}(po||(po={})),function(e){e.CONSTRAINT="CONSTRAINT",e.NO_CONSTRAINT="NO_CONSTRAINT",e.PROVIDER_DEFAULT="PROVIDER_DEFAULT"}(uo||(uo={}));const fo={applications:[],entityMap:new Map,functions:{abs:function(e){return e instanceof xn?e.applySqlFunction(Kn(me.AVG)):new An(e).applySqlFunction(Kn(me.ABS))},avg:function(e){return e instanceof xn?e.applySqlFunction(Kn(me.AVG)):new An(e).applySqlFunction(Kn(me.AVG))},count:function(e){return e instanceof gn?e.applySqlFunction(Kn(me.COUNT)):Xn(e).applySqlFunction(Kn(me.COUNT))},max:Zn,min:function(e){return e instanceof gn?e.applySqlFunction(Kn(me.MIN)):Xn(e).applySqlFunction(Kn(me.MIN))},sum:function(e){return e instanceof xn?e.applySqlFunction(Kn(me.SUM)):new An(e).applySqlFunction(Kn(me.SUM))},ucase:function(e){return e instanceof Sn?e.applySqlFunction(Kn(me.UCASE)):new Cn(e).applySqlFunction(Kn(me.UCASE))},lcase:function(e){return e instanceof Sn?e.applySqlFunction(Kn(me.LCASE)):new Cn(e).applySqlFunction(Kn(me.LCASE))},mid:function(e,t,n){return e instanceof Sn?e.applySqlFunction(Kn(me.MID,[t,n])):new Cn(e).applySqlFunction(Kn(me.MID,[t,n]))},len:function(e){return e instanceof Sn?e.applySqlFunction(Kn(me.LEN)):new Cn(e).applySqlFunction(Kn(me.LEN))},round:function(e,t=0){return e instanceof xn?e.applySqlFunction(Kn(me.ROUND,[t])):new An(e).applySqlFunction(Kn(me.ROUND,[t]))},now:function(){return new Nn(null).applySqlFunction(Kn(me.NOW))},format:function(e,...t){return e instanceof Sn?e.applySqlFunction(Kn(me.FORMAT,t)):new Cn(e).applySqlFunction(Kn(me.FORMAT,t))},replace:function(e,t,n){return e instanceof Sn?e.applySqlFunction(Kn(me.REPLACE,[t,n])):new Cn(e).applySqlFunction(Kn(me.REPLACE,[t,n]))},trim:function(e){return e instanceof Sn?e.applySqlFunction(Kn(me.TRIM)):new Cn(e).applySqlFunction(Kn(me.TRIM))},distinct:function(e){let t=new ni(e);return t.applySqlFunction(Kn(me.DISTINCT)),t},exists:function(e){if(!e.select)throw new Error("Sub-Query must have SELECT clause defined to be used in EXITS function");return new ii(e).applySqlFunction(Kn(me.EXISTS))},divide:function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.DIVIDE,[t])):new An(e).applySqlFunction(Kn(me.DIVIDE,[t]))},subtract:function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.MINUS,[t])):new An(e).applySqlFunction(Kn(me.MINUS,[t]))},modulus:function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.MODULUS,[t])):new An(e).applySqlFunction(Kn(me.MODULUS,[t]))},multiply:function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.MULTIPLY,[t])):new An(e).applySqlFunction(Kn(me.MULTIPLY,[t]))},add:function(e,t){return e instanceof xn?e.applySqlFunction(Kn(me.PLUS,[t])):new An(e).applySqlFunction(Kn(me.PLUS,[t]))},concat:function(...e){if(e.length>2)throw new Error("Less than two operands passed to 'concat' function.");let t=e[0],n=e.slice(1);return t instanceof Sn?t.applySqlFunction(Kn(me.CONCATENATE,n)):new Cn(t).applySqlFunction(Kn(me.CONCATENATE,n))},union:function(...e){throw new Error("not implemented")},unionAll:function(...e){throw new Error("not implemented")},intersect:function(...e){throw new Error("not implemented")},minus:oi,and:un,not:function(e){return(new yn).not(e)},or:fn,bool:Gn,date:qn,num:Yn,str:Qn,wrapPrimitive:Jn},qApplications:[],QM:{}};var yo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ho=class{get applications(){return fo.applications}get entityMap(){return fo.entityMap}get functions(){return fo.functions}get qApplications(){return fo.qApplications}get QM(){return fo.QM}};ho=yo([function(e){}],ho);const mo=V("air-traffic-control"),Ro=mo.token({class:null,interface:"IAirportDatabase",token:"AIRPORT_DATABASE"}),Io=mo.token({class:co,interface:"IApplicationUtils",token:"APPLICATION_UTILS"}),Eo=mo.token({class:null,interface:"IDatabaseFacade",token:"DATABASE_FACADE"}),go=mo.token({class:ho,interface:"IDatabaseState",token:"DATABASE_STORE"}),Oo=mo.token({class:Wi,interface:"IEntityUtils",token:"ENTITY_UTILS"}),To=mo.token({class:Ki,interface:"IFieldUtils",token:"FIELD_UTILS"}),wo=mo.token({class:Ti,interface:"ILookup",token:"LOOKUP"}),bo=mo.token({class:Si,interface:"INonEntityFind",token:"NON_ENTITY_FIND"}),No=mo.token({class:Di,interface:"INonEntityFindOne",token:"NON_ENTITY_FIND_ONE"}),_o=mo.token({class:Vi,interface:"INonEntitySearch",token:"NON_ENTITY_SEARCH"}),xo=mo.token({class:Li,interface:"INonEntitySearchOne",token:"NON_ENTITY_SEARCH_ONE"}),Ao=mo.token({class:Zi,interface:"IQMetadataUtils",token:"Q_METADATA_UTILS"}),vo=mo.token({class:null,interface:"IQueryFacade",token:"QUERY_FACADE"}),So=mo.token({class:to,interface:"IQueryUtils",token:"QUERY_UTILS"}),Co=mo.token({class:gi,interface:"IRelationManager",token:"RELATION_MANAGER"}),Do=mo.token({class:null,interface:"IRepositoryLoader",token:"REPOSITORY_LOADER"}),Mo=mo.token({class:null,interface:"IUpdateCacheManager",token:"UPDATE_CACHE_MANAGER"});Ro.setDependencies({databaseFacade:Eo,databaseStore:go,find:bo,findOne:No,search:_o,searchOne:xo}),Io.setDependencies({airportDatabase:Ro,entityStateManager:He}),Eo.setDependencies({applicationUtils:Io,entityStateManager:He,updateCacheManager:Mo}),To.setDependencies({relationManager:Co}),wo.setDependencies({entityUtils:Oo,queryFacade:vo}),vo.setDependencies({fieldUtils:To,queryUtils:So,relationManager:Co,transactionalConnector:Ge}),So.setDependencies({fieldUtils:To,relationManager:Co}),Co.setDependencies({applicationUtils:Io}),Mo.setDependencies({applicationUtils:Io,entityStateManager:He});class Vo{constructor(e,t,n){this.dbEntity=e,this.Q=t,this.dao=n,this.find=new Ni(this.dbEntity,n),this.findOne=new _i(this.dbEntity,n)}get from(){return this.Q[this.dbEntity.name]}async insertColumnValues(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertColumnValues(e,n)))}async insertValues(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertValues(e,n)))}async insertColumnValuesGenerateIds(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertColumnValuesGenerateIds(e,n)))}async insertValuesGenerateIds(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.insertValuesGenerateIds(e,n)))}async updateColumnsWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.updateColumnsWhere(e,n)))}async updateWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.updateWhere(e,n)))}async deleteWhere(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.deleteWhere(e,n)))}async save(e,t){return await this.withDbEntity(t,(async(t,n)=>await t.save(e,n)))}async saveToDestination(e,t,n){return await this.withDbEntity(n,(async(n,i)=>await n.saveToDestination(e,t,i)))}async withDbEntity(e,t){e||(e={}),e.startedAt||(e.startedAt=new Date);const n=e.dbEntity;e.dbEntity=this.dbEntity;try{return await t(this.dao.databaseFacade,e)}finally{e.dbEntity=n}}}class Po{Graph(...e){throw new Error("Cannot use this.stub.Find.Graph for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Find).  Instead\n\t\tplease use this.db.find.graph")}Tree(...e){throw new Error("Cannot use this.stub.Find.Tree for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Find).  Instead\n\t\tplease use this.db.find.tree")}}class Lo{Graph(...e){throw new Error("Cannot use this.stub.Find.Graph for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Find).  Instead\n\t\tplease use this.db.find.graph")}Tree(...e){throw new Error("Cannot use this.stub.Find.Tree for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Find).  Instead\n\t\tplease use this.db.find.tree")}}class Uo{Graph(...e){throw new Error("Cannot use this.stub.SearchOne.Graph for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.SearchOne).  Instead\n\t\tplease use this.db.searchOne.graph")}Tree(...e){throw new Error("Cannot use this.stub.SearchOne.Tree for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.SearchOne).  Instead\n\t\tplease use this.db.searchOne.tree")}}class jo{Graph(...e){throw new Error("Cannot use this.stub.Search.Graph for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Search).  Instead\n\t\tplease use this.db.search.graph")}Tree(...e){throw new Error("Cannot use this.stub.Search.Tree for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Search).  Instead\n\t\tplease use this.db.search.tree")}}class Fo{constructor(){this.Find=new Lo,this.FindOne=new Po,this.Search=new jo,this.SearchOne=new Uo}save(e){throw new Error("Cannot use this.stub.save for manual queries (it\n\t\tis meant for prepared queries (with @${EntityName}Dao.Save).  Instead\n\t\tplease use this.db.save")}}var ko=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Bo=class{constructor(e,t,n=!1){this.internal=n,this.stub=new Fo;const i=t.__dbApplication__.currentVersion[0].applicationVersion.entities[e];this.db=new Vo(i,t,this)}static BaseSave(e){return function(e,t){}}async count(e){throw new Error("Not Implemented")}exists(e,t){throw new Error("Not Implemented")}repositoryId(){return{actor:{id:no,uuId:no},actorRecordId:no,ageSuitability:no,repository:{id:no,uuId:no}}}async findAll(e,t,n=!1){if(e)throw new Error("Not implemented");return await this.db.find.graph({select:{},from:[this.db.from]},t)}async findAllAsTrees(e,t,n=!1){if(e)throw new Error("Not implemented");return await this.db.find.tree({select:{},from:[this.db.from]},t)}findById(e,t,n=!1){throw new Error("Not implemented")}async save(e,t){return await this.db.save(e,this.ensureContext(t))}markForDeletion(e,t){if(e instanceof Array)for(const t of e)this.entityStateManager.markForDeletion(t);else this.entityStateManager.markForDeletion(e)}ensureContext(e){return wi(e)}};ko([function(e,t){}],Bo.prototype,"airportDatabase",void 0),ko([function(e,t){}],Bo.prototype,"databaseFacade",void 0),ko([function(e,t){}],Bo.prototype,"entityStateManager",void 0),ko([function(e,t){}],Bo.prototype,"lookup",void 0),ko([function(e,t){}],Bo.prototype,"updateCacheManager",void 0),Bo=ko([function(e){}],Bo);class Ho{Graph(e){return function(e,t){}}Tree(e){return function(e,t){}}}var $o;!function(e){e.ARRAY="ARRAY",e.BOOLEAN="BOOLEAN",e.BOOLEAN_VALUE="BOOLEAN_VALUE",e.DATE="DATE",e.DB_ENTITY="DB_ENTITY",e.NUMBER="NUMBER",e.NUMBER_VALUE="NUMBER_VALUE",e.OBJECT="OBJECT",e.STRING="STRING",e.STRING_VALUE="STRING_VALUE",e.TYPE_UNION="TYPE_UNION"}($o||($o={}));class Go{constructor(e){this.dbEntity=e}get ids(){const e=this.dbEntity.properties.filter((e=>e.isId)).map((e=>e.name));return this.getSelect(e,!1)}get fields(){const e=this.dbEntity.properties.filter((e=>!e.relation||!e.relation.length)).map((e=>e.name));return this.getSelect(e,!1)}get manyToOnes(){return this.getRelationSelect(fe.MANY_TO_ONE)}get oneToManys(){return this.getRelationSelect(fe.ONE_TO_MANY)}getRelationSelect(e){const t=this.dbEntity.properties.filter((t=>t.relation&&t.relation.length&&t.relation[0].relationType===e)).map((e=>e.name));return this.getSelect(t,!0)}getSelect(e,t){const n={};for(const i of e)n[i]=t?{}:no;return n}}class qo{constructor(e,t){this.dbEntity="number"==typeof e?t.__dbApplication__.currentVersion[0].applicationVersion.entities[e]:e,this.select=new Go(this.dbEntity)}getIdStub(e){throw new Error("Not Implemented.")}getIdStubs(e){throw new Error("Not Implemented.")}}var Yo=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Qo=class{createSelector(...e){if(e.length<2||e.length>6)throw new Error("Invalid createSelector call, Expecting 1 to 5 selectors and a callback.");const t=e.slice(0,e.length-1),n=e[e.length-1];let i;i=t.length>1?Kt(t.map((e=>e.observable))):t[0].observable;let o=i.pipe((void 0===a&&(a=Nt),r=null!=r?r:Zt,vt((function(e,t){var n,i=!0;e.subscribe(new St(t,(function(e){var o=a(e);!i&&r(n,o)||(i=!1,n=o,t.next(e))})))}))),Xt((e=>n(e))));var r,a;return this.getSelector(o)}createRootSelector(e){return this.getSelector(e)}getSelector(e){let t=function(){let t;return e.subscribe((e=>t=e)).unsubscribe(),t};return t.observable=e,t}};function Jo(e,t){return e&&e.currentVersion[0].applicationVersion.entities[t]}async function Wo(e,t){return(await zo(1,e,t))[0]}async function zo(e,t,n){if(!e)return[];const i=t.QM[de.SYS_WIDE_OP_ID_APPLICATION].__dbApplication__.currentVersion[0].applicationVersion.entityMapByName[de.SYS_WIDE_OP_ID_ENTITY].columnMap.ID;return(await n.generateSequenceNumbers([i],[e]))[0]}Qo=Yo([function(e){}],Qo);const Ko=V("check-in"),Xo=Ko.token({class:null,interface:"IApiRegistry",token:"API_REGISTRY"}),Zo=Ko.token({class:null,interface:"IApiValidator",token:"API_VALIDATOR"}),er=Ko.token({class:null,interface:"IClientQueryManager",token:"CLIENT_QUERY_MANAGER"}),tr=Ko.token({class:Bo,interface:"class Dao",token:"DAO"}),nr=Ko.token({class:null,interface:"IOperationDeserializer",token:"OPERATION_DESERIALIZER"}),ir=Ko.token({class:null,interface:"IQueryParameterDeserializer",token:"QUERY_PARAMETER_DESERIALIZER"}),or=Ko.token({class:null,interface:"IQueryParameterDeserializer",token:"QUERY_RESULTS_SERIALIZER"}),rr=Ko.token({class:Qo,interface:"ISelectorManager",token:"SELECTOR_MANAGER"}),ar=Ko.token({class:null,interface:"ISequenceGenerator",token:"SEQUENCE_GENERATOR"});tr.setDependencies({airportDatabase:Ro,databaseFacade:Eo,entityStateManager:He,lookup:wo,updateCacheManager:Mo});const sr=V("terminal-map"),cr=sr.token({class:null,interface:"IApplicationInitializer",token:"APPLICATION_INITIALIZER"}),lr=sr.token({class:null,interface:"IDomainRetriever",token:"DOMAIN_RETRIEVER"}),pr=sr.token({class:null,interface:"IStoreDriver",token:"STORE_DRIVER"}),dr=sr.token({class:nn,interface:"ITerminalStore",token:"TERMINAL_STORE"}),ur=sr.token({class:null,interface:"ITransactionManager",token:"TRANSACTION_MANAGER"}),fr=sr.token({class:null,interface:"ITransactionalReceiver",token:"TRANSACTIONAL_RECEIVER"}),yr=sr.token({class:null,interface:"ITransactionalServer",token:"TRANSACTIONAL_SERVER"});cr.setDependencies({airportDatabase:Ro,sequenceGenerator:ar,terminalStore:dr}),lr.setDependencies({transactionalConnector:Ge}),dr.setDependencies({selectorManager:rr}),ur.setDependencies({storeDriver:pr,terminalStore:dr}),fr.setDependencies({applicationInitializer:cr}),yr.setDependencies({operationContextLoader:$e,terminalStore:dr,transactionManager:ur});var hr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mr=class{async loadRepository(e,t,n){if(n.repositoryExistenceChecked)return;n.repositoryExistenceChecked=!0;const i=await this.repositoryDao.getRepositoryLoadInfo(e,t,n);let o=!1,r=0;if(i){if(!i.immutable){o=!0;for(const e of i.repositoryTransactionHistory)r<e.saveTimestamp&&(r=e.saveTimestamp)}}else o=!0;if(!o)return;const a=(new Date).getTime(),s=await this.synchronizationAdapterLoader.load(e);let c;try{if(r){if(r>=a-1e4)return;r-=1e5,c=await s.getTransactionsForRepository(e,t,r)}else c=await s.getTransactionsForRepository(e,t);const i=new Map;for(const e of c)i.set(e.history.uuId,e);await this.synchronizationInManager.receiveMessages(i,n)}catch(e){return void console.error(e)}}};var Rr;hr([function(e,t){}],mr.prototype,"repositoryDao",void 0),hr([function(e,t){}],mr.prototype,"synchronizationAdapterLoader",void 0),hr([function(e,t){}],mr.prototype,"synchronizationInManager",void 0),mr=hr([function(e){}],mr);var Ir=new Uint8Array(16);function Er(){if(!Rr&&!(Rr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rr(Ir)}var gr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Or(e){return"string"==typeof e&&gr.test(e)}for(var Tr=[],wr=0;wr<256;++wr)Tr.push((wr+256).toString(16).substr(1));function br(e,t,n){var i=(e=e||{}).random||(e.rng||Er)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=i[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Tr[e[t+0]]+Tr[e[t+1]]+Tr[e[t+2]]+Tr[e[t+3]]+"-"+Tr[e[t+4]]+Tr[e[t+5]]+"-"+Tr[e[t+6]]+Tr[e[t+7]]+"-"+Tr[e[t+8]]+Tr[e[t+9]]+"-"+Tr[e[t+10]]+Tr[e[t+11]]+Tr[e[t+12]]+Tr[e[t+13]]+Tr[e[t+14]]+Tr[e[t+15]]).toLowerCase();if(!Or(n))throw TypeError("Stringified UUID is invalid");return n}(i)}var Nr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _r=class{async initialize(){}async createRepository(e,t){if(t.newRepository)throw new Error("Cannot create more than one repository per transaction:\nAttempting to create a new repository and Operation Context\nalready contains a new repository.");let n=await this.createRepositoryRecord(e,t);return t.newRepository=n,n}goOffline(){throw new Error("not implemented")}getUpdateState(e){throw new Error("not implemented")}setUpdateStateForAll(e){throw new Error("not implemented")}setUpdateState(e,t){throw new Error("not implemented")}getRepositoryRecord(e){return{ageSuitability:0,createdAt:new Date,id:null,immutable:!1,owner:e.user,repositoryTransactionHistory:[],source:"localhost:9000",uuId:br()}}async createRepositoryRecord(e,t){const n=this.getRepositoryRecord(e);return await this.repositoryDao.save(n,t),n}ensureRepositoryScopeOnInsertValues(e,t){let n=t.insertInto;if(!n.__driver__.dbEntity.isRepositoryEntity)return t;let i=t.columns.slice();if(i.some(((e,t)=>"repository"===e.dbProperty.name)))return t;i.push(n.repository);let o=t.values.slice();for(let t=0;t<o.length;t++){let n=o[t].slice();o[t]=n,n.push(e.id)}return{insertInto:n,columns:i,values:o}}ensureRepositoryLinkOnUpdateWhere(e,t,n){if(e.__driver__.dbEntity.isRepositoryEntity)return{update:n.update,set:n.set,where:un(n.where,e.repository.id.equals(t.id))}}ensureRepositoryScopeOnDeleteWhere(e,t,n){if(e.__driver__.dbEntity.isRepositoryEntity)return{deleteFrom:n.deleteFrom,where:un(n.where,e.repository.id.equals(t.id))}}};Nr([function(e,t){}],_r.prototype,"repositoryDao",void 0),_r=Nr([function(e){}],_r);var xr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ar=class{constructor(){this.recordHistory=[]}};xr([function(e,t){},function(e,t){},function(e,t){}],Ar.prototype,"id",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"orderNumber",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"changeType",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"systemWideOperationId",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"entity",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"actor",void 0),xr([function(e,t){},function(e,t){}],Ar.prototype,"repositoryTransactionHistory",void 0),xr([function(e,t){}],Ar.prototype,"recordHistory",void 0),Ar=xr([function(e){},function(e){}],Ar);var vr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sr=class{constructor(){this.newValues=[],this.oldValues=[]}};vr([function(e,t){},function(e,t){},function(e,t){}],Sr.prototype,"id",void 0),vr([function(e,t){},function(e,t){}],Sr.prototype,"actorRecordId",void 0),vr([function(e,t){},function(e,t){}],Sr.prototype,"actor",void 0),vr([function(e,t){},function(e,t){}],Sr.prototype,"operationHistory",void 0),vr([function(e,t){}],Sr.prototype,"newValues",void 0),vr([function(e,t){}],Sr.prototype,"oldValues",void 0),vr([function(e,t){}],Sr.prototype,"tableColumnMap",void 0),Sr=vr([function(e){},function(e){}],Sr);var Cr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Dr=class{};Cr([function(e,t){},function(e,t){},function(e,t){}],Dr.prototype,"recordHistory",void 0),Cr([function(e,t){},function(e,t){},function(e,t){}],Dr.prototype,"columnIndex",void 0),Cr([function(e,t){},function(e,t){}],Dr.prototype,"newValue",void 0),Dr=Cr([function(e){},function(e){}],Dr);var Mr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vr=class{};var Pr;Mr([function(e,t){},function(e,t){},function(e,t){}],Vr.prototype,"recordHistory",void 0),Mr([function(e,t){},function(e,t){},function(e,t){}],Vr.prototype,"columnIndex",void 0),Mr([function(e,t){},function(e,t){}],Vr.prototype,"oldValue",void 0),Vr=Mr([function(e){},function(e){}],Vr),function(e){e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.REMOTE_REFERENCE="REMOTE_REFERENCE"}(Pr||(Pr={}));var Lr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ur=class{constructor(e){this.repositoryTransactionType=Pr.LOCAL,this.operationHistory=[],e&&(this.id=e.id,this.transactionHistory=e.transactionHistory,this.repository=e.repository,this.saveTimestamp=e.saveTimestamp,this.operationHistory=e.operationHistory)}};Lr([function(e,t){},function(e,t){},function(e,t){}],Ur.prototype,"id",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"repositoryTransactionType",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"saveTimestamp",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"syncTimestamp",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"uuId",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"isRepositoryCreation",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"repository",void 0),Lr([function(e,t){},function(e,t){}],Ur.prototype,"transactionHistory",void 0),Lr([function(e,t){}],Ur.prototype,"operationHistory",void 0),Ur=Lr([function(e){},function(e){}],Ur);var jr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Fr=class{constructor(){this.repositoryTransactionHistories=[],this.repositoryTransactionHistoryMap={},this.applicationMap=new X,this.allOperationHistory=[],this.allRecordHistory=[],this.allRecordHistoryNewValues=[],this.allRecordHistoryOldValues=[]}};jr([function(e,t){},function(e,t){},function(e,t){}],Fr.prototype,"id",void 0),jr([function(e,t){},function(e,t){}],Fr.prototype,"transactionType",void 0),jr([function(e,t){}],Fr.prototype,"repositoryTransactionHistories",void 0),jr([function(e,t){}],Fr.prototype,"repositoryTransactionHistoryMap",void 0),jr([function(e,t){}],Fr.prototype,"applicationMap",void 0),jr([function(e,t){}],Fr.prototype,"allOperationHistory",void 0),jr([function(e,t){}],Fr.prototype,"allRecordHistory",void 0),jr([function(e,t){}],Fr.prototype,"allRecordHistoryNewValues",void 0),jr([function(e,t){}],Fr.prototype,"allRecordHistoryOldValues",void 0),Fr=jr([function(e){},function(e){}],Fr);var kr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Br=class{};kr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Br.prototype,"id",void 0),kr([function(e,t){},function(e,t){}],Br.prototype,"uuId",void 0),kr([function(e,t){},function(e,t){}],Br.prototype,"user",void 0),kr([function(e,t){},function(e,t){}],Br.prototype,"terminal",void 0),kr([function(e,t){},function(e,t){}],Br.prototype,"application",void 0),Br=kr([function(e){}],Br);var Hr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $r=class{constructor(){this.repositoryTransactionHistory=[]}};Hr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],$r.prototype,"id",void 0),Hr([function(e,t){},function(e,t){}],$r.prototype,"ageSuitability",void 0),Hr([function(e,t){},function(e,t){}],$r.prototype,"createdAt",void 0),Hr([function(e,t){}],$r.prototype,"immutable",void 0),Hr([function(e,t){},function(e,t){}],$r.prototype,"source",void 0),Hr([function(e,t){},function(e,t){}],$r.prototype,"uuId",void 0),Hr([function(e,t){},function(e,t){}],$r.prototype,"owner",void 0),Hr([function(e,t){}],$r.prototype,"repositoryTransactionHistory",void 0),$r=Hr([function(e){},function(e){}],$r);var Gr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let qr=class{};Gr([function(e,t){},function(e,t){},function(e,t){}],qr.prototype,"repository",void 0),Gr([function(e,t){},function(e,t){},function(e,t){}],qr.prototype,"actor",void 0),Gr([function(e,t){},function(e,t){},function(e,t){}],qr.prototype,"actorRecordId",void 0),Gr([function(e,t){},function(e,t){}],qr.prototype,"ageSuitability",void 0),Gr([function(e,t){}],qr.prototype,"systemWideOperationId",void 0),Gr([function(e,t){},function(e,t){}],qr.prototype,"originalRepository",void 0),Gr([function(e,t){},function(e,t){}],qr.prototype,"originalActor",void 0),Gr([function(e,t){}],qr.prototype,"originalActorRecordId",void 0),qr=Gr([function(e){}],qr);var Yr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Qr=class{};Yr([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],Qr.prototype,"id",void 0),Yr([function(e,t){},function(e,t){},function(e,t){}],Qr.prototype,"repository",void 0),Yr([function(e,t){},function(e,t){}],Qr.prototype,"applicationIndex",void 0),Qr=Yr([function(e){},function(e){}],Qr);var Jr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Wr=class extends qr{};Wr=Jr([function(e){}],Wr);var zr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Kr=class{};Kr=zr([function(e){}],Kr);var Xr=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zr=class extends qr{};Xr([function(e,t){}],Zr.prototype,"createdAt",void 0),Zr=Xr([function(e){}],Zr);var ea=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ta=class{};ea([function(e,t){},function(e,t){}],ta.prototype,"user",void 0),ea([function(e,t){}],ta.prototype,"createdAt",void 0),ta=ea([function(e){}],ta);var na=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ia=class extends Zr{};na([function(e,t){}],ia.prototype,"updatedAt",void 0),ia=na([function(e){}],ia);var oa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ra=class extends ta{};oa([function(e,t){}],ra.prototype,"updatedAt",void 0),ra=oa([function(e){}],ra);var aa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let sa=class{};sa=aa([function(e){}],sa);const ca={__constructors__:{Actor:Br,ChildRepoRow:Wr,ChildRow:Kr,ImmutableRepoRow:Zr,ImmutableRow:ta,MutableRepoRow:ia,MutableRow:ra,OperationHistory:Ar,RecordHistory:Sr,RecordHistoryNewValue:Dr,RecordHistoryOldValue:Vr,ReferenceRow:sa,Repository:$r,RepositoryApplication:Qr,RepositoryEntity:qr,RepositoryTransactionHistory:Ur,TransactionHistory:Fr},domain:"air",name:"@airport/holding-pattern"},la=ca;function pa(e){return Jo(la.__dbApplication__,e)}k.db().eventuallyGet(Ro).then((e=>{e.QM[Q(ca)]=la}));class da extends Bo{constructor(e){super(e,la)}}class ua extends da{constructor(){super(1)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(1)}}ua.Find=new Ho,ua.FindOne=new Ho,ua.Search=new Ho,ua.SearchOne=new Ho;class fa extends da{constructor(){super(5)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(5)}}fa.Find=new Ho,fa.FindOne=new Ho,fa.Search=new Ho,fa.SearchOne=new Ho;class ya extends da{constructor(){super(0)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(0)}}ya.Find=new Ho,ya.FindOne=new Ho,ya.Search=new Ho,ya.SearchOne=new Ho;class ha extends da{constructor(){super(6)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(6)}}ha.Find=new Ho,ha.FindOne=new Ho,ha.Search=new Ho,ha.SearchOne=new Ho;class ma extends da{constructor(){super(7)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(7)}}ma.Find=new Ho,ma.FindOne=new Ho,ma.Search=new Ho,ma.SearchOne=new Ho;class Ra extends da{constructor(){super(2)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(2)}}Ra.Find=new Ho,Ra.FindOne=new Ho,Ra.Search=new Ho,Ra.SearchOne=new Ho;class Ia extends da{constructor(){super(8)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(8)}}Ia.Find=new Ho,Ia.FindOne=new Ho,Ia.Search=new Ho,Ia.SearchOne=new Ho;class Ea extends da{constructor(){super(4)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(4)}}Ea.Find=new Ho,Ea.FindOne=new Ho,Ea.Search=new Ho,Ea.SearchOne=new Ho;class ga extends da{constructor(){super(3)}static Save(e){return Bo.BaseSave(e)}static diSet(){return pa(3)}}ga.Find=new Ho,ga.FindOne=new Ho,ga.Search=new Ho,ga.SearchOne=new Ho;class Oa extends qo{constructor(e){super(e,la)}}class Ta extends Oa{static diSet(){return pa(5)}constructor(){super(5)}}class wa extends Oa{static diSet(){return pa(0)}constructor(){super(0)}}class ba extends Oa{static diSet(){return pa(6)}constructor(){super(6)}}class Na extends Oa{static diSet(){return pa(7)}constructor(){super(7)}}class _a extends Oa{static diSet(){return pa(4)}constructor(){super(4)}}class xa extends Oa{static diSet(){return pa(3)}constructor(){super(3)}}var Aa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let va=class extends ha{async findByRecordHistoryIdIn(e){let t;return await this.db.find.tree({select:{},from:[t=la.RecordHistoryNewValue],where:t.recordHistory.id.in(e)})}};va=Aa([function(e){}],va);var Sa=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ca=class extends Ta{getNewRecord(e,t,n,i,o,r){return{actor:n,changeType:e,entity:t,id:void 0,orderNumber:++r.numberOfOperations,recordHistory:[],repositoryTransactionHistory:i,systemWideOperationId:o}}sort(e,t){let n=e.orderNumber,i=t.orderNumber;return n>i?1:i>n?-1:0}startRecordHistory(e,t,n){const i=this.recordHistoryDuo.getNewRecord(t,n);return i.operationHistory=e,e.recordHistory.push(i),e.repositoryTransactionHistory.transactionHistory.allRecordHistory.push(i),i}};Sa([function(e,t){}],Ca.prototype,"recordHistoryDuo",void 0),Ca=Sa([function(e){}],Ca);var Da=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ma=class extends wa{getNewRecord(e,t){const n=new Sr;return n.actorRecordId=t,n.actor={id:e},n}addNewValue(e,t,n){if(null===n)return null;const i=this.recordHistoryNewValueDuo.getNewRecord(e,t,n);return e.newValues.push(i),e.operationHistory.repositoryTransactionHistory.transactionHistory.allRecordHistoryNewValues.push(i),i}addOldValue(e,t,n){if(null===n)return null;const i=this.recordHistoryOldValueDuo.getNewRecord(e,t,n);return e.oldValues.push(i),e.operationHistory.repositoryTransactionHistory.transactionHistory.allRecordHistoryOldValues.push(i),i}};Da([function(e,t){}],Ma.prototype,"recordHistoryNewValueDuo",void 0),Da([function(e,t){}],Ma.prototype,"recordHistoryOldValueDuo",void 0),Ma=Da([function(e){}],Ma);var Va=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Pa=class extends ba{constructor(){super()}getNewRecord(e,t,n){const i=new Dr;return i.columnIndex=t.index,i.recordHistory=e,i.newValue=n,i}};Pa=Va([function(e){}],Pa);var La=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ua=class extends Na{constructor(){super()}getNewRecord(e,t,n){const i=new Vr;return i.columnIndex=t.index,i.recordHistory=e,i.oldValue=n,i}};Ua=La([function(e){}],Ua);var ja=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Fa=class extends _a{getNewRecord(e,t){let n=new Ur,i=(new Date).getTime();return n.saveTimestamp=i,n.uuId=br(),n.isRepositoryCreation=t,n.repository=new $r,n.repository.id=e,n}newRecord(e){return e?{...e}:null}sortRepoTransHistories(e,t){e.sort(((e,t)=>{const n=this.compareNumbers(e.syncTimestamp,t.syncTimestamp);if(n)return n;const i=this.compareNumbers(e.saveTimestamp,t.saveTimestamp);return i||0}))}startOperation(e,t,n,i,o,r){let a=this.operationHistoryDuo.getNewRecord(n,i,o,e,t,r);return e.operationHistory.push(a),e.transactionHistory.allOperationHistory.push(a),a}compareDates(e,t){const n=e?e.getTime():-1,i=t?t.getTime():-1;return this.compareNumbers(n,i)}compareNumbers(e,t){return e<t?-1:t>e?1:0}};ja([function(e,t){}],Fa.prototype,"operationHistoryDuo",void 0),Fa=ja([function(e){}],Fa);var ka=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ba=class extends xa{getNewRecord(e=we.LOCAL){let t=new Fr;return t.transactionType=we.LOCAL,t}getRepositoryTransaction(e,t,n){let i=e.repositoryTransactionHistoryMap[t];return i||(i=this.repositoryTransactionHistoryDuo.getNewRecord(t,n),e.repositoryTransactionHistories.push(i),e.repositoryTransactionHistoryMap[t]=i,i.transactionHistory=e),i}};ka([function(e,t){}],Ba.prototype,"repositoryTransactionHistoryDuo",void 0),Ba=ka([function(e){}],Ba);var Ha=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let $a=class extends Ea{async findWhereUuIdsIn(e){let t;return await this.db.find.tree({select:{uuId:no},from:[t=la.RepositoryTransactionHistory],where:t.uuId.in(e)})}async findAllLocalChangesForRecordIds(e){const t=new Map,n=la.RepositoryTransactionHistory,i=n.transactionHistory.innerJoin(),o=n.operationHistory.leftJoin(),r=o.entity.leftJoin(),a=r.applicationVersion.leftJoin(),s=o.recordHistory.leftJoin(),c=s.newValues.leftJoin();let l=no;const p=[];for(const[t,i]of e){const e=i.ids,r=[];for(const[t,n]of e){const e=[];for(const[t,i]of n)e.push(un(o.actor.id.equals(t),s.actorRecordId.in(Array.from(i))));r.push(un(o.entity.id.equals(t),fn(...e)))}p.push(un(n.repository.id.equals(t),n.saveTimestamp.greaterThanOrEquals(i.firstChangeTime),fn(...r)))}const d=await this.db.find.tree({select:{...io,operationHistory:{orderNumber:no,changeType:no,entity:{id:l,applicationVersion:{id:no}},recordHistory:{id:l,newValues:{columnIndex:no,newValue:no}}}},from:[n,i,o,r,a,s,c],where:un(i.transactionType.equals(we.LOCAL),fn(...p))});for(const e of d)Le(t,e.repository.id).push(e),e.operationHistory.sort(((e,t)=>e.orderNumber<t.orderNumber?-1:e.orderNumber>t.orderNumber?1:0));return t}async updateSyncTimestamp(e){let t;await this.db.updateWhere({update:t=la.RepositoryTransactionHistory,set:{syncTimestamp:e.syncTimestamp},where:t.id.equals(e.id)})}};$a=Ha([function(e){}],$a);var Ga=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let qa=class extends ua{async findWithDetailsAndGlobalIdsByIds(e){return await this.findWithDetailsAndGlobalIdsByWhereClause((t=>t.id.in(e)))}async findMapsWithDetailsByGlobalIds(e,t,n,i,o){const r=await this.findWithDetailsByGlobalIds(e,t,n);for(const e of r)je(i,e.user.id).set(e.terminal.id,e),o.set(e.id,e)}async findWithDetailsByGlobalIds(e,t,n){return await this.findWithDetailsAndGlobalIdsByWhereClause((i=>un(i.uuId.in(e),i.terminal.id.in(n),i.user.id.in(t))))}async findByDomainAndApplicationNames(e,t){let n,i,o;return await this.db.find.tree({select:{id:no,application:{...io,domain:{}},terminal:{},user:{},uuId:no},from:[n=la.Actor,i=n.application.innerJoin(),o=i.domain.innerJoin(),n.terminal.leftJoin(),n.user.leftJoin()],where:un(o.name.equals(e),i.name.equals(t))})}async findByUuIds(e){let t;return await this.db.find.tree({select:{},from:[t=la.Actor],where:t.uuId.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.uuId,t.application.index,t.user.id,t.terminal.id]);const i=await this.db.insertValuesGenerateIds({insertInto:t=la.Actor,columns:[t.uuId,t.application.index,t.user.id,t.terminal.id],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}async findWithDetailsAndGlobalIdsByWhereClause(e){let t,n,i;const o=no,r=no,a=no;return await this.db.find.tree({select:{...io,application:{index:no,name:no,domain:{name:no}},terminal:{id:o,uuId:a,owner:{id:o,username:r,uuId:a}},user:{id:o,username:r,uuId:a}},from:[t=la.Actor,n=t.application.leftJoin(),n.domain.leftJoin(),i=t.terminal.leftJoin(),i.owner.leftJoin(),t.user.leftJoin()],where:e(t)})}};qa=Ga([function(e){}],qa);var Ya=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Qa=class extends Ra{async getRepositoryLoadInfo(e,t,n){let i,o,r;return await this.db.findOne.tree({select:{immutable:no,repositoryTransactionHistory:{saveTimestamp:no}},from:[i=la.Repository,o=i.repositoryTransactionHistory.innerJoin(),r=o.transactionHistory.innerJoin()],where:un(i.source.equals(e),i.uuId.equals(t),r.transactionType.equals(we.REMOTE_SYNC))},n)}async findReposWithDetailsAndSyncNodeIds(e){let t;const n=no;return await this.db.find.tree({select:{id:n,owner:{id:n},createdAt:no,uuId:no},from:[t=la.Repository],where:t.id.in(e)})}async findByIds(e){let t;return await this.db.find.tree({select:{...io,owner:{}},from:[t=la.Repository,t.owner.innerJoin()],where:t.id.in(e)})}async findByUuIds(e){let t;return await this.db.find.tree({select:{},from:[t=la.Repository],where:t.uuId.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.createdAt,t.uuId,t.ageSuitability,t.source,t.immutable,t.owner.id]);const i=await this.db.insertValuesGenerateIds({insertInto:t=la.Repository,columns:[t.createdAt,t.uuId,t.ageSuitability,t.source,t.immutable,t.owner.id],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}};Qa=Ya([function(e){}],Qa);const Ja=V("holding-pattern");Ja.token({class:qa,interface:"IActorDao",token:"ACTOR_DAO"});const Wa=Ja.token({class:Ca,interface:"IOperationHistoryDuo",token:"OPERATION_HISTORY_DUO"}),za=Ja.token({class:Ma,interface:"IRecordHistoryDuo",token:"RECORD_HISTORY_DUO"});Ja.token({class:va,interface:"IRecordHistoryNewValueDao",token:"RECORD_HISTORY_NEW_VALUE_DAO"});const Ka=Ja.token({class:Pa,interface:"IRecordHistoryNewValueDuo",token:"RECORD_HISTORY_NEW_VALUE_DUO"});Ja.token({class:ns,interface:"IRecordHistoryOldValueDao",token:"RECORD_HISTORY_OLD_VALUE_DAO"});const Xa=Ja.token({class:Ua,interface:"IRecordHistoryOldValueDuo",token:"RECORD_HISTORY_OLD_VALUE_DUO"});Ja.token({class:Qa,interface:"IRepositoryDao",token:"REPOSITORY_DAO"}),Ja.token({class:$a,interface:"IRepositoryTransactionHistoryDao",token:"REPOSITORY_TRANSACTION_HISTORY_DAO"});const Za=Ja.token({class:Fa,interface:"IRepositoryTransactionHistoryDuo",token:"REPOSITORY_TRANSACTION_HISTORY_DUO"}),es=Ja.token({class:Ba,interface:"ITransactionHistoryDuo",token:"TRANSACTION_HISTORY_DUO"});Wa.setDependencies({recordHistoryDuo:za}),za.setDependencies({recordHistoryNewValueDuo:Ka,recordHistoryOldValueDuo:Xa}),Za.setDependencies({operationHistoryDuo:Wa}),es.setDependencies({repositoryTransactionHistoryDuo:Za});var ts=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ns=class extends ma{async findByRecordHistoryIdIn(e){let t;return await this.db.find.tree({select:{},from:[t=la.RecordHistoryOldValue],where:t.recordHistory.id.in(e)})}};ns=ts([function(e){}],ns);const is=V("holding-pattern"),os=is.token({class:qa,interface:"IActorDao",token:"ACTOR_DAO"}),rs=is.token({class:Ca,interface:"IOperationHistoryDuo",token:"OPERATION_HISTORY_DUO"}),as=is.token({class:Ma,interface:"IRecordHistoryDuo",token:"RECORD_HISTORY_DUO"});is.token({class:va,interface:"IRecordHistoryNewValueDao",token:"RECORD_HISTORY_NEW_VALUE_DAO"});const ss=is.token({class:Pa,interface:"IRecordHistoryNewValueDuo",token:"RECORD_HISTORY_NEW_VALUE_DUO"});is.token({class:ns,interface:"IRecordHistoryOldValueDao",token:"RECORD_HISTORY_OLD_VALUE_DAO"});const cs=is.token({class:Ua,interface:"IRecordHistoryOldValueDuo",token:"RECORD_HISTORY_OLD_VALUE_DUO"}),ls=is.token({class:Qa,interface:"IRepositoryDao",token:"REPOSITORY_DAO"}),ps=is.token({class:$a,interface:"IRepositoryTransactionHistoryDao",token:"REPOSITORY_TRANSACTION_HISTORY_DAO"}),ds=is.token({class:Fa,interface:"IRepositoryTransactionHistoryDuo",token:"REPOSITORY_TRANSACTION_HISTORY_DUO"}),us=is.token({class:Ba,interface:"ITransactionHistoryDuo",token:"TRANSACTION_HISTORY_DUO"});rs.setDependencies({recordHistoryDuo:as}),as.setDependencies({recordHistoryNewValueDuo:ss,recordHistoryOldValueDuo:cs}),ds.setDependencies({operationHistoryDuo:rs}),us.setDependencies({repositoryTransactionHistoryDuo:ds});var fs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ys=class{};fs([function(e,t){},function(e,t){}],ys.prototype,"id",void 0),fs([function(e,t){}],ys.prototype,"terminalAgts",void 0),fs([function(e,t){}],ys.prototype,"userTerminalAgts",void 0),ys=fs([function(e){},function(e){}],ys);var hs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ms=class{};hs([function(e,t){},function(e,t){},function(e,t){}],ms.prototype,"id",void 0),hs([function(e,t){}],ms.prototype,"name",void 0),hs([function(e,t){}],ms.prototype,"countries",void 0),ms=hs([function(e){},function(e){}],ms);var Rs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Is=class{};Rs([function(e,t){},function(e,t){},function(e,t){}],Is.prototype,"id",void 0),Rs([function(e,t){}],Is.prototype,"name",void 0),Rs([function(e,t){},function(e,t){}],Is.prototype,"continent",void 0),Rs([function(e,t){}],Is.prototype,"users",void 0),Is=Rs([function(e){},function(e){}],Is);var Es=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gs=class{constructor(){this.isLocal=!1}};Es([function(e,t){},function(e,t){},function(e,t){}],gs.prototype,"id",void 0),Es([function(e,t){},function(e,t){}],gs.prototype,"uuId",void 0),Es([function(e,t){},function(e,t){}],gs.prototype,"owner",void 0),Es([function(e,t){},function(e,t){}],gs.prototype,"isLocal",void 0),gs=Es([function(e){},function(e){}],gs);var Os=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ts=class{};Os([function(e,t){},function(e,t){},function(e,t){}],Ts.prototype,"terminal",void 0),Os([function(e,t){},function(e,t){},function(e,t){}],Ts.prototype,"agt",void 0),Os([function(e,t){}],Ts.prototype,"userTerminalAgts",void 0),Ts=Os([function(e){},function(e){}],Ts);var ws=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let bs=class{};ws([function(e,t){},function(e,t){},function(e,t){}],bs.prototype,"id",void 0),ws([function(e,t){},function(e,t){}],bs.prototype,"email",void 0),ws([function(e,t){},function(e,t){}],bs.prototype,"passwordHash",void 0),ws([function(e,t){},function(e,t){}],bs.prototype,"username",void 0),ws([function(e,t){},function(e,t){}],bs.prototype,"uuId",void 0),bs=ws([function(e){}],bs);var Ns=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _s=class{};Ns([function(e,t){},function(e,t){},function(e,t){}],_s.prototype,"user",void 0),Ns([function(e,t){},function(e,t){},function(e,t){}],_s.prototype,"terminal",void 0),_s=Ns([function(e){},function(e){}],_s);var xs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let As=class{};xs([function(e,t){},function(e,t){},function(e,t){}],As.prototype,"id",void 0),xs([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],As.prototype,"agtId",void 0),xs([function(e,t){},function(e,t){}],As.prototype,"user",void 0),xs([function(e,t){},function(e,t){}],As.prototype,"terminal",void 0),xs([function(e,t){},function(e,t){}],As.prototype,"agt",void 0),xs([function(e,t){},function(e,t){}],As.prototype,"terminalAgt",void 0),As=xs([function(e){},function(e){}],As);const vs={__constructors__:{Agt:ys,Continent:ms,Country:Is,Terminal:gs,TerminalAgt:Ts,User:bs,UserTerminal:_s,UserTerminalAgt:As},domain:"air",name:"@airport/travel-document-checkpoint"},Ss=vs;function Cs(e){return Jo(Ss.__dbApplication__,e)}k.db().eventuallyGet(Ro).then((e=>{e.QM[Q(vs)]=Ss}));class Ds extends Bo{constructor(e){super(e,Ss)}}class Ms extends Ds{constructor(){super(7)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(7)}}Ms.Find=new Ho,Ms.FindOne=new Ho,Ms.Search=new Ho,Ms.SearchOne=new Ho;class Vs extends Ds{constructor(){super(0)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(0)}}Vs.Find=new Ho,Vs.FindOne=new Ho,Vs.Search=new Ho,Vs.SearchOne=new Ho;class Ps extends Ds{constructor(){super(1)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(1)}}Ps.Find=new Ho,Ps.FindOne=new Ho,Ps.Search=new Ho,Ps.SearchOne=new Ho;class Ls extends Ds{constructor(){super(5)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(5)}}Ls.Find=new Ho,Ls.FindOne=new Ho,Ls.Search=new Ho,Ls.SearchOne=new Ho;class Us extends Ds{constructor(){super(6)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(6)}}Us.Find=new Ho,Us.FindOne=new Ho,Us.Search=new Ho,Us.SearchOne=new Ho;class js extends Ds{constructor(){super(4)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(4)}}js.Find=new Ho,js.FindOne=new Ho,js.Search=new Ho,js.SearchOne=new Ho;class Fs extends Ds{constructor(){super(2)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(2)}}Fs.Find=new Ho,Fs.FindOne=new Ho,Fs.Search=new Ho,Fs.SearchOne=new Ho;class ks extends Ds{constructor(){super(3)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Cs(3)}}ks.Find=new Ho,ks.FindOne=new Ho,ks.Search=new Ho,ks.SearchOne=new Ho;var Bs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hs=class extends Ls{async findByOwnerIdsAndUuIds(e,t){let n;return await this.db.find.tree({select:{},from:[n=Ss.Terminal],where:un(n.owner.id.in(e),n.uuId.in(t))})}async findByUuIds(e){let t;return await this.db.find.tree({select:{},from:[t=Ss.Terminal],where:t.uuId.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.uuId,t.owner.id,!1]);const i=await this.db.insertValuesGenerateIds({insertInto:t=Ss.Terminal,columns:[t.uuId,t.owner.id,t.isLocal],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}};Hs=Bs([function(e){}],Hs);var $s=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gs=class extends js{async findByUserNames(e){let t;return await this.db.find.tree({select:{},from:[t=Ss.User],where:t.username.in(e)})}async findByUuIds(e){let t;return await this.db.find.tree({select:{},from:[t=Ss.User],where:t.uuId.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.uuId,t.username]);const i=await this.db.insertValuesGenerateIds({insertInto:t=Ss.User,columns:[t.uuId,t.username],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}};Gs=$s([function(e){}],Gs);var qs,Ys=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.EMAIL_TAKEN="EMAIL_TAKEN",e.INVALID_BIRTH_MONTH="INVALID_BIRTH_MONTH",e.INVALID_COUNTRY="INVALID_COUNTRY",e.INVALID_EMAIL="INVALID_EMAIL",e.INVALID_USERNAME="INVALID_USERNAME",e.USERNAME_TAKEN="USERNAME_TAKEN"}(qs||(qs={}));let Qs=class{async addUser(e,t){const n=await this.userDao.findByUserNames([e]);for(const t of n)if(t.username===e)return{errorCode:qs.USERNAME_TAKEN};const i={id:null,uuId:br(),username:e};return await this.userDao.save(i),{user:i}}async findUser(e){const t=await this.userDao.findByUuIds([e]);return t.length?t[0]:null}};Ys([function(e,t,n){return null}],Qs.prototype,"addUser",null),Ys([function(e,t,n){return null}],Qs.prototype,"findUser",null),Qs=Ys([function(e){}],Qs);const Js=V("travel-document-checkpoint"),Ws=Js.token({class:null,interface:"IUserApi",token:"USER_API"}),zs=Js.token({class:Hs,interface:"ITerminalDao",token:"TERMINAL_DAO"}),Ks=Js.token({class:Gs,interface:"IUserDao",token:"USER_DAO"});Ws.setClass(Qs),Ws.setDependencies({userDao:Ks});var Xs=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zs=class{async ensureApplicationRecords(e,t){await this.transactionManager.transactInternal((async t=>{await this.updateDomain(e);let n,i=this.terminalStore.getApplicationActorMapByDomainAndApplicationNames().get(e.domain);if(i&&(n=i.get(e.name),n&&n.length))return;n=await this.actorDao.findByDomainAndApplicationNames(e.domain,e.name);let o=await this.applicationDao.findByIndex(e.lastIds.applications+1);if(!n||!n.length){const e=this.terminalStore.getFrameworkActor(),t={id:null,application:o,terminal:e.terminal,user:e.user,uuId:br()};await this.actorDao.save(t),n=[t]}const r=this.terminalStore.getTerminalState(),a=r.applications.slice();a.push(o);let s=r.applicationActors.slice();s=s.concat(n),this.terminalStore.state.next({...r,applicationActors:s,applications:a})}),t)}async initTerminal(e,t){await this.transactionManager.transactInternal((async e=>{const n=new bs;n.uuId="AIRportA-demo-demo-demo-functionalty",n.username="internalUser";const i=new gs;i.owner=n,i.isLocal=!0,i.uuId=br();const o=new Br;o.user=n,o.terminal=i,o.uuId=br(),await this.actorDao.save(o,t);const r=this.terminalStore.getTerminalState();this.terminalStore.state.next({...r,frameworkActor:o,terminal:i})}),t)}async updateDomain(e){let t=this.terminalStore.getDomainMapByName().get(e.domain);if(t&&this.entityStateManager.getOriginalValues(t))return t;let n,i=await this.domainDao.findByName(e.domain);if(t?i&&(this.entityStateManager.setOriginalValues(this.entityStateManager.getOriginalValues(i),t),n=t):i?n=i:(n={id:null,name:e.domain},await this.domainDao.save(n)),!n)return t;const o=this.terminalStore.getTerminalState(),r=o.domains.slice();let a=!1;for(let e=0;e<r.length;e++){r[e].name===t.name&&(r.splice(e,1,t),a=!0)}return a||r.push(t),this.terminalStore.state.next({...o,domains:r}),n}};Xs([function(e,t){}],Zs.prototype,"actorDao",void 0),Xs([function(e,t){}],Zs.prototype,"applicationDao",void 0),Xs([function(e,t){}],Zs.prototype,"domainDao",void 0),Xs([function(e,t){}],Zs.prototype,"entityStateManager",void 0),Xs([function(e,t){}],Zs.prototype,"terminalStore",void 0),Xs([function(e,t){}],Zs.prototype,"transactionManager",void 0),Zs=Xs([function(e){}],Zs);var ec=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let tc=class{callApi(e){throw new Error("InternalTransactionalConnector.callApi should never be called.\nInteral Application API requests should be made directly (since\nthey are internal to the AIRport framework).")}async addRepository(e){return await this.transactionalServer.addRepository(this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...e})}async find(e,t,n){return await this.transactionalServer.find(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async findOne(e,t,n){return await this.transactionalServer.findOne(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}search(e,t,n){return this.transactionalServer.search(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}searchOne(e,t,n){return this.transactionalServer.searchOne(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async save(e,t){return await this.transactionalServer.save(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async saveToDestination(e,t,n){return await this.transactionalServer.saveToDestination(e,t,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...n})}async insertValues(e,t,n){return await this.transactionalServer.insertValues(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t},n)}async insertValuesGetIds(e,t){return await this.transactionalServer.insertValuesGetIds(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async updateValues(e,t){return await this.transactionalServer.updateValues(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}async deleteWhere(e,t){return await this.transactionalServer.deleteWhere(e,this.terminalStore.getInternalConnector().internalCredentials,{internal:!0,...t})}onMessage(e){}};ec([function(e,t){}],tc.prototype,"terminalStore",void 0),ec([function(e,t){}],tc.prototype,"transactionalServer",void 0),tc=ec([function(e){}],tc);var nc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ic=class{constructor(){this.online=!1}async goOffline(e={}){this.repositoryManager.goOffline(),this.online=!1}async goOnline(e={}){const t=await B(this).get(OFFLINE_DELTA_STORE);await this.transactionManager.transactInternal((async()=>{try{this.repositoryManager.setUpdateStateForAll($.GO_ONLINE);const e=await this.repositoryDao.findReposWithDetailsByIds();let n=[];e.forEach((e=>{n.push(this.repositoryGoOnline(e,t,this.repositoryManager))})),await Promise.all(n),this.online=!0}catch(e){throw e}finally{this.repositoryManager.setUpdateStateForAll($.LOCAL)}}),e)}async repositoryGoOnline(e,t,n){let i=n.deltaStore[e.id],o=[];await i.goOnline((async i=>{if(i.length)if(i=i.map((e=>e=new Ur(e))),n.getUpdateState(e)===$.GO_ONLINE)o.push(i);else try{n.setUpdateState(e,$.REMOTE),await t.addRemoteChanges(e,i)}catch(e){throw e}finally{n.setUpdateState(e,$.LOCAL)}}));let r=await i.loadTransactionsSinceLastKnown(e.lastSyncedTransaction),a=[];for(;r.hasNext();)a.push(r.next());for(a.length&&await t.addRemoteChanges(e,a);o.length;)a=o,o=[],await t.addRemoteChanges(e,a);let s=await this.repositoryTransactionHistoryDao.findUnsyncedTransactions(e);for(s.length&&(s.forEach((e=>{e.syncStatus=Z.SYNCHRONIZED})),await i.addChanges(i.config.changeListConfig,s),await t.markChangesAsSynced(e,null));o.length;)a=o,o=[],await t.addRemoteChanges(e,a);this.online=!0}isOnline(e={}){return this.online}};var oc,rc;nc([function(e,t){}],ic.prototype,"repositoryDao",void 0),nc([function(e,t){}],ic.prototype,"repositoryManager",void 0),nc([function(e,t){}],ic.prototype,"repositoryTransactionHistoryDao",void 0),nc([function(e,t){}],ic.prototype,"transactionManager",void 0),ic=nc([function(e){}],ic),function(e){e.ADD_REPOSITORY="ADD_REPOSITORY",e.APP_INITIALIZING="APP_INITIALIZING",e.APP_INITIALIZED="APP_INITIALIZED",e.CALL_API="CALL_API",e.DELETE_WHERE="DELETE_WHERE",e.FIND="FIND",e.FIND_ONE="FIND_ONE",e.GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME="GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME",e.INSERT_VALUES="INSERT_VALUES",e.INSERT_VALUES_GET_IDS="INSERT_VALUES_GET_IDS",e.RETRIEVE_DOMAIN="RETRIEVE_DOMAIN",e.SEARCH="SEARCH",e.SEARCH_ONE="SEARCH_ONE",e.SEARCH_UNSUBSCRIBE="UNSUBSCRIBE",e.SAVE="SAVE",e.SAVE_TO_DESTINATION="SAVE_TO_DESTINATION",e.UPDATE_VALUES="UPDATE_VALUES"}(oc||(oc={})),function(e){e.NOT_INITIALIED="NOT_INITIALIED",e.START_INITIALIZING="START_INITIALIZING",e.INITIALIZING_IN_PROGRESS="INITIALIZING_IN_PROGRESS",e.INITIALIZED="INITIALIZED"}(rc||(rc={}));const ac={application:null,appState:rc.NOT_INITIALIED,domain:null,hostServer:"http://localhost:7500",lastIds:null,mainDomain:null,observableMessageMap:new Map,pendingMessageMap:new Map,messageCallback:null};var sc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let cc=class{get state(){return ac}};cc=sc([function(e){}],cc);const lc=V("apron");lc.token({class:null,interface:"IApplicationLoader",token:"APPLICATION_LOADER"}),lc.token({class:cc,interface:"IApplicationStore",token:"APPLICATION_STORE"});const pc=lc.token({class:null,interface:"ILocalAPIServer",token:"LOCAL_API_SERVER"});pc.setDependencies({apiRegistry:Xo});var dc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let uc=class{async processMessage(e){let t,n;try{if("internal://domain"===e.domain)throw new Error("Internal domain cannot be used in external calls");let i={application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName},o={};switch(o.startedAt=new Date,e.type){case oc.CALL_API:{const i={};try{t=await this.nativeHandleApiCall(e,i)}catch(e){n=e.message}break}case oc.APP_INITIALIZING:const r=e.jsonApplication,a=Q(r);if(a!==J(e.domain,e.application)){t=null;break}if(this.terminalStore.getReceiver().initializingApps.has(a))return null;this.terminalStore.getReceiver().initializingApps.add(a),await this.databaseManager.initFeatureApplications({},[r]),await this.internalRecordManager.ensureApplicationRecords(r,{}),t=r.lastIds;break;case oc.APP_INITIALIZED:return this.terminalStore.getReceiver().initializedApps.add(e.fullApplicationName),null;case oc.GET_LATEST_APPLICATION_VERSION_BY_APPLICATION_NAME:t=this.terminalStore.getLatestApplicationVersionMapByFullApplicationName().get(e.fullApplicationName);break;case oc.RETRIEVE_DOMAIN:t=this.terminalStore.getDomainMapByName().get(e.domain);break;case oc.ADD_REPOSITORY:t=await this.transactionalServer.addRepository(i,o);break;case oc.DELETE_WHERE:const s=e;t=await this.transactionalServer.deleteWhere(s.portableQuery,i,o);break;case oc.FIND:const c=e;t=await this.transactionalServer.find(c.portableQuery,i,{...o,repository:c.repository});break;case oc.FIND_ONE:const l=e;t=await this.transactionalServer.findOne(l.portableQuery,i,{...o,repository:c.repository});break;case oc.INSERT_VALUES:const p=e;t=await this.transactionalServer.insertValues(p.portableQuery,i,o);break;case oc.INSERT_VALUES_GET_IDS:const d=e;t=await this.transactionalServer.insertValuesGetIds(d.portableQuery,i,o);break;case oc.SAVE:case oc.SAVE_TO_DESTINATION:{const r=e;if(!r.dbEntity){n="DbEntity id was not passed in";break}const a=r.dbEntity.id,s=this.terminalStore.getAllEntities()[a];if(!s){n=`Could not find DbEntity with Id ${a}`;break}if(o.dbEntity=s,e.type===oc.SAVE)t=await this.transactionalServer.save(r.entity,i,o);else{const n=e;t=await this.transactionalServer.saveToDestination(n.repositoryDestination,n.entity,i,o)}break}case oc.SEARCH:const u=e;t=await this.transactionalServer.search(u.portableQuery,i,{...o,repository:c.repository});break;case oc.SEARCH_ONE:const f=e;t=await this.transactionalServer.search(f.portableQuery,i,{...o,repository:c.repository});break;case oc.UPDATE_VALUES:const y=e;t=await this.transactionalServer.updateValues(y.portableQuery,i,o);break;default:return}}catch(e){console.error(e),t=null,n=e.message}return{application:e.application,category:"FromDb",domain:e.domain,errorMessage:n,id:e.id,type:e.type,result:t}}async startApiCall(e,t,n){const i={application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName,transactionId:e.transactionId};if(!await this.transactionalServer.startTransaction(i,t))return!1;const o=t.transaction.initiator;o.application=e.application,o.domain=e.domain,o.methodName=e.methodName,o.objectName=e.objectName,e.transactionId=t.transaction.id;try{await n()}catch(e){return t.errorMessage=e.message,this.transactionalServer.rollback(i,t),!1}return!0}async endApiCall(e,t,n){return t?await this.transactionalServer.rollback(e,n):await this.transactionalServer.commit(e,n)}};dc([function(e,t){}],uc.prototype,"databaseManager",void 0),dc([function(e,t){}],uc.prototype,"internalRecordManager",void 0),dc([function(e,t){}],uc.prototype,"terminalStore",void 0),dc([function(e,t){}],uc.prototype,"transactionalServer",void 0),uc=dc([function(e){}],uc);var fc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yc=class{async init(e={}){return await this.transactionManager.initialize("airport",e)}async addRepository(e,t){await this.ensureContext(t),this.transactionManager.getTransactionFromContextOrCredentials(e,t);const n=await this.getActor(e);let i=0;return await this.transactionManager.transactInternal((async()=>{const e=await this.repositoryManager.createRepository(n,t);i=e.id}),t),i}async find(e,t,n,i){return await this.ensureContext(n),t.transactionId&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),await this.queryManager.find(e,n,i)}async findOne(e,t,n,i){return await this.ensureContext(n),t.transactionId&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),await this.queryManager.findOne(e,n,i)}search(e,t,n,i){return this.ensureContextSync(n),t.transactionId&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),this.queryManager.search(e,n)}searchOne(e,t,n,i){return this.ensureContextSync(n),t.transactionId&&this.transactionManager.getTransactionFromContextOrCredentials(t,n),this.queryManager.searchOne(e,n)}async startTransaction(e,t){try{return await this.ensureContext(t),await this.transactionManager.startTransaction(e,t),!0}catch(e){return t.errorMessage=e.message,console.error(e),!1}}async commit(e,t){try{return await this.ensureContext(t),await this.transactionManager.commit(e,t),!0}catch(e){return console.error(e),t.errorMessage=e.message,!1}}async rollback(e,t){t.transaction;try{return await this.ensureContext(t),await this.transactionManager.rollback(e,t),!0}catch(e){return console.error(e),t.errorMessage=e.message,!1}}async save(e,t,n){if(!e)return null;await this.ensureContext(n),this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return n.actor=i,await this.transactionManager.transactInternal((async(t,n)=>{o=await this.operationManager.performSave(e,i,t,n.rootTransaction,n)}),n),o}async saveToDestination(e,t,n,i){if(!t)return null;await this.ensureContext(i),this.transactionManager.getTransactionFromContextOrCredentials(n,i);const o=await this.getActor(n);let r;return i.actor=o,await this.transactionManager.transactInternal((async(e,n)=>{r=await this.operationManager.performSave(t,o,e,n.rootTransaction,n)}),i),r}async insertValues(e,t,n,i){await this.ensureContext(n),this.transactionManager.getTransactionFromContextOrCredentials(t,n);const o=await this.getActor(t);let r;return await this.transactionManager.transactInternal((async(t,n)=>{r=await this.insertManager.insertValues(e,o,t,n.rootTransaction,n,i)}),n),r}async insertValuesGetIds(e,t,n){await this.ensureContext(n),this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.insertManager.insertValuesGetIds(e,i,t,n.rootTransaction,n)}),n),o}async updateValues(e,t,n){await this.ensureContext(n),this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.updateManager.updateValues(e,i,t,n.rootTransaction,n)}),n),o}async deleteWhere(e,t,n){await this.ensureContext(n),this.transactionManager.getTransactionFromContextOrCredentials(t,n);const i=await this.getActor(t);let o;return await this.transactionManager.transactInternal((async(t,n)=>{o=await this.deleteManager.deleteWhere(e,i,t,n.rootTransaction,n)}),n),o}async getActor(e){if(this.tempActor)return this.tempActor;if("internal://domain"===e.domain)return new Br;let t;const n=this.terminalStore.getApplicationActorMapByDomainAndApplicationNames().get(e.domain);if(!n)throw new Error(`No Actors found for\n\tDomain:\n\t\t${e.domain}\n\t\t\t`);if(t=n.get(e.application),!t)throw new Error(`No Actors found for\n\tDomain:\n\t\t${e.domain}\n\tApplication:\n\t\t${e.application}\n\t\t\t`);const i=this.terminalStore.getFrameworkActor().terminal;if(!i.isLocal)throw new Error("Expecting terminal of the TerminalStore.frameworkActor to be .isLocal");let o;for(const e of t)if(e.terminal.uuId===i.uuId){o=e;break}if(!o)throw new Error(`Could not find actor for\n\tDomain:\n\t\t${e.domain}\n\tApplication:\n\t\t${e.application}\n\t\t\t`);return o}async ensureContext(e){await this.operationContextLoader.ensure(e)}async ensureContextSync(e){this.operationContextLoader.ensureSync(e)}};fc([function(e,t){}],yc.prototype,"deleteManager",void 0),fc([function(e,t){}],yc.prototype,"insertManager",void 0),fc([function(e,t){}],yc.prototype,"operationManager",void 0),fc([function(e,t){}],yc.prototype,"operationContextLoader",void 0),fc([function(e,t){}],yc.prototype,"queryManager",void 0),fc([function(e,t){}],yc.prototype,"repositoryManager",void 0),fc([function(e,t){}],yc.prototype,"terminalStore",void 0),fc([function(e,t){}],yc.prototype,"transactionManager",void 0),fc([function(e,t){}],yc.prototype,"updateManager",void 0),yc=fc([function(e){}],yc);var hc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mc=class{getPortableQuery(e,t,n,i){return{applicationIndex:e,tableIndex:t,jsonQuery:n.toJSON(this.queryUtils,this.fieldUtils,this.relationManager),parameterMap:n.getParameters(),queryResultType:i}}async doInsertValues(e,t,n,i){const o=t.__driver__.dbEntity,r=[],a=[];for(const e of o.properties){let t={name:e.name,nested:null};if(e.relation&&e.relation.length){const n=e.relation[0];this.applicationUtils.forEachColumnTypeOfRelation(n,((e,n)=>{if(r[e.index])return;r[e.index]=e.index,a[e.index]=t;const i=n[0];for(let e=1;e<i.length;e++){const n={name:i[e],nested:null};t.nested=n,t=n}}))}else{const n=e.propertyColumns[0].column;if(r[n.index])continue;r[n.index]=n.index,a[n.index]=t}}const s=n.map((e=>a.map((t=>{let n=e[t.name];for(;t.nested&&n instanceof Object;)n=n[(t=t.nested).name];return void 0===n?null:n}))));let c=new Hi({insertInto:t,columns:null,values:s},r),l=this.getPortableQuery(o.applicationVersion.application.index,o.index,c,null);return await e.insertValues(l,i)}};hc([function(e,t){}],mc.prototype,"applicationUtils",void 0),hc([function(e,t){}],mc.prototype,"fieldUtils",void 0),hc([function(e,t){}],mc.prototype,"queryUtils",void 0),hc([function(e,t){}],mc.prototype,"relationManager",void 0),mc=hc([function(e){}],mc);const Rc=[{domain:"air",index:null,name:"@airport/airport-code",sinceVersion:1,versions:[{api:{apiObjectMap:{IApplicationApi:{operationMap:{testApiDefinitionGeneration:{isAsync:!0,parameters:[]}}}}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SEQUENCE_INCREMENT_BY",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"CURRENT_VALUE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1},{index:2}],index:0,isLocal:!0,isRepositoryEntity:!1,name:"Sequence",properties:[{columnRef:{index:0},index:0,isId:!0,name:"applicationIndex",sinceVersion:1},{columnRef:{index:1},index:1,isId:!0,name:"tableIndex",sinceVersion:1},{columnRef:{index:2},index:2,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"incrementBy",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"currentValue",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"SEQUENCES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isRepositoryEntity:!1,name:"SystemWideOperationId",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"SYSTEM_WIDE_OPERATION_IDS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"CREATE_TIMESTAMP",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"RANDOM_NUMBER",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:2,isLocal:!0,isRepositoryEntity:!1,name:"TerminalRun",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"createTimestamp",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"randomNumber",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{name:"TERMINAL_RUNS",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/travel-document-checkpoint",sinceVersion:1,versions:[{api:{apiObjectMap:{IUserApi:{operationMap:{addUser:{isAsync:!0,parameters:[]},findUser:{isAsync:!0,parameters:[]}}}}},entities:[{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:0,isLocal:!0,isRepositoryEntity:!1,name:"Continent",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"countries",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"continent"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"CONTINENTS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:0,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"CONTINENT_ID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isRepositoryEntity:!1,name:"Country",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"continent",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"users",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"country"},relationType:"ONE_TO_MANY",propertyRef:{index:3},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"COUNTRIES",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"USER_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:2,isLocal:!0,isRepositoryEntity:!1,name:"UserTerminal",properties:[{index:0,isId:!0,name:"user",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"terminal",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:4,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:5,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"USER_TERMINAL",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!0,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:7,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1},{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:2,oneColumnIndex:2,sinceVersion:1}],name:"AGT_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"PASSWORD",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"USER_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1},{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:2,oneColumnIndex:1,sinceVersion:1}],name:"TERMINAL_ID",notNull:!1,propertyRefs:[{index:4},{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:3,isLocal:!0,isRepositoryEntity:!1,name:"UserTerminalAgt",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!0,name:"agtId",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"password",sinceVersion:1},{index:3,isId:!1,name:"user",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"terminal",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"agt",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"terminalAgt",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:4,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:5,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:7,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:6,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"USER_TERMINAL_AGT",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"EMAIL",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"PASSWORD_HASH",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"USERNAME",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"STRING"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"UUID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:4,isLocal:!0,isRepositoryEntity:!1,name:"User",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"email",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"passwordHash",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"username",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"uuId",sinceVersion:1}],relations:[],sinceVersion:1,tableConfig:{columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"UUID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LOCAL",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"BOOLEAN"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"OWNER_USER_ID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:5,isLocal:!0,isRepositoryEntity:!1,name:"Terminal",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"uuId",sinceVersion:1},{index:2,isId:!1,name:"owner",relationRef:{index:0},sinceVersion:1},{columnRef:{index:2},index:3,isId:!1,name:"isLocal",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TERMINAL",propertyIndexes:[{propertyIndex:1,unique:!0}]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"PASSWORD",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:7,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"AGT_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:1},{index:2}],index:6,isLocal:!0,isRepositoryEntity:!1,name:"TerminalAgt",properties:[{index:0,isId:!0,name:"terminal",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"agt",relationRef:{index:1},sinceVersion:1},{columnRef:{index:0},index:2,isId:!1,name:"password",sinceVersion:1},{index:3,isId:!1,name:"userTerminalAgts",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:5,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:7,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"terminalAgt"},relationType:"ONE_TO_MANY",propertyRef:{index:3},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TERMINAL_AGTS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ADDRESS",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:7,isLocal:!0,isRepositoryEntity:!1,name:"Agt",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"address",sinceVersion:1},{index:2,isId:!1,name:"terminalAgts",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"userTerminalAgts",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"agt"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:6,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"agt"},relationType:"ONE_TO_MANY",propertyRef:{index:3},relationTableIndex:3,sinceVersion:1}],sinceVersion:1,tableConfig:{columnIndexes:[]}}],integerVersion:1,referencedApplications:[],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/airspace",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:4,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"MANY_APPLICATION_COLUMN_ID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplicationIndex:null,oneTableIndex:4,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"ONE_APPLICATION_COLUMN_ID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:5,oneApplicationIndex:null,oneTableIndex:1,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"MANY_APPLICATION_RELATION_ID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:6,oneApplicationIndex:null,oneTableIndex:1,oneRelationIndex:7,oneColumnIndex:3,sinceVersion:1}],name:"ONE_APPLICATION_RELATION_ID",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:7,oneApplicationIndex:null,oneTableIndex:1,oneColumnIndex:3,sinceVersion:1}],name:"PARENT_RELATION_ID",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:0,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationRelationColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{index:4,isId:!1,name:"manyColumn",relationRef:{index:3},sinceVersion:1},{index:5,isId:!1,name:"oneColumn",relationRef:{index:4},sinceVersion:1},{index:6,isId:!1,name:"manyRelation",relationRef:{index:5},sinceVersion:1},{index:7,isId:!1,name:"oneRelation",relationRef:{index:6},sinceVersion:1},{index:8,isId:!1,name:"parentRelation",relationRef:{index:7},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:4,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:4,sinceVersion:1},{index:5,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:1,sinceVersion:1},{index:6,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:1,sinceVersion:1},{index:7,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:8},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_RELATION_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"RELATION_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"FOREIGN_KEY",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"JSON"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"MANY_TO_ONE_ELEMENTS",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"ONE_TO_MANY_ELEMENTS",notNull:!1,propertyRefs:[{index:8}],sinceVersion:1,type:"JSON"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"RELATION_TYPE",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"STRING"},{index:9,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_ID",notNull:!0,propertyRefs:[{index:10}],sinceVersion:1,type:"BOOLEAN"},{index:10,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:2,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_PROPERTY_ID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:11,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:7,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_TABLE_ID",notNull:!0,propertyRefs:[{index:11}],sinceVersion:1,type:"NUMBER"},{index:12,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:5,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:8,oneColumnIndex:3,sinceVersion:1}],name:"RELATION_APPLICATION_TABLE_ID",notNull:!0,propertyRefs:[{index:12}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:1,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationRelation",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{index:5,isId:!1,name:"property",relationRef:{index:3},sinceVersion:1},{columnRef:{index:5},index:6,isId:!1,name:"foreignKey",sinceVersion:1},{columnRef:{index:6},index:7,isId:!1,name:"manyToOneElems",sinceVersion:1},{columnRef:{index:7},index:8,isId:!1,name:"oneToManyElems",sinceVersion:1},{columnRef:{index:8},index:9,isId:!1,name:"relationType",sinceVersion:1},{columnRef:{index:9},index:10,isId:!1,name:"isId",sinceVersion:1},{index:11,isId:!1,name:"entity",relationRef:{index:4},sinceVersion:1},{index:12,isId:!1,name:"relationEntity",relationRef:{index:5},sinceVersion:1},{index:13,isId:!1,name:"manyRelationColumns",relationRef:{index:6},sinceVersion:1},{index:14,isId:!1,name:"oneRelationColumns",relationRef:{index:7},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:2,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:11},relationTableIndex:6,sinceVersion:1},{index:5,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:12},relationTableIndex:6,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"manyRelation"},relationType:"ONE_TO_MANY",propertyRef:{index:13},relationTableIndex:0,sinceVersion:1},{index:7,isId:!1,oneToManyElems:{mappedBy:"oneRelation"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_RELATIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"PROPERTY_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_ID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_ID",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:2,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationProperty",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isId",sinceVersion:1},{index:7,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{index:8,isId:!1,name:"propertyColumns",relationRef:{index:4},sinceVersion:1},{index:9,isId:!1,name:"relation",relationRef:{index:5},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:6,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"property"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:3,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"property"},relationType:"ONE_TO_MANY",propertyRef:{index:9},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_PROPERTIES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:4,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_COLUMN_ID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplicationIndex:null,oneTableIndex:2,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_PROPERTY_ID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3},{index:4}],index:3,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationPropertyColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{index:3,isId:!0,name:"column",relationRef:{index:3},sinceVersion:1},{index:4,isId:!0,name:"property",relationRef:{index:4},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:4,sinceVersion:1},{index:4,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:2,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_PROPERTY_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"ID_INDEX",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_GENERATED",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"ALLOCATION_SIZE",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:8}],sinceVersion:1,type:"STRING"},{index:9,isGenerated:!1,manyRelationColumnRefs:[],name:"NOT_NULL",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"BOOLEAN"},{index:10,isGenerated:!1,manyRelationColumnRefs:[],name:"PRECISION",notNull:!1,propertyRefs:[{index:10}],sinceVersion:1,type:"NUMBER"},{index:11,isGenerated:!1,manyRelationColumnRefs:[],name:"SCALE",notNull:!1,propertyRefs:[{index:11}],sinceVersion:1,type:"NUMBER"},{index:12,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!0,propertyRefs:[{index:12}],sinceVersion:1,type:"STRING"},{index:13,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_ID",notNull:!0,propertyRefs:[{index:13}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:4,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationColumn",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"idIndex",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isGenerated",sinceVersion:1},{columnRef:{index:7},index:7,isId:!1,name:"allocationSize",sinceVersion:1},{columnRef:{index:8},index:8,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:9},index:9,isId:!1,name:"notNull",sinceVersion:1},{columnRef:{index:10},index:10,isId:!1,name:"precision",sinceVersion:1},{columnRef:{index:11},index:11,isId:!1,name:"scale",sinceVersion:1},{columnRef:{index:12},index:12,isId:!1,name:"type",sinceVersion:1},{index:13,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{index:14,isId:!1,name:"propertyColumns",relationRef:{index:4},sinceVersion:1},{index:15,isId:!1,name:"manyRelationColumns",relationRef:{index:5},sinceVersion:1},{index:16,isId:!1,name:"oneRelationColumns",relationRef:{index:6},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:13},relationTableIndex:6,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"column"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:3,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"manyColumn"},relationType:"ONE_TO_MANY",propertyRef:{index:15},relationTableIndex:0,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"oneColumn"},relationType:"ONE_TO_MANY",propertyRef:{index:16},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_COLUMNS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"RULE",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:6,oneRelationIndex:5,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_ID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:5,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationOperation",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"type",sinceVersion:1},{index:5,isId:!1,name:"entity",relationRef:{index:3},sinceVersion:1},{columnRef:{index:5},index:6,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:6},index:7,isId:!1,name:"rule",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:6,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_OPERATIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_INDEX",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_LOCAL",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"BOOLEAN"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_REPOSITORY_ENTITY",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"BOOLEAN"},{index:7,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"STRING"},{index:8,isGenerated:!1,manyRelationColumnRefs:[],name:"TABLE_CONFIGURATION",notNull:!0,propertyRefs:[{index:8}],sinceVersion:1,type:"JSON"},{index:9,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:8,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:9}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:3}],index:6,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationEntity",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{columnRef:{index:3},index:3,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"index",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"isLocal",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"isRepositoryEntity",sinceVersion:1},{columnRef:{index:7},index:7,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:8},index:8,isId:!1,name:"tableConfig",sinceVersion:1},{index:9,isId:!1,name:"applicationVersion",relationRef:{index:3},sinceVersion:1},{index:10,isId:!1,name:"columns",relationRef:{index:4},sinceVersion:1},{index:11,isId:!1,name:"operations",relationRef:{index:5},sinceVersion:1},{index:12,isId:!1,name:"properties",relationRef:{index:6},sinceVersion:1},{index:13,isId:!1,name:"relations",relationRef:{index:7},sinceVersion:1},{index:14,isId:!1,name:"relationReferences",relationRef:{index:8},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:9},relationTableIndex:8,sinceVersion:1},{index:4,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:10},relationTableIndex:4,sinceVersion:1},{index:5,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:11},relationTableIndex:5,sinceVersion:1},{index:6,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:12},relationTableIndex:2,sinceVersion:1},{index:7,isId:!1,oneToManyElems:{mappedBy:"entity"},relationType:"ONE_TO_MANY",propertyRef:{index:13},relationTableIndex:1,sinceVersion:1},{index:8,isId:!1,oneToManyElems:{mappedBy:"relationEntity"},relationType:"ONE_TO_MANY",propertyRef:{index:14},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_ENTITIES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"DEPRECATED_SINCE_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"REMOVED_IN_APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"SINCE_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_REFERENCE_INDEX",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:null,oneTableIndex:8,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"OWN_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplicationIndex:null,oneTableIndex:8,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"REFERENCED_APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:4},{index:5}],index:7,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationReference",properties:[{index:0,isId:!1,name:"deprecatedSinceVersion",relationRef:{index:0},sinceVersion:1},{index:1,isId:!1,name:"removedInVersion",relationRef:{index:1},sinceVersion:1},{index:2,isId:!1,name:"sinceVersion",relationRef:{index:2},sinceVersion:1},{index:3,isId:!0,name:"ownApplicationVersion",relationRef:{index:3},sinceVersion:1},{index:4,isId:!0,name:"referencedApplicationVersion",relationRef:{index:4},sinceVersion:1},{columnRef:{index:3},index:5,isId:!1,name:"index",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:8,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:8,sinceVersion:1},{index:3,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:8,sinceVersion:1},{index:4,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_REFERENCES",columnIndexes:[]},operations:{}},{columns:[{allocationSize:100,index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"INTEGER_VERSION",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"VERSION_STRING",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"MAJOR_VERSION",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"MINOR_VERSION",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"PATCH_VERSION",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[],name:"JSON_APPLICATION",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"JSON"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:10,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:8,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationVersion",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"integerVersion",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"versionString",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"majorVersion",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"minorVersion",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"patchVersion",sinceVersion:1},{columnRef:{index:6},index:6,isId:!1,name:"jsonApplication",sinceVersion:1},{index:7,isId:!1,name:"application",relationRef:{index:0},sinceVersion:1},{index:8,isId:!1,name:"entities",relationRef:{index:1},sinceVersion:1},{index:9,isId:!1,name:"references",relationRef:{index:2},sinceVersion:1},{index:10,isId:!1,name:"referencedBy",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:10,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"applicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:6,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"ownApplicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:9},relationTableIndex:7,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"referencedApplicationVersion"},relationType:"ONE_TO_MANY",propertyRef:{index:10},relationTableIndex:7,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_VERSIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:10,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_ID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:9,isLocal:!0,isRepositoryEntity:!1,name:"ApplicationCurrentVersion",properties:[{index:0,isId:!0,name:"application",relationRef:{index:0},sinceVersion:1},{index:1,isId:!0,name:"applicationVersion",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:10,sinceVersion:1},{index:1,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATION_CURRENT_VERSIONS",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"SCOPE",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_NAME",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"FULL_APPLICATION_NAME",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"STATUS",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"SIGNATURE",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:11,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"DOMAIN_ID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:10,isLocal:!0,isRepositoryEntity:!1,name:"Application",properties:[{columnRef:{index:0},index:0,isId:!0,name:"index",sinceVersion:1},{index:1,isId:!1,name:"domain",relationRef:{index:0},sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"scope",sinceVersion:1},{columnRef:{index:2},index:3,isId:!1,name:"name",sinceVersion:1},{columnRef:{index:3},index:4,isId:!1,name:"fullName",sinceVersion:1},{columnRef:{index:4},index:5,isId:!1,name:"status",sinceVersion:1},{columnRef:{index:5},index:6,isId:!1,name:"signature",sinceVersion:1},{index:7,isId:!1,name:"versions",relationRef:{index:1},sinceVersion:1},{index:8,isId:!1,name:"currentVersion",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:11,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"application"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:8,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"application"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:9,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"APPLICATIONS",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NAME",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:11,isLocal:!0,isRepositoryEntity:!1,name:"Domain",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"name",sinceVersion:1},{index:2,isId:!1,name:"applications",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"domain"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:10,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"DOMAINS",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/holding-pattern",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{allocationSize:2e3,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ACTOR_RECORD_ID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:5,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_OPERATION_HISTORY_ID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:0,isLocal:!0,isRepositoryEntity:!1,name:"RecordHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"actorRecordId",sinceVersion:1},{index:2,isId:!1,name:"actor",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"operationHistory",relationRef:{index:1},sinceVersion:1},{index:4,isId:!1,name:"newValues",relationRef:{index:2},sinceVersion:1},{index:5,isId:!1,name:"oldValues",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:1,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:5,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"recordHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:4},relationTableIndex:6,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"recordHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:5},relationTableIndex:7,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY",columnIndexes:[{name:"RCRD_HSTR_TO_OPRTN_HSTR_FX",columnList:["REPOSITORY_OPERATION_HISTORY_ID"],unique:!1}]}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"UU_ID",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:0,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"USER_ID",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:0,oneTableIndex:5,oneColumnIndex:0,sinceVersion:1}],name:"TERMINAL_ID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:1,oneTableIndex:10,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_INDEX",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isRepositoryEntity:!1,name:"Actor",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"uuId",sinceVersion:1},{index:2,isId:!1,name:"user",relationRef:{index:0},sinceVersion:1},{index:3,isId:!1,name:"terminal",relationRef:{index:1},sinceVersion:1},{index:4,isId:!1,name:"application",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:4,relationTableApplicationIndex:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:5,relationTableApplicationIndex:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:10,relationTableApplicationIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"AGE_SUITABILITY",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"CREATED_AT",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"DATE"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"IMMUTABLE",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"BOOLEAN"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"SOURCE",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"UU_ID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"STRING"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:0,oneTableIndex:4,oneColumnIndex:0,sinceVersion:1}],name:"OWNER_USER_ID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:2,isLocal:!0,isRepositoryEntity:!1,name:"Repository",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"ageSuitability",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"createdAt",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"immutable",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"source",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"uuId",sinceVersion:1},{index:6,isId:!1,name:"owner",relationRef:{index:0},sinceVersion:1},{index:7,isId:!1,name:"repositoryTransactionHistory",relationRef:{index:1},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:4,relationTableApplicationIndex:0,sinceVersion:1},{index:1,isId:!1,oneToManyElems:{mappedBy:"repository"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY",columnIndexes:[]},operations:{}},{columns:[{allocationSize:100,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TRANSACTION_TYPE",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"}],idColumnRefs:[{index:0}],index:3,isLocal:!0,isRepositoryEntity:!1,name:"TransactionHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"transactionType",sinceVersion:1},{index:2,isId:!1,name:"repositoryTransactionHistories",relationRef:{index:0},sinceVersion:1}],relations:[{index:0,isId:!1,oneToManyElems:{mappedBy:"transactionHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:2},relationTableIndex:4,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"TRANSACTION_HISTORY",columnIndexes:[]}},{columns:[{allocationSize:200,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"REPOSITORY_TRANSACTION_TYPE",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"SAVE_TIMESTAMP",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SYNC_TIMESTAMP",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[],name:"UUID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"STRING"},{index:5,isGenerated:!1,manyRelationColumnRefs:[],name:"IS_REPOSITORY_CREATION",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"BOOLEAN"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:2,oneRelationIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_ID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:3,oneRelationIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"TRANSACTION_HISTORY_ID",notNull:!0,propertyRefs:[{index:7}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:4,isLocal:!0,isRepositoryEntity:!1,name:"RepositoryTransactionHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"repositoryTransactionType",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"saveTimestamp",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"syncTimestamp",sinceVersion:1},{columnRef:{index:4},index:4,isId:!1,name:"uuId",sinceVersion:1},{columnRef:{index:5},index:5,isId:!1,name:"isRepositoryCreation",sinceVersion:1},{index:6,isId:!1,name:"repository",relationRef:{index:0},sinceVersion:1},{index:7,isId:!1,name:"transactionHistory",relationRef:{index:1},sinceVersion:1},{index:8,isId:!1,name:"operationHistory",relationRef:{index:2},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:2,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:7},relationTableIndex:3,sinceVersion:1},{index:2,isId:!1,oneToManyElems:{mappedBy:"repositoryTransactionHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:8},relationTableIndex:5,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_TRANSACTION_HISTORY",columnIndexes:[]},operations:{}},{columns:[{allocationSize:600,index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ORDER_NUMBER",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"CHANGE_TYPE",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"STRING"},{index:3,isGenerated:!1,manyRelationColumnRefs:[],name:"SYSTEM_WIDE_OPERATION_ID",notNull:!0,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:1,oneTableIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"ENTITY_ID",notNull:!0,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_ID",notNull:!0,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:null,oneTableIndex:4,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_TRANSACTION_HISTORY_ID",notNull:!0,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:5,isLocal:!0,isRepositoryEntity:!1,name:"OperationHistory",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"orderNumber",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"changeType",sinceVersion:1},{columnRef:{index:3},index:3,isId:!1,name:"systemWideOperationId",sinceVersion:1},{index:4,isId:!1,name:"entity",relationRef:{index:0},sinceVersion:1},{index:5,isId:!1,name:"actor",relationRef:{index:1},sinceVersion:1},{index:6,isId:!1,name:"repositoryTransactionHistory",relationRef:{index:2},sinceVersion:1},{index:7,isId:!1,name:"recordHistory",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:6,relationTableApplicationIndex:1,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:1,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:4,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"operationHistory"},relationType:"ONE_TO_MANY",propertyRef:{index:7},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_OPERATION_HISTORY",columnIndexes:[]}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"NEW_VALUE",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"ANY"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:0,oneRelationIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_RECORD_HISTORY_ID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:2}],index:6,isLocal:!0,isRepositoryEntity:!1,name:"RecordHistoryNewValue",properties:[{index:0,isId:!0,name:"recordHistory",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"newValue",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY_NEW_VALUES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMN_INDEX",notNull:!0,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"OLD_VALUE",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"ANY"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:0,oneRelationIndex:3,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_RECORD_HISTORY_ID",notNull:!0,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:2}],index:7,isLocal:!0,isRepositoryEntity:!1,name:"RecordHistoryOldValue",properties:[{index:0,isId:!0,name:"recordHistory",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"oldValue",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_RECORD_HISTORY_OLD_VALUES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"REPOSITORY_APPLICATION_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"APPLICATION_INDEX",notNull:!0,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:2}],index:8,isLocal:!0,isRepositoryEntity:!1,name:"RepositoryApplication",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{index:1,isId:!0,name:"repository",relationRef:{index:0},sinceVersion:1},{columnRef:{index:1},index:2,isId:!1,name:"applicationIndex",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:2,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"REPOSITORY_APPLICATIONS",columnIndexes:[]}}],integerVersion:1,referencedApplications:[{domain:"air",index:0,name:"@airport/travel-document-checkpoint",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]},{domain:"air",index:1,name:"@airport/airspace",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]}],versionString:"1.0.0"}]},{domain:"air",index:null,name:"@airport/moving-walkway",sinceVersion:1,versions:[{api:{apiObjectMap:{}},entities:[{columns:[{index:0,isGenerated:!1,manyRelationColumnRefs:[],name:"COLUMNINDEX",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:null,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"SYNCHRONIZATION_CONFLICT_ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0},{index:1}],index:0,isLocal:!0,isRepositoryEntity:!1,name:"SynchronizationConflictValues",properties:[{index:0,isId:!0,name:"synchronizationConflict",relationRef:{index:0},sinceVersion:1},{columnRef:{index:0},index:1,isId:!0,name:"columnIndex",sinceVersion:1}],relations:[{index:0,isId:!0,relationType:"MANY_TO_ONE",propertyRef:{index:0},relationTableIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"SYNCHRONIZATION_CONFLICT_VALUES",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"TYPE",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"STRING"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"ACKNOWLEDGED",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"BOOLEAN"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:0,oneTableIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:0,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"OVERWRITTEN_RECORD_HISTORY_ID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:0,oneTableIndex:0,oneColumnIndex:0,sinceVersion:1}],name:"OVERWRITING_RECORD_HISTORY_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:1,isLocal:!0,isRepositoryEntity:!1,name:"SynchronizationConflict",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{columnRef:{index:1},index:1,isId:!1,name:"type",sinceVersion:1},{columnRef:{index:2},index:2,isId:!1,name:"acknowledged",sinceVersion:1},{index:3,isId:!1,name:"repository",relationRef:{index:0},sinceVersion:1},{index:4,isId:!1,name:"overwrittenRecordHistory",relationRef:{index:1},sinceVersion:1},{index:5,isId:!1,name:"overwritingRecordHistory",relationRef:{index:2},sinceVersion:1},{index:6,isId:!1,name:"values",relationRef:{index:3},sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:2,relationTableApplicationIndex:0,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:0,relationTableApplicationIndex:0,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:5},relationTableIndex:0,relationTableApplicationIndex:0,sinceVersion:1},{index:3,isId:!1,oneToManyElems:{mappedBy:"SYNCHRONIZATION_CONFLICT_ID"},relationType:"ONE_TO_MANY",propertyRef:{index:6},relationTableIndex:0,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"SYNCHRONIZATION_CONFLICT",columnIndexes:[]},operations:{}},{columns:[{index:0,isGenerated:!0,manyRelationColumnRefs:[],name:"ID",notNull:!1,propertyRefs:[{index:0}],sinceVersion:1,type:"NUMBER"},{index:1,isGenerated:!1,manyRelationColumnRefs:[],name:"ACTOR_RECORD_ID",notNull:!1,propertyRefs:[{index:5}],sinceVersion:1,type:"NUMBER"},{index:2,isGenerated:!1,manyRelationColumnRefs:[],name:"UPDATED_VALUE",notNull:!1,propertyRefs:[{index:7}],sinceVersion:1,type:"ANY"},{index:3,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:0,oneApplicationIndex:1,oneTableIndex:8,oneColumnIndex:0,sinceVersion:1}],name:"APPLICATION_VERSION_ID",notNull:!1,propertyRefs:[{index:1}],sinceVersion:1,type:"NUMBER"},{index:4,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:1,oneApplicationIndex:1,oneTableIndex:6,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_ENTITY_ID",notNull:!1,propertyRefs:[{index:2}],sinceVersion:1,type:"NUMBER"},{index:5,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:2,oneApplicationIndex:0,oneTableIndex:2,oneColumnIndex:0,sinceVersion:1}],name:"REPOSITORY_ID",notNull:!1,propertyRefs:[{index:3}],sinceVersion:1,type:"NUMBER"},{index:6,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:3,oneApplicationIndex:0,oneTableIndex:1,oneColumnIndex:0,sinceVersion:1}],name:"ACTOR_ID",notNull:!1,propertyRefs:[{index:4}],sinceVersion:1,type:"NUMBER"},{index:7,isGenerated:!1,manyRelationColumnRefs:[{manyRelationIndex:4,oneApplicationIndex:1,oneTableIndex:4,oneColumnIndex:3,sinceVersion:1}],name:"APPLICATION_COLUMN_ID",notNull:!1,propertyRefs:[{index:6}],sinceVersion:1,type:"NUMBER"}],idColumnRefs:[{index:0}],index:2,isLocal:!0,isRepositoryEntity:!1,name:"RecordUpdateStage",properties:[{columnRef:{index:0},index:0,isId:!0,name:"id",sinceVersion:1},{index:1,isId:!1,name:"applicationVersion",relationRef:{index:0},sinceVersion:1},{index:2,isId:!1,name:"entity",relationRef:{index:1},sinceVersion:1},{index:3,isId:!1,name:"repository",relationRef:{index:2},sinceVersion:1},{index:4,isId:!1,name:"actor",relationRef:{index:3},sinceVersion:1},{columnRef:{index:1},index:5,isId:!1,name:"actorRecordId",sinceVersion:1},{index:6,isId:!1,name:"column",relationRef:{index:4},sinceVersion:1},{columnRef:{index:2},index:7,isId:!1,name:"updatedValue",sinceVersion:1}],relations:[{index:0,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:1},relationTableIndex:8,relationTableApplicationIndex:1,sinceVersion:1},{index:1,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:2},relationTableIndex:6,relationTableApplicationIndex:1,sinceVersion:1},{index:2,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:3},relationTableIndex:2,relationTableApplicationIndex:0,sinceVersion:1},{index:3,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:4},relationTableIndex:1,relationTableApplicationIndex:0,sinceVersion:1},{index:4,isId:!1,relationType:"MANY_TO_ONE",propertyRef:{index:6},relationTableIndex:4,relationTableApplicationIndex:1,sinceVersion:1}],sinceVersion:1,tableConfig:{name:"RECORD_UPDATE_STAGE",columnIndexes:[]},operations:{}}],integerVersion:1,referencedApplications:[{domain:"air",index:0,name:"@airport/holding-pattern-runtime",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]},{domain:"air",index:1,name:"@airport/airspace",sinceVersion:1,versions:[{entities:null,integerVersion:1,referencedApplications:null,versionString:"1.0.0"}]}],versionString:"1.0.0"}]}];var Ic=Object.freeze({__proto__:null,BLUEPRINT:Rc}),Ec=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gc=class{constructor(){this.initialized=!1}async initNoDb(e,...t){await B(this).get(Ro),this.transactionalServer.tempActor=new Br,await this.installStarterApplication(!0,!1,e),await this.applicationInitializer.stage(t,e),this.transactionalServer.tempActor=null,this.initialized=!0}async initWithDb(e,t){await B(this).get(Ro),this.transactionalServer.tempActor=new Br;const n=await this.storeDriver.doesTableExist(Q(Rc[0]),"PACKAGES",t);await this.installStarterApplication(!1,n,t),n||await this.internalRecordManager.initTerminal(e,t),this.transactionalServer.tempActor=null,this.initialized=!0}isInitialized(){return this.initialized}async initFeatureApplications(e,t){const n=await this.applicationDao.findAllWithJson(),i=new Map;for(const e of n)i.set(e.fullName,e);const o=[];for(const e of t){const t=i.get(Q(e));t?e.lastIds=t.versions[0].jsonApplication.lastIds:o.push(e)}this.transactionalServer.tempActor=new Br,await this.applicationInitializer.initialize(o,e,!0,!0),this.transactionalServer.tempActor=null}async installStarterApplication(e,t,n){const i=await Promise.resolve().then((function(){return Ic}));e?await this.applicationInitializer.stage(i.BLUEPRINT,n):t?await this.applicationInitializer.hydrate(i.BLUEPRINT,n):await this.applicationInitializer.initialize(i.BLUEPRINT,n,!1,!1)}};Ec([function(e,t){}],gc.prototype,"applicationDao",void 0),Ec([function(e,t){}],gc.prototype,"applicationInitializer",void 0),Ec([function(e,t){}],gc.prototype,"internalRecordManager",void 0),Ec([function(e,t){}],gc.prototype,"storeDriver",void 0),Ec([function(e,t){}],gc.prototype,"transactionalServer",void 0),gc=Ec([function(e){}],gc);var Oc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Tc=class{async deleteWhere(e,t,n,i,o){const r=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],a=n.deleteWhere(e,o);if(r.isLocal||n.isSync)return await a;const s=this.getCascadeSubTree(r),c=e.jsonQuery,l={S:s,F:[c.DF],W:c.W},p={applicationIndex:e.applicationIndex,tableIndex:e.tableIndex,jsonQuery:l,queryResultType:Ce.ENTITY_TREE,parameterMap:e.parameterMap},d=await n.find(p,{},o),u=new Map,f=new Set;for(const e of d)this.recordRepositoryIds(e,r,u,f,this.applicationUtils);return await this.recordTreeToDelete(u,t,n,i,o),await a}recordRepositoryIds(e,t,n,i,o){const r=e.repository.id;i.add(r);const a=je(n,t.applicationVersion.application.index),s=Le(je(a,t.index),r),c={};s.push(c);for(const r of t.properties)if(r.relation&&r.relation.length){if(!e[r.name])continue;const a=r.relation[0];switch(a.relationType){case fe.MANY_TO_ONE:o.forEachColumnOfRelation(a,e,((e,t,n)=>{this.columnProcessed(r,c,e,t)}),!1);break;case fe.ONE_TO_MANY:if(!a.oneToManyElems)continue;let s=e[a.property.name];if(s&&s.length){const e=a.relationEntity;s.forEach((t=>{this.recordRepositoryIds(t,e,n,i,o)}))}break;default:throw new Error(`Unknown relation type: '${a.relationType}' \n\t\t\t\t\t\t\ton '${t.name}.${a.property.name}'.`)}}else{const t=e[r.name];if(null==t)continue;this.columnProcessed(r,c,r.propertyColumns[0].column,t)}}columnProcessed(e,t,n,i){if(void 0===t[n.name])return t[n.name]=i,!1;if(!Yi(t[n.name],i))throw new Error(`Found value mismatch in '${e.entity.name}.${e.name}'\n\t\t\t(column: '${n.name}'): ${t[n.name]} !== ${i}`);return!0}async recordTreeToDelete(e,t,n,i,o){let r;for(const[a,s]of e)for(const[e,c]of s){const s=this.airportDatabase.applications[a].currentVersion[0].applicationVersion.entities[e];r||(r=await Wo(this.airportDatabase,this.sequenceGenerator));for(const[e,a]of c){const c=await this.historyManager.getNewRepositoryTransactionHistory(n.transactionHistory,e,o),l=this.repositoryTransactionHistoryDuo.startOperation(c,r,be.DELETE_ROWS,s,t,i);for(const e of a){const t=this.operationHistoryDuo.startRecordHistory(l,e.actor.id,e.actorRecordId);for(const n of s.properties)if(n.relation&&n.relation.length){const i=n.relation[0];switch(i.relationType){case fe.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(i,e,((e,n,i)=>{switch(e.name){case de.ACTOR_ID:case de.REPOSITORY_ID:break;default:this.recordHistoryDuo.addOldValue(t,e,n)}}));break;case fe.ONE_TO_MANY:break;default:throw new Error(`Unknown relation type: '${i.relationType}'\n\t\t\t\t\t\t\t\t\t\ton '${s.name}.${n.name}'.`)}}else{const i=n.propertyColumns[0].column;this.recordHistoryDuo.addOldValue(t,i,e[n.name])}}}}}getCascadeSubTree(e,t={}){for(const n of e.properties){let i;if(n.relation&&n.relation.length&&(i=n.relation[0]),i)switch(i.relationType){case fe.ONE_TO_MANY:if(!i.oneToManyElems)continue;const o={};t[n.name]=o,this.getCascadeSubTree(i.relationEntity,o);break;case fe.MANY_TO_ONE:this.applicationUtils.addRelationToEntitySelectClause(i,t);break;default:throw new Error(`Unknown relation type: '${i.relationType}' \n\t\t\t\t\t\t\ton '${e.name}.${n.name}'.`)}else t[n.name]=no}return t}};Oc([function(e,t){}],Tc.prototype,"airportDatabase",void 0),Oc([function(e,t){}],Tc.prototype,"applicationUtils",void 0),Oc([function(e,t){}],Tc.prototype,"historyManager",void 0),Oc([function(e,t){}],Tc.prototype,"operationHistoryDuo",void 0),Oc([function(e,t){}],Tc.prototype,"recordHistoryDuo",void 0),Oc([function(e,t){}],Tc.prototype,"repositoryTransactionHistoryDuo",void 0),Oc([function(e,t){}],Tc.prototype,"sequenceGenerator",void 0),Tc=Oc([function(e){}],Tc);var wc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let bc=class{async getNewTransactionHistory(e=we.LOCAL){return await this.transactionHistoryDuo.getNewRecord(e)}async getNewRepositoryTransactionHistory(e,t,n){return await this.transactionHistoryDuo.getRepositoryTransaction(e,t,!!n.newRepository)}};wc([function(e,t){}],bc.prototype,"transactionHistoryDuo",void 0),bc=wc([function(e){}],bc);var Nc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let _c=class{async insertValues(e,t,n,i,o,r){return await this.internalInsertValues(e,t,n,i,o,!1,r)}async insertValuesGetIds(e,t,n,i,o){return await this.internalInsertValues(e,t,n,i,o,!0)}verifyNoGeneratedColumns(e,t,n){for(let i=0;i<t.C.length;i++){const o=t.C[i],r=e.columns[o];if(r.isGenerated)throw new Error(n+`You cannot explicitly insert into a @GeneratedValue column '${r.name}'`)}return e.columns.filter((e=>e.isGenerated))}async internalInsertValues(e,t,n,i,o,r=!1,a=!0){const s=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],c=`Error inserting into '${s.name}'.'\n`;this.validateValueRowLength(e,c);const l=e.jsonQuery,p={};let d,u=0;for(const e of l.C){if(e<0||e>=s.columns.length)throw new Error(c+`Invalid column index: ${e}`);if(p[e])throw new Error(c+`Column ${s.name}.${s.columns[e].name} \nappears more than once in the Columns clause`);let t=1;for(let n of l.V){if(void 0===n[u])throw new Error(c+`\n\t'undefined' value in column ${s.name}.${s.columns[e].name} of row ${t}.\n\tAll values in an insert statment must either be null or have a non-null value.`);t++}u++,p[e]=!0}const f=e.jsonQuery;let y,h,m;s.isRepositoryEntity&&(d=this.ensureRepositoryEntityIdValues(t,s,f,c,n,o)),n.isSync&&!o.generateOnSync||(y=this.verifyNoGeneratedColumns(s,e.jsonQuery,c)),s.isLocal||(m=await Wo(this.airportDatabase,this.sequenceGenerator)),n.isSync&&!o.generateOnSync||!a||(h=await this.ensureGeneratedValues(s,f,t,d,y,m,c,this.sequenceGenerator)),s.isLocal||n.isSync||await this.addInsertHistory(s,e,t,m,n,i,o);const R=await n.insertValues(e,o);return r?h:R}async validateValueRowLength(e,t){const n=e.jsonQuery.V;if(!n.length)throw new Error(t+"no colum values provided");const i=n[0];if(!i||!i.length)throw new Error(t+"First row has no values");const o=i.length;for(let e=0;e<n.length;e++){const i=n[e];if(i.length!==o)throw new Error(t+`First row has ${o} values,\n\twhile row ${e+1} has ${i.length} values`)}}async ensureGeneratedValues(e,t,n,i,o,r,a,s){const c=t.V,l=e.idColumns,p=[];for(const e of c)p.push([]);let d,u;e.isLocal||(d=i.actorIdColumn,u=i.sysWideOperationIdColumn);for(const i of l){if(i.isGenerated)continue;let o,r=!1;if(t.C.filter(((e,t)=>{if(e===i.index)return o=t,!0})).length<1){if(i.id!==d.id)throw new Error(a+`Could not find @Id column ${e.name}.${i.name} in\n\t\t\t\t\tthe insert statement.  Non-generated @Id columns must be present in the Insert\n\t\t\t\t\tstatement (with exception of Actor ID).`);r=!0,o=t.C.length,t.C.push(d.index)}for(let t=0;t<c.length;t++){const s=c[t],l=p[t];let d;if(r)d=n.id;else if(d=s[o],!d&&0!==d)throw new Error(a+`No value provided on insert for @Id '${e.name}.${i.name}'.`);l[i.index]=d}}const f=[];for(const e of o)t.C.length,f.push(t.C.length),t.C.push(e.index);const y=o.map((e=>c.length)),h=await s.generateSequenceNumbers(o,y);return o.forEach(((e,t)=>{const n=h[t],i=f[t];c.forEach(((t,o)=>{const r=n[o];t[i]=r,p[o][e.index]=r}))})),e.isLocal||(t.C.push(u.index),c.forEach((e=>{e.push(r)}))),l.length||o.length?p:c.length}ensureRepositoryEntityIdValues(e,t,n,i,o,r){const a=t.idColumnMap[de.ACTOR_ID],s=t.idColumnMap[de.ACTOR_RECORD_ID],c=t.idColumnMap[de.REPOSITORY_ID],l=t.columnMap[de.SYSTEM_WIDE_OPERATION_ID];let p,d=!1,u=!1,f=!1;for(let e=0;e<n.C.length;e++){switch(n.C[e]){case a.index:if(d=!0,r.isSaveOperation)break;if(!o.isSync)throw new Error(i+"You cannot explicitly provide an ACTOR_ID value for Repository entities.");break;case s.index:if(u=!0,!o.isSync)throw new Error(i+"You cannot explicitly provide an ACTOR_RECORD_ID value for Repository entities.");break;case l.index:if(f=!0,!o.isSync)throw new Error(`Error inserting into '${t.name}'.\nYou cannot explicitly provide a SYSTEM_WIDE_OPERATION_ID value for Repository entities.`);break;case c.index:p=e}}const y=i+`Error inserting into '${t.name}'.\nYou must provide a valid REPOSITORY_ID value for Repository entities.`;if(void 0===p)throw new Error(y);if(o.isSync){if(!d)throw new Error(i+"ACTOR_ID must be provided for sync operations.");if(!u)throw new Error(i+"ACTOR_RECORD_ID must be provided for sync operations.");if(!f)throw new Error(i+"SYSTEM_WIDE_OPERATION_ID must be provided for sync operations.")}for(const s of n.V){if(s.length!==n.C.length)throw new Error(i+`Number of columns (${n.C.length}) does not match number of values (${s.length}).\n\t\t\t\t`);let c=s[p];if("number"!=typeof c||!Number.isInteger(c)||c<1)throw new Error(y);for(let e=0;e<s.length;e++){switch(e){case p:continue}const o=s[e],r=n.C[e],a=t.columns[r];if(a.notNull&&null===o)throw new Error(i+`Column '${a.name}' is NOT NULL\nand cannot have NULL values.`)}r.isSaveOperation||o.isSync||(s[a.index]=e.id)}return{actorIdColumn:a,sysWideOperationIdColumn:l}}async addInsertHistory(e,t,n,i,o,r,a){const s=t.jsonQuery;let c=[],l=[];const p=e.columnMap[de.REPOSITORY_ID].index,d=e.columnMap[de.ACTOR_ID].index,u=e.columnMap[de.ACTOR_RECORD_ID].index;let f,y,h;for(const e in s.C){switch(s.C[e]){case p:f=e;break;case d:y=e;break;case u:h=e}}for(const t of s.V){const p=t[f];let d=l[p];d||(d=await this.historyManager.getNewRepositoryTransactionHistory(o.transactionHistory,p,a));let u=c[p];u||(u=this.repositoryTransactionHistoryDuo.startOperation(d,i,be.INSERT_VALUES,e,n,r),c[p]=u);const m=t[h],R=t[y],I=this.operationHistoryDuo.startRecordHistory(u,R,m);for(const n in s.C){if(n===f||n===y||n===h)continue;const i=s.C[n],o=e.columns[i],r=t[n];this.recordHistoryDuo.addNewValue(I,o,r)}}}};Nc([function(e,t){}],_c.prototype,"airportDatabase",void 0),Nc([function(e,t){}],_c.prototype,"historyManager",void 0),Nc([function(e,t){}],_c.prototype,"insertManager",void 0),Nc([function(e,t){}],_c.prototype,"operationHistoryDuo",void 0),Nc([function(e,t){}],_c.prototype,"recordHistoryDuo",void 0),Nc([function(e,t){}],_c.prototype,"repositoryTransactionHistoryDuo",void 0),Nc([function(e,t){}],_c.prototype,"sequenceGenerator",void 0),_c=Nc([function(e){}],_c);var xc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ac=class{async find(e,t,n){return await this.ensureRepositoryPresenceAndCurrentState(t),await this.storeDriver.find(e,{},t,n)}async findOne(e,t,n){return await this.ensureRepositoryPresenceAndCurrentState(t),await this.storeDriver.findOne(e,{},t,n)}search(e,t,n){return this.storeDriver.search(e,{},t,n)}searchOne(e,t,n){return this.storeDriver.searchOne(e,{},t,n)}async ensureRepositoryPresenceAndCurrentState(e){e.repository&&e.repository.source&&e.repository.uuId&&await this.repositoryLoader.loadRepository(e.repository.source,e.repository.uuId,e)}};xc([function(e,t){}],Ac.prototype,"repositoryLoader",void 0),xc([function(e,t){}],Ac.prototype,"storeDriver",void 0),Ac=xc([function(e){}],Ac);var vc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sc=class extends mc{async initialize(e,t){return await this.storeDriver.initialize(e,t)}getInProgressTransactionById(e){return this.terminalStore.getTransactionManager().transactionInProgressMap.get(e)}isServer(e){return this.storeDriver.isServer(e)}async transactInternal(e,t){return await this.transact({application:"@airport/terminal",domain:"internal://domain",methodName:null,objectName:null},e,t)}async transact(e,t,n){if(n.transaction)return void await t(n.transaction,n);const i=await this.startTransaction(e,n);try{await t(i,n),await this.commit(e,n)}catch(t){throw await this.rollback(e,n),t}}async startTransaction(e,t){const n=this.terminalStore.getTransactionManager();let i;if(e.transactionId){if(i=n.transactionInProgressMap.get(e.transactionId),!i)throw new Error(`\nRecieved a startTransaction call (@Api call) with parent transaction id:\n\t${e.transactionId}\nBut, there is no such transaction in progress.`);if(i.id!==e.transactionId)throw new Error(`\nIn-progress transaction id does not match the passed in transaction id:\n${e.transactionId}`);this.checkForCircularDependencies(i,e)}else if(!this.isServer(t)&&n.transactionInProgressMap.size>0)return new Promise(((t,i)=>{n.pendingTransactionQueue.unshift({credentials:e,reject:i,resolve:t})}));const o=await this.internalStartTransaction(e,i,t);return i||(o.numberOfOperations=0),o}async internalStartTransaction(e,t,n){const i=this.terminalStore.getTransactionManager(),o=await this.storeDriver.setupTransaction(n,t);return await this.storeDriver.startTransaction(o,n),o.credentials=e,await this.setupTransaction(e,o,t,i,n),o}async rollback(e,t){const n=await this.getTransactionFromContextOrCredentials(e,t);let i=n.parentTransaction;await n.rollback(null,t),await this.clearTransaction(n,i,e,t),await this.resumeParentOrPendingTransaction(i,t)}async getTransactionFromContextOrCredentials(e,t){let n=t.transaction;if(!n){if(!e.transactionId)throw new Error("\nNo Transaction Id is passed in Credentials for a Rollback operation.\n\t\t\t\t");if(n=this.terminalStore.getTransactionManager().transactionInProgressMap.get(e.transactionId),!n)throw new Error(`\nCould not find Transaction: ${e.transactionId} in Transactons in-progress.\nNOTE: nested/child transactions must be commited or rolled back before their\nparent transactions.\n\t\t\t\t`);t.transaction=n}let i=n;for(;i=i.parentTransaction;);return t.rootTransaction=i,n}async resumeParentOrPendingTransaction(e,t){const n=this.terminalStore.getTransactionManager();if(e)await this.setupTransaction(e.credentials,e,e.parentTransaction,n,t);else if(n.pendingTransactionQueue.length){const e=n.pendingTransactionQueue.pop(),i=await this.internalStartTransaction(e.credentials,null,t);e.resolve(i)}}async commit(e,t){const n=await this.getTransactionFromContextOrCredentials(e,t);let i=n.parentTransaction;try{if(i){let e=n.transactionHistory,t=i.transactionHistory;for(const n of e.allOperationHistory){const e=n.repositoryTransactionHistory.repository.id,i=t.repositoryTransactionHistoryMap[e];i?n.repositoryTransactionHistory=i:(t.repositoryTransactionHistoryMap[e]=n.repositoryTransactionHistory,t.repositoryTransactionHistories.push(n.repositoryTransactionHistory))}t.allOperationHistory=t.allOperationHistory.concat(e.allOperationHistory),t.allRecordHistory=t.allRecordHistory.concat(e.allRecordHistory),t.allRecordHistoryNewValues=t.allRecordHistoryNewValues.concat(e.allRecordHistoryNewValues),t.allRecordHistoryOldValues=t.allRecordHistoryOldValues.concat(e.allRecordHistoryOldValues)}else await this.saveRepositoryHistory(n,t),await n.saveTransaction(n.transactionHistory);this.activeQueries.rerunQueries(),await n.commit(null,t);let o=n.transactionHistory;!i&&o.allRecordHistory.length&&await this.synchronizationOutManager.synchronizeOut(o.repositoryTransactionHistories)}finally{await this.clearTransaction(n,i,e,t),await this.resumeParentOrPendingTransaction(i,t)}}checkForCircularDependencies(e,t){if("internal://domain"!==t.domain)do{if(this.isSameSource(e,t)){let n=this.getApiName(t),i=e;do{n=`${this.getApiName(i.initiator)} ->\n${n}`}while(i=i.parentTransaction);throw new Error(`Circular API call detected:\n\t\t\t\t\n${n}\n\n\t\t\t\t`)}}while(e=e.parentTransaction)}async setupTransaction(e,t,n,i,o){o.transaction=t,e.transactionId=t.id,t.transactionHistory=this.transactionHistoryDuo.getNewRecord(),i.transactionInProgressMap.set(t.id,t),n?i.transactionInProgressMap.delete(n.id):i.rootTransactionInProgressMap.set(t.id,t)}isSameSource(e,t){const n=e.initiator;return n.domain===t.domain&&n.application===t.application&&n.objectName===t.objectName&&n.methodName===t.methodName}getApiName(e){return`${e.domain}.${e.application}.${e.objectName}.${e.methodName}`}async clearTransaction(e,t,n,i){const o=this.terminalStore.getTransactionManager();o.transactionInProgressMap.delete(e.id),t||o.rootTransactionInProgressMap.delete(e.id),i.transaction=null,n.transactionId=null}async saveRepositoryHistory(e,t){let n=e.transactionHistory;if(!n.allRecordHistory.length)return!1;let i=n.applicationMap;const o=await this.idGenerator.generateTransactionHistoryIds(n.repositoryTransactionHistories.length,n.allOperationHistory.length,n.allRecordHistory.length);return i.ensureEntity(la.TransactionHistory.__driver__.dbEntity,!0),n.id=o.transactionHistoryId,await this.doInsertValues(e,la.TransactionHistory,[n],t),i.ensureEntity(la.RepositoryTransactionHistory.__driver__.dbEntity,!0),n.repositoryTransactionHistories.forEach(((e,t)=>{e.id=o.repositoryHistoryIds[t],e.transactionHistory=n})),await this.doInsertValues(e,la.RepositoryTransactionHistory,n.repositoryTransactionHistories,t),i.ensureEntity(la.OperationHistory.__driver__.dbEntity,!0),n.allOperationHistory.forEach(((e,t)=>{e.id=o.operationHistoryIds[t]})),await this.doInsertValues(e,la.OperationHistory,n.allOperationHistory,t),i.ensureEntity(la.RecordHistory.__driver__.dbEntity,!0),n.allRecordHistory.forEach(((e,t)=>{e.id=o.recordHistoryIds[t]})),await this.doInsertValues(e,la.RecordHistory,n.allRecordHistory,t),n.allRecordHistoryNewValues.length&&(i.ensureEntity(la.RecordHistoryNewValue.__driver__.dbEntity,!0),await this.doInsertValues(e,la.RecordHistoryNewValue,n.allRecordHistoryNewValues,t)),n.allRecordHistoryOldValues.length&&(i.ensureEntity(la.RecordHistoryOldValue.__driver__.dbEntity,!0),await this.doInsertValues(e,la.RecordHistoryOldValue,n.allRecordHistoryOldValues,t)),!0}};vc([function(e,t){}],Sc.prototype,"activeQueries",void 0),vc([function(e,t){}],Sc.prototype,"idGenerator",void 0),vc([function(e,t){}],Sc.prototype,"storeDriver",void 0),vc([function(e,t){}],Sc.prototype,"synchronizationOutManager",void 0),vc([function(e,t){}],Sc.prototype,"terminalStore",void 0),vc([function(e,t){}],Sc.prototype,"transactionHistoryDuo",void 0),Sc=vc([function(e){}],Sc);var Cc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Dc=class{async updateValues(e,t,n,i,o){const r=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex],a=`Error updating '${r.name}'\n`,s={SET:[]};let c,l,p;r.isLocal||n.isSync||(p=await Wo(this.airportDatabase,this.sequenceGenerator),[c,l]=await this.addUpdateHistory(e,t,p,a,n,i,o),s.SET.push({column:l.systemWideOperationIdColumn,value:p}));const d=await n.updateWhere(e,s,o);if(!r.isLocal&&!n.isSync){const t=o.dbEntity;o.dbEntity=r,await this.addNewValueHistory(e.jsonQuery,c,p,l,a,n,o),o.dbEntity=t}return d}async addUpdateHistory(e,t,n,i,o,r,a){if(!a.dbEntity.isRepositoryEntity)throw new Error(i+"Cannot add update history for a non-RepositoryEntity");const s=this.airportDatabase.qApplications[a.dbEntity.applicationVersion.application.index][a.dbEntity.name],c=e.jsonQuery,l=this.applicationUtils.getSheetSelectFromSetClause(a.dbEntity,s,c.S,i),p={S:new Ai(null).nonDistinctSelectClauseToJSON(l.selectClause,this.queryUtils,this.fieldUtils,this.relationManager),F:[c.U],W:c.W},d={applicationIndex:e.applicationIndex,tableIndex:e.tableIndex,jsonQuery:p,queryResultType:Ce.SHEET,parameterMap:e.parameterMap},u=await o.find(d,{},a),{recordsByRepositoryId:f,repositoryIdSet:y}=this.groupRecordsByRepository(u,l),h=Array.from(y),m={};for(const e of h){const i={};m[e]=i;const s=await this.historyManager.getNewRepositoryTransactionHistory(o.transactionHistory,e,a),c=this.repositoryTransactionHistoryDuo.startOperation(s,n,be.UPDATE_ROWS,a.dbEntity,t,r),p=f[e];for(const e of p){const t=e[l.actorIdColumnIndex],n=Ue(i,t),o=e[l.actorRecordIdColumnIndex],r=this.operationHistoryDuo.startRecordHistory(c,t,o);n[o]=r;for(let t=0;t<e.length;t++){switch(t){case l.actorIdColumnIndex:case l.actorRecordIdColumnIndex:case l.repositoryIdColumnIndex:continue}const n=l.selectClause[t].dbColumn,i=e[t];this.recordHistoryDuo.addOldValue(r,n,i)}}}return[m,l]}async addNewValueHistory(e,t,n,i,o,r,a){const s=this.airportDatabase.qApplications[a.dbEntity.applicationVersion.application.index][a.dbEntity.name],c=new Ai({from:[s],select:[],where:s[de.systemWideOperationId].equals(n)});let l=this.queryFacade.getPortableQuery(c,Ce.SHEET,a);const p=new Map,d=[];let u=0;for(const e of i.selectClause){const t=e.dbColumn;d.push(t),p.set(t.index,u),u++}const f={SELECT:d},y=await r.find(l,f,a),{recordsByRepositoryId:h,repositoryIdSet:m}=this.groupRecordsByRepository(y,i);for(const n of m){const r=h[n];for(const n of r){const r=n[p.get(i.repositoryIdColumnIndex)],s=n[p.get(i.actorIdColumnIndex)],c=n[p.get(i.actorRecordIdColumnIndex)],l=t[r][s][c];for(const t in e.S){const e=a.dbEntity.columnMap[t],i=n[p.get(e.index)];if(void 0===i)throw new Error(o+"Values cannot be 'undefined'.");if(e.notNull&&null===i)throw new Error(o+`Column '${e.entity.name}'.'${e.name}' is NOT NULL\n\t\t\t\t\t\tand cannot have NULL values.`);this.recordHistoryDuo.addNewValue(l,e,i)}}}}groupRecordsByRepository(e,t){const n={},i=new Set;for(const o of e){const e=o[t.repositoryIdColumnIndex];i.add(e);Le(n,e).push(o)}return{recordsByRepositoryId:n,repositoryIdSet:i}}};Cc([function(e,t){}],Dc.prototype,"airportDatabase",void 0),Cc([function(e,t){}],Dc.prototype,"applicationUtils",void 0),Cc([function(e,t){}],Dc.prototype,"fieldUtils",void 0),Cc([function(e,t){}],Dc.prototype,"historyManager",void 0),Cc([function(e,t){}],Dc.prototype,"operationHistoryDuo",void 0),Cc([function(e,t){}],Dc.prototype,"queryFacade",void 0),Cc([function(e,t){}],Dc.prototype,"queryUtils",void 0),Cc([function(e,t){}],Dc.prototype,"recordHistoryDuo",void 0),Cc([function(e,t){}],Dc.prototype,"relationManager",void 0),Cc([function(e,t){}],Dc.prototype,"repositoryTransactionHistoryDuo",void 0),Cc([function(e,t){}],Dc.prototype,"sequenceGenerator",void 0),Dc=Cc([function(e){}],Dc);var Mc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vc=class{verify(e,t){return e instanceof Array||(e=[e]),e}};Vc=Mc([function(e){}],Vc);var Pc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Lc=class{getOperationsInOrder(e,t){const n=this.getEntitiesToPersist(e,[],[],t);this.resolveCircularDependencies(n,t);const i=this.orderEntitiesToPersist(n,t),o=this.optimizePersistOperations(i,t);return this.ensureUpdatesAreGroupedCorrectly(o,t)}getEntitiesToPersist(e,t,n,i,o,r,a=!1){let s=[];const c=i.dbEntity;for(const l of e){const{isCreate:e,isDelete:p,isParentId:d,isPassThrough:u,isStub:f,isUpdate:y}=this.entityStateManager.getEntityStateTypeAsFlags(l,c);if(f)continue;const h=this.entityStateManager.getOperationUniqueId(l);if(a&&(e||y))throw new Error(`Cannot do a Create or Update operation on an entity that will be\ndeleted by cascading rules.  Entity: ${c.name}.\nEntity "${this.entityStateManager.getUniqueIdFieldName()}":  ${h}`);let m;if(u){if(n[h])continue;n[h]=!0}else{m=t[h];let n=!1;if(m?n=!0:d||a||(m={circleTraversedFor:{},dbEntity:c,dependsOnByOUID:[],dependsOn:[],entity:l,isCreate:e,isDelete:p},s.push(m),t[h]=m),!d&&!p){if(o&&!p){const e=this.entityStateManager.getOperationUniqueId(o.entity);m.dependsOnByOUID[e]||this.entityStateManager.getOperationUniqueId(m.entity)===e||(m.dependsOnByOUID[e]=o,m.dependsOn.push(o))}r&&(m.dependsOnByOUID[h]||this.entityStateManager.getOperationUniqueId(r.entity)===h||(r.dependsOnByOUID[h]=m,r.dependsOn.push(m)))}if(n)continue}for(const o of i.dbEntity.properties){let f,y=l[o.name];if(!y||"object"!=typeof y||!o.relation||!o.relation.length)continue;let R=null,I=!1,E=a||p;const g=o.relation[0];switch(g.relationType){case fe.MANY_TO_ONE:if(E=!1,c.isRepositoryEntity&&("repository"===o.name||"actor"===o.name)&&!y[this.entityStateManager.getStateFieldName()])continue;const t=this.entityStateManager.getEntityStateTypeAsFlags(y,g.relationEntity);if(t.isParentId)continue;if(t.isDelete)if(u)this.entityStateManager.markForDeletion(l);else{if(!p)throw new Error(`Cannot delete an entity without removing all references to it.\n\t\t\t\t\t\t\t\tFound a reference in ${c.name}.${o.name}.\n\t\t\t\t\t\t\t\tEntity "${this.entityStateManager.getUniqueIdFieldName()}":  ${h}`);a||(r&&r.dependsOn.pop(),s.pop()),a=!0}t.isCreate&&(I=!0),f=[y];break;case fe.ONE_TO_MANY:e&&(R=m),f=y}if(f){const e=g.relationEntity,o=i.dbEntity;i.dbEntity=e;const r=this.getEntitiesToPersist(f,t,n,i,R,d||p||!I?null:m,E);s=s.concat(r),i.dbEntity=o}}}return s}resolveCircularDependencies(e,t){for(const n of e){const e=this.entityStateManager.getOperationUniqueId(n.entity);this.resolveCircularDependenciesForNode(n,e,n,t)}}resolveCircularDependenciesForNode(e,t,n,i,o=[]){if(n.dependsOn&&!n.circleTraversedFor[t]){n.circleTraversedFor[t]=!0;for(let r=n.dependsOn.length-1;r>=0;r--){const a=n.dependsOn[r];if(this.entityStateManager.getOperationUniqueId(a.entity)===t){let e=[];for(let t of o){let n=t.dbEntity.applicationVersion.application.name+":"+t.dbEntity.name;e.push(n)}let t=a.dbEntity.applicationVersion.application.name+":"+a.dbEntity.name;throw e.push(t),t=o[0].dbEntity.applicationVersion.application.name+":"+o[0].dbEntity.name,new Error(`Found a circular dependency in\n\t\t\t\t\t${e.join(" -> ")}\n\t\t\t\t\t`)}o.push(a),this.resolveCircularDependenciesForNode(e,t,a,i,o),o.pop()}}}orderEntitiesToPersist(e,t){let n=[],i=[];for(;n.length<e.length;)for(const t of e){const e=this.entityStateManager.getOperationUniqueId(t.entity);if(i[e])continue;let o=!0;for(const e of t.dependsOn){if(!i[this.entityStateManager.getOperationUniqueId(e.entity)]){o=!1;break}}o&&(i[e]=t,n.push(t))}return n}optimizePersistOperations(e,t){let n=[],i=[],o=[];for(const t of e){const e=t.dbEntity,r=Le(o,e.applicationVersion.application.index);let a=r[e.index];a||(a={create:[],delete:[],update:[]},r[e.index]=a);let s,c=[];c=t.isCreate?a.create:t.isDelete?a.delete:a.update,c.length?s=c[c.length-1]:(s={dbEntity:e,entities:[],isCreate:t.isCreate,isDelete:t.isDelete},c.push(s),n.push(s));let l=!0;for(const e of t.dependsOn){const t=this.entityStateManager.getOperationUniqueId(e.entity);if(this.entityStateManager.getOperationUniqueId(e.entity),!i[t]){l=!1;break}}!l&&s.entities.length&&(s={dbEntity:e,entities:[],isCreate:t.isCreate,isDelete:t.isDelete},c.push(s),n.push(s)),s.entities.push(t.entity)}return n}ensureUpdatesAreGroupedCorrectly(e,t){return e}};Pc([function(e,t){}],Lc.prototype,"entityStateManager",void 0),Lc=Pc([function(e){}],Lc);var Uc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jc=class{restoreEntityGraph(e,t){const n=[],i=new Set,o=this.linkEntityGraph(e,n,i,t);for(let e=1;e<n.length;e++){if(!n[e])throw new Error(`Missing entity for\n"${this.entityStateManager.getUniqueIdFieldName()}": ${e}`)}return t.lastOUID=n.length-1,o}linkEntityGraph(e,t,n,i){const o=i.dbEntity,r=[];for(const a of e){if(!a)throw new Error("Null root entities and @OneToMany arrays with null entities are not allowed");const e=this.entityStateManager.getOperationUniqueId(a);if(!e||"number"!=typeof e||e<1)throw new Error(`Invalid entity Unique Id Field\n"${this.entityStateManager.getUniqueIdFieldName()}": ${e}.`);const s=t[e];if(n.has(a)){if(!s)throw new Error("Entity has been processed but is not found by operationUniqueId");r.push(s);continue}n.add(a);const{isParentId:c,isStub:l}=this.entityStateManager.getEntityStateTypeAsFlags(a,o);let p;if(s){if(this.entityStateManager.isStub(s))l||this.entityStateManager.copyEntityState(a,s);else if(!l)throw new Error(`More than 1 non-Stub object found in input\nfor "${this.entityStateManager.getUniqueIdFieldName()}": ${e}`);p=s}else p={},p[this.entityStateManager.getUniqueIdFieldName()]=e,p[this.entityStateManager.getStateFieldName()]=this.entityStateManager.getEntityState(a),this.entityStateManager.copyEntityState(a,p),t[e]=p;for(const e of o.properties){let r=a[e.name];if(void 0!==r){if(e.relation&&e.relation.length){const a=e.relation[0];let s=r,l=!1;switch(this.assertRelationValueIsAnObject(r,e),a.relationType){case fe.MANY_TO_ONE:l=!0,this.assertManyToOneNotArray(r,e),s=[r];break;case fe.ONE_TO_MANY:if(this.assertOneToManyIsArray(r,e),c)throw new Error("Parent Ids may not contain any @OneToMany relations");break;default:throw new Error(`Unexpected relation type ${a.relationType}\nfor ${o.name}.${e.name}`)}const p=i.dbEntity,d=p.applicationVersion.application,u=a.relationEntity.applicationVersion.application;if("air"!==u.domain.name&&d.fullName!==u.fullName)continue;let f;if(i.dbEntity=a.relationEntity,r)if(f=this.linkEntityGraph(s,t,n,i),l){if(f=f[0],c&&!this.entityStateManager.isParentId(f))throw new Error("Parent Ids may only contain @ManyToOne relations\nthat are themselves Parent Ids.")}else if(c)throw new Error("Parent Ids may NOT contain @OneToMany colletions.");r=f,i.dbEntity=p}else if((c||l)&&!e.isId)throw new Error("Deletes, ParentIds and Stubs may only contain @Id properties or relations.");p[e.name]=r}}r.push(p)}return r}assertRelationValueIsAnObject(e,t){if(null!=e&&("object"!=typeof e||e instanceof Date))throw new Error(`Unexpected value in relation property: ${t.name}, \n\t\t\t\tof entity ${t.entity.name}`)}assertManyToOneNotArray(e,t){if(e instanceof Array)throw new Error(`@ManyToOne relation cannot be an array. Relation property: ${t.name}, \nof entity ${t.entity.name}`)}assertOneToManyIsArray(e,t){if(null!=e&&!(e instanceof Array))throw new Error(`@OneToMany relation must be an array. Relation property: ${t.name}, \nof entity ${t.entity.name}\``)}};Uc([function(e,t){}],jc.prototype,"entityStateManager",void 0),jc=Uc([function(e){}],jc);var Fc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let kc=class{async ensure(e){}ensureSync(e){}};kc=Fc([function(e){}],kc);var Bc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hc=class{async performSave(e,t,n,i,o){let r;if(o.isSaveOperation=!0,o.internal)r=e instanceof Array?e:[e];else{const t=this.cascadeGraphVerifier.verify(e,o);r=this.entityGraphReconstructor.restoreEntityGraph(t,o)}await this.structuralEntityValidator.validate(r,[],o);const a=this.dependencyGraphResolver.getOperationsInOrder(r,o),s=o.dbEntity;let c,l={id:t.id,uuId:t.uuId,user:t.user?{id:t.user.id}:null};o.newRepository&&(c={id:o.newRepository.id,createdAt:o.newRepository.createdAt,uuId:o.newRepository.uuId,ageSuitability:o.newRepository.ageSuitability,source:o.newRepository.source,ownerActor:{id:t.id,uuId:t.uuId,user:t.user?{id:t.user.id}:null}});const p={actor:l,created:{},newRepository:c,deleted:{},updated:{}};for(const e of a)o.dbEntity=e.dbEntity,e.isCreate?await this.internalCreate(e.entities,t,n,i,p,o,!0):e.isDelete?await this.internalDelete(e.entities,t,n,i,p,o):await this.internalUpdate(e.entities,t,n,i,p,o);return o.dbEntity=s,p}async internalCreate(e,t,n,i,o,r,a){const s=this.airportDatabase.qApplications[r.dbEntity.applicationVersion.application.index][r.dbEntity.name];let c={insertInto:s,columns:this.qMetadataUtils.getAllInsertableColumns(s),values:[]},l=[];c.columns.forEach(((e,t)=>{l[e.dbColumn.index]=t}));for(const t of e){let e=[];for(const n of r.dbEntity.properties){let i=t[n.name];if(void 0===i&&(i=null),n.relation&&n.relation.length){const i=n.relation[0];switch(i.relationType){case fe.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(i,t,((t,n,i)=>{t.isGenerated||(e[l[t.index]]=void 0===n?null:n)}),!1);break;case fe.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${i.relationType}' \n\t\t\t\t\t\tfor '${r.dbEntity.name}.${n.name}'.`)}}else{let t=n.propertyColumns[0].column;t.isGenerated||(e[l[t.index]]=i)}}c.values.push(e)}const p=new Hi(c);if(c.values.length){const s=r.dbEntity.columns.filter((e=>e.isGenerated));if(s.length&&a){const a=this.queryFacade.getPortableQuery(p,null,r),c=await this.insertManager.insertValuesGetIds(a,t,n,i,r);for(let t=0;t<e.length;t++){const n=e[t],i={};o.created[this.entityStateManager.getOperationUniqueId(n)]=i;for(const e of s){const o=e.propertyColumns[0].property.name,r=c[t][e.index];n[o]=r,i[o]=r}}}else{const s=this.queryFacade.getPortableQuery(p,null,r);await this.insertManager.insertValues(s,t,n,i,r,a);for(let t=0;t<e.length;t++){const n=e[t];o.created[this.entityStateManager.getOperationUniqueId(n)]=!0}}}}async internalUpdate(e,t,n,i,o,r){const a=this.airportDatabase.qApplications[r.dbEntity.applicationVersion.application.index][r.dbEntity.name];for(const s of e){const e={},c=[];let l=!1;const p=this.entityStateManager.getOriginalValues(s);if(p){for(const t of r.dbEntity.properties){const n=s[t.name];if(t.relation&&t.relation.length){const n=t.relation[0];switch(n.relationType){case fe.MANY_TO_ONE:let i=p[t.name];this.applicationUtils.forEachColumnOfRelation(n,s,((n,r,p)=>{let d=i,u=r,f=r;for(const e of p[0])d=d instanceof Object&&d[e]?d[e]:null,u instanceof Object&&u[e]?(u=u[e],f.push(e)):u=null;if(t.isId){let e=a;for(const t of p[0])e=e[t];c.push(e.equals(r))}else if(!Yi(d,u)){let t=e;for(let e=0;e<f.length-1;e++){const n=f[e];t[n]||(t[n]={}),t=t[n]}t[f.length-1]=u,o.updated[this.entityStateManager.getOperationUniqueId(s)]=!0,l=!0}}),t.isId);break;case fe.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${n.relationType}' \n\t\t\t\t\t\tfor '${r.dbEntity.name}.${t.name}'.`)}}else{const i=p[t.name];t.isId?c.push(a[t.name].equals(n)):Yi(i,n)||(e[t.name]=n,o.updated[this.entityStateManager.getOperationUniqueId(s)]=!0,l=!0)}}if(l){let o;o=c.length>1?un(...c):c[0];const s=new Gi({update:a,set:e,where:o}),l=this.queryFacade.getPortableQuery(s,null,r);await this.updateManager.updateValues(l,t,n,i,r)}}}}async internalDelete(e,t,n,i,o,r){const a=r.dbEntity,s=this.airportDatabase.qApplications[a.applicationVersion.application.index][a.name],c=[],l=[];let p,d=[];for(const t of e){for(let e in t){if(!t.hasOwnProperty(e))continue;const n=a.propertyMap[e];if(!n)continue;const i=t[e];let o;if(n.relation&&n.relation.length&&(o=n.relation[0]),o)switch(o.relationType){case fe.MANY_TO_ONE:this.applicationUtils.forEachColumnOfRelation(o,a,((e,t,i)=>{if(n.isId&&void 0===l[e.index]){let e=s;for(const t of i[0])e=e[t];c.push(e.equals(t))}}),!1);break;case fe.ONE_TO_MANY:break;default:throw new Error(`Unknown relationType '${o.relationType}' \n\t\t\t\t\t\tfor '${a.name}.${n.name}'.`)}else n.isId&&c.push(s[e].equals(i))}c.length>1?d.push(un(...c)):d.push(c[0]),o.deleted[this.entityStateManager.getOperationUniqueId(t)]=!0}p=1===d.length?d[0]:fn(...d);let u=new Fi({deleteFrom:s,where:p}),f=this.queryFacade.getPortableQuery(u,null,r);await this.deleteManager.deleteWhere(f,t,n,i,r)}};Bc([function(e,t){}],Hc.prototype,"airportDatabase",void 0),Bc([function(e,t){}],Hc.prototype,"applicationUtils",void 0),Bc([function(e,t){}],Hc.prototype,"cascadeGraphVerifier",void 0),Bc([function(e,t){}],Hc.prototype,"deleteManager",void 0),Bc([function(e,t){}],Hc.prototype,"dependencyGraphResolver",void 0),Bc([function(e,t){}],Hc.prototype,"entityGraphReconstructor",void 0),Bc([function(e,t){}],Hc.prototype,"entityStateManager",void 0),Bc([function(e,t){}],Hc.prototype,"insertManager",void 0),Bc([function(e,t){}],Hc.prototype,"qMetadataUtils",void 0),Bc([function(e,t){}],Hc.prototype,"queryFacade",void 0),Bc([function(e,t){}],Hc.prototype,"structuralEntityValidator",void 0),Bc([function(e,t){}],Hc.prototype,"updateManager",void 0),Hc=Bc([function(e){}],Hc);var $c=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gc=class{async validate(e,t,n,i=!1,o=null,r=null,a=null){const s=n.dbEntity;if(!s.idColumns.length)throw new Error(`Cannot run 'save' for entity '${s.name}' with no @Id(s).\n\t\t\t\t\tPlease use non-entity operations (like 'insert' or 'updateWhere') instead.`);let c=!!r;for(const l of e){c||(r=l);const{isCreate:e,isParentId:p,isStub:d}=this.entityStateManager.getEntityStateTypeAsFlags(l,s);if(p)continue;const u=this.entityStateManager.getOperationUniqueId(l);if(!!t[u])continue;t[u]=!0;let f=!1;for(const c of s.properties){let y=l[c.name];if(void 0!==y||d||(y=null,l[c.name]=y),c.relation&&c.relation.length){const p=c.relation[0];let d=null,u=!1,h=!0;switch(p.relationType){case fe.MANY_TO_ONE:if(c.isId){let t=!1;this.applicationUtils.forEachColumnOfRelation(p,l,((i,o,r)=>{i.notNull&&(h=!1),this.isRepositoryColumnAndNewRepositoryNeed(s,c,i,e,l,o,n)&&(t=!0)}),!1),t&&(n.newRepository||(await this.repositoryManager.createRepository(n.actor,n),f=!0),l[c.name]=n.newRepository)}if(i){const e=o.relation[0].oneToManyElems,t=e?e.mappedBy:null,n=p.manyToOneElems?p.manyToOneElems.mappedBy:null;t!==c.name&&n!==o.name||(l[c.name]=a)}if(y)if(y)d=[y];else{if(!h)throw new Error(`Non-nullable relation ${s.name}.${c.name} does not have value assigned`);console.warn(`Probably OK: Nullable @ManyToOne ${s.name}.${c.name} does not have anything assigned.`)}break;case fe.ONE_TO_MANY:u=!0,d=y;break;default:throw new Error(`Unexpected relation type ${p.relationType}\nfor ${s.name}.${c.name}`)}if(d&&d.length){const e=n.dbEntity;n.dbEntity=p.relationEntity,this.validate(d,t,n,u,c,r,l),n.dbEntity=e}}else{const t=c.propertyColumns[0].column;if(c.isId){const n=this.applicationUtils.isIdEmpty(y);this.ensureIdValue(s,c,t,e,n)}else if((d||p)&&void 0!==y)throw new Error(`Unexpected non-@Id value Stub|ParentId|Deleted record.\nProperty: ${s.name}.${c.name}, with "${this.entityStateManager.getUniqueIdFieldName()}":  ${u}`);this.ensureNonRelationalValue(c,t,y)}}this.ensureRepositoryValidity(l,r,a,s,o,e,i,f,n)}}ensureRepositoryValidity(e,t,n,i,o,r,a,s,c){if(!i.isRepositoryEntity)return;if(!n){const t=this.entityStateManager.getOriginalValues(e);if(s&&t&&t.repository&&t.actor&&t.actorRecordId){const n=e;n.originalRepository=t.repository,this.entityStateManager.markAsStub(n.originalRepository),n.originalActor=t.actor,this.entityStateManager.markAsStub(n.originalActor),n.originalActorRecordId=t.actorRecordId}return}if(s)throw new Error(`Error creating a new repository in a nested record:\nIn Entity: ${i.name}\nThat is a child of ${o.entity.name} via ${o.entity.name}.${o.name}\n->\nWhen creating a new repository the top level record should be of the newly created repository.\n`);let l=e;if(t.repository.id!==l.repository.id){if(r)throw new Error(`A newly created ${i.name} via ${i.name} record for repository id ${l.repository.id} (UUID: ${l.repository.id})\nis being assigned to repository id ${l.repository.id} (UUID: ${l.repository.id})\n\tThis is because it is being referenced via ${o.entity.name}.${o.name},\n\tfrom a record of repository id ${l.repository.id} (UUID: ${l.repository.id})\n\t\n\tIf you are manually creating a copy of a record in another repository, there is no need,\n\tAIRport automatically copies all records refrenced via @ManyToOne()s into the created/modified\n\trepository.\n\n\tOtherwise, did you mean to set this record's repository to the same one as the referencing record?`);l.originalRepository=l.repository,l.repository=t.repository,l.originalActor=l.actor,l.originalActorRecordId=l.actorRecordId,l.actor=c.actor,delete l.actorRecordId,l[this.entityStateManager.getStateFieldName()]=Ee.CREATE}}isRepositoryColumnAndNewRepositoryNeed(e,t,n,i,o,r,a){if(!n.idIndex&&0!==n.idIndex)return;const s=this.applicationUtils.isIdEmpty(r);if(!e.isRepositoryEntity)return this.ensureIdValue(e,t,n,i,s),!1;if(!s){if(i&&this.applicationUtils.isActorId(n.name))throw new Error("Actor cannot be passed in for create Operations");return!1}if(!i)throw new Error("Ids must be populated in entities for non-Create operations");if(this.applicationUtils.isRepositoryId(n.name))return!0;if(this.applicationUtils.isActorId(n.name))return o[t.name]=a.actor,!1;if(this.applicationUtils.isActorRecordId(n.name))return!1;throw new Error(`Unexpected @Id column '${n.name}' in a Repository Entity.`)}ensureIdValue(e,t,n,i,o){if(n.isGenerated){if(i&&!o)throw new Error(`@GeneratedValue() @Id() ${e.name}.${t.name},\ncolumn:  ${n.name}\nmust NOT have a value for entity Insert operation.`);if(!i&&o)throw new Error(`@GeneratedValue() @Id() ${e.name}.${t.name} \ncolumn:  ${n.name}\nmust have a value for entity non-Insert operations.`)}else if(o)throw new Error(`non-@GeneratedValue() @Id() ${e.name}.${t.name},\ncolumn:  ${n.name}\nmust always have a value for all entity operations.`)}ensureNonRelationalValue(e,t,n){if(null!=n)switch(t.type){case Ie.ANY:break;case Ie.BOOLEAN:"boolean"!=typeof n&&this.throwUnexpectedProperty(e,t,n);break;case Ie.DATE:"object"==typeof n&&n instanceof Date||this.throwUnexpectedProperty(e,t,n);break;case Ie.JSON:("object"!=typeof n||n instanceof Date)&&this.throwUnexpectedProperty(e,t,n);break;case Ie.NUMBER:"number"!=typeof n&&this.throwUnexpectedProperty(e,t,n);break;case Ie.STRING:"string"!=typeof n&&this.throwUnexpectedProperty(e,t,n)}}throwUnexpectedProperty(e,t,n){throw new Error(`Unexpected property value '${n.toString()}' in property '${e.entity.name}.${e.name}'\n\t\t(column: '${t.name}').`)}};$c([function(e,t){}],Gc.prototype,"applicationUtils",void 0),$c([function(e,t){}],Gc.prototype,"entityStateManager",void 0),$c([function(e,t){}],Gc.prototype,"repositoryManager",void 0),Gc=$c([function(e){}],Gc);var qc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yc=class{deserialize(e,t,n){if(e.length!==t.jsonQuery.parameters.length)throw new Error(`Wrong number of parameters for ${t.dbEntity.name}.${t.jsonQuery.queryName}\n            Received:  ${e.length}\n            Expecting: ${t.jsonQuery.parameters.length}\n            `);const i=[];for(let o=0;o<e.length;o++){const r=this.deserializeParameter(e[o],t.jsonQuery.parameters[o],o+1,t,n);i.push(r)}return i}deserializeParameter(e,t,n,i,o){switch(t.type){case Ie.BOOLEAN:this.checkTypeOfParameter(e,"boolean",n,i);break;case Ie.DATE:if(!(e instanceof Object&&e[o.getStateFieldName()]===EntityState.RESULT_DATE&&e.value))throw new Error(`Invalid Serialized Date format for:\n                    ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                    parameter #: ${n}\n        got: ${JSON.stringify(e)}\n                    `);try{return new Date(e)}catch(t){throw new Error(`Invalid Serialized Date format for:\n                    ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                    parameter #: ${n}\n        got: ${JSON.stringify(e)}\n                    `)}break;case Ie.NUMBER:this.checkTypeOfParameter(e,"number",n,i);break;case Ie.STRING:this.checkTypeOfParameter(e,"string",n,i);break;default:throw new Error(`Unsupported parameter type for:\n                ${i.dbEntity.name}.${i.jsonQuery.queryName}\n                parameter #: ${n}\n    got: ${t.type}\n                `)}return e}checkTypeOfParameter(e,t,n,i){const o=typeof e;if(o!==t)throw new Error(`Expecting a '${t}' parameter for:\n            ${i.dbEntity.name}.${i.jsonQuery.queryName}\n            parameter #: ${n}\ngot: ${o}\n            `)}};Yc=qc([function(e){}],Yc);var Qc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Jc=class{serialize(e,t,n,i){const o={lookupTable:[],sequence:0,stubLookupTable:[]};let r;r=e instanceof Array?e.map((e=>this.doSerialize(e,t,o,n,i))):this.doSerialize(e,t,o,n,i);for(let e=1;e<o.lookupTable.length;e++)delete o.lookupTable[e][n.getUniqueIdFieldName()];return r}doSerialize(e,t,n,i,o){let r=i.getOperationUniqueId(e);if(r)return n.stubLookupTable[r];r=++n.sequence;let a={};a[i.getUniqueIdFieldName()]=r,a[i.getStateFieldName()]=Ee.STUB,n.stubLookupTable[r]=a;let s={};n.lookupTable[r]=e,s[i.getUniqueIdFieldName()]=r,s[i.getStateFieldName()]=e[i.getStateFieldName()];for(const r of t.properties){let a,c=e[r.name];if(!o.isEmpty(c)){if(r.relation){const e=r.relation[0];a=c instanceof Array?c.map((t=>{this.doSerialize(t,e.relationEntity,n,i,o)})):this.doSerialize(c,e.relationEntity,n,i,o)}else switch(r.propertyColumns[0].column.type){case Ie.JSON:throw new Error("@Json() properties cannot be serialized.");case Ie.DATE:a={value:c.toISOString()},a[i.getStateFieldName()]=Ee.DATE;break;case Ie.ANY:case Ie.BOOLEAN:case Ie.NUMBER:case Ie.STRING:a=c;break;default:throw new Error(`Unsupported data type for property ${t.applicationVersion.application.name}.${t.name}.${r.name}`)}s[r.name]=a}}return s}};Jc=Qc([function(e){}],Jc),(new Date).getTime();var Wc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let zc=class{async getClientQuery(e,t,n){throw new Error("TODO: implement")}};zc=Wc([function(e){}],zc);var Kc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Xc=class{};Kc([function(e,t){},function(e,t){}],Xc.prototype,"id",void 0),Kc([function(e,t){}],Xc.prototype,"name",void 0),Kc([function(e,t){}],Xc.prototype,"applications",void 0),Xc=Kc([function(e){},function(e){}],Xc);var Zc=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let el=class{constructor(){this.versions=[],this.currentVersion=[]}};Zc([function(e,t){},function(e,t){},function(e,t){}],el.prototype,"index",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"domain",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"scope",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"name",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"fullName",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"status",void 0),Zc([function(e,t){},function(e,t){}],el.prototype,"signature",void 0),Zc([function(e,t){}],el.prototype,"versions",void 0),Zc([function(e,t){}],el.prototype,"currentVersion",void 0),el=Zc([function(e){},function(e){}],el);var tl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nl=class{};tl([function(e,t){},function(e,t){}],nl.prototype,"deprecatedSinceVersion",void 0),tl([function(e,t){},function(e,t){}],nl.prototype,"removedInVersion",void 0),tl([function(e,t){},function(e,t){}],nl.prototype,"sinceVersion",void 0),nl=tl([function(e){}],nl);var il=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ol=class extends nl{constructor(){super(...arguments),this.propertyColumns=[],this.manyRelationColumns=[],this.oneRelationColumns=[]}};il([function(e,t){},function(e,t){}],ol.prototype,"id",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"index",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"idIndex",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"isGenerated",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"allocationSize",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"name",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"notNull",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"precision",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"scale",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"type",void 0),il([function(e,t){},function(e,t){}],ol.prototype,"entity",void 0),il([function(e,t){}],ol.prototype,"propertyColumns",void 0),il([function(e,t){}],ol.prototype,"manyRelationColumns",void 0),il([function(e,t){}],ol.prototype,"oneRelationColumns",void 0),ol=il([function(e){},function(e){}],ol);var rl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let al=class{};rl([function(e,t){},function(e,t){},function(e,t){}],al.prototype,"application",void 0),rl([function(e,t){},function(e,t){},function(e,t){}],al.prototype,"applicationVersion",void 0),al=rl([function(e){},function(e){}],al);var sl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let cl=class extends nl{constructor(){super(...arguments),this.columns=[],this.operations=[],this.properties=[],this.relations=[],this.relationReferences=[],this.columnMap={},this.idColumns=[],this.idColumnMap={},this.propertyMap={}}};sl([function(e,t){},function(e,t){}],cl.prototype,"id",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"index",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"isLocal",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"isRepositoryEntity",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"name",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"tableConfig",void 0),sl([function(e,t){},function(e,t){}],cl.prototype,"applicationVersion",void 0),sl([function(e,t){}],cl.prototype,"columns",void 0),sl([function(e,t){}],cl.prototype,"operations",void 0),sl([function(e,t){}],cl.prototype,"properties",void 0),sl([function(e,t){}],cl.prototype,"relations",void 0),sl([function(e,t){}],cl.prototype,"relationReferences",void 0),sl([function(e,t){}],cl.prototype,"columnMap",void 0),sl([function(e,t){}],cl.prototype,"idColumns",void 0),sl([function(e,t){}],cl.prototype,"idColumnMap",void 0),sl([function(e,t){}],cl.prototype,"propertyMap",void 0),cl=sl([function(e){},function(e){}],cl);var ll=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let pl=class extends nl{};ll([function(e,t){},function(e,t){},function(e,t){}],pl.prototype,"id",void 0),ll([function(e,t){},function(e,t){}],pl.prototype,"type",void 0),ll([function(e,t){},function(e,t){}],pl.prototype,"entity",void 0),ll([function(e,t){},function(e,t){}],pl.prototype,"name",void 0),ll([function(e,t){},function(e,t){}],pl.prototype,"rule",void 0),pl=ll([function(e){},function(e){}],pl);var dl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ul=class extends nl{constructor(){super(...arguments),this.propertyColumns=[],this.relation=[]}};dl([function(e,t){},function(e,t){}],ul.prototype,"id",void 0),dl([function(e,t){},function(e,t){}],ul.prototype,"index",void 0),dl([function(e,t){},function(e,t){}],ul.prototype,"name",void 0),dl([function(e,t){},function(e,t){}],ul.prototype,"isId",void 0),dl([function(e,t){},function(e,t){}],ul.prototype,"entity",void 0),dl([function(e,t){}],ul.prototype,"propertyColumns",void 0),dl([function(e,t){}],ul.prototype,"relation",void 0),ul=dl([function(e){},function(e){}],ul);var fl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yl=class extends nl{};fl([function(e,t){},function(e,t){},function(e,t){}],yl.prototype,"column",void 0),fl([function(e,t){},function(e,t){},function(e,t){}],yl.prototype,"property",void 0),yl=fl([function(e){},function(e){}],yl);var hl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ml=class extends nl{};hl([function(e,t){},function(e,t){},function(e,t){}],ml.prototype,"ownApplicationVersion",void 0),hl([function(e,t){},function(e,t){},function(e,t){}],ml.prototype,"referencedApplicationVersion",void 0),hl([function(e,t){},function(e,t){}],ml.prototype,"index",void 0),ml=hl([function(e){},function(e){}],ml);var Rl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Il=class extends nl{constructor(){super(...arguments),this.manyRelationColumns=[],this.oneRelationColumns=[]}};Rl([function(e,t){},function(e,t){}],Il.prototype,"id",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"index",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"property",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"foreignKey",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"manyToOneElems",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"oneToManyElems",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"relationType",void 0),Rl([function(e,t){}],Il.prototype,"isId",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"entity",void 0),Rl([function(e,t){},function(e,t){}],Il.prototype,"relationEntity",void 0),Rl([function(e,t){}],Il.prototype,"manyRelationColumns",void 0),Rl([function(e,t){}],Il.prototype,"oneRelationColumns",void 0),Il=Rl([function(e){},function(e){}],Il);var El=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gl=class extends nl{};El([function(e,t){}],gl.prototype,"id",void 0),El([function(e,t){},function(e,t){}],gl.prototype,"manyColumn",void 0),El([function(e,t){},function(e,t){}],gl.prototype,"oneColumn",void 0),El([function(e,t){},function(e,t){}],gl.prototype,"manyRelation",void 0),El([function(e,t){},function(e,t){}],gl.prototype,"oneRelation",void 0),El([function(e,t){},function(e,t){}],gl.prototype,"parentRelation",void 0),gl=El([function(e){},function(e){}],gl);var Ol=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Tl=class{constructor(){this.entities=[],this.references=[],this.referencedBy=[],this.entityMapByName={},this.referencesMapByName={},this.referencedByMapByName={}}};Ol([function(e,t){},function(e,t){},function(e,t){}],Tl.prototype,"id",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"integerVersion",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"versionString",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"majorVersion",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"minorVersion",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"patchVersion",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"jsonApplication",void 0),Ol([function(e,t){},function(e,t){}],Tl.prototype,"application",void 0),Ol([function(e,t){}],Tl.prototype,"entities",void 0),Ol([function(e,t){}],Tl.prototype,"references",void 0),Ol([function(e,t){}],Tl.prototype,"referencedBy",void 0),Ol([function(e,t){}],Tl.prototype,"entityMapByName",void 0),Ol([function(e,t){}],Tl.prototype,"referencesMapByName",void 0),Ol([function(e,t){}],Tl.prototype,"referencedByMapByName",void 0),Tl=Ol([function(e){},function(e){}],Tl);const wl={__constructors__:{Application:el,ApplicationColumn:ol,ApplicationCurrentVersion:al,ApplicationEntity:cl,ApplicationOperation:pl,ApplicationProperty:ul,ApplicationPropertyColumn:yl,ApplicationReference:ml,ApplicationRelation:Il,ApplicationRelationColumn:gl,ApplicationVersion:Tl,Domain:Xc,VersionedApplicationObject:nl},domain:"air",name:"@airport/airspace"},bl=wl;function Nl(e){return Jo(bl.__dbApplication__,e)}k.db().eventuallyGet(Ro).then((e=>{e.QM[Q(wl)]=bl}));class _l extends Bo{constructor(e){super(e,bl)}}class xl extends _l{constructor(){super(10)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(10)}}xl.Find=new Ho,xl.FindOne=new Ho,xl.Search=new Ho,xl.SearchOne=new Ho;class Al extends _l{constructor(){super(4)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(4)}}Al.Find=new Ho,Al.FindOne=new Ho,Al.Search=new Ho,Al.SearchOne=new Ho;class vl extends _l{constructor(){super(9)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(9)}}vl.Find=new Ho,vl.FindOne=new Ho,vl.Search=new Ho,vl.SearchOne=new Ho;class Sl extends _l{constructor(){super(6)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(6)}}Sl.Find=new Ho,Sl.FindOne=new Ho,Sl.Search=new Ho,Sl.SearchOne=new Ho;class Cl extends _l{constructor(){super(5)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(5)}}Cl.Find=new Ho,Cl.FindOne=new Ho,Cl.Search=new Ho,Cl.SearchOne=new Ho;class Dl extends _l{constructor(){super(2)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(2)}}Dl.Find=new Ho,Dl.FindOne=new Ho,Dl.Search=new Ho,Dl.SearchOne=new Ho;class Ml extends _l{constructor(){super(3)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(3)}}Ml.Find=new Ho,Ml.FindOne=new Ho,Ml.Search=new Ho,Ml.SearchOne=new Ho;class Vl extends _l{constructor(){super(7)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(7)}}Vl.Find=new Ho,Vl.FindOne=new Ho,Vl.Search=new Ho,Vl.SearchOne=new Ho;class Pl extends _l{constructor(){super(1)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(1)}}Pl.Find=new Ho,Pl.FindOne=new Ho,Pl.Search=new Ho,Pl.SearchOne=new Ho;class Ll extends _l{constructor(){super(0)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(0)}}Ll.Find=new Ho,Ll.FindOne=new Ho,Ll.Search=new Ho,Ll.SearchOne=new Ho;class Ul extends _l{constructor(){super(8)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(8)}}Ul.Find=new Ho,Ul.FindOne=new Ho,Ul.Search=new Ho,Ul.SearchOne=new Ho;class jl extends _l{constructor(){super(11)}static Save(e){return Bo.BaseSave(e)}static diSet(){return Nl(11)}}jl.Find=new Ho,jl.FindOne=new Ho,jl.Search=new Ho,jl.SearchOne=new Ho;class Fl extends qo{constructor(e){super(e,bl)}}class kl extends Fl{static diSet(){return Nl(8)}constructor(){super(8)}}var Bl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hl=class extends jl{async findByIdIn(e){let t;return await this.db.find.tree({select:{},from:[t=bl.Domain],where:t.id.in(e)})}async findMapByNameWithNames(e){let t;const n=await this.db.find.tree({select:{},from:[t=bl.Domain],where:t.name.in(e)}),i=new Map;for(const e of n)i.set(e.name,e);return i}async findOneByName(e){let t;return await this.db.findOne.tree({select:{},from:[t=bl.Domain],where:t.name.equals(e)})}async findByNames(e){let t;return await this.db.find.tree({select:{},from:[t=bl.Domain],where:t.name.in(e)})}async findByName(e){let t;return await this.db.findOne.tree({select:{},from:[t=bl.Domain],where:t.name.equals(e)})}async checkAndInsertIfNeeded(e){const t=await this.findByIdIn(e.map((e=>e.id))),n=new Map;for(const e of t)n.set(e.id,e);const i=[];for(const t of e)n.has(t.id)||i.push(t);if(!i.length)return;let o;const r=[];for(const e of i)r.push([e.id,e.name]);await this.db.insertValuesGenerateIds({insertInto:o=bl.Domain,columns:[o.id,o.name],values:r})}async insert(e){let t;const n=[];for(const t of e)n.push([t.name]);const i=await this.db.insertValuesGenerateIds({insertInto:t=bl.Domain,columns:[t.name],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}};Hl=Bl([function(e){}],Hl);var $l=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gl=class extends Al{async findAllForEntities(e){let t;return this.db.find.tree({select:{},from:[t=bl.ApplicationColumn],where:t.entity.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.index,ke(t.idIndex),t.isGenerated,ke(t.allocationSize),t.name,t.notNull,ke(t.precision),ke(t.scale),t.type,t.entity.id,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationColumn,columns:[t.id,t.index,t.idIndex,t.isGenerated,t.allocationSize,t.name,t.notNull,t.precision,t.scale,t.type,t.entity.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};Gl=$l([function(e){}],Gl);var ql=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yl=class extends xl{async findAllActive(){return this.db.find.tree({select:{},from:[bl.Application]})}async findAllWithJson(){let e;return this.db.find.tree({select:{...io,versions:{id:no,jsonApplication:no}},from:[e=bl.Application,e.versions.innerJoin()]})}async findMapByVersionIds(e){const t=new Map;let n,i;const o=await this.db.find.tree({select:{index:no,domain:{id:no,name:no},name:no,fullName:no,versions:{id:no,majorVersion:no,minorVersion:no,patchVersion:no}},from:[n=bl.Application,i=n.versions.innerJoin()],where:i.id.in(e)});for(const e of o)for(const n of e.versions)t.set(n.id,e);return t}async findMaxIndex(){const e=bl.Application;return await this.airportDatabase.findOne.field({select:Zn(e.index),from:[e]})}async findMaxVersionedMapByApplicationAndDomainNames(e,t){const n=new Map;let i,o,r,a,s;const c=await this.airportDatabase.find.tree({from:[s=pi({from:[a=pi({from:[o=bl.Application,i=o.versions.innerJoin(),r=o.domain.innerJoin()],select:{index:o.index,domainId:r.id,domainName:r.name,name:o.name,majorVersion:Zn(i.majorVersion),minorVersion:i.minorVersion,patchVersion:i.patchVersion},where:un(r.name.in(e),o.name.in(t)),groupBy:[o.index,r.id,r.name,o.name,i.minorVersion,i.patchVersion]})],select:{index:a.index,domainId:a.domainId,domainName:a.domainName,name:a.name,majorVersion:a.majorVersion,minorVersion:Zn(a.minorVersion),patchVersion:a.patchVersion},groupBy:[a.index,a.domainId,a.domainName,a.name,a.majorVersion,a.patchVersion]})],select:{index:s.index,domain:{id:s.domainId,name:s.domainName},name:s.name,majorVersion:s.majorVersion,minorVersion:s.minorVersion,patchVersion:Zn(s.patchVersion)},groupBy:[s.index,s.domainId,s.domainName,s.name,s.majorVersion,s.minorVersion]});for(const e of c)je(n,e.domain.name).set(e.name,e);return n}async setStatusByIndexes(e,t){let n;await this.db.updateWhere({update:n=bl.Application,set:{status:t},where:n.index.in(e)})}async findMapByFullNames(e){const t=new Map;let n;const i=await this.db.find.tree({select:{},from:[n=bl.Application],where:n.fullName.in(e)});for(const e of i)t.set(e.fullName,e);return t}async findByDomainNamesAndApplicationNames(e,t){let n,i;return await this.db.find.tree({select:{index:no,domain:{id:no,name:no},fullName:no,name:no},from:[n=bl.Application,i=n.domain.innerJoin()],where:un(i.name.in(e),n.name.in(t))})}async findByIndex(e){let t;return await this.db.findOne.tree({select:{...io,domain:{}},from:[t=bl.Application,t.domain.innerJoin()],where:t.index.equals(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.index,t.domain.id,t.scope,t.fullName,t.name,t.status,t.signature]);await this.db.insertValuesGenerateIds({insertInto:t=bl.Application,columns:[t.index,t.domain.id,t.scope,t.fullName,t.name,t.status,t.signature],values:n})}};Yl=ql([function(e){}],Yl);var Ql=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Jl=class extends Sl{async findAllForApplicationVersions(e){let t;return await this.db.find.tree({select:{},from:[t=bl.ApplicationEntity],where:t.applicationVersion.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.index,t.isLocal,t.isRepositoryEntity,t.name,t.tableConfig,t.applicationVersion.id,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationEntity,columns:[t.id,t.index,t.isLocal,t.isRepositoryEntity,t.name,t.tableConfig,t.applicationVersion.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};Jl=Ql([function(e){}],Jl);var Wl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let zl=class extends Ml{async findAllForColumns(e){let t;return this.db.find.tree({select:{},from:[t=bl.ApplicationPropertyColumn],where:t.column.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.column.id,t.property.id,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationPropertyColumn,columns:[t.column.id,t.property.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};zl=Wl([function(e){}],zl);var Kl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Xl=class extends Dl{async findAllForEntities(e){let t;return this.db.find.tree({select:{},from:[t=bl.ApplicationProperty],where:t.entity.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.index,t.name,t.isId,t.entity.id,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationProperty,columns:[t.id,t.index,t.name,t.isId,t.entity.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};Xl=Kl([function(e){}],Xl);var Zl=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ep=class extends Vl{async findAllForApplicationVersions(e){let t;return await this.db.find.tree({select:{},from:[t=bl.ApplicationReference],where:t.ownApplicationVersion.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.ownApplicationVersion.id,t.referencedApplicationVersion.id,t.index,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationReference,columns:[t.ownApplicationVersion.id,t.referencedApplicationVersion.id,t.index,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};ep=Zl([function(e){}],ep);var tp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let np=class extends Ll{async findAllForColumns(e){let t;return this.db.find.tree({select:{},from:[t=bl.ApplicationRelationColumn],where:fn(t.oneColumn.id.in(e),t.manyColumn.id.in(e))})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.manyColumn?t.manyColumn.id:null,t.oneColumn?t.oneColumn.id:null,t.manyRelation?t.manyRelation.id:null,t.oneRelation?t.oneRelation.id:null,t.parentRelation?t.parentRelation.id:null,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationRelationColumn,columns:[t.id,t.manyColumn.id,t.oneColumn.id,t.manyRelation.id,t.oneRelation.id,t.parentRelation.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};np=tp([function(e){}],np);var ip=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let op=class extends Pl{async findAllForProperties(e){let t;return this.db.find.tree({select:{},from:[t=bl.ApplicationRelation],where:t.property.id.in(e)})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.index,t.property.id,ke(t.foreignKey),ke(t.manyToOneElems),ke(t.oneToManyElems),t.relationType,t.isId,t.entity.id,t.relationEntity.id,t.deprecatedSinceVersion?t.deprecatedSinceVersion.id:null,t.removedInVersion?t.removedInVersion.id:null,t.sinceVersion?t.sinceVersion.id:null]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationRelation,columns:[t.id,t.index,t.property.id,t.foreignKey,t.manyToOneElems,t.oneToManyElems,t.relationType,t.isId,t.entity.id,t.relationEntity.id,t.deprecatedSinceVersion.id,t.removedInVersion.id,t.sinceVersion.id],values:n})}};op=ip([function(e){}],op);var rp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let ap=class extends Ul{async findAllActiveOrderByApplicationIndexAndId(){let e;return await this.db.find.tree({from:[e=bl.ApplicationVersion],select:{},orderBy:[e.application.index.asc(),e.id.desc()]})}async findByDomainNamesAndApplicationNames(e,t){let n,i,o;return await this.db.find.tree({select:{id:no,integerVersion:no,application:{domain:{name:no},fullName:no,name:no}},from:[n=bl.ApplicationVersion,i=n.application.innerJoin(),o=i.domain.innerJoin()],where:un(o.name.in(e),i.name.in(t))})}async insert(e){let t;const n=[];for(const t of e)n.push([t.id,t.integerVersion,t.versionString,t.majorVersion,t.minorVersion,t.patchVersion,t.application.index,t.jsonApplication]);await this.db.insertValuesGenerateIds({insertInto:t=bl.ApplicationVersion,columns:[t.id,t.integerVersion,t.versionString,t.majorVersion,t.minorVersion,t.patchVersion,t.application.index,t.jsonApplication],values:n})}};ap=rp([function(e){}],ap);var sp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let cp=class extends kl{};cp=sp([function(e){}],cp);const lp=V("traffic-pattern"),pp=lp.token({class:Hl,interface:"IDomainDao",token:"DOMAIN_DAO"}),dp=lp.token({class:Gl,interface:"IApplicationColumnDao",token:"APPLICATION_COLUMN_DAO"}),up=lp.token({class:Yl,interface:"IApplicationDao",token:"APPLICATION_DAO"}),fp=lp.token({class:Jl,interface:"IApplicationEntityDao",token:"APPLICATION_ENTITY_DAO"}),yp=lp.token({class:zl,interface:"IApplicationPropertyColumnDao",token:"APPLICATION_PROPERTY_COLUMN_DAO"}),hp=lp.token({class:Xl,interface:"IApplicationPropertyDao",token:"APPLICATION_PROPERTY_DAO"}),mp=lp.token({class:ep,interface:"IApplicationReferenceDao",token:"APPLICATION_REFERENCE_DAO"}),Rp=lp.token({class:np,interface:"IApplicationRelationColumnDao",token:"APPLICATION_RELATION_COLUMN_DAO"}),Ip=lp.token({class:op,interface:"IApplicationRelationDao",token:"APPLICATION_RELATION_DAO"}),Ep=lp.token({class:ap,interface:"IApplicationVersionDao",token:"APPLICATION_VERSION_DAO"});lp.token({class:cp,interface:"IApplicationVersionDuo",token:"APPLICATION_VERSION_DUO"});class gp extends class{constructor(e,t,n,i,o){this.rootSelectClauseFragment=e,this.airportDatabase=t,this.qValidator=n,this.relationManager=i,this.orderBy=o}getCommonOrderByFragment(e){return e.map((e=>{switch(e.so){case he.ASCENDING:return`${e.fa} ASC`;case he.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}{getOrderByFragment(e,t,n){let i=[],o=[];this.orderBy&&(o=this.orderBy.slice());const r=[];let a=this.rootSelectClauseFragment;r.push(a);const s=[];let c=e;for(s.push(c);(a=r.shift())&&(c=s.shift());){const e=this.relationManager.getAlias(c.jsonRelation),n=t[e].__driver__.dbEntity,l=[];o=o.filter((t=>{const i=this.airportDatabase.applications[t.si].currentVersion[0].applicationVersion.entities[t.ti],o=i.columns[t.ci];if(this.isForParentNode(c,t))throw new Error(`Found out of order entry in Order By \n\t\t\t\t\t[${i.applicationVersion.application.name} - ${i.name}.${o.name}].\n\t\t\t\t\tEntries must be ordered hierarchically, in breadth-first order.`);return t.si!==n.applicationVersion.application.index||t.ti!==n.index||(this.qValidator.validateReadProperty(o),t.fa=`${e}.${o.name}`,l.push(t),!1)}));const p=[],d=[];for(const e in a){const t=n.propertyMap[e];if(t.relation&&t.relation.length){for(const e of t.propertyColumns){const n=e.column;p.push(n.name),t.isId&&d.push(n.name)}if(!c.childNodes.length)continue;const n=t.relation[0],i=n.relationEntity;if(!c.childNodes.filter((e=>{const t=e.jsonRelation;return t.si===i.applicationVersion.application.index&&t.ti===i.index})).length)return;r.push(this.rootSelectClauseFragment[e]);const o=c.getEntityRelationChildNode(n);s.push(o)}else{const e=t.propertyColumns[0].column;p.push(e.name),t.isId&&d.push(e.name)}}let u=this.buildOrderByFragmentForEntity(e,p,d,l,t);i=i.concat(u)}if(o.length)throw new Error("\n\t\t\tFound entries in Order By for tables not found in select clause.  \n\t\t\tEntries must be ordered hierarchically, in breadth-first order.");return i.join(", ")}buildOrderByFragmentForEntity(e,t,n,i,o){const r=[],a={},s=o[e].__driver__.dbEntity;if(i.forEach((e=>{r.push(e);const t=s.columns[e.ci].name;a[t]=!0})),n.length)for(const t of n)a[t]||r.push({fa:`${e}.${t}`,so:he.ASCENDING});else t.forEach((t=>{a[t]||r.push({fa:`${e}.${t}`,so:he.ASCENDING})}));return this.getCommonOrderByFragment(r)}isForParentNode(e,t){do{if(!(e=e.parentNode))return!1;if(t.si===e.jsonRelation.si&&t.ti===e.jsonRelation.ti)return!0}while(e.parentNode);return!1}}class Op{constructor(e){this.validator=e}getOrderByFragment(e,t){return t.map((e=>{switch(this.validator.validateAliasedFieldAccess(e.fa),e.so){case he.ASCENDING:return`${e.fa} ASC`;case he.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}class Tp{constructor(e){this.validator=e}getOrderByFragment(e,t){let n=[],i=[];t&&(i=t.slice());let o=[],r=e;for(o.push(r);r=o.shift();){let e={};for(let t in r){let n=r[t];n.appliedFunctions?e[n.fa]=!0:o.push(n)}let t=[];i=i.filter((n=>!e[n.fa]||(delete e[n.fa],t.push(n),!1)));for(let n in e)t.push({fa:n,so:he.ASCENDING});let a=this.buildOrderByFragmentForEntity(t);n=n.concat(a)}if(i.length)throw new Error("Found entries in Order By for tables not found in select clause.  Entries must be ordered hierarchically, in breadth-first order.");return n.join(", ")}buildOrderByFragmentForEntity(e){return e.map((e=>{switch(this.validator.validateAliasedFieldAccess(e.fa),e.so){case he.ASCENDING:return`${e.fa} ASC`;case he.DESCENDING:return`${e.fa} DESC`}}))}}class wp{constructor(){this.mtoStubReferenceMap=[]}addMtoReference(e,t){const n=e.mtoDbEntity;let i=Ue(Le(this.mtoStubReferenceMap,n.applicationVersion.application.index),n.index);Ue(i,t)[e.mtoRelationField]=e}populateMtos(e){for(const t in this.mtoStubReferenceMap){const n=this.mtoStubReferenceMap[t];for(const t in n){const i=n[t];for(let t in i){let n=i[t];for(let t in n){let i=n[t],o=i.otmDbEntity;if(!e[o.applicationVersion.application.index])continue;let r=e[o.applicationVersion.application.index][o.index];if(!r)continue;let a=r[i.otmEntityId];a&&(i.mtoParentObject[i.mtoRelationField]=a)}}}}}}class bp{constructor(){this.mtoEntityReferenceMap=[],this.otmEntityReferenceMap=[]}addMtoReference(e,t,n,i){if(!e.otmEntityField)return;const o=e.otmDbEntity;let r=Ue(Le(this.mtoEntityReferenceMap,o.applicationVersion.application.index),o.index),a=r[e.otmEntityId];a||(a={},r[e.otmEntityId]=a);let s=a[e.otmEntityField];s||(s=[],a[e.otmEntityField]=s),s.push(e.mtoParentObject)}addOtmReference(e,t){const n=e.otmDbEntity;let i=Ue(Le(this.otmEntityReferenceMap,n.applicationVersion.application.index),n.index),o=i[t];o||(o={},i[t]=o),o[e.otmPropertyName]=e.otmObject}populateOtms(e,t){for(const n in this.mtoEntityReferenceMap){const i=this.mtoEntityReferenceMap[n];for(const o in i){const r=i[o];if(!e[n])continue;if(!e[n][o])continue;if(!this.otmEntityReferenceMap[n])continue;let a=this.otmEntityReferenceMap[n][o];if(a)for(let e in r){let n=r[e],i=a[e];if(i)for(let e in n){let o=i[e];if(!o)continue;let r=n[e],a=o[e];a?a.putAll(r):o[e]=r,t||(i[e]=o[e].slice())}}}}}}class Np{constructor(e,t){this.applicationUtils=e,this.entityStateManager=t}addManyToOneStub(e,t,n,i){let o={};this.entityStateManager.isStub(o),e[t]=o;let r=!0;return n.forEach((e=>{if(this.applicationUtils.isIdEmpty(e.value))return void(r=!1);let t,n=o,i=1;const a=e.propertyNameChains[0];for(;i<a.length;)n||(n={},this.entityStateManager.markAsStub(n),t[a[i-1]]=n),i<a.length-1?(t=n,n=t[a[i]]):n[a[i]]=e.value,i++})),r}}class _p extends Np{constructor(e,t,n,i){super(n,i),this.config=e,this.rootDbEntity=t,this.entityMapByApplicationAndTableIndexes=[],this.otmStubBuffer=[],this.mtoStubBuffer=[],this.currentResultRow=[],this.otmMapper=new bp,this.mtoMapper=new wp}addEntity(e,t,n){return this.applicationUtils.getNewEntity(t)}addProperty(e,t,n,i,o){return t[i]=o,qi(o)}bufferManyToOneStub(e,t,n,i,o,r,a){if(this.addManyToOneStub(n,i,r,a)){const e=this.applicationUtils.getIdKey(n[i],o);this.bufferManyToOne(t,i,o,e)}}bufferBlankManyToOneStub(e,t,n){t[n]=null}bufferManyToOneObject(e,t,n,i,o,r,a){n[i]=r;const s=this.applicationUtils.getIdKey(n[i],o);this.bufferManyToOne(t,i,o,s)}bufferBlankManyToOneObject(e,t,n){t[n]=null}bufferOneToManyStub(e,t){this.bufferOneToMany(e,t)}bufferOneToManyCollection(e,t,n,i,o,r,a){this.bufferOneToMany(n,i),t[i]=[r]}bufferBlankOneToMany(e,t,n,i,o,r){t[i]=[]}flushEntity(e,t,n,i,o,r){if(!i)throw new Error(`No Id provided for entity \n\t\t\t'${t.applicationVersion.application.name}.${t.name}'`);let a=this.getEntityToFlush(t,n,i,o,r);return this.flushRelationStubBuffers(i,a,t,r),a}flushRow(){}bridge(e,t,n){return this.mtoMapper.populateMtos(this.entityMapByApplicationAndTableIndexes),this.otmMapper.populateOtms(this.entityMapByApplicationAndTableIndexes,!this.config||this.config.mapped),e}bufferManyToOne(e,t,n,i){let o;for(const i of n.relations){switch(i.relationType){case fe.ONE_TO_MANY:break;case fe.MANY_TO_ONE:continue;default:throw new Error(`Unknown EntityRelationType: ${i.relationType}`)}i.oneToManyElems&&i.oneToManyElems.mappedBy&&(e.id!==i.relationEntity.id&&i.oneToManyElems.mappedBy!==t||(o=i.property.name))}this.mtoStubBuffer.push({otmEntityId:i,otmDbEntity:n,otmEntityField:o,mtoDbEntity:e,mtoRelationField:t,mtoParentObject:null})}bufferOneToMany(e,t){this.otmStubBuffer.push({otmDbEntity:e,otmPropertyName:t,otmObject:null})}getEntityToFlush(e,t,n,i,o){if(!n)throw new Error(`Entity ID not specified for entity \n\t\t\t'${e.applicationVersion.application.name}.${e.name}'.`);let r=Ue(Le(this.entityMapByApplicationAndTableIndexes,e.applicationVersion.application.index),e.index),a=r[n],s=this.mergeEntities(a,i,e,t,o);return r[n]=s,s}mergeEntities(e,t,n,i,o){if(!e||t===e)return t;const r=this.applicationUtils.getIdKey(t,n);for(let o in i){if(void 0===i[o])continue;const a=n.propertyMap[o];if(a.relation&&a.relation.length){if(null==i[o])e[o]=t[o];else{const i=a.relation[0],s=i.relationEntity;switch(i.relationType){case fe.MANY_TO_ONE:void 0===e[o]&&void 0!==t[o]&&(e[o]=t[o]);break;case fe.ONE_TO_MANY:let c=e[o];const l=t[o];if(this.config&&this.config.strict&&(!c&&l||!l&&c||c.length!=l.length))throw new Error(`One-to-Many child arrays don't match for \n\t\t\t\t\t\t\t\t\t'${n.name}.${a.name}', Id: ${r}`);const p={};c?c.forEach((e=>{const t=this.applicationUtils.getIdKey(e,s);p[t]=e})):(c=[],e[o]=c),l&&l.forEach((e=>{const t=this.applicationUtils.getIdKey(e,s);if(this.config&&this.config.strict&&!p[t])throw new Error(`One-to-Many child arrays don't match for \n\t\t\t\t\t\t\t\t\t\t'${n.name}.${a.name}', Id: ${r}`);p[t]||c.put(e)}));break;default:throw new Error(`Unknown relation type '${i.relationType}' for \n\t\t\t\t\t\t\t'${n.name}.${a.name}'`)}}}else this.applicationUtils.isEmpty(e[o])&&(e[o]=t[o])}return e}flushRelationStubBuffers(e,t,n,i){let o=this.otmStubBuffer;this.otmStubBuffer=[],o.forEach((n=>{n.otmObject=t,this.otmMapper.addOtmReference(n,e)}));let r=this.mtoStubBuffer;this.mtoStubBuffer=[],r.forEach((o=>{o.mtoParentObject=t,this.otmMapper.addMtoReference(o,e,n,i),this.mtoMapper.addMtoReference(o,e)}))}}class xp extends Np{constructor(){super(...arguments),this.currentRowObjectMap={},this.objectEqualityMap={},this.lastRowObjectMap={},this.currentObjectOneToManys={}}addProperty(e,t,n,i,o){if(t[i]=o,this.isDifferentOrDoesntExist(e,t,i))return qi(o);let r=this.lastRowObjectMap[e];switch(n){case Ie.DATE:this.objectEqualityMap[e]=r[i].getTime()===t[i].getTime();break;default:this.objectEqualityMap[e]=r[i]===t[i]}return!0}flushRow(){this.lastRowObjectMap=this.currentRowObjectMap,this.currentRowObjectMap={}}isDifferentOrDoesntExist(e,t,n){if(!this.objectEqualityMap[e])return!0;let i=this.lastRowObjectMap[e];return i?!t||(i[n]?!t[n]&&(this.objectEqualityMap[e]=!i[n],!0):(this.objectEqualityMap[e]=!t[n],!0)):(this.objectEqualityMap[e]=!1,!0)}addOneToManyCollection(e,t,n){let i=t[n];if(this.currentObjectOneToManys[n]=i,this.isDifferentOrDoesntExist(e,t,n))return;let o=this.lastRowObjectMap[e][n];o.length?i.length||o.length&&(this.objectEqualityMap[e]=!1):i.length&&(this.objectEqualityMap[e]=!1)}mergeEntity(e,t){let n=this.objectEqualityMap[e];this.objectEqualityMap[e]=!0;let i=this.currentObjectOneToManys;if(this.currentObjectOneToManys={},!n)return t;t=this.lastRowObjectMap[e],this.currentRowObjectMap[e]=t;for(let e in i){let n=i[e];if(n&&n.length){let i=n[0],o=t[e];o&&o.length?o[o.length-1]!==i&&o.push(i):t[e]=n}}return t}}class Ap extends xp{constructor(){super(...arguments),this.currentRowObjectMap={},this.objectEqualityMap={},this.lastRowObjectMap={},this.currentObjectOneToManys={}}addEntity(e,t,n){let i=this.applicationUtils.getNewEntity(t);return this.currentRowObjectMap[e]=i,void 0!==this.objectEqualityMap[e]&&(this.objectEqualityMap[e]=!0),i}bufferManyToOneStub(e,t,n,i,o,r,a){this.addManyToOneStub(n,i,r,a),this.addManyToOneReference(e,n,i)}bufferBlankManyToOneStub(e,t,n){t[n]=null,this.addManyToOneReference(e,t,n)}bufferManyToOneObject(e,t,n,i,o,r,a){if(n[i]=r,this.isDifferentOrDoesntExist(e,n,i))return;let s=this.lastRowObjectMap[e];this.objectEqualityMap[e]=s[i]===n[i]}bufferBlankManyToOneObject(e,t,n){t[n]=null,this.addManyToOneReference(e,null,n)}bufferOneToManyStub(e,t){throw new Error("@OneToMany stubs not allowed in QueryResultType.HIERARCHICAL")}bufferOneToManyCollection(e,t,n,i,o,r,a){t[i]=[r],this.addOneToManyCollection(e,t,i)}bufferBlankOneToMany(e,t,n,i,o,r){t[i]=[],this.addOneToManyCollection(e,t,i)}flushEntity(e,t,n,i,o,r){return this.mergeEntity(e,o)}bridge(e,t,n){return e}addManyToOneReference(e,t,n){if(this.isDifferentOrDoesntExist(e,t,n))return;let i=this.lastRowObjectMap[e][n],o=t[n];this.objectEqualityMap[e]=Yi(i,o,!0)}}var vp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Sp=class{getObjectResultParser(e,t,n){switch(e){case Ce.ENTITY_GRAPH:case Ce.MAPPED_ENTITY_GRAPH:return new _p(t,n,this.applicationUtils,this.entityStateManager);case Ce.ENTITY_TREE:case Ce.MAPPED_ENTITY_TREE:return new Ap(this.applicationUtils,this.entityStateManager);default:throw new Error(`ObjectQueryParser not supported for QueryResultType: ${e}`)}}};vp([function(e,t){}],Sp.prototype,"applicationUtils",void 0),vp([function(e,t){}],Sp.prototype,"entityStateManager",void 0),Sp=vp([function(e){}],Sp);class Cp extends xp{addEntity(e){let t={};return this.currentRowObjectMap[e]=t,t}bufferOneToManyCollection(e,t,n,i){t[n]=[i],this.addOneToManyCollection(e,t,n)}flushEntity(e,t){return this.mergeEntity(e,t)}}var Dp,Mp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e.MAPPED_SELECT_CLAUSE="MAPPED_SELECT_CLAUSE",e.NON_MAPPED_SELECT_CLAUSE="NON_MAPPED_SELECT_CLAUSE",e.WHERE_CLAUSE="WHERE_CLAUSE",e.FUNCTION_CALL="FUNCTION_CALL"}(Dp||(Dp={}));let Vp=class{constructor(e,t,n,i,o,r,a,s,c){this.dbEntity=e,this.dialect=t,this.airportDatabase=n,this.applicationUtils=i,this.entityStateManager=o,this.qMetadataUtils=r,this.sqlQueryAdapter=a,this.storeDriver=s,this.context=c,this.parameterReferences=[],this.fieldMap=new W,this.qEntityMapByAlias={},this.jsonRelationMapByAlias={}}getParameters(e,t){return this.parameterReferences.map((t=>{let n=e[t];if(!n){if(null===t||["number","string"].indexOf(typeof t)>-1)return t;throw new Error(`No parameter found for alias '${t}'`)}return this.sqlQueryAdapter.getParameterValue(n)}))}getFunctionCallValue(e,t){return this.getFieldValue(e,Dp.FUNCTION_CALL,null,t)}getFieldFunctionValue(e,t,n){let i=e.v;if(this.isParameterReference(i)){let e=i;this.parameterReferences.push(e),i=this.sqlQueryAdapter.getParameterReference(this.parameterReferences,e)}else i=this.getFieldValue(i,Dp.FUNCTION_CALL,t,n);return i=this.sqlQueryAdapter.getFunctionAdaptor().getFunctionCalls(e,i,this.qEntityMapByAlias,this,n),this.validator.addFunctionAlias(e.fa),i}getFieldValue(e,t,n,i){let o;if(!e)throw new Error("Missing Clause Field definition");if(e instanceof Array)return e.map((e=>this.getFieldValue(e,t,n,i))).join(", ");if(t!==Dp.MAPPED_SELECT_CLAUSE&&!e.ot)throw new Error("Object Type is not defined in JSONClauseField");const r=e;let a;switch(e.ot){case Re.FIELD_FUNCTION:return this.getFieldFunctionValue(r,n,i);case Re.DISTINCT_FUNCTION:throw new Error("Distinct function cannot be nested.");case Re.EXISTS_FUNCTION:{if(t!==Dp.WHERE_CLAUSE)throw new Error("Exists can only be used as a top function in a WHERE clause.");const{parameterReferences:e,subQuerySql:n}=this.subStatementSqlGenerator.getTreeQuerySql(r.v,this.dialect,i);return e.length&&(this.parameterReferences=this.parameterReferences.concat(e)),`EXISTS(${n})`}case Re.FIELD:return a=this.qEntityMapByAlias[r.ta],this.validator.validateReadQEntityProperty(r.si,r.ti,r.ci),o=this.getEntityPropertyColumnName(a,r.ci,i),this.addField(r.si,r.ti,r.ci),this.getComplexColumnFragment(r,o,i);case Re.FIELD_QUERY:{let e=r.fieldSubQuery;r.S&&(e=r);const{parameterReferences:t,subQuerySql:n}=this.subStatementSqlGenerator.getFieldQuerySql(e,this.dialect,this.qEntityMapByAlias,i);return t.length&&(this.parameterReferences=this.parameterReferences.concat(t)),this.validator.addSubQueryAlias(r.fa),`(${n})`}case Re.MANY_TO_ONE_RELATION:return a=this.qEntityMapByAlias[r.ta],this.validator.validateReadQEntityManyToOneRelation(r.si,r.ti,r.ci),o=this.getEntityManyToOneColumnName(a,r.ci,i),this.addField(r.si,r.ti,r.ci),this.getComplexColumnFragment(r,o,i);default:return Dp.MAPPED_SELECT_CLAUSE,n()}}applyOperator(e,t){switch(e){case Oe.EQUALS:return` = ${t}`;case Oe.GREATER_THAN:return` > ${t}`;case Oe.GREATER_THAN_OR_EQUALS:return` >= ${t}`;case Oe.IS_NOT_NULL:return" IS NOT NULL";case Oe.IS_NULL:return" IS NULL";case Oe.IN:return` IN (${t})`;case Oe.LESS_THAN:return` < ${t}`;case Oe.LESS_THAN_OR_EQUALS:return` <= ${t}`;case Oe.NOT_EQUALS:return` != ${t}`;case Oe.NOT_IN:return` NOT IN (${t})`;case Oe.LIKE:return` LIKE ${t}`;default:throw new Error(`Unsupported operator ${e}`)}}getWHEREFragment(e,t,n){let i="";if(!e)throw new Error("An operation is missing in WHERE or HAVING clause");switch(t=`${t}\t`,e.c){case ge.LOGICAL:return this.getLogicalWhereFragment(e,t,n);case ge.BOOLEAN:case ge.DATE:case ge.NUMBER:case ge.STRING:case ge.UNTYPED:let o=e,r=this.getFieldValue(o.l,Dp.WHERE_CLAUSE,null,n),a=this.getFieldValue(o.r,Dp.WHERE_CLAUSE,null,n);i+=`${r}${this.applyOperator(o.o,a)}`;break;case ge.FUNCTION:let s=e;i=this.getFieldValue(s.ob,Dp.WHERE_CLAUSE,null,n)}return i}getEntityPropertyColumnName(e,t,n){return this.qMetadataUtils.getDbEntity(e).columns[t].name}addFieldFromColumn(e){const t=e.propertyColumns[0].property.entity;this.addField(t.applicationVersion.id,t.index,e.index)}addField(e,t,n){this.fieldMap.ensure(e,t).ensure(n)}warn(e){console.log(e)}getSimpleColumnFragment(e,t){return`${e}.${t}`}getComplexColumnFragment(e,t,n){let i=`${e.ta}.${t}`;return i=this.sqlQueryAdapter.getFunctionAdaptor().getFunctionCalls(e,i,this.qEntityMapByAlias,this,n),i}getEntityManyToOneColumnName(e,t,n){return this.getEntityPropertyColumnName(e,t,n)}getLogicalWhereFragment(e,t,n){let i;switch(e.o){case Oe.AND:i="AND";break;case Oe.OR:i="OR";break;case Oe.NOT:return` NOT (${this.getWHEREFragment(e.v,t,n)})`;default:throw new Error(`Unknown logical operator: ${e.o}`)}let o=e.v;if(!(o instanceof Array))throw new Error(`Expecting an array of child operations as a value for operator ${i}, \n\t\t\t\tin the WHERE Clause.`);return`( ${o.map((e=>this.getWHEREFragment(e,t,n))).join(`\n${t}${i} `)} )`}isParameterReference(e){if(null===e)return!1;if(void 0===e||""===e||NaN===e)throw new Error(`Invalid query value: ${e}`);switch(typeof e){case"boolean":case"number":throw new Error("Unexpected primitive instance, expecting parameter alias.");case"string":return!0}if(e instanceof Date)throw new Error("Unexpected date instance, expecting parameter alias.");return!1}};Mp([function(e,t){}],Vp.prototype,"validator",void 0),Mp([function(e,t){}],Vp.prototype,"subStatementSqlGenerator",void 0),Vp=Mp([function(e){}],Vp);class Pp extends Vp{constructor(e,t,n,i,o,r,a,s,c,l){super(e,t,n,i,o,r,s,c,l),this.relationManager=a}getTableFragment(e,t,n=!0){if(!e)throw new Error("Expecting exactly one table in UPDATE/DELETE clause");if(e.ri||e.jt)throw new Error("Table in UPDATE/DELETE clause cannot be joined");const i=this.airportDatabase.applications[e.si].currentVersion[0].applicationVersion.entities[e.ti];let o=this.storeDriver.getEntityTableName(i,t);if(e.si!==this.dbEntity.applicationVersion.application.index||e.ti!==this.dbEntity.index)throw new Error(`Unexpected table in UPDATE/DELETE clause: \n\t\t\t'${o}',\n\t\t\texpecting: '${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}'`);const r=new yi(i,this.applicationUtils,this.relationManager),a=this.relationManager.getAlias(e);this.qEntityMapByAlias[a]=r;let s=`\t${o}`;return n&&(s+=` AS ${a}`),s}}class Lp extends Pp{constructor(e,t,n,i,o,r,a,s,c,l){super(n.applications[e.DF.si].currentVersion[0].applicationVersion.entities[e.DF.ti],t,n,i,o,r,a,s,c,l),this.jsonDelete=e}toSQL(e){let t=this.getTableFragment(this.jsonDelete.DF,e),n="",i=this.jsonDelete;return i.W&&(n=this.getWHEREFragment(i.W,"",e),n=`\nWHERE\n${n}`),`DELETE\nFROM\n${t}${n}`}}class Up extends Pp{constructor(e,t,n,i,o,r,a,s,c,l,p){super(n.applications[e.II.si].currentVersion[0].applicationVersion.entities[e.II.ti],t,n,i,o,r,s,c,l,p),this.jsonInsertValues=e,this.qValidator=a}toSQL(e){if(!this.jsonInsertValues.II)throw new Error("Expecting exactly one table in INSERT INTO clause");return this.qValidator.validateInsertQEntity(this.dbEntity),`INSERT INTO\n${this.getTableFragment(this.jsonInsertValues.II,e,!1)} ${this.getColumnsFragment(this.dbEntity,this.jsonInsertValues.C)}\nVALUES\n${this.getValuesFragment(this.jsonInsertValues.V,e)}\n`}getColumnsFragment(e,t){if(!t.length)return"";return`( ${t.map((t=>e.columns[t].name)).join(", \n")} )`}getValuesFragment(e,t){return e.map((e=>`(${e.map((e=>{if(null===e||["number","string"].indexOf(typeof e)>-1)return this.parameterReferences.push(e),this.sqlQueryAdapter.getParameterReference(this.parameterReferences,e);if(void 0===e)throw new Error(`An 'undefined' value was provided when inserting into: ${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}`);return`\n${this.getFieldValue(e,Dp.WHERE_CLAUSE,null,t)}\n`})).join(",")})`)).join(",\n")}}var jp;!function(e){e.MYSQL="MYSQL",e.POSTGRESQL="POSTGRESQL",e.SQLITE="SQLITE"}(jp||(jp={}));class Fp{constructor(){this.map={}}getForAlias(e){let t=this.map[e];return t||(t={},this.map[e]=t),t}}class kp extends Vp{constructor(e,t,n,i,o,r,a,s,c,l,p){super(t,n,o,r,a,s,c,l,p),this.jsonQuery=e,this.queryResultType=i,this.entityDefaults=new Fp}getFieldMap(){return this.fieldMap}getEntityApplicationRelationFromJoin(e,t,n,i,o,r,a,s,c){const l=[],p=e.__driver__.dbEntity,d=t.__driver__.dbEntity,u=p.relations[n.ri];let f;switch(u.relationType){case fe.MANY_TO_ONE:f=u.manyRelationColumns;break;case fe.ONE_TO_MANY:if(u.oneRelationColumns&&u.oneRelationColumns.length)f=u.oneRelationColumns;else{const e=u.relationEntity.relations.filter((e=>e.relationEntity.id==p.id&&e.manyToOneElems&&!0!==e.manyToOneElems&&e.manyToOneElems.mappedBy===u.property.name));e.length&&(f=e[0].manyRelationColumns)}break;default:throw new Error(`Unknown relation type ${u.relationType} \non '${p.applicationVersion.application.name}.${p.name}.${u.property.name}'.`)}for(const e of f){let t,n;switch(u.relationType){case fe.MANY_TO_ONE:t=e.manyColumn.name,n=e.oneColumn.name;break;case fe.ONE_TO_MANY:t=e.oneColumn.name,n=e.manyColumn.name;break;default:throw new Error(`Unknown relation type ${u.relationType} \non '${p.applicationVersion.application.name}.${p.name}.${u.property.name}'.`)}l.push({leftColumn:t,rightColumn:n})}let y=l.map((e=>` ${r}.${e.leftColumn} = ${o}.${e.rightColumn}`)).join("\n\t\t\tAND");if(n.joinWhereClause){const e=this.getWHEREFragment(n.joinWhereClause,"\t\t",c);y=`${y}\n\t\t\t${n.joinWhereClauseOperator===Oe.AND?"AND":"OR"} ${e}`}return`\n\t${a} ${this.storeDriver.getEntityTableName(d,c)} ${o}\n\t\tON ${y}`}}class Bp extends Pp{constructor(e,t,n,i,o,r,a,s,c,l,p){super(n.applications[e.U.si].currentVersion[0].applicationVersion.entities[e.U.ti],t,n,i,o,r,s,c,l,p),this.jsonUpdate=e,this.qValidator=a}toSQL(e,t){if(!this.jsonUpdate.U)throw new Error("Expecting exactly one table in UPDATE clause");let n=this.getTableFragment(this.jsonUpdate.U,t),i=this.getSetFragment(this.jsonUpdate.S,t);e.SET&&e.SET.length&&(i+=","+e.SET.map((e=>`\n\t${e.column.name} = ${e.value}`)).join(","));let o="",r=this.jsonUpdate;return r.W&&(o=this.getWHEREFragment(r.W,"",t),o=`WHERE\n${o}`),`UPDATE\n${n}\nSET\n${i}\n${o}`}getSetFragment(e,t){let n=[];for(let i in e){let o=e[i];void 0!==o&&(this.qValidator.validateUpdateColumn(this.dbEntity.columnMap[i]),this.addSetFragment(i,o,n,t))}return n.join(", \n")}addSetFragment(e,t,n,i){let o;"number"==typeof t?(this.parameterReferences.push(t),o=this.sqlQueryAdapter.getParameterReference(this.parameterReferences,t)):o=this.getFieldValue(t,Dp.WHERE_CLAUSE,null,i),n.push(`\t${e} = ${o}`)}isManyToOneRelation(e){return"object"==typeof e&&e.ot===Re.MANY_TO_ONE_RELATION}addManyToOneMappings(e){let t=[];const n=e.value;if("object"!=typeof n||n.ot&&n.ot!==Re.MANY_TO_ONE_RELATION)t.push(e);else for(const i in n){if("ot"===i&&n[i]===Re.MANY_TO_ONE_RELATION)continue;const o={tableIndex:e.tableIndex,propertyChain:e.propertyChain.concat([i]),value:n[i]},r=this.addManyToOneMappings(o);t=t.concat(r)}return t}}class Hp{constructor(e){this.jsonClauseField=e}getValue(e,t){return e.getFieldFunctionValue(this.jsonClauseField,null,t)}}class $p extends kp{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u){super(e,null,t,n,i,o,r,a,l,p,u),this.qValidator=s,this.relationManager=c,this.subStatementQueryGenerator=d}addQEntityMapByAlias(e){for(let t in e)this.qEntityMapByAlias[t]=e[t]}toSQL(e,t){let n=this.jsonQuery;this.joinTrees=this.buildFromJoinTree(n.F,{},t);let i=this.getSELECTFragment(!1,n.S,e,t),o=this.getFROMFragments(this.joinTrees,t),r="";n.W&&(r=`\nWHERE\n\t${this.getWHEREFragment(n.W,"",t)}`);let a="";n.GB&&n.GB.length&&(a=`\nGROUP BY\n\t${this.getGroupByFragment(n.GB)}`);let s="";n.H&&(s=`\nHAVING\n\t${this.getWHEREFragment(n.H,"",t)}`);let c="";n.OB&&n.OB.length&&(c=`\nORDER BY\n\t${this.orderByParser.getOrderByFragment(n.S,n.OB)}`);let l="";n.O&&(l=this.sqlQueryAdapter.getOffsetFragment(n.O));return n.L&&(l=this.sqlQueryAdapter.getLimitFragment(n.L)),`SELECT\n\t${i}\nFROM\n${o}${r}${a}${s}${c}${l}`}buildFromJoinTree(e,t,n){let i,o=[];if(e.length<1)throw new Error("FROM clause must have entries for non-Entity queries");let r=e[0];switch(r.rt){case ye.SUB_QUERY_ROOT:case ye.ENTITY_ROOT:break;default:throw new Error("First table in FROM clause cannot be joined")}let a=this.relationManager.getAlias(r);this.qValidator.validateReadFromEntity(r);let s=this.relationManager.createRelatedQEntity(r,n);this.qEntityMapByAlias[a]=s,i=new Ii(r,[],null),o.push(i),t[a]=i;for(let i=1;i<e.length;i++){let r,s=e[i];if(!s.jt)throw new Error(`Table ${i+1} in FROM clause is missing joinType`);switch(this.qValidator.validateReadFromEntity(s),a=this.relationManager.getAlias(s),s.rt){case ye.SUB_QUERY_ROOT:let e=this.addFieldsToView(s,a,n);this.qEntityMapByAlias[a]=e;continue;case ye.ENTITY_ROOT:let c=this.relationManager.createRelatedQEntity(s,n);this.qEntityMapByAlias[a]=c;let l=new Ii(s,[],null);if(t[a])throw new Error(`Alias '${a}' used more than once in the FROM clause.`);o.push(l),t[a]=l;continue;case ye.ENTITY_APPLICATION_RELATION:if(!s.ri)throw new Error(`Table ${i+1} in FROM clause is missing relationPropertyName`);r=this.relationManager.createRelatedQEntity(s,n);break;case ye.SUB_QUERY_JOIN_ON:s.joinWhereClause||this.warn(`View ${i+1} in FROM clause is missing joinWhereClause`),r=this.addFieldsToView(s,a,n);break;case ye.ENTITY_JOIN_ON:s.joinWhereClause||this.warn(`Table ${i+1} in FROM clause is missing joinWhereClause`),r=this.relationManager.createRelatedQEntity(s,n);break;default:throw new Error(`Unknown JSONRelationType ${s.rt}`)}let c=this.relationManager.getParentAlias(s);if(!t[c])throw new Error(`Missing parent entity for alias ${c}, on table ${i+1} in FROM clause. \n\t\t\t\t\tNOTE: sub-queries in FROM clause cannot reference parent FROM tables.`);let l=t[c],p=new Ii(s,[],l);if(l.addChildNode(p),this.qValidator.validateReadFromEntity(s),this.qEntityMapByAlias[a]=r,!r)throw new Error(`Could not find entity ${s.ti} for table ${i+1} in FROM clause`);if(t[a])throw new Error(`Alias '${a}' used more than once in the FROM clause.`);t[a]=p}return o}addFieldsToView(e,t,n){let i=new mi(e.fromClausePosition,null);return this.addFieldsToViewForSelect(i,t,e.subQuery.S,"f",null,n),i}addFieldsToViewForSelect(e,t,n,i,o,r){let a=0,s=!1;for(let c in n){let l=`${i}${++a}`,p=n[c];if(p.ot){let n=o||l;s=s&&this.addFieldToViewForSelect(e,t,i,p,n,o,r)}else this.addFieldsToViewForSelect(e,t,p,`${l}_`,null,r)}if(a>1){if(s)throw new Error("DISTINCT clause must be the only property at its level");if(o)throw new Error("Field queries can have only one field in SELECT clause")}}addFieldToViewForSelect(e,t,n,i,o,r=null,a){let s,c,l,p=!1;switch(i.ot){case Re.FIELD_FUNCTION:throw e[o]=new Hp(i),new Error("Not implemented");case Re.EXISTS_FUNCTION:throw new Error("Exists function cannot be used in SELECT clause.");case Re.FIELD:switch(s=this.airportDatabase.applications[i.si].currentVersion[0].applicationVersion.entities[i.ti],c=s.properties[i.pi],l=s.columns[i.ci],i.dt){case Ie.BOOLEAN:e[o]=new On(l,c,e);break;case Ie.DATE:e[o]=new bn(l,c,e);break;case Ie.NUMBER:e[o]=new xn(l,c,e);break;case Ie.STRING:e[o]=new Sn(l,c,e);break;default:throw new Error(`Unknown SQLDataType: ${i.dt}.`)}break;case Re.FIELD_QUERY:let d=i;this.addFieldToViewForSelect(e,t,n,d.S,o,o,a);break;case Re.DISTINCT_FUNCTION:this.addFieldsToViewForSelect(e,t,i.v,n,r,a),p=!0;break;case Re.MANY_TO_ONE_RELATION:throw new Error("@ManyToOne fields cannot be directly in a select clause.\n\t\t\t\t\tPlease select a non-relational field within the relation.");default:throw new Error(`Unexpected type property on JSONClauseField: ${i.ot}.`)}return p}getFieldSelectFragment(e,t,n,i,o){let r=this.getFieldValue(e,t,n,o);return void 0!==e.fa&&(r+=` as ${e.fa}`),0===i?`\n\t${r}`:`,\n\t${r}`}getFROMFragments(e,t){return e.map((e=>this.getFROMFragment(null,e,t))).join("\n")}getFROMFragment(e,t,n){let i="\t",o=t.jsonRelation,r=this.relationManager.getAlias(o),a=this.qEntityMapByAlias[r];if(e){let t,s=e.jsonRelation,c=this.relationManager.getAlias(s),l=this.qEntityMapByAlias[c],p=this.qEntityMapByAlias[r];switch(o.jt){case ue.FULL_JOIN:t="FULL JOIN";break;case ue.INNER_JOIN:t="INNER JOIN";break;case ue.LEFT_JOIN:t="LEFT JOIN";break;case ue.RIGHT_JOIN:t="RIGHT JOIN";default:throw new Error(`Unsupported join type: ${o.jt}`)}let d,u="Error building FROM: ";switch(o.rt){case ye.ENTITY_JOIN_ON:let e=o;d=this.getWHEREFragment(e.joinWhereClause,"\t",n),i+=`\t${t} ${this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n)} ${r} ON\n${d}`;break;case ye.ENTITY_APPLICATION_RELATION:i+=this.getEntityApplicationRelationFromJoin(l,p,o,s,r,c,t,u,n);break;case ye.SUB_QUERY_JOIN_ON:let f=o;const{parameterReferences:y,subQuerySql:h}=this.subStatementSqlGenerator.getTreeQuerySql(f.subQuery,this.dialect,n);y.length&&(this.parameterReferences=this.parameterReferences.concat(y)),d=this.getWHEREFragment(f.joinWhereClause,"\t",n),i+=`${t} (${h}) ${r} ON\n${d}`;break;default:throw new Error("Nested FROM entries must be Entity JOIN ON\n\t\t\t\t\tor Application Relation, or Sub-Query JOIN ON")}}else switch(o.rt){case ye.ENTITY_ROOT:i+=`${this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n)} ${r}`;break;case ye.SUB_QUERY_ROOT:let e=o;const{parameterReferences:t,subQuerySql:s}=this.subStatementSqlGenerator.getTreeQuerySql(e.subQuery,this.dialect,n);t.length&&(this.parameterReferences=this.parameterReferences.concat(t)),i+=`(${s}) ${r}`;break;default:throw new Error("Top level FROM entries must be Entity or Sub-Query root")}for(let e=0;e<t.childNodes.length;e++){let o=t.childNodes[e];i+=this.getFROMFragment(t,o,n)}return i}getGroupByFragment(e){return e.map((e=>(this.qValidator.validateAliasedFieldAccess(e.fa),`${e.fa}`))).join(", ")}getOrderByFragment(e){return e.map((e=>{switch(this.qValidator.validateAliasedFieldAccess(e.fa),e.so){case he.ASCENDING:return`${e.fa} ASC`;case he.DESCENDING:return`${e.fa} DESC`}})).join(", ")}}class Gp extends $p{constructor(e,t,n,i,o,r,a,s,c,l,p,d){super(e,t,Ce.FIELD,n,i,o,r,a,s,c,l,p,d),this.orderByParser=new Op(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let t=this.parseQueryResult(this.jsonQuery.S,e,[0]);r.push(t)})),r):r}getSELECTFragment(e,t,n,i){if(!t)throw new Error("SELECT clause is not defined for a Field Query");{let o=t;if(o.ot==Re.DISTINCT_FUNCTION){return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}}let o=t,r=0;return this.getFieldSelectFragment(o,Dp.NON_MAPPED_SELECT_CLAUSE,null,r++,i)}parseQueryResult(e,t,n){let i=e,o=this.sqlQueryAdapter.getResultCellValue(t,i.fa,n[0],i.dt,null);return n[0]++,o}}class qp extends $p{constructor(e,t,n,i,o,r,a,s,c,l,p,d){super(e,t,Ce.TREE,n,i,o,r,a,s,c,l,p,d),this.queryParser=new Cp(i,o),this.orderByParser=new Tp(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let t=new rn,n=this.parseQueryResult(this.jsonQuery.S,e,[0],t,t.getFollowingAlias());r.push(n),this.queryParser.flushRow()})),r):r}getSELECTFragment(e,t,n,i){const o=t;if(o.ot==Re.DISTINCT_FUNCTION){if(e)throw new Error("Cannot have DISTINCT specified in a nested select clause");return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}let r=0;for(let e in t){if("*"===e)throw new Error("'*' operator isn't yet implemented in mapped queries");r++}if(0===r){if(e)throw new Error("Mapped query must have fields in a nested-select clause");return"*"}let a=0,s="";for(let e in t){const o=t[e];void 0!==o&&(s+=o instanceof Hp?o.getValue(this,i):this.getFieldSelectFragment(o,Dp.MAPPED_SELECT_CLAUSE,(()=>this.getSELECTFragment(!0,o,n,i)),a++,i))}return s}parseQueryResult(e,t,n,i,o){if(!t||!(t instanceof Object)||t instanceof Date)return t;{let r=e;if(r.ot==Re.DISTINCT_FUNCTION)return this.parseQueryResult(r.appliedFunctions[0].p[0],t,n,i,o)}let r=this.queryParser.addEntity(o);for(let a in e){if(void 0===e[a])continue;let s=e[a],c=s.dt;if(c){let e=this.sqlQueryAdapter.getResultCellValue(t,s.fa,n[0],c,null);this.queryParser.addProperty(o,r,c,a,e)}else{let e=this.parseQueryResult(s,t,n,i,i.getFollowingAlias());this.queryParser.bufferOneToManyCollection(o,r,a,e)}n[0]++}return this.queryParser.flushEntity(o,r)}}var Yp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Qp=class{getTreeQuerySql(e,t,n){let i=new qp(e,t,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this.storeDriver,this.subStatementQueryGenerator,n);const o=i.toSQL({},n);return{parameterReferences:i.parameterReferences,subQuerySql:o}}getFieldQuerySql(e,t,n,i){let o=new Gp(e,t,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this.storeDriver,this.subStatementQueryGenerator,i);o.addQEntityMapByAlias(n);const r=o.toSQL({},i);return{parameterReferences:o.parameterReferences,subQuerySql:r}}};Yp([function(e,t){}],Qp.prototype,"airportDatabase",void 0),Yp([function(e,t){}],Qp.prototype,"applicationUtils",void 0),Yp([function(e,t){}],Qp.prototype,"entityStateManager",void 0),Yp([function(e,t){}],Qp.prototype,"qMetadataUtils",void 0),Yp([function(e,t){}],Qp.prototype,"qValidator",void 0),Yp([function(e,t){}],Qp.prototype,"relationManager",void 0),Yp([function(e,t){}],Qp.prototype,"sqlQueryAdapter",void 0),Yp([function(e,t){}],Qp.prototype,"storeDriver",void 0),Yp([function(e,t){}],Qp.prototype,"subStatementQueryGenerator",void 0),Qp=Yp([function(e){}],Qp);class Jp extends kp{constructor(e,t,n,i,o,r,a,s,c,l,p,d,u,f,y){if(super(e,t,n,i,o,r,a,c,d,u,f),this.objectResultParserFactory=s,this.relationManager=p,this.graphQueryConfiguration=y,this.columnAliases=new rn,y&&void 0!==this.graphQueryConfiguration.strict)throw new Error('"strict" configuration is not yet implemented for \n\t\t\tQueryResultType.ENTITY_GRAPH');this.finalSelectTree=this.setupSelectFields(this.jsonQuery.S,t,f),this.orderByParser=new gp(this.finalSelectTree,o,l,p,e.OB)}toSQL(e,t){this.joinTree=this.buildFromJoinTree(this.jsonQuery.F,{},t);let n=this.getSELECTFragment(this.dbEntity,this.finalSelectTree,this.joinTree,t),i=this.getFROMFragment(null,this.joinTree,t),o="",r=this.jsonQuery;r.W&&(o=`\nWHERE\n${this.getWHEREFragment(r.W,"",t)}`);let a="";return r.OB&&r.OB.length&&(a=`\nORDER BY\n${this.orderByParser.getOrderByFragment(this.joinTree,this.qEntityMapByAlias,t)}`),`SELECT\n\t${n}\nFROM\n${i}${o}${a}`}async parseQueryResults(e,t,n,i,o){this.queryParser=this.objectResultParserFactory.getObjectResultParser(this.queryResultType,this.graphQueryConfiguration,this.dbEntity);let r,a=[];if(!e||!e.length)return a;a=[];for(let t=0;t<e.length;t++){let n=e[t],o=this.relationManager.getAlias(this.joinTree.jsonRelation);this.columnAliases.reset();let s=this.parseQueryResult(this.finalSelectTree,o,this.joinTree,n,[0],i);r?r!==s&&a.push(s):a.push(s),r=s,this.queryParser.flushRow()}return this.queryParser.bridge(a,this.jsonQuery.S,i)}buildFromJoinTree(e,t,n){let i;if(e.length<1){let t={currentChildIndex:0,ti:this.dbEntity.index,fromClausePosition:[],jt:null,ri:null,rt:ye.ENTITY_ROOT,rep:"r_",si:this.dbEntity.applicationVersion.id};e.push(t)}let o=e[0];switch(o.rt){case ye.ENTITY_ROOT:break;case ye.SUB_QUERY_ROOT:case ye.SUB_QUERY_JOIN_ON:throw new Error("Entity query's FROM clause cannot contain sub-queries");case ye.ENTITY_JOIN_ON:throw new Error("Entity queries cannot use JOIN ON");default:throw new Error("First table in FROM clause cannot be result of a join")}let r=this.relationManager.getAlias(o),a=this.relationManager.createRelatedQEntity(o,n);this.qEntityMapByAlias[r]=a,this.jsonRelationMapByAlias[r]=o;const s=a.__driver__.dbEntity;if(s.applicationVersion.application.index!==this.dbEntity.applicationVersion.application.index||s.index!==this.dbEntity.index)throw new Error(`ERROR: Unexpected first table in FROM clause: \n\t\t\t'${s.applicationVersion.application.name}.${s.name}',\n\t\t\texpecting:\n\t\t\t'${this.dbEntity.applicationVersion.application.name}.${this.dbEntity.name}'`);i=new Ii(o,[],null),t[r]=i;for(let i=1;i<e.length;i++){let a=e[i];switch(a.rt){case ye.ENTITY_ROOT:throw new Error("All Entity query tables after the first must be joined");case ye.SUB_QUERY_JOIN_ON:throw new Error("Entity queries FROM clause cannot contain sub-queries");case ye.ENTITY_JOIN_ON:throw new Error("Entity queries cannot use JOIN ON")}if(!a.ri&&0!==a.ri)throw new Error(`Table ${i+1} in FROM clause is missing \n\t\t\t\trelationPropertyName`);let s=this.relationManager.getParentAlias(a);if(!t[s])throw new Error(`Missing parent entity for alias ${s}, \n\t\t\t\ton table ${i+1} in FROM clause`);let c=t[s],l=new Ii(a,[],c);c.addChildNode(l),r=this.relationManager.getAlias(a);let p=this.relationManager.createRelatedQEntity(a,n);if(this.qEntityMapByAlias[r]=p,this.jsonRelationMapByAlias[r]=o,!p)throw new Error(`Could not find entity ${a.ti} for \n\t\t\t\ttable ${i+1} in FROM clause`);if(t[r])throw new Error(`Alias '${r}' used more than once in the FROM clause.`);t[r]=l}return i}parseQueryResult(e,t,n,i,o,r){if(!i||!(i instanceof Object)||i instanceof Date)return i;let a=0;const s=this.qEntityMapByAlias[t].__driver__.dbEntity;let c=this.queryParser.addEntity(t,s,r);for(let l in e){const p=s.propertyMap[l];if(p.relation&&p.relation.length){const d=e[l],u=p.relation[0],f=u.relationEntity;if(null===d||d.__state__===Ee.STUB)switch(u.relationType){case fe.MANY_TO_ONE:let e=!1,n=[];this.applicationUtils.forEachColumnTypeOfRelation(u,((t,r)=>{const s=this.columnAliases.getFollowingAlias();let c=this.sqlQueryAdapter.getResultCellValue(i,s,o[0],t.type,null);n.push({propertyNameChains:r,sqlDataType:t.type,value:c}),qi(c)&&(e=!0,a++),o[0]++})),e?this.queryParser.bufferManyToOneStub(t,s,c,l,f,n,r):this.queryParser.bufferBlankManyToOneStub(t,c,l,n);break;case fe.ONE_TO_MANY:this.queryParser.bufferOneToManyStub(s,l);break;default:throw new Error(`Unknown relation type '${u.relationType}' for \n\t\t\t\t\t\t\t\t'${s.name}.${p.name}'`)}else{const e=n.getEntityRelationChildNode(u),a=this.relationManager.getAlias(e.jsonRelation),f=this.qEntityMapByAlias[a].__driver__.dbEntity;let y=this.parseQueryResult(d,a,e,i,o,r);switch(u.relationType){case fe.MANY_TO_ONE:y?this.queryParser.bufferManyToOneObject(t,s,c,l,f,y,r):this.queryParser.bufferBlankManyToOneObject(t,c,l);break;case fe.ONE_TO_MANY:y?this.queryParser.bufferOneToManyCollection(t,c,s,l,f,y,r):this.queryParser.bufferBlankOneToMany(t,c,s.name,l,f,r);break;default:throw new Error(`Unknown relation type '${u.relationType}' for \n\t\t\t\t\t\t\t\t'${s.name}.${p.name}'`)}}}else{const e=this.columnAliases.getFollowingAlias(),n=this.entityDefaults.getForAlias(t)[l],r=p.propertyColumns[0].column,s=this.sqlQueryAdapter.getResultCellValue(i,e,o[0],r.type,n);this.queryParser.addProperty(t,c,r.type,l,s)&&a++,o[0]++}}if(0===a)return null;let l=this.applicationUtils.getIdKey(c,s);return this.queryParser.flushEntity(t,s,e,l,c,r)}setupSelectFields(e,t,n,i){let o,r=!0;if(!e||e instanceof Array){let e="";throw i&&(e=`(of '${i.entity.name}.${i.name}') `),new Error(`'${t.name}' Entity SELECT clause ${e}must be specified as an Object.`)}var a;(a=o)&&"ID"===a.airportSelectField?(o={},r=!1):o={...e};let s=!1;!0===o.__allFields__&&(s=!0,delete o.__allFields__);const c=!!t.idColumns.length;for(const e in o){s||(r=!1);const i=t.propertyMap[e];if(!i)throw new Error(`Entity property '${t.name}.${e}' does not exist.`);const a=o[e];if(null==a||ro(a)){if(i.isId)throw new Error("@Id properties cannot be excluded from entity queries.");if(!c)throw new Error(`Cannot exclude property '${e}' from select clause \n\t\t\t\t\tfor '${t.name}' Entity - entity has no @Id so all properties must be included.`);delete o[e]}else i.relation&&i.relation.length?o[e]=this.setupSelectFields(a,i.relation[0].relationEntity,n,i):oo(a)||(o[e]=no)}for(const e of t.properties){if(c&&!e.isId&&!r)continue;const n=c&&!e.isId;if(e.relation&&e.relation.length){const n=e.relation[0];switch(n.relationType){case fe.ONE_TO_MANY:break;case fe.MANY_TO_ONE:if(o[e.name])break;const i={};this.entityStateManager.markAsStub(i),o[e.name]=i;break;default:throw new Error(`Unknown relation type: '${n.relationType}' \n\t\t\t\t\t\ton '${t.name}.${e.name}'.`)}}else{const t=o[e.name];if(null!=t){if(!n&&!oo(t))throw new Error((c?"@Id properties":"Entities without @Id")+" \n\t\t\t\t\t\tcannot have default SELECT values.")}else o[e.name]=no}}return o}getSELECTFragment(e,t,n,i,o){const r=this.relationManager.getAlias(n.jsonRelation);let a=[];this.entityStateManager.isStub(t);const s=this.entityDefaults.getForAlias(r);for(let o in t){if("__state__"===o)continue;const c=t[o];oo(c)||(s[o]=c);const l=e.propertyMap[o];if(l.relation&&l.relation.length){const e=l.relation[0];if(this.entityStateManager.isStub(t[o]))for(const t of e.manyRelationColumns){const e=t.manyColumn;this.addFieldFromColumn(e);const n=this.getSimpleColumnFragment(r,e.name);a.push(`${n} ${this.columnAliases.getFollowingAlias()}`)}else{const r=this.getSELECTFragment(e.relationEntity,t[o],n.getEntityRelationChildNode(e),i,l);a=a.concat(r)}}else{const e=l.propertyColumns[0].column;this.addFieldFromColumn(e);const t=this.getSimpleColumnFragment(r,e.name);a.push(`${t} ${this.columnAliases.getFollowingAlias()}`)}}return a}getFROMFragment(e,t,n){let i="\t",o=t.jsonRelation,r=this.relationManager.getAlias(o),a=this.qEntityMapByAlias[r],s=this.storeDriver.getEntityTableName(a.__driver__.dbEntity,n);if(e){let t,a=e.jsonRelation,s=this.relationManager.getAlias(a),c=this.qEntityMapByAlias[s],l=this.qEntityMapByAlias[r];switch(o.jt){case ue.FULL_JOIN:throw new Error("Full Joins are not allowed in Entity queries.");case ue.INNER_JOIN:t="INNER JOIN";break;case ue.LEFT_JOIN:t="LEFT JOIN";break;case ue.RIGHT_JOIN:throw new Error("Right Joins are not allowed in Entity queries.");default:throw new Error(`Unsupported join type: ${o.jt}`)}let p="Error building FROM: ";switch(o.rt){case ye.ENTITY_APPLICATION_RELATION:i+=this.getEntityApplicationRelationFromJoin(c,l,o,a,r,s,t,p,n);break;default:throw new Error("Only Entity application relations are allowed in Entity query FROM clause.")}}else i+=`${s} ${r}`;for(let e=0;e<t.childNodes.length;e++){let o=t.childNodes[e];i+=this.getFROMFragment(t,o,n)}return i}}class Wp extends $p{constructor(e,t,n,i,o,r,a,s,c,l,p,d){super(e,t,Ce.SHEET,n,i,o,r,a,s,c,l,p,d),this.orderByParser=new Op(a)}async parseQueryResults(e,t,n,i,o){let r=[];return e&&e.length?(r=[],e.forEach((e=>{let n=this.parseQueryResult(this.jsonQuery.S,e,[0],t);r.push(n)})),r):r}getSELECTFragment(e,t,n,i){if(!t)throw new Error("SELECT clause is not defined for a Flat Query");{let o=t;if(o.ot==Re.DISTINCT_FUNCTION){return`DISTINCT ${this.getSELECTFragment(e,o.appliedFunctions[0].p[0],n,i)}`}}if(!(t instanceof Array))throw new Error("SELECT clause for a Flat Query must be an Array");let o=0,r=t.map((e=>this.getFieldSelectFragment(e,Dp.NON_MAPPED_SELECT_CLAUSE,null,o++,i))).join("");const a=n.SELECT;return a&&a.length&&(o&&(r+="\n\t,"),r+=a.map((e=>`${e.name}`)).join("\n\t,")),r}parseQueryResult(e,t,n,i){const o=e.map((e=>{let i=this.sqlQueryAdapter.getResultCellValue(t,e.fa,n[0],e.dt,null);return n[0]++,i})),r=i.SELECT;if(r&&r.length)for(const e of r){let i=this.sqlQueryAdapter.getResultCellValue(t,e.name,n[0],e.type,null);o.push(i),n[0]++}return o}}var zp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Kp=class{constructor(){this.queries=new Map}add(e,t){this.queries.set(e,t)}remove(e){this.queries.delete(e)}markQueriesToRerun(e){this.queries.forEach((t=>{e.intersects(t.sqlQuery.getFieldMap())&&(t.rerun=!0)}))}rerunQueries(){setTimeout((()=>{this.queries.forEach((e=>{e.rerun&&(e.rerun=!1,e.runQuery())}))}),100)}};Kp=zp([function(e){}],Kp);var Xp=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zp=class{constructor(){this.transactionHistoryIdColumns=[]}async init(){this.populateTransactionHistoryIdColumns().then()}populateTransactionHistoryIdColumns(){return new Promise(((e,t)=>{this.doPopulateTransactionHistoryIdColumns(e)}))}doPopulateTransactionHistoryIdColumns(e){if(la.__dbApplication__&&la.__dbApplication__.currentVersion){const t=this.getHoldingPatternDbEntity("TransactionHistory"),n=this.getHoldingPatternDbEntity("RepositoryTransactionHistory"),i=this.getHoldingPatternDbEntity("OperationHistory"),o=this.getHoldingPatternDbEntity("RecordHistory");this.transactionHistoryIdColumns.push(t.idColumns[0]),this.transactionHistoryIdColumns.push(n.idColumns[0]),this.transactionHistoryIdColumns.push(i.idColumns[0]),this.transactionHistoryIdColumns.push(o.idColumns[0]),e()}else setTimeout((()=>{this.doPopulateTransactionHistoryIdColumns(e)}),100)}async generateTransactionHistoryIds(e,t,n){let i=await this.sequenceGenerator.generateSequenceNumbers(this.transactionHistoryIdColumns,[1,e,t,n]);return{operationHistoryIds:i[2],recordHistoryIds:i[3],repositoryHistoryIds:i[1],transactionHistoryId:i[0][0]}}async generateEntityIds(){}getHoldingPatternDbEntity(e){return la.__dbApplication__.currentVersion[0].applicationVersion.entityMapByName[e]}};var ed;Xp([function(e,t){}],Zp.prototype,"sequenceGenerator",void 0),Zp=Xp([function(e){}],Zp),function(e){e.CREATED="CREATED",e.DELETED="DELETED",e.UPDATED="UPDATED"}(ed||(ed={}));var td=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nd=class{supportsLocalTransactions(e){return!0}getEntityTableName(e,t){return this.getTableName(e.applicationVersion.application,e,t)}getTableName(e,t,n){let i,o=t.name;return t.tableConfig&&t.tableConfig.name&&(o=t.tableConfig.name),i=e.fullName?e.fullName:Q(e),this.composeTableName(i,o,n)}async internalSetupTransaction(e,t){await this.ensureContext(t)}async tearDownTransaction(e,t){e.childTransaction&&this.tearDownTransaction(e.childTransaction,t),e.parentTransaction&&(e.parentTransaction.childTransaction=null,e.parentTransaction=null)}async startTransaction(e,t){await this.ensureContext(t);try{await this.internalStartTransaction(e)}catch(n){throw await this.tearDownTransaction(e,t),console.error(n),n}}async commit(e,t){await this.ensureContext(t);try{await this.internalCommit(e)}catch(t){console.error(t);try{await this.internalRollback(e)}catch(e){console.error(e)}throw t}finally{await this.tearDownTransaction(e,t)}}async rollback(e,t){await this.ensureContext(t);try{await this.internalRollback(e)}catch(e){console.error(e)}finally{await this.tearDownTransaction(e,t)}}async insertValues(e,t,n){const i=this.splitValues(e.jsonQuery.V,t);let o=0;for(const n of i){let i=new Up({...e.jsonQuery,V:n},this.getDialect(t),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,t),r=i.toSQL(t),a=i.getParameters(e.parameterMap,t);o+=await this.executeNative(r,a,t)}return o}async deleteWhere(e,t){let n=new X,i=new Lp(e.jsonQuery,this.getDialect(t),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.relationManager,this.sqlQueryAdapter,this,t),o=i.toSQL(t),r=i.getParameters(e.parameterMap,t),a=await this.executeNative(o,r,t);return this.activeQueries.markQueriesToRerun(n),a}async updateWhere(e,t,n){let i=new Bp(e.jsonQuery,this.getDialect(n),this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,n),o=i.toSQL(t,n),r=i.getParameters(e.parameterMap,n);return await this.executeNative(o,r,n)}async find(e,t,n,i){if(n.transaction)return await n.transaction.find(e,t,n,i);n=await this.ensureContext(n);const o=this.getSQLQuery(e,n),r=o.toSQL(t,n),a=o.getParameters(e.parameterMap,n);let s=await this.findNative(r,a,n);return s=await o.parseQueryResults(s,t,e.queryResultType,n),s}getSQLQuery(e,t){let n=e.jsonQuery,i=this.getDialect(t),o=e.queryResultType;const r=Ce;switch(o){case r.ENTITY_GRAPH:case r.ENTITY_TREE:case r.MAPPED_ENTITY_GRAPH:case r.MAPPED_ENTITY_TREE:const a=this.airportDatabase.applications[e.applicationIndex].currentVersion[0].applicationVersion.entities[e.tableIndex];return new Jp(n,a,i,o,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.objectResultParserFactory,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,t);case r.FIELD:return new Gp(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,t);case r.SHEET:return new Wp(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,t);case r.TREE:return new qp(n,i,this.airportDatabase,this.applicationUtils,this.entityStateManager,this.qMetadataUtils,this.qValidator,this.relationManager,this.sqlQueryAdapter,this,this.subStatementQueryGenerator,t);case r.RAW:default:throw new Error(`Unknown QueryResultType: ${o}`)}}async findOne(e,t,n,i){let o=await this.find(e,t,n);if(o.length>1)throw new Error(`Expecting a single result, got ${o.length}`);return 1==o.length?o[0]:null}search(e,t,n,i){let o=new Dt;return(()=>{this.find(e,t,n).then((e=>{o.next(e)}))})(),o}searchOne(e,t,n,i){let o=new Dt;return(()=>{this.findOne(e,t,n).then((e=>{o.next(e)}))})(),o}warn(e){console.log(e)}splitValues(e,t){const n=e[0].length;if(e.length*n<=this.maxValues)return[e];let i=Math.floor(this.maxValues/n);const o=[];for(let t=0;t<e.length;t+=i){const n=e.slice(t,t+i);o.push(n)}return o}async ensureContext(e){return e=wi(e),await this.operationContextLoader.ensure(e),e}};td([function(e,t){}],nd.prototype,"activeQueries",void 0),td([function(e,t){}],nd.prototype,"airportDatabase",void 0),td([function(e,t){}],nd.prototype,"applicationUtils",void 0),td([function(e,t){}],nd.prototype,"entityStateManager",void 0),td([function(e,t){}],nd.prototype,"objectResultParserFactory",void 0),td([function(e,t){}],nd.prototype,"operationContextLoader",void 0),td([function(e,t){}],nd.prototype,"qMetadataUtils",void 0),td([function(e,t){}],nd.prototype,"qValidator",void 0),td([function(e,t){}],nd.prototype,"relationManager",void 0),td([function(e,t){}],nd.prototype,"transactionManager",void 0),td([function(e,t){}],nd.prototype,"sqlQueryAdapter",void 0),td([function(e,t){}],nd.prototype,"subStatementQueryGenerator",void 0),nd=td([function(e){}],nd);var id=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let od=class{validateInsertQEntity(e){}validateReadFromEntity(e){}validateReadProperty(e){}validateUpdateProperty(e,t){}validateUpdateColumn(e){}validateReadQEntityProperty(e,t,n){}validateReadQEntityManyToOneRelation(e,t,n){}addFunctionAlias(e){}addSubQueryAlias(e){}validateAliasedFieldAccess(e){}};od=id([function(e){}],od);const rd=V("fuel-hydrant-system"),ad=rd.token({class:Kp,interface:"IActiveQueries",token:"ACTIVE_QUERIES"}),sd=rd.token({class:Qp,interface:"ISubStatementSqlGenerator",token:"SUB_STATEMENT_SQL_GENERATOR"}),cd=rd.token({class:Zp,interface:"IIdGenerator",token:"ID_GENERATOR"}),ld=rd.token({class:Sp,interface:"IObjectResultParserFactory",token:"OBJECT_RESULT_PARSER_FACTORY"}),pd=rd.token({class:od,interface:"IValidator",token:"Q_VALIDATOR"}),dd=rd.token({class:null,interface:"ISQLQueryAdaptor",token:"SQL_QUERY_ADAPTOR"}),ud=rd.token({class:nd,interface:"class SqlDriver",token:"ABSTRACT_SQL_DRIVER"}),fd=rd.token({class:Vp,interface:"class SQLWhereBase",token:"SQL_WHERE_BASE"});cd.setDependencies({sequenceGenerator:ar}),ld.setDependencies({applicationUtils:Io,entityStateManager:He}),ud.setDependencies({activeQueries:ad,airportDatabase:Ro,applicationUtils:Io,entityStateManager:He,objectResultParserFactory:ld,operationContextLoader:$e,qMetadataUtils:Ao,qValidator:pd,relationManager:Co,transactionManager:ur,sqlQueryAdapter:dd,subStatementQueryGenerator:sd}),fd.setDependencies({qValidator:pd,subStatementSqlGenerator:sd}),sd.setDependencies({airportDatabase:Ro,applicationUtils:Io,entityStateManager:He,operationContextLoader:$e,qMetadataUtils:Ao,qValidator:pd,relationManager:Co,sqlQueryAdapter:dd,storeDriver:pr,subStatementQueryGenerator:sd});var yd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let hd=class{async getTransactionsForRepository(e,t,n){const i=await this.nonhubClient.getRepositoryTransactions(e,t,n),o=[];for(const e of i)if(e.repositoryUuId===t)for(const t of e.messages)t.syncTimestamp=e.syncTimestamp,o.push(t);else console.error(`Got a reponse fragment for repository ${e.repositoryUuId}.\n    Expecting message fragments for repository: ${t}`);return o}async sendTransactions(e,t){let n=!0;for(const[i,o]of t)try{await this.sendTransactionsForRepository(e,i,o)||(n=!1)}catch(e){console.error(e),n=!1}return n}async sendTransactionsForRepository(e,t,n){if(!n||!n.length)return!1;const i=await this.nonhubClient.sendRepositoryTransactions(e,t,n);if(!i)return!1;for(const e of n)e.syncTimestamp=i;return!0}};yd([function(e,t){}],hd.prototype,"nonhubClient",void 0),hd=yd([function(e){}],hd);var md=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Rd=class{async load(e){switch(e){case"IPFS":throw new Error("Not Implemented");case"localhost:9000":return this.debugSynchronizationAdapter;default:throw new Error(`Unexpected synchronization source: ${e}`)}}};md([function(e,t){}],Rd.prototype,"debugSynchronizationAdapter",void 0),Rd=md([function(e){}],Rd);var Id=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ed=class{async ensureActors(e){try{let t=[],n=new Map;for(let i=0;i<e.actors.length;i++){const o=e.actors[i];if("string"!=typeof o.uuId||36!==o.uuId.length)throw new Error("Invalid 'terminal.uuid'");this.checkActorApplication(o,e),this.checkActorTerminal(o,e),this.checkActorUser(o,e),t.push(o.uuId),n.set(o.uuId,i),delete o.id}const i=await this.actorDao.findByUuIds(t);for(const t of i){const i=n.get(t.uuId);e.actors[i]=t}const o=e.actors.filter((e=>!e.id));o.length&&await this.actorDao.insert(o)}catch(e){return console.error(e),!1}return!0}checkActorApplication(e,t){if("number"!=typeof e.application)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.terminal'");const n=t.applications[e.application];if(!n)throw new Error(`Did not find actor.application with "in-message index" ${e.application}`);e.application=n}checkActorTerminal(e,t){if("number"!=typeof e.terminal)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.terminal'");const n=t.terminals[e.terminal];if(!n)throw new Error(`Did not find actor.terminal with "in-message index" ${e.terminal}`);e.terminal=n}checkActorUser(e,t){if("number"!=typeof e.user)throw new Error("Expecting \"in-message index\" (number)\n\t\t\tin 'actor.user'");const n=t.users[e.user];if(!n)throw new Error(`Did not find actor.user with "in-message index" ${e.user}`);e.user=n}};Id([function(e,t){}],Ed.prototype,"actorDao",void 0),Ed=Id([function(e){}],Ed);var gd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Od=class{async ensureApplications(e){try{let t=await this.checkApplicationsAndDomains(e);for(let n=0;n<e.applications.length;n++){let i=e.applications[n];e.applications[n]=t.get(i.domain.name).get(i.name).application}}catch(e){return console.error(e),!1}return!0}async checkApplicationsAndDomains(e){const{allApplicationNames:t,domainCheckMap:n,domainNames:i,applicationCheckMap:o}=this.getNames(e),r=await this.applicationDao.findByDomainNamesAndApplicationNames(i,t);for(let e of r){let t=e.domain.name,i=e.name;for(let[r,a]of o.get(t))if(a.applicationName===i){let i=n.get(t);i.found=!0,i.domain=e.domain,a.found=!0,a.application=e}}let a=[];for(let[e,t]of n){if(t.found)continue;let n={id:null,name:e};t.domain=n,a.push(n)}a.length&&await this.domainDao.insert(a);let s=[];for(let[e,t]of o)for(let[i,o]of t){if(o.found)continue;let t={domain:n.get(e).domain,index:null,name:i,scope:"private",status:Pe.STUB,signature:"localhost"};o.application=t,s.push(t)}return s.length&&await this.applicationDao.insert(s),o}getNames(e){if(!(e.applications&&e.applications instanceof Array))throw new Error("Did not find applications in RepositorySynchronizationMessage.");const t=new Map,n=new Map;for(let i of e.applications){if("object"!=typeof i)throw new Error("Invalid ApplicationVersion.application");if(!i.name||"string"!=typeof i.name)throw new Error("Invalid ApplicationVersion.Application.name");const e=i.domain;if("object"!=typeof e)throw new Error("Invalid ApplicationVersion.Application.Domain");if(!e.name||"string"!=typeof e.name)throw new Error("Invalid ApplicationVersion.Application.Domain.name");let o=n.get(e.name);o||(o=new Map,n.set(e.name,o)),o.has(i.name)||o.set(i.name,{applicationName:i.name}),t.get(e.name)||t.set(e.name,{domainName:e.name})}const i=[],o=[];for(const[e,t]of n){i.push(e);for(let[e,n]of t)o.push(e)}return{allApplicationNames:o,domainCheckMap:t,domainNames:i,applicationCheckMap:n}}};gd([function(e,t){}],Od.prototype,"applicationDao",void 0),gd([function(e,t){}],Od.prototype,"domainDao",void 0),Od=gd([function(e){}],Od);var Td=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wd=class{async ensureApplicationVersions(e){try{let t=await this.checkVersionsApplicationsDomains(e);for(let n=0;n<e.applicationVersions.length;n++){const i=e.applicationVersions[n];e.applicationVersions[n]=t.get(i.application.domain.name).get(i.application.name).applicationVersion}}catch(e){return console.error(e),!1}return!0}async checkVersionsApplicationsDomains(e){const{allApplicationNames:t,domainNames:n,applicationVersionCheckMap:i}=this.getNames(e),o=await this.applicationVersionDao.findByDomainNamesAndApplicationNames(n,t);let r,a;for(let e of o){let t=e.application.domain.name,n=e.application.name;if(r!==t&&a!==n){let o=e.integerVersion;for(let[r,a]of i.get(t))if(a.applicationName===n){if(a.found=!0,a.applicationVersionNumber>o)throw new Error(`Installed application ${n} for domain ${t}\n\tis at a lower version ${o} than needed in message ${a.applicationVersionNumber}.`);a.applicationVersion=e}r=t,a=n}}for(const[e,t]of i)for(let[n,i]of t)if(!i.found)throw new Error(`Application ${i.applicationName} for domain ${e} is not installed.`);return i}getNames(e){if(!(e.applicationVersions&&e.applicationVersions instanceof Array))throw new Error("Did not find applicationVersions in RepositorySynchronizationMessage.");const t=new Map;for(let n of e.applicationVersions){if(!n.integerVersion||"number"!=typeof n.integerVersion)throw new Error("Invalid ApplicationVersion.integerVersion.");const i=e.applications[n.application];if("object"!=typeof i)throw new Error("Invalid ApplicationVersion.application");n.application=i;const o=i.domain;let r=t.get(o.name);r||(r=new Map,t.set(o.name,r)),r.has(i.name)||r.set(i.name,{applicationName:i.name,applicationVersionNumber:n.integerVersion})}const n=[],i=[];for(const[e,o]of t){n.push(e);for(let[e,t]of o)i.push(e)}return{allApplicationNames:i,domainNames:n,applicationVersionCheckMap:t}}};Td([function(e,t){}],wd.prototype,"applicationVersionDao",void 0),wd=Td([function(e){}],wd);var bd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Nd=class{async checkMessage(e){return!!await this.syncInUserChecker.ensureUsers(e)&&(!!await this.syncInTerminalChecker.ensureTerminals(e)&&(!!await this.syncInApplicationChecker.ensureApplications(e)&&(!!await this.syncInActorChecker.ensureActors(e)&&(!!await this.syncInRepositoryChecker.ensureRepositories(e)&&(!!await this.syncInApplicationVersionChecker.ensureApplicationVersions(e)&&!!await this.syncInDataChecker.checkData(e))))))}};bd([function(e,t){}],Nd.prototype,"syncInActorChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInApplicationChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInApplicationVersionChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInDataChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInRepositoryChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInTerminalChecker",void 0),bd([function(e,t){}],Nd.prototype,"syncInUserChecker",void 0),Nd=bd([function(e){}],Nd);var _d=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let xd=class{async checkData(e){const t=e.history;try{if(!t||"object"!=typeof t)throw new Error("Invalid RepositorySynchronizationMessage.history");if("string"!=typeof t.uuId||36!==t.uuId.length)return!1;if(!(t.operationHistory&&t.operationHistory instanceof Array))return!1;if(!t.saveTimestamp||"number"!=typeof t.saveTimestamp)throw new Error("Invalid RepositorySynchronizationMessage.history.saveTimestamp");if(t.transactionHistory)throw new Error("RepositorySynchronizationMessage.history.transactionHistory cannot be specified");if(t.repositoryTransactionType)throw new Error("RepositorySynchronizationMessage.history.repositoryTransactionType cannot be specified");if(t.syncTimestamp)throw new Error("RepositorySynchronizationMessage.history.syncTimestamp cannot be specified");t.repositoryTransactionType=Pr.REMOTE,t.syncTimestamp=e.syncTimestamp,delete t.id;const n=await this.populateApplicationEntityMap(e);await this.checkOperationHistories(e,n)}catch(e){return console.error(e),!1}return!0}async populateApplicationEntityMap(e){const t=this.terminalStore.getAllApplicationVersionsByIds(),n=new Map;for(const i of e.applicationVersions){const e=t[i.id];for(const t of e.entities){let i=n.get(e.application.domain.name);i||(i=new Map,n.set(e.application.domain.name,i));let o=i.get(e.application.name);o||(o=new Map,i.set(e.application.name,o)),o.set(t.index,t)}}return n}async checkOperationHistories(e,t){const n=e.history;if(!(n.operationHistory instanceof Array&&n.operationHistory.length))throw new Error("Invalid RepositorySynchronizationMessage.history.operationHistory");const i=zo(n.operationHistory.length,this.airportDatabase,this.sequenceGenerator);let o=0;for(let r=0;r<n.operationHistory.length;r++){const a=n.operationHistory[r];if("object"!=typeof a)throw new Error("Invalid operationHistory");if(a.orderNumber)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.orderNumber cannot be specified,\n\t\t\t\tthe position of orderHistory record determines it's order");switch(a.orderNumber=++o,a.changeType){case be.DELETE_ROWS:case be.INSERT_VALUES:case be.UPDATE_ROWS:break;default:throw new Error(`Invalid operationHistory.changeType: ${a.changeType}`)}if("object"!=typeof a.entity)throw new Error("Invalid operationHistory.entity");if("number"!=typeof a.entity.applicationVersion)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\t\tin 'operationHistory.entity.applicationVersion'");const s=e.actors[a.actor];if(!s)throw new Error('Cannot find Actor for "in-message id" RepositorySynchronizationMessage.history.actor');a.actor=s;const c=e.applicationVersions[a.entity.applicationVersion];if(!c)throw new Error(`Invalid index into message.applicationVersions [${a.entity.applicationVersion}],\n\t\t\t\tin operationHistory.entity.applicationVersion`);const l=t.get(c.application.domain.name).get(c.application.name).get(a.entity.index);if(!l)throw new Error(`Invalid operationHistory.entity.index: ${a.entity.index}`);if(a.entity=l,a.repositoryTransactionHistory)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.repositoryTransactionHistory cannot be specified");if(a.repositoryTransactionHistory=n,a.systemWideOperationId)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.systemWideOperationId cannot be specified");a.systemWideOperationId=i[r],delete a.id;let p=new Map,d=new Map;for(const e of a.entity.columns){switch(e.name){case de.ORIGINAL_ACTOR_ID:p.set(e.index,e);break;case de.ORIGINAL_REPOSITORY_ID:d.set(e.index,e)}/.*_AID_[\d]+$/.test(e.name)&&e.manyRelationColumns.length&&p.set(e.index,e),/.*_RID_[\d]+$/.test(e.name)&&e.manyRelationColumns.length&&d.set(e.index,e)}await this.checkRecordHistories(a,p,d,e)}}async checkRecordHistories(e,t,n,i){const o=e.recordHistory;if(!(o instanceof Array&&o.length))throw new Error("Inalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory");for(const r of o){if(!r.actorRecordId||"number"!=typeof r.actorRecordId)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.actorRecordId");switch(e.changeType){case be.INSERT_VALUES:if(r.actor)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.actor\nfor ChangeType.INSERT_VALUES");r.actor=e.actor;break;case be.DELETE_ROWS:case be.UPDATE_ROWS:if(void 0===r.actor)r.actor=e.actor;else{const e=i.actors[r.actor];if(!e)throw new Error('Did find Actor for "in-message id" in RepositorySynchronizationMessage.history -> operationHistory.actor');r.actor=e}}if(r.operationHistory)throw new Error("RepositorySynchronizationMessage.history -> operationHistory.recordHistory.operationHistory cannot be specified");this.checkNewValues(r,t,n,e,i),this.checkOldValues(r,t,n,e,i),r.operationHistory=e,delete r.id}}checkNewValues(e,t,n,i,o){switch(i.changeType){case be.DELETE_ROWS:if(e.newValues)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues\nfor ChangeType.DELETE_ROWS");return;case be.INSERT_VALUES:case be.UPDATE_ROWS:if(!(e.newValues instanceof Array&&e.newValues.length))throw new Error("Must specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues\nfor ChangeType.INSERT_VALUES|UPDATE_ROWS")}for(const t of e.newValues){if(t.recordHistory)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.recordHistory");if(t.recordHistory=e,"number"!=typeof t.columnIndex)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.columnIndex");if(void 0===typeof t.newValue)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue")}for(const i of e.newValues){const e=t.get(i.columnIndex);if(e){const t=o.actors[i.newValue];if(!t)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue\nValue is for ${e.name} and could find RepositorySynchronizationMessage.actors[${i.newValue}]`);i.newValue=t.id}const r=n.get(i.columnIndex);if(r)if(-1===i.newValue)i.newValue=o.history.repository.id;else{const e=o.referencedRepositories[i.newValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.newValue\n\tValue is for ${r.name} and could find RepositorySynchronizationMessage.referencedRepositories[${i.newValue}]`);i.newValue=e.id}}}checkOldValues(e,t,n,i,o){switch(i.changeType){case be.DELETE_ROWS:case be.INSERT_VALUES:if(e.oldValues)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues\nfor ChangeType.DELETE_ROWS|INSERT_VALUES");return;case be.UPDATE_ROWS:if(!(e.newValues instanceof Array&&e.oldValues.length))throw new Error("Must specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues\nfor ChangeType.UPDATE_ROWS")}for(const t of e.oldValues){if(t.recordHistory)throw new Error("Cannot specify RepositorySynchronizationMessage.history -> operationHistory.recordHistory.newValues.recordHistory");if(t.recordHistory=e,"number"!=typeof t.columnIndex)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.columnIndex");if(void 0===typeof t.oldValue)throw new Error("Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue")}for(const i of e.oldValues){if(t.get(i.columnIndex)){const e=o.actors[i.oldValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue\nValue is for ORIGINAL_ACTOR_ID and could find RepositorySynchronizationMessage.actors[${i.oldValue}]`);i.oldValue=e.id}if(n.get(i.columnIndex)){const e=o.referencedRepositories[i.oldValue];if(!e)throw new Error(`Invalid RepositorySynchronizationMessage.history -> operationHistory.recordHistory.oldValues.oldValue\nValue is for ORIGINAL_REPOSITORY_ID and could find RepositorySynchronizationMessage.referencedRepositories[${i.oldValue}]`);i.oldValue=e.id}}}};_d([function(e,t){}],xd.prototype,"airportDatabase",void 0),_d([function(e,t){}],xd.prototype,"sequenceGenerator",void 0),_d([function(e,t){}],xd.prototype,"terminalStore",void 0),xd=_d([function(e){}],xd);var Ad=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let vd=class{async ensureRepositories(e){try{let t=[],n=new Map;for(let i=0;i<e.referencedRepositories.length;i++)this.checkRepository(e.referencedRepositories[i],i,t,n,e);const i=e.history;if(i.isRepositoryCreation){if("object"!=typeof i.repository)throw new Error("Serialized RepositorySynchronizationMessage.history.repository should be an object\n\tif RepositorySynchronizationMessage.history.isRepositoryCreation === true");this.checkRepository(i.repository,null,t,n,e)}else{if("string"!=typeof i.repository)throw new Error("Serialized RepositorySynchronizationMessage.history.repository should be a string\n\tif RepositorySynchronizationMessage.history.isRepositoryCreation === false");t.push(i.repository)}const o=await this.repositoryDao.findByUuIds(t);for(const t of o){const o=n.get(t.uuId);o||0===o?e.referencedRepositories[o]=t:i.repository=t}const r=e.referencedRepositories.filter((e=>!e.id));if("object"!=typeof i.repository)throw new Error(`Repository with UuId ${i.repository} is not\n\t\t\t\t\tpresent and cannot be synced\n\tThis RepositorySynchronizationMessage is for an existing repository and that\n\trepository must already be loaded in this database for this message to be\n\tprocessed.`);i.repository.id||r.push(i.repository),r.length&&await this.repositoryDao.insert(r)}catch(e){return console.error(e),!1}return!0}checkRepository(e,t,n,i,o){if("number"!=typeof e.ageSuitability)throw new Error("Invalid 'repository.ageSuitability'");if(!e.createdAt||"string"!=typeof e.createdAt)throw new Error("Invalid 'repository.createdAt'");if(e.createdAt=new Date(e.createdAt),"boolean"!=typeof e.immutable)throw new Error("Invalid 'repository.immutable'");if(!e.source||"string"!=typeof e.source)throw new Error("Invalid 'repository.source'");if("string"!=typeof e.uuId||36!==e.uuId.length)throw new Error("Invalid 'repository.uuid'");if("number"!=typeof e.owner)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\tin 'repository.owner'");const r=o.users[e.owner];if(!r)throw new Error(`Did not find repository.owner (User) with "in-message index" ${e.owner}`);e.owner=r,n.push(e.uuId),"number"==typeof t&&i.set(e.uuId,t),delete e.id}};Ad([function(e,t){}],vd.prototype,"repositoryDao",void 0),vd=Ad([function(e){}],vd);var Sd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Cd=class{async ensureTerminals(e){try{let t=[],n=new Map;for(let i=0;i<e.terminals.length;i++){const o=e.terminals[i];if("number"!=typeof o.owner)throw new Error("Expecting \"in-message index\" (number)\n\t\t\t\t\tin 'terminal.owner' of RepositorySynchronizationMessage.terminals");if("string"!=typeof o.uuId||36!==o.uuId.length)throw new Error("Invalid 'terminal.uuid' in RepositorySynchronizationMessage.terminals");if(void 0!==o.isLocal)throw new Error("'terminal.isLocal' cannot defined in RepositorySynchronizationMessage.terminals");o.isLocal=!1;const r=e.users[o.owner];if(!r)throw new Error(`Did not find user for terminal.owner with "in-message index" ${o.owner}\n\t\t\t\t\t\tfor RepositorySynchronizationMessage.terminals`);o.owner=r,t.push(o.uuId),n.set(o.uuId,i),delete o.id}const i=await this.terminalDao.findByUuIds(t);for(const t of i){const i=n.get(t.uuId);e.terminals[i]=t}const o=e.terminals.filter((e=>!e.id));o.length&&await this.addMissingTerminals(o)}catch(e){return console.error(e),!1}return!0}async addMissingTerminals(e){for(const t of e)t.isLocal=!1;await this.terminalDao.insert(e)}};Sd([function(e,t){}],Cd.prototype,"terminalDao",void 0),Cd=Sd([function(e){}],Cd);var Dd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Md=class{async ensureUsers(e){try{let t=[],n=new Map;for(let i=0;i<e.users.length;i++){const o=e.users[i];if("string"!=typeof o.uuId||36!==o.uuId.length)throw new Error("Invalid 'user.uuid'");if("string"!=typeof o.username||o.username.length<3)throw new Error("Invalid 'user.username'");t.push(o.uuId),n.set(o.uuId,i),delete o.id}const i=await this.userDao.findByUuIds(t);for(const t of i){const i=n.get(t.uuId);e.users[i]=t}const o=e.users.filter((e=>!e.id));o.length&&await this.addMissingUsers(o)}catch(e){return console.error(e),!1}return!0}async addMissingUsers(e){for(const t of e)if(!t.username||"string"!=typeof t.username)throw new Error(`Invalid User.username ${t.username}`);await this.userDao.insert(e)}};Dd([function(e,t){}],Md.prototype,"userDao",void 0),Md=Dd([function(e){}],Md);var Vd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Pd=class{};var Ld;Vd([function(e,t){},function(e,t){},function(e,t){}],Pd.prototype,"id",void 0),Vd([function(e,t){}],Pd.prototype,"type",void 0),Vd([function(e,t){}],Pd.prototype,"acknowledged",void 0),Vd([function(e,t){},function(e,t){}],Pd.prototype,"repository",void 0),Vd([function(e,t){},function(e,t){}],Pd.prototype,"overwrittenRecordHistory",void 0),Vd([function(e,t){},function(e,t){}],Pd.prototype,"overwritingRecordHistory",void 0),Vd([function(e,t){}],Pd.prototype,"values",void 0),Pd=Vd([function(e){},function(e){}],Pd),function(e){e.LOCAL_UPDATE_REMOTELY_DELETED="LOCAL_UPDATE_REMOTELY_DELETED",e.REMOTE_CREATE_REMOTELY_DELETED="REMOTE_CREATE_REMOTELY_DELETED",e.REMOTE_UPDATE_LOCALLY_DELETED="REMOTE_UPDATE_LOCALLY_DELETED",e.REMOTE_UPDATE_LOCALLY_UPDATED="REMOTE_UPDATE_LOCALLY_UPDATED"}(Ld||(Ld={}));var Ud=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let jd=class{};var Fd,kd;Ud([function(e,t){},function(e,t){},function(e,t){}],jd.prototype,"synchronizationConflict",void 0),Ud([function(e,t){},function(e,t){}],jd.prototype,"columnIndex",void 0),jd=Ud([function(e){},function(e){}],jd),function(e){e.LOCAL="LOCAL",e.REMOTE="REMOTE"}(Fd||(Fd={})),function(e){e.CHANGE_NEEDED="CHANGE_NEEDED",e.CHANGE_COMPLETED="CHANGE_COMPLETED"}(kd||(kd={}));var Bd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Hd=class{};Bd([function(e,t){},function(e,t){}],Hd.prototype,"id",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"applicationVersion",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"entity",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"repository",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"actor",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"actorRecordId",void 0),Bd([function(e,t){},function(e,t){}],Hd.prototype,"column",void 0),Bd([function(e,t){}],Hd.prototype,"updatedValue",void 0),Hd=Bd([function(e){},function(e){}],Hd);const $d={__constructors__:{RecordUpdateStage:Hd,SynchronizationConflict:Pd,SynchronizationConflictValues:jd},domain:"air",name:"@airport/moving-walkway"},Gd=$d;function qd(e){return Jo(Gd.__dbApplication__,e)}k.db().eventuallyGet(Ro).then((e=>{e.QM[Q($d)]=Gd}));class Yd extends Bo{constructor(e){super(e,Gd)}}class Qd extends Yd{constructor(){super(2)}static Save(e){return Bo.BaseSave(e)}static diSet(){return qd(2)}}Qd.Find=new Ho,Qd.FindOne=new Ho,Qd.Search=new Ho,Qd.SearchOne=new Ho;class Jd extends Yd{constructor(){super(1)}static Save(e){return Bo.BaseSave(e)}static diSet(){return qd(1)}}Jd.Find=new Ho,Jd.FindOne=new Ho,Jd.Search=new Ho,Jd.SearchOne=new Ho;class Wd extends Yd{constructor(){super(0)}static Save(e){return Bo.BaseSave(e)}static diSet(){return qd(0)}}Wd.Find=new Ho,Wd.FindOne=new Ho,Wd.Search=new Ho,Wd.SearchOne=new Ho;var zd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Kd=class extends Jd{async insert(e){let t;const n=[];for(const t of e)n.push([t.type,t.acknowledged,t.repository.id,t.overwrittenRecordHistory.id,t.overwritingRecordHistory.id]);const i=await this.db.insertValuesGenerateIds({insertInto:t=Gd.SynchronizationConflict,columns:[t.type,t.acknowledged,t.repository.id,t.overwrittenRecordHistory.id,t.overwritingRecordHistory.id],values:n});for(let t=0;t<e.length;t++){e[t].id=i[t][0]}}};Kd=zd([function(e){}],Kd);var Xd=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Zd=class extends Wd{async insert(e){let t;const n=[];for(const t of e)n.push([t.synchronizationConflict.id,t.columnIndex]);await this.db.insertValues({insertInto:t=Gd.SynchronizationConflictValues,columns:[t.synchronizationConflict.id,t.columnIndex],values:n})}};Zd=Xd([function(e){}],Zd);var eu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let tu=class extends Qd{async insertValues(e){const t=Gd.RecordUpdateStage,n=[t.applicationVersion.id,t.entity.id,t.repository.id,t.actor.id,t.actorRecordId,t.column.id,t.updatedValue];return await this.db.insertValuesGenerateIds({insertInto:t,columns:n,values:e},{generateOnSync:!0})}async updateEntityWhereIds(e,t,n,i,o){const r=this.airportDatabase.applications[e].currentVersion[0].applicationVersion.entities[n],a=this.airportDatabase.qApplications[e][r.name],s=[];for(const[e,t]of i){const n=[];for(const[e,i]of t)n.push(un(a.actor.id.equals(e),a.actorRecordId.in(Array.from(i))));s.push(un(a.repository.id.equals(e),fn(...n)))}const c={};for(const e of o){const n=r.columns[e];let i=Gd.RecordUpdateStage,o=ui({from:[i],select:i.updatedValue,where:un(i.applicationVersion.id.equals(t),i.entity.id.equals(r.index),i.repository.id.equals(a.repository.id),i.actor.id.equals(a.actor.id),i.actorRecordId.equals(a.actorRecordId),i.column.id.equals(n.index))});c[n.name]=o}await this.db.updateColumnsWhere({update:a,set:c,where:fn(...s)})}async delete(){return await this.db.deleteWhere({deleteFrom:Gd.RecordUpdateStage})}};tu=eu([function(e){}],tu);const nu=V("moving-walkway"),iu=nu.token({class:tu,interface:"IRecordUpdateStageDao",token:"RECORD_UPDATE_STAGE_DAO"}),ou=nu.token({class:Kd,interface:"ISynchronizationConflictDao",token:"SYNCHRONIZATION_CONFLICT_DAO"}),ru=nu.token({class:Zd,interface:"ISynchronizationConflictValuesDao",token:"SYNCHRONIZATION_CONFLICT_VALUES_DAO"});var au=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let su=class{async performStage1DataProcessing(e,t){await this.populateSystemWideOperationIds(e);const n=new Map;for(const[t,i]of e){const e={ids:new Map,firstChangeTime:(new Date).getTime()+1e10};n.set(t,e);for(const t of i){t.saveTimestamp<e.firstChangeTime&&(e.firstChangeTime=t.saveTimestamp);for(const n of t.operationHistory){const t=je(e.ids,n.entity.id);for(const e of n.recordHistory){Fe(t,e.actor.id).add(e.actorRecordId);const n=new Map;e.newValueMap=n;for(const t of e.newValues)n.set(t.columnIndex,t)}}}}const i=new Map,o=this.getDeletedRecordIdsAndPopulateAllHistoryMap(i,e),r=await this.repositoryTransactionHistoryDao.findAllLocalChangesForRecordIds(n),a=this.getDeletedRecordIdsAndPopulateAllHistoryMap(i,r,!0),s=new Set;for(const[e,n]of r)for(const e of n)for(const n of e.operationHistory){const e=n.actor.id;void 0===t.get(e)&&s.add(e)}if(s.size){const e=await this.actorDao.findWithDetailsAndGlobalIdsByIds(Array.from(s));for(const n of e)t.set(n.id,n)}for(const[e,n]of i)this.repositoryTransactionHistoryDuo.sortRepoTransHistories(n,t);const c=new Map,l=new Map,p=new Map,d=new Map;for(const[e,t]of i)for(const n of t)for(const t of n.operationHistory)switch(t.changeType){case be.INSERT_VALUES:this.processCreation(e,t,n.isLocal,c,l,p,o,a,d);break;case be.UPDATE_ROWS:this.processUpdate(e,t,n.isLocal,c,l,o,a,d);break;case be.DELETE_ROWS:this.processDeletion(e,t,c,l,p,a)}return{recordCreations:c,recordDeletions:p,recordUpdates:l,syncConflictMapByRepoId:d}}async populateSystemWideOperationIds(e){let t=0;for(const[n,i]of e)for(const e of i)t+=e.operationHistory.length;const n=await zo(t,this.airportDatabase,this.sequenceGenerator);let i=0;for(const[t,o]of e)for(const e of o)for(const t of e.operationHistory)t.systemWideOperationId=n[i],i++}ensureRecordHistoryId(e,t,n=e.actorRecordId){je(t,e.actor.id).set(n,e.id)}getDeletedRecordIdsAndPopulateAllHistoryMap(e,t,n=!1){const i=new Map;for(const[o,r]of t){this.mergeArraysInMap(e,o,r);for(const e of r){e.isLocal=n;for(const t of e.operationHistory)switch(t.changeType){case be.DELETE_ROWS:for(const e of t.recordHistory)this.ensureRecordHistoryId(e,this.syncInUtils.ensureRecordMapForRepoInTable(o,t,i))}}}return i}mergeArraysInMap(e,t,n){let i=e.get(t);i=i?i.concat(n):n,e.set(t,i)}processCreation(e,t,n,i,o,r,a,s,c){const l=this.getRecordsForRepoInTable(e,t,o),p=this.getRecordsForRepoInTable(e,t,r),d=this.getRecordsForRepoInTable(e,t,a),u=this.getRecordsForRepoInTable(e,t,s),f=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,i);for(const i of t.recordHistory){if(this.getRecord(i,f))throw new Error(`A record is being created more than once.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);if(n)throw new Error(`Remotely mutated record is being created locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if changes are never sent to originating TMs.\n\t\t\t\t\t`);if(this.hasRecordId(i,p))throw new Error(`\n\t\t\t\tRemotely created record is being deleted remotely before it's been created.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if all server clocks are synced.\n\t\t\t\t\t`);if(this.getRecordHistoryId(i,u))throw new Error(`Remotely created record is being deleted locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);const o=this.getRecordHistoryId(i,d);if(o){this.addSyncConflict(Ld.REMOTE_CREATE_REMOTELY_DELETED,e,i,{id:o},c);continue}const r=this.ensureColumnValueMap(i,f);if(this.getRecord(i,l))throw new Error(`Remotely created record is being updated BEFORE it is created.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if all server clocks are synced.\n\t\t\t\t\t`);for(const e of i.newValues)r.set(e.columnIndex,e.newValue)}}processUpdate(e,t,n,i,o,r,a,s){const c=this.getRecordsForRepoInTable(e,t,i),l=this.getRecordsForRepoInTable(e,t,r),p=this.getRecordsForRepoInTable(e,t,a),d=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,o);for(const i of t.recordHistory){const o=this.getRecordHistoryId(i,p);if(o){n||this.addSyncConflict(Ld.REMOTE_UPDATE_LOCALLY_DELETED,e,i,{id:o},s);continue}const r=this.getRecordHistoryId(i,l);if(r){n&&this.addSyncConflict(Ld.LOCAL_UPDATE_REMOTELY_DELETED,e,i,{id:r},s);continue}let a=this.getRecord(i,c);if(a){if(n)throw new Error(`Remotely created records are being updated locally.\n\t\t\t\t\t${this.getRecordInfo(e,t,i)}\n\t\t\t\t\tThis is not possible if every remote change is only processed once.\n\t\t\t\t\t`);for(const e of i.newValues)a.set(e.columnIndex,e.newValue);continue}let u,f=this.ensureRecord(i,d);for(const t of i.newValues)if(n){const n=t.columnIndex,i=f.get(n);i&&(u||(u=this.addSyncConflict(Ld.REMOTE_UPDATE_LOCALLY_UPDATED,e,{id:i.recordHistoryId},{id:r},s),u.values=[]),u.values.push({columnIndex:n,synchronizationConflict:u}),f.delete(t.columnIndex))}else f.set(t.columnIndex,{newValue:t.newValue,recordHistoryId:i.id})}}processDeletion(e,t,n,i,o,r){const a=this.getRecordsForRepoInTable(e,t,n),s=this.getRecordsForRepoInTable(e,t,i),c=this.getRecordsForRepoInTable(e,t,r),l=this.syncInUtils.ensureRecordMapForRepoInTable(e,t,o);for(const e of t.recordHistory){let t=this.getRecordsForActor(e,a);if(t&&t.get(e.actorRecordId)){t.delete(e.actorRecordId);continue}let n=this.getRecordsForActor(e,s);n&&n.get(e.actorRecordId)&&n.delete(e.actorRecordId),this.getRecordHistoryId(e,c)||Fe(l,e.actor.id).add(e.actorRecordId)}}getRecordsForRepoInTable(e,t,n){const i=n.get(t.entity.applicationVersion.id);let o,r;return i&&(o=i.get(t.entity.id)),o&&(r=o.get(e)),r}getRecord(e,t){let n=this.getRecordsForActor(e,t);return n?n.get(e.actorRecordId):null}hasRecordId(e,t){let n=this.getRecordsForActor(e,t);return!!n&&n.has(e.actorRecordId)}getRecordHistoryId(e,t){let n=this.getRecordsForActor(e,t);return n?n.get(e.actorRecordId):null}getRecordsForActor(e,t){let n;return t&&(n=t.get(e.actor.id)),n}getRecordInfo(e,t,n){return`\n\t\tApplication Version ID: ${t.entity.applicationVersion.id}\n\t\tEntity ID:         ${t.entity.id}\n\t\tRepository ID:     ${e}\n\t\tActor ID:          ${n.actor.id}\n\t\tActor Record ID:   ${n.actorRecordId}\n\t\t`}addSyncConflict(e,t,n,i,o){const r=this.createSynchronizationConflict(e,t,n,i);return Le(o,t).push(r),r}createSynchronizationConflict(e,t,n,i){return{id:null,overwrittenRecordHistory:n,overwritingRecordHistory:i,repository:{id:t},type:e}}ensureColumnValueMap(e,t){return je(je(t,e.actor.id),e.actorRecordId)}ensureRecord(e,t){return je(je(t,e.actor.id),e.actorRecordId)}};au([function(e,t){}],su.prototype,"actorDao",void 0),au([function(e,t){}],su.prototype,"airportDatabase",void 0),au([function(e,t){}],su.prototype,"repositoryTransactionHistoryDao",void 0),au([function(e,t){}],su.prototype,"repositoryTransactionHistoryDuo",void 0),au([function(e,t){}],su.prototype,"sequenceGenerator",void 0),au([function(e,t){}],su.prototype,"syncInUtils",void 0),su=au([function(e){}],su);var cu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let lu=class{async applyChangesToDb(e,t){const n={};await this.performCreates(e.recordCreations,t,n),await this.performUpdates(e.recordUpdates,t,n),await this.performDeletes(e.recordDeletions,t,n)}async performCreates(e,t,n){for(const[i,o]of e)for(const[e,r]of o){const o=t.get(i).index,a=this.airportDatabase.applications[o].currentVersion[0].applicationVersion.entities[e],s=this.airportDatabase.qApplications[o][a.name],c=[s.repository.id,s.actor.id,s.actorRecordId],l=this.getNonIdColumnsInIndexOrder(a);let p=!0,d=0;const u=[];for(const[e,t]of r)for(const[n,i]of t)for(const[t,o]of i){const i=[e,n,t],r=[];for(const[e,t]of o)r.push([e,t]);r.length&&d++,r.sort(((e,t)=>Qi(e[0],t[0])));let a=0;for(const[e,t]of r){let n=l[a];for(;n.index<e;)p&&c.push(s.__driver__.allColumns[n.index]),i.push(null),a++,n=l[a];p&&c.push(s.__driver__.allColumns[e]),i.push(t),a++}r.length&&u.push(i),p=!1}if(d){const e=n.dbEntity;n.dbEntity=s.__driver__.dbEntity;try{await this.databaseFacade.insertValues({insertInto:s,columns:c,values:u},n)}finally{n.dbEntity=e}}}}getNonIdColumnsInIndexOrder(e){const t=[];for(const n of e.columns){switch(n.name){case de.ACTOR_ID:case de.ACTOR_RECORD_ID:case de.REPOSITORY_ID:continue}t.push(n)}return t.sort(((e,t)=>Qi(e.index,t.index))),t}async performUpdates(e,t,n){const i=new Map,o=[];for(const[t,n]of e){const e=je(i,t);for(const[i,r]of n){const n=je(e,i);for(const[e,a]of r)for(const[r,s]of a)for(const[a,c]of s){Fe(je(this.getRecordKeyMap(c,n),e),r).add(a);for(const[n,s]of c)o.push([t,i,e,r,a,n,s.newValue])}}}if(o.length){await this.recordUpdateStageDao.insertValues(o);for(const[e,n]of i){const i=t.get(e);for(const[t,o]of n)await this.runUpdatesForTable(i.index,e,t,o)}await this.recordUpdateStageDao.delete()}}async performDeletes(e,t,n){for(const[i,o]of e){const e=t.get(i);for(const[t,i]of o){const o=this.airportDatabase.applications[e.index].currentVersion[0].applicationVersion.entities[t],r=this.airportDatabase.qApplications[e.index][o.name];let a=0,s=[];for(const[e,t]of i){let n=[];for(const[e,i]of t)a++,n.push(un(r.actorRecordId.in(Array.from(i)),r.actor.id.equals(e)));s.push(un(r.repository.id.equals(e),fn(...n)))}if(a){const e=n.dbEntity;n.dbEntity=r.__driver__.dbEntity;try{await this.databaseFacade.deleteWhere({deleteFrom:r,where:fn(...s)},n)}finally{n.dbEntity=e}}}}}getRecordKeyMap(e,t){const n=[];for(const t of e.keys())n.push(t);let i;n.sort(Qi);let o=t;for(const e of n)i=o.get(e),i||(i={childColumnUpdateKeyMap:new Map,recordKeyMap:new Map,updatedColumns:null},o.set(e,i)),o=i.childColumnUpdateKeyMap;return i.updatedColumns=n,i.recordKeyMap}async runUpdatesForTable(e,t,n,i){for(const o of i.values()){const i=o.updatedColumns;i&&await this.recordUpdateStageDao.updateEntityWhereIds(e,t,n,o.recordKeyMap,i),await this.runUpdatesForTable(e,t,n,o.childColumnUpdateKeyMap)}}};cu([function(e,t){}],lu.prototype,"airportDatabase",void 0),cu([function(e,t){}],lu.prototype,"databaseFacade",void 0),cu([function(e,t){}],lu.prototype,"recordUpdateStageDao",void 0),lu=cu([function(e){}],lu);var pu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let du=class{async receiveMessages(e,t){const n=(new Date).getTime(),i=await this.repositoryTransactionHistoryDao.findWhereUuIdsIn([...e.keys()]);for(const t of i)e.delete(t.uuId);if(!e.size)return;let o=[];const r=this.timeOrderMessages(e);for(const e of r){if(!this.isValidLastChangeTime(n,e.syncTimestamp,"Sync Timestamp"))continue;if(!this.isValidLastChangeTime(e.syncTimestamp,e.history.saveTimestamp,"Sync Timestamp","Save Timestamp"))continue;let i=!0;await this.transactionManager.transactInternal((async n=>{if(!await this.syncInChecker.checkMessage(e))return n.rollback(null,t),void(i=!1)}),t),i&&o.push(e)}await this.transactionManager.transactInternal((async e=>{e.isSync=!0,await this.twoStageSyncedInDataProcessor.syncMessages(o,e)}),t)}timeOrderMessages(e){const t=[...e.values()];return t.sort(((e,t)=>{if(e.syncTimestamp<t.syncTimestamp)return-1;if(e.syncTimestamp>t.syncTimestamp)return 1;let n=e.history,i=t.history;return n.saveTimestamp<i.saveTimestamp?-1:n.saveTimestamp>i.saveTimestamp?1:0})),t}isValidLastChangeTime(e,t,n,i="Reception Time:"){return!(e<t)||(console.error(`Message ${i} is less than\n\t\t\tthe ${n} in received message:\n\t\t\t\t${i}:               ${e}\n\t\t\t\t${n}:           ${t}\n\t\t\t`),!1)}};pu([function(e,t){}],du.prototype,"repositoryTransactionHistoryDao",void 0),pu([function(e,t){}],du.prototype,"syncInChecker",void 0),pu([function(e,t){}],du.prototype,"transactionManager",void 0),pu([function(e,t){}],du.prototype,"twoStageSyncedInDataProcessor",void 0),du=pu([function(e){}],du);var uu,fu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e[e.MESSAGE_APPLICATION_VERSION_IS_LOWER=-1]="MESSAGE_APPLICATION_VERSION_IS_LOWER",e[e.MESSAGE_APPLICATION_VERSION_IS_EQUAL=0]="MESSAGE_APPLICATION_VERSION_IS_EQUAL",e[e.MESSAGE_APPLICATION_VERSION_IS_HIGHER=1]="MESSAGE_APPLICATION_VERSION_IS_HIGHER"}(uu||(uu={}));let yu=class{ensureRecordMapForRepoInTable(e,t,n){return je(je(je(n,t.entity.applicationVersion.id),t.entity.index),e)}};yu=fu([function(e){}],yu);var hu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mu=class{async syncMessages(e,t){this.aggregateHistoryRecords(e,t);const{actorMapById:n,repositoryTransactionHistoryMapByRepositoryId:i,applicationsByApplicationVersionIdMap:o}=await this.getDataStructures(e);await this.updateLocalData(i,n,o)}aggregateHistoryRecords(e,t){const n=t.transactionHistory;n.transactionType=we.REMOTE_SYNC;for(const t of e){const e=t.history;n.repositoryTransactionHistories.push(e),e.repositoryTransactionType=Pr.REMOTE,n.allOperationHistory=n.allOperationHistory.concat(e.operationHistory),e.operationHistory.forEach((e=>{n.allRecordHistory=n.allRecordHistory.concat(e.recordHistory),e.recordHistory.forEach((e=>{e.newValues&&e.newValues.length&&(n.allRecordHistoryNewValues=n.allRecordHistoryNewValues.concat(e.newValues)),e.oldValues&&e.oldValues.length&&(n.allRecordHistoryOldValues=n.allRecordHistoryOldValues.concat(e.oldValues))}))}))}}async getDataStructures(e){const t=new Map,n=new Map,i=new Map,o=[];for(const r of e){o.push(r.history),t.set(r.history.repository.id,o);for(const e of r.actors)i.set(e.id,e);for(const e of r.applicationVersions)n.set(e.id,e.application)}for(const[e,n]of t)this.repositoryTransactionHistoryDuo.sortRepoTransHistories(n,i);return{actorMapById:i,repositoryTransactionHistoryMapByRepositoryId:t,applicationsByApplicationVersionIdMap:n}}async updateLocalData(e,t,n){const i=await this.stage1SyncedInDataProcessor.performStage1DataProcessing(e,t);let o=[],r=[];for(const[e,t]of i.syncConflictMapByRepoId){o=o.concat(t);for(const e of t)e.values.length&&(r=r.concat(e.values))}await this.stage2SyncedInDataProcessor.applyChangesToDb(i,n),o.length&&await this.synchronizationConflictDao.insert(o),r.length&&await this.synchronizationConflictValuesDao.insert(r)}};hu([function(e,t){}],mu.prototype,"repositoryTransactionHistoryDuo",void 0),hu([function(e,t){}],mu.prototype,"stage1SyncedInDataProcessor",void 0),hu([function(e,t){}],mu.prototype,"stage2SyncedInDataProcessor",void 0),hu([function(e,t){}],mu.prototype,"synchronizationConflictDao",void 0),hu([function(e,t){}],mu.prototype,"synchronizationConflictValuesDao",void 0),mu=hu([function(e){}],mu);var Ru=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};const Iu={},Eu={},gu={};let Ou=class{async serialize(e){let t=[];const n=[];for(const i of e){if(i.repositoryTransactionType!==Pr.LOCAL)continue;const e=await this.serializeMessage(i);t.push(i),n.push(e)}return{historiesToSend:t,messages:n}}async serializeMessage(e){const t={actorInMessageIndexesById:new Map,applicationVersionInMessageIndexesById:new Map,applicationVersions:[],lastInMessageActorIndex:-1,lastInMessageApplicationVersionIndex:-1,lastInMessageRepositoryIndex:-1,messageRepository:e.repository,repositoryInMessageIndexesById:new Map},n={inMessageIndexesById:new Map,lastInMessageIndex:-1},i={actors:[],applicationVersions:[],applications:[],history:null,referencedRepositories:[],users:[],terminals:[]};i.history=this.serializeRepositoryTransactionHistory(e,i,t,n),await this.serializeRepositories(e,i,t,n);const o=await this.serializeActorsUsersAndTerminals(i,t,n);return await this.serializeApplicationsAndVersions(i,o,t),i}async serializeActorsUsersAndTerminals(e,t,n){let i=[];for(let e of t.actorInMessageIndexesById.keys())i.push(e);const o=await this.actorDao.findWithDetailsAndGlobalIdsByIds(i);this.serializeUsers(o,e,n);const r=this.serializeTerminals(o,e,n),a={lastInMessageIndex:-1,inMessageIndexesById:new Map};for(const i of o){const o=this.serializeApplication(i.application,a,e),s=t.actorInMessageIndexesById.get(i.id);e.actors[s]={...Iu,application:o,terminal:r.get(i.terminal.id),user:n.inMessageIndexesById.get(i.user.id),uuId:i.uuId}}return a}serializeTerminals(e,t,n){let i=-1;const o=new Map;for(const r of e){let e=r.terminal;if(o.has(e.id))continue;const a=++i;o.set(e.id,a),t.terminals[a]={...Iu,uuId:e.uuId,owner:n.inMessageIndexesById.get(e.owner.id)}}return o}serializeUsers(e,t,n){for(const i of e)this.addUserToMessage(i.user,t,n),this.addUserToMessage(i.terminal.owner,t,n)}addUserToMessage(e,t,n){let i=this.getUserInMessageIndex(e,n);return t.users[i]={...Iu,username:e.username,uuId:e.uuId},i}getUserInMessageIndex(e,t){if(t.inMessageIndexesById.has(e.id))return t.inMessageIndexesById.get(e.id);let n=++t.lastInMessageIndex;return t.inMessageIndexesById.set(e.id,n),n}async serializeRepositories(e,t,n,i){let o=[];for(let e of n.repositoryInMessageIndexesById.keys())o.push(e);o.push(e.id);const r=await this.repositoryDao.findByIds(o);for(const e of r){let o=this.getUserInMessageIndex(e.owner,i);if(n.repositoryInMessageIndexesById.has(e.id)){const i=n.repositoryInMessageIndexesById.get(e.id);t.referencedRepositories[i]=this.serializeRepository(e,o)}else t.history.repository.owner=o,t.history.repository.id=e.id}}serializeApplicationsAndVersions(e,t,n){for(let i=0;i<n.applicationVersions.length;i++){const o=n.applicationVersions[i],r=this.serializeApplication(o.application,t,e);e.applicationVersions[i]={...Iu,application:r,integerVersion:o.integerVersion}}}serializeApplication(e,t,n){let i;return t.inMessageIndexesById.has(e.index)?i=t.inMessageIndexesById.get(e.index):(i=++t.lastInMessageIndex,t.inMessageIndexesById.set(e.index,i),n.applications[i]={...gu,domain:{...Iu,name:e.domain.name},name:e.name}),i}serializeRepositoryTransactionHistory(e,t,n,i){e.operationHistory.sort(((e,t)=>e.orderNumber<t.orderNumber?-1:e.orderNumber>t.orderNumber?1:0));const o=[];for(const t of e.operationHistory)o.push(this.serializeOperationHistory(t,n));return{...Iu,isRepositoryCreation:e.isRepositoryCreation,repository:this.serializeHistoryRepository(e,t,i),operationHistory:o,saveTimestamp:e.saveTimestamp,uuId:e.uuId}}serializeHistoryRepository(e,t,n){if(e.isRepositoryCreation){const i=e.repository;let o=this.addUserToMessage(i.owner,t,n);return this.serializeRepository(i,o)}return e.repository.uuId}serializeOperationHistory(e,t){const n=e.entity,i=[];for(const o of e.recordHistory)i.push(this.serializeRecordHistory(e,o,n,t));const o=e.entity.applicationVersion;let r;return t.applicationVersionInMessageIndexesById.has(o.id)?r=t.applicationVersionInMessageIndexesById.get(o.id):(r=++t.lastInMessageApplicationVersionIndex,t.applicationVersionInMessageIndexesById.set(o.id,r)),t.applicationVersions[r]=o,{...Iu,actor:this.getActorInMessageIndex(e.actor,t),changeType:e.changeType,entity:{...Iu,applicationVersion:r,index:e.entity.index},recordHistory:i}}serializeRecordHistory(e,t,n,i){const o=new Map;for(const e of n.columns)o.set(e.index,e);const r=[];for(const e of t.newValues){const t=o.get(e.columnIndex);r.push(this.serializeNewValue(e,t,i))}const a=[];for(const e of t.oldValues){const t=o.get(e.columnIndex);a.push(this.serializeOldValue(e,t,i))}const s=t.actor,c={...Iu};return s.id!==e.actor.id&&(c.actor=this.getActorInMessageIndex(s,i)),r.length&&(c.newValues=r),a.length&&(c.oldValues=a),{...c,actorRecordId:t.actorRecordId}}getActorInMessageIndex(e,t){return e?this.getActorInMessageIndexById(e.id,t):null}getActorInMessageIndexById(e,t){let n;return t.actorInMessageIndexesById.has(e)?n=t.actorInMessageIndexesById.get(e):(n=++t.lastInMessageActorIndex,t.actorInMessageIndexesById.set(e,n)),n}serializeNewValue(e,t,n){return this.serializeValue(e,t,n,"newValue")}serializeOldValue(e,t,n){return this.serializeValue(e,t,n,"oldValue")}serializeValue(e,t,n,i){let o=e[i],r=o;switch(t.name){case de.ORIGINAL_ACTOR_ID:r=this.getActorInMessageIndexById(o,n);break;case de.ORIGINAL_REPOSITORY_ID:r=this.getSerializedRepositoryId(o,n)}return/.*_AID_[\d]+$/.test(t.name)&&t.manyRelationColumns.length&&(r=this.getActorInMessageIndexById(o,n)),/.*_RID_[\d]+$/.test(t.name)&&t.manyRelationColumns.length&&(r=this.getSerializedRepositoryId(o,n)),{...Eu,columnIndex:e.columnIndex,[i]:r}}getSerializedRepositoryId(e,t){if(e===t.messageRepository.id)return-1;let n=t.repositoryInMessageIndexesById.get(e);return void 0===n&&(t.lastInMessageRepositoryIndex++,n=t.lastInMessageRepositoryIndex,t.repositoryInMessageIndexesById.set(e,n)),n}serializeRepository(e,t){return{...Iu,ageSuitability:e.ageSuitability,createdAt:e.createdAt,immutable:e.immutable,owner:t,source:e.source,uuId:e.uuId}}};Ru([function(e,t){}],Ou.prototype,"actorDao",void 0),Ru([function(e,t){}],Ou.prototype,"repositoryDao",void 0),Ou=Ru([function(e){}],Ou);var Tu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wu=class{async synchronizeOut(e){await this.loadHistoryRepositories(e);const{historiesToSend:t,messages:n}=await this.syncOutDataSerializer.serialize(e),i=this.groupMessagesBySourceAndRepository(n,t);for(const[e,t]of i){const n=await this.synchronizationAdapterLoader.load(e);await n.sendTransactions(e,t)}await this.updateRepositoryTransactionHistories(n,t)}async loadHistoryRepositories(e){const t=new Set,n=new Map;for(const n of e)t.add(n.repository.id);if(!t.size)return;const i=await this.repositoryDao.findByIds([...t.values()]);for(const e of i)n.set(e.id,e);for(const t of e)t.repository=n.get(t.repository.id)}async ensureGlobalRepositoryIdentifiers(e,t){const n=new Set,i=new Map;for(const t of e){const e=t.repository;e.source&&e.uuId?i.set(e.id,e):n.add(e.id)}if(!n.size)return;const o=await this.repositoryDao.findByIds([...n.values()]);for(const e of o)i.set(e.id,e);for(const e of t){const t=e.history.repository;if(!t.source||!t.uuId){const e=i.get(t.id);t.source=e.source,t.uuId=e.uuId,delete t.id}}}groupMessagesBySourceAndRepository(e,t){const n=new Map;for(let i=0;i<e.length;i++){const o=t[i].repository;Le(je(n,o.source),o.uuId).push(e[i])}return n}async updateRepositoryTransactionHistories(e,t){for(let n=0;n<e.length;n++){const i=e[n],o=t[n];i.syncTimestamp&&(o.syncTimestamp=i.syncTimestamp,await this.repositoryTransactionHistoryDao.updateSyncTimestamp(o))}}};Tu([function(e,t){}],wu.prototype,"repositoryDao",void 0),Tu([function(e,t){}],wu.prototype,"repositoryTransactionHistoryDao",void 0),Tu([function(e,t){}],wu.prototype,"synchronizationAdapterLoader",void 0),Tu([function(e,t){}],wu.prototype,"syncOutDataSerializer",void 0),wu=Tu([function(e){}],wu);var bu=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Nu=class{constructor(){this.serverLocationProtocol="http://"}async getRepositoryTransactions(e,t,n=null){try{const i=await this.sendMessage(e+"/read",{repositoryUuId:t,syncTimestamp:n});return i.error?(console.error(i.error),[]):i.fragments}catch(e){return console.error(e),[]}}async sendRepositoryTransactions(e,t,n){try{const i=await this.sendMessage(e+"/write",{messages:n,repositoryUuId:t});return i.error?(console.error(i.error),0):i.syncTimestamp}catch(e){return console.error(e),0}}async sendMessage(e,t){let n=JSON.stringify(t);return(await fetch(this.serverLocationProtocol+e,{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json"},body:n})).json()}};Nu=bu([function(e){}],Nu);const _u=V("nonhub-client").token({class:Nu,interface:"INonhubClient",token:"INonhubClient"}),xu=V("ground-transport"),Au=xu.token({class:su,interface:"IStage1SyncedInDataProcessor",token:"STAGE1_SYNCED_IN_DATA_PROCESSOR"}),vu=xu.token({class:lu,interface:"IStage2SyncedInDataProcessor",token:"STAGE2_SYNCED_IN_DATA_PROCESSOR"}),Su=xu.token({class:Ed,interface:"ISyncInActorChecker",token:"SYNC_IN_ACTOR_CHECKER"}),Cu=xu.token({class:Nd,interface:"ISyncInChecker",token:"SYNC_IN_CHECKER"}),Du=xu.token({class:xd,interface:"ISyncInDataChecker",token:"SYNC_IN_DATA_CHECKER"}),Mu=xu.token({class:Cd,interface:"ISyncInTerminalChecker",token:"SYNC_IN_TERMINAL_CHECKER"}),Vu=xu.token({class:vd,interface:"ISyncInRepositoryChecker",token:"SYNC_IN_REPOSITORY_CHECKER"}),Pu=xu.token({class:Od,interface:"ISyncInApplicationChecker",token:"SYNC_IN_APPLICATION_CHECKER"}),Lu=xu.token({class:wd,interface:"ISyncInApplicationVersionChecker",token:"SYNC_IN_APPLICATION_VERSION_CHECKER"}),Uu=xu.token({class:Md,interface:"ISyncInUserChecker",token:"SYNC_IN_USER_CHECKER"}),ju=xu.token({class:yu,interface:"ISyncInUtils",token:"SYNC_IN_UTILS"}),Fu=xu.token({class:du,interface:"ISynchronizationInManager",token:"SYNCHRONIZATION_IN_MANAGER"}),ku=xu.token({class:wu,interface:"ISynchronizationOutManager",token:"SYNCHRONIZATION_OUT_MANAGER"}),Bu=xu.token({class:Ou,interface:"ISyncOutDataSerializer",token:"SYNC_OUT_DATA_SERIALIZER"}),Hu=xu.token({class:mu,interface:"ITwoStageSyncedInDataProcessor",token:"TWO_STAGE_SYNCED_IN_DATA_PROCESSOR"}),$u=xu.token({class:hd,interface:"ISynchronizationAdapter",token:"DEBUG_SYNCHRONIZATION_ADAPTER"}),Gu=xu.token({class:Rd,interface:"ISynchronizationAdapterLoader",token:"SYNCHRONIZATION_ADAPTER_LOADER"});$u.setDependencies({nonhubClient:_u}),Au.setDependencies({actorDao:os,airportDatabase:Ro,repositoryTransactionHistoryDao:ps,repositoryTransactionHistoryDuo:ds,sequenceGenerator:ar,syncInUtils:ju}),vu.setDependencies({airportDatabase:Ro,databaseFacade:Eo,recordUpdateStageDao:iu}),Su.setDependencies({actorDao:os}),Pu.setDependencies({applicationDao:up,domainDao:pp}),Lu.setDependencies({applicationVersionDao:Ep}),Cu.setDependencies({syncInActorChecker:Su,syncInApplicationChecker:Pu,syncInApplicationVersionChecker:Lu,syncInDataChecker:Du,syncInRepositoryChecker:Vu,syncInTerminalChecker:Mu,syncInUserChecker:Uu}),Du.setDependencies({airportDatabase:Ro,sequenceGenerator:ar,terminalStore:dr}),Vu.setDependencies({repositoryDao:ls}),Mu.setDependencies({terminalDao:zs}),Uu.setDependencies({userDao:Ks}),Bu.setDependencies({repositoryDao:ls}),Gu.setDependencies({debugSynchronizationAdapter:$u}),Fu.setDependencies({repositoryTransactionHistoryDao:ps,syncInChecker:Cu,transactionManager:ur,twoStageSyncedInDataProcessor:Hu}),ku.setDependencies({repositoryDao:ls,repositoryTransactionHistoryDao:ps,synchronizationAdapterLoader:Gu,syncOutDataSerializer:Bu}),Hu.setDependencies({repositoryTransactionHistoryDuo:ds,stage1SyncedInDataProcessor:Au,stage2SyncedInDataProcessor:vu,synchronizationConflictDao:ou,synchronizationConflictValuesDao:ru});const qu=V("terminal");er.setClass(zc),Do.setClass(mr),Ge.setClass(tc),Ge.setDependencies({terminalStore:dr,transactionalServer:yr}),yr.setClass(yc),ur.setClass(Sc),$e.setClass(kc),ir.setClass(Yc),or.setClass(Jc);const Yu=qu.token({class:mc,interface:"class AbstractMutationManager",token:"ABSTRACT_MUTATION_MANAGER"}),Qu=qu.token({class:uc,interface:"class TransactionalReceiver",token:"ABSTRACT_TRANSACTIONAL_RECIEVER"}),Ju=qu.token({class:Vc,interface:"ICascadeGraphVerifier",token:"CASCADE_GRAPH_VERIFIER"}),Wu=qu.token({class:gc,interface:"IDatabaseManager",token:"DATABASE_MANAGER"}),zu=qu.token({class:Tc,interface:"IDeleteManager",token:"DELETE_MANAGER"}),Ku=qu.token({class:Lc,interface:"IDependencyGraphResolver",token:"DEPENDENCY_GRAPH_RESOLVER"}),Xu=qu.token({class:jc,interface:"IEntityGraphReconstructor",token:"ENTITY_GRAPH_RECONSTRUCTOR"}),Zu=qu.token({class:bc,interface:"IHistoryManager",token:"HISTORY_MANAGER"}),ef=qu.token({class:_c,interface:"IInsertManager",token:"INSERT_MANAGER"}),tf=qu.token({class:Zs,interface:"IInternalRecordManager",token:"INTERNAL_RECORD_MANAGER"}),nf=qu.token({class:ic,interface:"IOnlineManager",token:"ONLINE_MANAGER"}),of=qu.token({class:Hc,interface:"IOperationManager",token:"OPERATION_MANAGER"}),rf=qu.token({class:Ac,interface:"IQueryManager",token:"QUERY_MANAGER"}),af=qu.token({class:_r,interface:"IRepositoryManager",token:"REPOSITORY_MANAGER"}),sf=qu.token({class:Gc,interface:"IStructuralEntityValidator",token:"STRUCTURAL_ENTITY_VALIDATOR"}),cf=qu.token({class:Dc,interface:"IUpdateManager",token:"UPDATE_MANAGER"});Yu.setDependencies({applicationUtils:Io,fieldUtils:To,queryUtils:So,relationManager:Co}),Qu.setDependencies({terminalStore:dr,transactionalServer:yr}),Wu.setDependencies({applicationDao:up,applicationInitializer:cr,internalRecordManager:tf,storeDriver:pr,transactionalServer:yr}),zu.setDependencies({airportDatabase:Ro,applicationUtils:Io,historyManager:Zu,operationHistoryDuo:rs,recordHistoryDuo:as,repositoryTransactionHistoryDuo:ds,sequenceGenerator:ar}),Ku.setDependencies({entityStateManager:He}),Xu.setDependencies({entityStateManager:He}),Zu.setDependencies({transactionHistoryDuo:us}),ef.setDependencies({airportDatabase:Ro,historyManager:Zu,operationHistoryDuo:rs,recordHistoryDuo:as,repositoryTransactionHistoryDuo:ds}),tf.setDependencies({actorDao:os,applicationDao:up,domainDao:pp,entityStateManager:He,terminalStore:dr,transactionManager:ur}),nf.setDependencies({repositoryDao:ls,repositoryManager:af,repositoryTransactionHistoryDao:ps,transactionManager:ur}),of.setDependencies({airportDatabase:Ro,applicationUtils:Io,cascadeGraphVerifier:Ju,deleteManager:zu,dependencyGraphResolver:Ku,entityGraphReconstructor:Xu,entityStateManager:He,insertManager:ef,qMetadataUtils:Ao,queryFacade:vo,structuralEntityValidator:sf,updateManager:cf}),rf.setDependencies({repositoryLoader:Do,storeDriver:pr}),Do.setDependencies({repositoryDao:ls,synchronizationAdapterLoader:Gu,synchronizationInManager:Fu}),af.setDependencies({repositoryDao:ls}),sf.setDependencies({applicationUtils:Io,entityStateManager:He,repositoryManager:af}),ur.setDependencies({activeQueries:ad,idGenerator:cd,synchronizationOutManager:ku,transactionHistoryDuo:us}),fr.setDependencies({databaseManager:Wu,internalRecordManager:tf}),yr.setDependencies({deleteManager:zu,insertManager:ef,operationContextLoader:$e,operationManager:of,queryManager:rf,repositoryManager:af,updateManager:cf}),cf.setDependencies({airportDatabase:Ro,applicationUtils:Io,fieldUtils:To,historyManager:Zu,operationHistoryDuo:rs,queryFacade:vo,queryUtils:So,recordHistoryDuo:as,relationManager:Co,repositoryTransactionHistoryDuo:ds,sequenceGenerator:ar}),k.isFramework=!0;var lf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let pf=class{initialize(e){this.applicationApi=e}async findApiObjectAndOperation(e,t,n,i){const o=this.applicationApi.apiObjectMap[n];if(!o)throw new Error(`Could not find API object for\n        Domain:\n            ${e}\n        Application:\n            ${t}\n        Token:\n            ${n}`);const r=o.operationMap[i];if(!r)throw new Error(`Could not find API object method for \n        Domain:\n            ${e}\n        Application:\n            ${t}\n        Token:\n            ${n}\n        Method name:\n            ${i}`);return{apiObject:await B(this).getByNames(e,t,n),apiOperation:r}}};pf=lf([function(e){}],pf);var df=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let uf=class{validate(e,t){}};uf=df([function(e){}],uf);var ff=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let yf=class{async handleRequest(e){let t,n;try{const{apiObject:n,apiOperation:i}=await this.apiRegistry.findApiObjectAndOperation(e.domain,e.application,e.objectName,e.methodName),o=n[e.methodName].apply(n,e.args);t=i.isAsync?await o:o}catch(e){n=e.message,console.error(e)}return{application:e.application,category:"ToClient",domain:e.domain,errorMessage:n,id:e.id,methodName:e.methodName,objectName:e.objectName,protocol:e.protocol,payload:t}}};ff([function(e,t){}],yf.prototype,"apiRegistry",void 0),yf=ff([function(e){}],yf);var hf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let mf=class{deserialize(e,t,n,i){const o={lookupTable:[]};let r;return r=e instanceof Array?e.map((e=>this.doDeserialize(e,t,o,n,i))):this.doDeserialize(e,t,o,n,i),r}doDeserialize(e,t,n,i,o){let r=i.getEntityState(e),a=i.getOperationUniqueId(e);if(!a||"number"!=typeof a||a<1||a%1==0)throw new Error(`Invalid or missing ${i.getUniqueIdFieldName()} field.`);let s=n.lookupTable[a];switch(r){case Ee.STUB:{let e=n.lookupTable[a];if(!e)throw new Error(`Could not find an already present entity for\n\t\t\t\t\t${i.getUniqueIdFieldName()} of ${a}`);return e}default:if(s)throw new Error(`Entity appears more than once for\n\t\t\t\t\t${i.getUniqueIdFieldName()} of ${a}`)}let c={};n.lookupTable[a]=c,c[i.getStateFieldName()]=r;for(const r of t.properties){let a,s=e[r.name];if(!o.isEmpty(s)){if(r.relation){const e=r.relation[0];switch(e.relationType){case fe.ONE_TO_MANY:if(!(s instanceof Array))throw new Error("Expecting @OneToMany for an array entity relation");a=s.map((t=>this.doDeserialize(t,e.entity,n,i,o)));break;case fe.MANY_TO_ONE:if(!(s instanceof Object)||s instanceof Array)throw new Error("Expecting @ManyToOne for a non-array entity relation");a=this.doDeserialize(s,e.entity,n,i,o);break;default:throw new Error(`Unknown relation type: ${e.relationType}`)}}else{switch(r.propertyColumns[0].column.type){case Ie.JSON:throw new Error("Json properties cannot be deserialized");case Ie.DATE:if(!(s instanceof Object&&s[i.getStateFieldName()]===Ee.DATE&&s.value))throw new Error(`Invalid Serialized Date format for ${t.name}.${r.name}`);try{a=new Date(s)}catch(e){throw new Error(`Invalid Serialized Date format for ${t.name}.${r.name}`)}break;case Ie.ANY:case Ie.BOOLEAN:case Ie.NUMBER:case Ie.STRING:a=s;break;default:throw new Error(`Unexpected data type for ${t.name}.${r.name}`)}}c[r.name]=a}}return c}cleanJsonObject(e,t,n){let i;if(e instanceof Object)if(e instanceof Array)i=e.map((e=>this.cleanJsonObject(e,t,n)));else{if(i={},e[n.getStateFieldName()]===Ee.STUB)throw new Error(`Interlinked object graphs are not supported in @Json() columns \n                    ${t.entity.name}.${t.name}`);delete e[n.getStateFieldName()],delete e[n.getUniqueIdFieldName()];for(const o in e){const r=e[o];i[o]=this.cleanJsonObject(r,t,n)}}else i=e;return i}};mf=hf([function(e){}],mf);var Rf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let If=class{copyEntityForProcessing(e,t,n,i){const o={processedEntityMap:new Map,sequence:i.lastOUID?i.lastOUID:0},r=this.doCopyEntityForProcessing(e,t,n,o);return i.lastOUID=o.sequence,r}doCopyEntityForProcessing(e,t,n,i){if(e instanceof Array)return e.map((e=>this.doCopyEntityForProcessing(e,t,n,i)));{let o={};if(i.processedEntityMap.has(e))return i.processedEntityMap.get(e);i.processedEntityMap.set(e,o);const r=++i.sequence;o[n.getUniqueIdFieldName()]=r,e[n.getUniqueIdFieldName()]=r,n.setOriginalValues(n.getOriginalValues(e),o);for(let r of t.properties){const t=e[r.name];r.relation&&r.relation.length&&t?o[r.name]=this.doCopyEntityForProcessing(t,r.relation[0].relationEntity,n,i):o[r.name]=t}return o[n.getStateFieldName()]=e[n.getStateFieldName()],o}}};If=Rf([function(e){}],If);var Ef=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let gf=class{saveOriginalValues(e,t){if(e instanceof Array){for(let n=0;n<e.length;n++)this.saveOriginalValues(e[n],t);return}if(!e)return;const n={};this.entityStateManager.setOriginalValues(n,e);for(let i of t.properties){const t=e[i.name];if(i.relation&&i.relation.length){if(!t)continue;i.relation[0].relationType===fe.MANY_TO_ONE&&this.applicationUtils.forEachColumnTypeOfRelation(i.relation[0],((t,i)=>{for(let t of i){let i=e,o=n;for(let e=0;e<t.length;e++){const n=t[e];if(i instanceof Object){let r;i=i[n],r=e===t.length-1?i:{},o[n]=r,o=o[n]}else o[n]=i}}})),this.saveOriginalValues(t,i.relation[0].relationEntity)}else n[i.name]=e[i.name]}}setOperationState(e,t,n){if(e instanceof Array){for(var i=0;i<e.length;i++)this.setOperationState(e[i],t,n);return}if(n.has(e))return;n.add(e);const o=this.entityStateManager.getOriginalValues(e);let r=e[this.entityStateManager.getStateFieldName()],a=!0,s=!1;for(const n of t.properties)if(n.isId){for(const e of n.propertyColumns)e.column.isGenerated&&(s=!0);n.relation&&n.relation.length?this.applicationUtils.forEachColumnTypeOfRelation(n.relation[0],((t,n)=>{for(let t of n){let n=e;for(let e=0;e<t.length;e++){const i=t[e];n&&(n=n[i])}if(!n){if(r===Ee.DELETE)throw new Error(`Entity is marked for deletion but does not have an @Id() property:\n            ${t.join(".")}\n                                    `);return r=Ee.CREATE,a=!1,!0}}})):e[n.name]||0===e[n.name]||(a=!1)}if(o)for(const n of t.properties){const t=e[n.name];if(n.relation&&n.relation.length){if(!t)continue;const i=n.relation[0];this.entityStateManager.getOriginalValues(t),this.applicationUtils.forEachColumnTypeOfRelation(i,((n,i)=>{const o=this.entityStateManager.getOriginalValues(t);for(const t of i){let n=e,i=o;for(let e=0;e<t.length;e++){const o=t[e];n=n[o],0!==e&&(i=i[o]);let a=null==i;if(null==n){if(i)return r=Ee.UPDATE,!0;break}if(a){if(n)return r=Ee.UPDATE,!0;break}if("object"==typeof n){if("object"!=typeof i)return r=Ee.UPDATE,!0}else{if("object"==typeof i)return r=Ee.UPDATE,!0;if(n!==i)return r=Ee.UPDATE,!0}}}}))}else{if(r)continue;let e,i=o[n.name];switch(n.propertyColumns[0].column.type){case Ie.DATE:i&&(i=i.getTime()),t&&(e=t.getTime());break;case Ie.JSON:i&&(i=JSON.stringify(i)),t&&(e=JSON.stringify(t));break;default:e=t}e!==i&&(r=Ee.UPDATE)}}for(const i of t.properties){const t=e[i.name];t&&i.relation&&i.relation.length&&this.setOperationState(t,i.relation[0].relationEntity,n)}r||(r=a&&s||o?Ee.PASS_THROUGH:Ee.CREATE),e[this.entityStateManager.getStateFieldName()]=r}afterSaveModifications(e,t,n,i){this.updateOriginalValuesAfterSave(e,t,n,new Set),this.removeDeletedEntities(e,t,n,i)}updateOriginalValuesAfterSave(e,t,n,i){if(e instanceof Array)for(let o=0;o<e.length;o++)this.updateOriginalValuesAfterSave(e[o],t,n,i);else{if(i.has(e))return;i.add(e);let o=this.entityStateManager.getOperationUniqueId(e,!1,t),r={};o&&(r=this.doUpdateOriginalValuesAfterSave(e,t,n,i,o)),this.entityStateManager.setOriginalValues(r,e)}}doUpdateOriginalValuesAfterSave(e,t,n,i,o){let r=n.created[o];if(r){if(!0!==r){for(const t in r)e[t]=r[t];if(t.isRepositoryEntity){let t=e;t.repository&&t.repository.id||(t.repository=n.newRepository),t.actor=n.actor}}}else if(n.deleted[o])return this.entityStateManager.setIsDeleted(!0,e),void this.entityStateManager.setOriginalValues(null,e);let a={};for(const o of t.properties){const t=e[o.name];t&&o.relation&&o.relation.length?(o.relation[0].relationType===fe.MANY_TO_ONE&&this.applicationUtils.forEachColumnTypeOfRelation(o.relation[0],((t,n)=>{for(let t of n){let n=e,i=a;for(let e=0;e<t.length;e++){const o=t[e];if(n instanceof Object){let r;n=n[o],r=e===t.length-1?n:{},i[o]=r,i=i[o]}else i[o]=n}}})),this.updateOriginalValuesAfterSave(t,o.relation[0].relationEntity,n,i)):a[o.name]=t}return a}removeDeletedEntities(e,t,n,i){if(e instanceof Array){for(let o=e.length-1;o>=0;o--)this.removeDeletedEntities(e[o],t,n,i)&&e.splice(o,1);return!e.length}if(i.has(e))return this.entityStateManager.isDeleted(e);i.add(e);for(const o of t.relations){const t=o.property,r=e[t.name];if(r)switch(o.relationType){case fe.MANY_TO_ONE:this.removeDeletedEntities(r,o.relationEntity,n,i)&&(e[t.name]=null);break;case fe.ONE_TO_MANY:this.removeDeletedEntities(r,o.relationEntity,n,i)}}return this.entityStateManager.isDeleted(e)}};Ef([function(e,t){}],gf.prototype,"entityStateManager",void 0),Ef([function(e,t){}],gf.prototype,"applicationUtils",void 0),gf=Ef([function(e){}],gf);var Of,Tf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wf=Of=class{isStub(e){return this.getEntityState(e)===Ee.STUB}isParentId(e){return this.getEntityState(e)===Ee.PARENT_ID}markForDeletion(e){e[Of.STATE_FIELD]=Ee.DELETE}markToCreate(e){e[Of.STATE_FIELD]=Ee.CREATE}markToUpdate(e){e[Of.STATE_FIELD]=Ee.UPDATE}getEntityState(e){return e[Of.STATE_FIELD]}getOriginalValues(e){return e[Of.ORIGINAL_VALUES_PROPERTY]}setOriginalValues(e,t){t[Of.ORIGINAL_VALUES_PROPERTY]=e}copyEntityState(e,t){t[Of.STATE_FIELD]=e[Of.STATE_FIELD],t[Of.ORIGINAL_VALUES_PROPERTY]=e[Of.ORIGINAL_VALUES_PROPERTY]}getStateFieldName(){return Of.STATE_FIELD}getEntityStateTypeAsFlags(e,t){let n,i,o,r,a,s,c;const l=this.getEntityState(e);switch(l){case Ee.CREATE:n=!0;break;case Ee.DELETE:i=!0;break;case Ee.PARENT_ID:o=!0;break;case Ee.PASS_THROUGH:r=!0;break;case Ee.DATE:a=!0;break;case Ee.STUB:s=!0;break;case Ee.UPDATE:c=!0;break;default:throw new Error(`Unexpected entity state\n"${this.getStateFieldName()}" for ${t.name}: ${l}`)}return{isCreate:n,isDelete:i,isParentId:o,isPassThrough:r,isResultDate:a,isStub:s,isUpdate:c}}setIsDeleted(e,t){t[Of.STATE_FIELD]=Ee.DELETE}isDeleted(e){return e[Of.STATE_FIELD]===Ee.DELETE}getOperationUniqueId(e,t=!0,n=null){const i=e[Of.OPERATION_UNIQUE_ID_FIELD];if((!i||"number"!=typeof i||i<1)&&t){let t;throw t=n?n.applicationVersion.application.name+"."+n.name:JSON.stringify(e),new Error(`Could not find "${Of.OPERATION_UNIQUE_ID_FIELD}" property on DTO:\n        \n        ${t}`)}return i}copyOperationUniqueId(e,t){const n=e[Of.OPERATION_UNIQUE_ID_FIELD];t[Of.OPERATION_UNIQUE_ID_FIELD]=n}markAsStub(e){e[Of.STATE_FIELD]=Ee.STUB}getUniqueIdFieldName(){return Of.OPERATION_UNIQUE_ID_FIELD}};wf.DELETED_PROPERTY="__deleted__",wf.ORIGINAL_VALUES_PROPERTY="__originalValues__",wf.STATE_FIELD="__state__",wf.OPERATION_UNIQUE_ID_FIELD="__OUID__",wf=Of=Tf([function(e){}],wf);var bf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Nf=class{async addRepository(e){return await this.transactionalConnector.addRepository(e)}async insertColumnValues(e,t){if(!e)return 0;e instanceof Function&&(e=e());const n=new Bi(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValues(o,t)}async insertValues(e,t){if(!e)return 0;e instanceof Function&&(e=e());const n=new Hi(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValues(o,t)}async insertColumnValuesGenerateIds(e,t){if(!e)return[];e instanceof Function&&(e=e());const n=new Bi(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValuesGetIds(o,t)}async insertValuesGenerateIds(e,t){if(!e)return[];e instanceof Function&&(e=e());const n=new Hi(e),i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.insertValuesGetIds(o,t)}async deleteWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new Fi(e);const i=await this.ensureQueryContext(t);let o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.deleteWhere(o,t)}async save(e,t){if(!e)return null;const n=await this.preSaveOperations(e,t),i=await this.transactionalConnector.save(n,t);return this.updateCacheManager.afterSaveModifications(e,t.dbEntity,i,new Set),i}async saveToDestination(e,t,n){if(!t)return null;const i=await this.preSaveOperations(t,n),o=await this.transactionalConnector.saveToDestination(e,i,n);return this.updateCacheManager.afterSaveModifications(t,n.dbEntity,o,new Set),o}async preSaveOperations(e,t){if(!e)return null;const n=t.dbEntity,i=this.entityCopier.copyEntityForProcessing(e,n,this.entityStateManager,t);return this.updateCacheManager.setOperationState(i,n,new Set),i}async updateColumnsWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new $i(e);const i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.updateValues(o,t)}async updateWhere(e,t){if(!e)return 0;e instanceof Function&&(e=e());let n=new Gi(e);const i=await this.ensureQueryContext(t),o=this.queryFacade.getPortableQuery(n,null,i);return await this.transactionalConnector.updateValues(o,t)}prepare(e){return new _f(e)}async ensureQueryContext(e){return e}};bf([function(e,t){}],Nf.prototype,"entityCopier",void 0),bf([function(e,t){}],Nf.prototype,"entityStateManager",void 0),bf([function(e,t){}],Nf.prototype,"queryFacade",void 0),bf([function(e,t){}],Nf.prototype,"transactionalConnector",void 0),bf([function(e,t){}],Nf.prototype,"updateCacheManager",void 0),Nf=bf([function(e){}],Nf);class _f{constructor(e){throw new Error("Not Implemented")}find(...e){}}var xf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Af=class{async find(e,t,n){await this.ensureContext(n);return await this.transactionalConnector.find(this.getPortableQuery(e,t,n),n)}async findOne(e,t,n){await this.ensureContext(n);return await this.transactionalConnector.findOne(this.getPortableQuery(e,t,n),n)}getPortableQuery(e,t,n){return{jsonQuery:e.toJSON(this.queryUtils,this.fieldUtils,this.relationManager),parameterMap:e.getParameters(),queryResultType:t,applicationIndex:n.dbEntity.applicationVersion.application.index,tableIndex:n.dbEntity.index}}async search(e,t,n){return await this.ensureContext(n),await this.transactionalConnector.search(this.getPortableQuery(e,t,n),n)}async searchOne(e,t,n){return await this.ensureContext(n),await this.transactionalConnector.searchOne(this.getPortableQuery(e,t,n),n)}async ensureContext(e){}};xf([function(e,t){}],Af.prototype,"fieldUtils",void 0),xf([function(e,t){}],Af.prototype,"queryUtils",void 0),xf([function(e,t){}],Af.prototype,"relationManager",void 0),xf([function(e,t){}],Af.prototype,"transactionalConnector",void 0),Af=xf([function(e){}],Af);var vf=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};class Sf{constructor(e,t,n){this.applicationDomain=e,this.applicationName=t,this.entityMap=n}add(e,t){this.entityMap.set(e,{entity:{index:t,name:e.name},application:{domain:this.applicationDomain,name:this.applicationName}})}}let Cf=class{get entityMap(){return this.databaseStore.entityMap}get F(){return this.databaseStore.functions}get functions(){return this.databaseStore.functions}get A(){return this.databaseStore.applications}get applications(){return this.databaseStore.applications}get qApplications(){return this.databaseStore.qApplications}get Q(){return this.databaseStore.qApplications}get QM(){return this.databaseStore.QM}getAccumulator(e,t){return new Sf(e,t,this.entityMap)}async addRepository(e){return await this.databaseFacade.addRepository(e)}async insertColumnValues(e,t){return await this.databaseFacade.insertColumnValues(e,t)}async insertValues(e,t){return await this.databaseFacade.insertValues(e,t)}async insertColumnValuesGenerateIds(e,t){return await this.databaseFacade.insertColumnValuesGenerateIds(e,t)}async insertValuesGenerateIds(e,t){return await this.databaseFacade.insertValuesGenerateIds(e,t)}async deleteWhere(e,t){return await this.databaseFacade.deleteWhere(e,t)}async save(e,t,n){return await this.databaseFacade.save(e,t)}async updateColumnsWhere(e,t){return await this.databaseFacade.updateColumnsWhere(e,t)}async updateWhere(e,t){return await this.databaseFacade.updateWhere(e,t)}};vf([function(e,t){}],Cf.prototype,"databaseFacade",void 0),vf([function(e,t){}],Cf.prototype,"databaseStore",void 0),vf([function(e,t){}],Cf.prototype,"find",void 0),vf([function(e,t){}],Cf.prototype,"findOne",void 0),vf([function(e,t){}],Cf.prototype,"search",void 0),vf([function(e,t){}],Cf.prototype,"searchOne",void 0),Cf=vf([function(e){}],Cf);const Df=V("tower").token({class:If,interface:"IEntityCopier",token:"ENTITY_COPIER"});Ro.setClass(Cf),He.setClass(wf),Xo.setClass(pf),Zo.setClass(uf),pc.setClass(yf),nr.setClass(mf),Mo.setClass(gf),Eo.setClass(Nf),Eo.setDependencies({entityCopier:Df,queryFacade:vo}),vo.setClass(Af);var Mf=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=t.PROMISE_RESOLVED_VOID=t.PROMISE_RESOLVED_TRUE=t.PROMISE_RESOLVED_FALSE=void 0,t.isPromise=function(e){return!(!e||"function"!=typeof e.then)},t.microSeconds=function(){var e=(new Date).getTime();return e===r?(a++,1e3*e+a):(r=e,a=0,1e3*e)},t.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},t.randomToken=function(){return Math.random().toString(36).substring(2)},t.sleep=function(e,t){e||(e=0);return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))};var n=Promise.resolve(!1);t.PROMISE_RESOLVED_FALSE=n;var i=Promise.resolve(!0);t.PROMISE_RESOLVED_TRUE=i;var o=Promise.resolve();t.PROMISE_RESOLVED_VOID=o;var r=0,a=0;var s="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);t.isNode=s})),Vf=N((function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}));N((function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}));var Pf=Mf,Lf=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=l,t.canBeUsed=c,t.close=r,t.create=o,t.microSeconds=t.default=void 0,t.onMessage=s,t.postMessage=a,t.type=void 0;var n=Pf.microSeconds;t.microSeconds=n;var i="native";function o(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function r(e){e.bc.close(),e.subFns=[]}function a(e,t){try{return e.bc.postMessage(t,!1),Pf.PROMISE_RESOLVED_VOID}catch(e){return Promise.reject(e)}}function s(e,t){e.messagesCallback=t}function c(){if(Pf.isNode&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function l(){return 150}t.type=i;var p={create:o,close:r,onMessage:s,postMessage:a,canBeUsed:c,type:i,averageResponseTime:l,microSeconds:n};t.default=p})),Uf=function(){function e(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(e){return this.set.has(e)},e.prototype.add=function(e){var t=this;this.timeMap.set(e,Ff()),this.set.add(e),setTimeout((function(){jf(t)}),0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function jf(e){for(var t=Ff()-e.ttl,n=e.set[Symbol.iterator]();;){var i=n.next().value;if(!i)return;if(!(e.timeMap.get(i)<t))return;e.timeMap.delete(i),e.set.delete(i)}}function Ff(){return(new Date).getTime()}var kf=Object.freeze({__proto__:null,ObliviousSet:Uf,removeTooOldValues:jf,now:Ff}),Bf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0);t.idb||(t.idb={});t.idb.ttl||(t.idb.ttl=45e3);t.idb.fallbackInterval||(t.idb.fallbackInterval=150);e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose);t.localstorage||(t.localstorage={});t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4);e.methods&&(t.methods=e.methods);t.node||(t.node={});t.node.ttl||(t.node.ttl=12e4);t.node.maxParallelWrites||(t.node.maxParallelWrites=2048);void 0===t.node.useFastPath&&(t.node.useFastPath=!0);return t};var Hf=Object.defineProperty({fillOptionsWithDefaults:Bf},"__esModule",{value:!0}),$f=b(kf),Gf=Hf,qf=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=I,t.canBeUsed=R,t.cleanOldMessages=p,t.close=y,t.create=d,t.createDatabase=r,t.default=void 0,t.getAllMessages=function(e){var t=e.transaction(i).objectStore(i),n=[];return new Promise((function(e){t.openCursor().onsuccess=function(t){var i=t.target.result;i?(n.push(i.value),i.continue()):e(n)}}))},t.getIdb=o,t.getMessagesHigherThan=s,t.getOldMessages=l,t.microSeconds=void 0,t.onMessage=m,t.postMessage=h,t.removeMessageById=c,t.type=void 0,t.writeMessage=a;var n=Pf.microSeconds;t.microSeconds=n;var i="messages";function o(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function r(e){var t="pubkey.broadcast-channel-0-"+e,n=o().open(t,1);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(i,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}function a(e,t,n){var o={uuid:t,time:(new Date).getTime(),data:n},r=e.transaction([i],"readwrite");return new Promise((function(e,t){r.oncomplete=function(){return e()},r.onerror=function(e){return t(e)},r.objectStore(i).add(o)}))}function s(e,t){var n=e.transaction(i).objectStore(i),o=[];return new Promise((function(e){(function(){try{var e=IDBKeyRange.bound(t+1,1/0);return n.openCursor(e)}catch(e){return n.openCursor()}}()).onsuccess=function(n){var i=n.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):e(o)}}))}function c(e,t){var n=e.transaction([i],"readwrite").objectStore(i).delete(t);return new Promise((function(e){n.onsuccess=function(){return e()}}))}function l(e,t){var n=(new Date).getTime()-t,o=e.transaction(i).objectStore(i),r=[];return new Promise((function(e){o.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var o=i.value;if(!(o.time<n))return void e(r);r.push(o),i.continue()}else e(r)}}))}function p(e,t){return l(e,t).then((function(t){return Promise.all(t.map((function(t){return c(e,t.id)})))}))}function d(e,t){return t=(0,Gf.fillOptionsWithDefaults)(t),r(e).then((function(n){var i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:(0,Pf.randomToken)(),eMIs:new $f.ObliviousSet(2*t.idb.ttl),writeBlockPromise:Pf.PROMISE_RESOLVED_VOID,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},u(i),i}))}function u(e){e.closed||f(e).then((function(){return(0,Pf.sleep)(e.options.idb.fallbackInterval)})).then((function(){return u(e)}))}function f(e){return e.closed?Pf.PROMISE_RESOLVED_VOID:e.messagesCallback?s(e.db,e.lastCursorId).then((function(t){return t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time})).forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Pf.PROMISE_RESOLVED_VOID})):Pf.PROMISE_RESOLVED_VOID}function y(e){e.closed=!0,e.db.close()}function h(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return a(e.db,e.uuid,t)})).then((function(){0===(0,Pf.randomInt)(0,10)&&p(e.db,e.options.idb.ttl)})),e.writeBlockPromise}function m(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,f(e)}function R(){return!Pf.isNode&&!!o()}function I(e){return 2*e.idb.fallbackInterval}t.type="idb";var E={create:d,close:y,onMessage:m,postMessage:h,canBeUsed:R,type:"idb",averageResponseTime:I,microSeconds:n};t.default=E})),Yf=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.addStorageEventListener=s,t.averageResponseTime=f,t.canBeUsed=u,t.close=p,t.create=l,t.default=void 0,t.getLocalStorage=o,t.microSeconds=void 0,t.onMessage=d,t.postMessage=a,t.removeStorageEventListener=c,t.storageKey=r,t.type=void 0;var n=Pf.microSeconds;t.microSeconds=n;var i="localstorage";function o(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function r(e){return"pubkey.broadcastChannel-"+e}function a(e,t){return new Promise((function(n){(0,Pf.sleep)().then((function(){var i=r(e.channelName),a={token:(0,Pf.randomToken)(),time:(new Date).getTime(),data:t,uuid:e.uuid},s=JSON.stringify(a);o().setItem(i,s);var c=document.createEvent("Event");c.initEvent("storage",!0,!0),c.key=i,c.newValue=s,window.dispatchEvent(c),n()}))}))}function s(e,t){var n=r(e),i=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",i),i}function c(e){window.removeEventListener("storage",e)}function l(e,t){if(t=(0,Gf.fillOptionsWithDefaults)(t),!u())throw new Error("BroadcastChannel: localstorage cannot be used");var n=(0,Pf.randomToken)(),i=new $f.ObliviousSet(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:i};return o.listener=s(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!i.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(i.add(e.token),o.messagesCallback(e.data)))})),o}function p(e){c(e.listener)}function d(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function u(){if(Pf.isNode)return!1;var e=o();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function f(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}t.type=i;var y={create:l,close:p,onMessage:d,postMessage:a,canBeUsed:u,type:i,averageResponseTime:f,microSeconds:n};t.default=y})),Qf=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=p,t.canBeUsed=l,t.close=a,t.create=r,t.microSeconds=t.default=void 0,t.onMessage=c,t.postMessage=s,t.type=void 0;var n=Pf.microSeconds;t.microSeconds=n;var i="simulate";t.type=i;var o=new Set;function r(e){var t={name:e,messagesCallback:null};return o.add(t),t}function a(e){o.delete(e)}function s(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(o).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))}function c(e,t){e.messagesCallback=t}function l(){return!0}function p(){return 5}var d={create:r,close:a,onMessage:c,postMessage:s,canBeUsed:l,type:i,averageResponseTime:p,microSeconds:n};t.default=d})),Jf=function(e){var t=[].concat(e.methods,Zf).filter(Boolean);if(e.type){if("simulate"===e.type)return Xf.default;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||Pf.isNode||(t=t.filter((function(e){return"idb"!==e.type})));var i=t.find((function(e){return e.canBeUsed()}));if(i)return i;throw new Error("No useable method found in "+JSON.stringify(Zf.map((function(e){return e.type}))))},Wf=Vf(Lf),zf=Vf(qf),Kf=Vf(Yf),Xf=Vf(Qf),Zf=[Wf.default,zf.default,Kf.default];var ey=Object.defineProperty({chooseMethod:Jf},"__esModule",{value:!0}),ty=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OPEN_BROADCAST_CHANNELS=t.BroadcastChannel=void 0,t.clearNodeFolder=function(e){e=(0,Gf.fillOptionsWithDefaults)(e);var t=(0,ey.chooseMethod)(e);return"node"===t.type?t.clearNodeFolder().then((function(){return!0})):Pf.PROMISE_RESOLVED_FALSE},t.enforceOptions=function(e){i=e};var n=new Set;t.OPEN_BROADCAST_CHANNELS=n;var i,o=0,r=function(e,t){var r,a;this.id=o++,n.add(this),this.name=e,i&&(t=i),this.options=(0,Gf.fillOptionsWithDefaults)(t),this.method=(0,ey.chooseMethod)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,a=(r=this).method.create(r.name,r.options),(0,Pf.isPromise)(a)?(r._prepP=a,a.then((function(e){r._state=e}))):r._state=a};function a(e,t,n){var i={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:Pf.PROMISE_RESOLVED_VOID).then((function(){var t=e.method.postMessage(e._state,i);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function s(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function c(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&s(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=1e5,i=e.time-n;t.time>=i&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function l(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!s(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}t.BroadcastChannel=r,r._pubkey=!0,r.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return a(this,"message",e)},postInternal:function(e){return a(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};l(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,c(this,"message",t)):this._onML=null},addEventListener:function(e,t){c(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){l(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){n.delete(this),this.closed=!0;var t=this._prepP?this._prepP:Pf.PROMISE_RESOLVED_VOID;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}}}));var ny={add:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}}},iy=new Set,oy=!1;function ry(){var e=[];return iy.forEach((function(t){e.push(t()),iy.delete(t)})),Promise.all(e)}var ay=b(Object.freeze({__proto__:null,add:function(e){if(oy||(oy=!0,ny.add(ry)),"function"!=typeof e)throw new Error("Listener is no function");return iy.add(e),{remove:function(){return iy.delete(e)},run:function(){return iy.delete(e),e()}}},runAll:ry,removeAll:function(){iy.clear()},getSize:function(){return iy.size}})),sy=dy,cy=function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){e||(e={});(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3);e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options));return e}(t,e);var n=new ly(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n},ly=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=(0,Pf.randomToken)(),this._aplQ=Pf.PROMISE_RESOLVED_VOID,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var i=function(e){"leader"===e.context&&("death"===e.action&&(n.hasLeader=!1),"tell"===e.action&&(n.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",i),this._lstns.push(i)};function py(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function dy(e){e.isLeader=!0,e.hasLeader=!0;var t=(0,ay.add)((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&py(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),py(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),py(e,"tell")}ly.prototype={applyOnce:function(e){var t=this;if(this.isLeader)return(0,Pf.sleep)(0,!0);if(this.isDead)return(0,Pf.sleep)(0,!1);if(this._aplQC>1)return this._aplQ;return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return Pf.PROMISE_RESOLVED_TRUE;var n,i=!1,o=new Promise((function(e){n=function(){i=!0,e()}})),r=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t.hasLeader=!0))};t.broadcastChannel.addEventListener("internal",r);var a=e?4*t._options.responseTime:t._options.responseTime;return py(t,"apply").then((function(){return Promise.race([(0,Pf.sleep)(a),o.then((function(){return Promise.reject(new Error)}))])})).then((function(){return py(t,"apply")})).then((function(){return Promise.race([(0,Pf.sleep)(a),o.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",r),!i&&dy(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){if(e.isLeader)return Pf.PROMISE_RESOLVED_VOID;return new Promise((function(t){var n=!1;function i(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",o),t(!0))}e.applyOnce().then((function(){e.isLeader&&i()})),function t(){return(0,Pf.sleep)(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void i():e.applyOnce(!0).then((function(){e.isLeader?i():t()}))}))}();var o=function(t){"leader"===t.context&&"death"===t.action&&(e.hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&i()})))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,py(this,"death")}};var uy=ty,fy=Object.defineProperty({beLeader:sy,createLeaderElection:cy},"__esModule",{value:!0}),yy=N((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BroadcastChannel",{enumerable:!0,get:function(){return uy.BroadcastChannel}}),Object.defineProperty(t,"OPEN_BROADCAST_CHANNELS",{enumerable:!0,get:function(){return uy.OPEN_BROADCAST_CHANNELS}}),Object.defineProperty(t,"beLeader",{enumerable:!0,get:function(){return fy.beLeader}}),Object.defineProperty(t,"clearNodeFolder",{enumerable:!0,get:function(){return uy.clearNodeFolder}}),Object.defineProperty(t,"createLeaderElection",{enumerable:!0,get:function(){return fy.createLeaderElection}}),Object.defineProperty(t,"enforceOptions",{enumerable:!0,get:function(){return uy.enforceOptions}})})),hy={BroadcastChannel:yy.BroadcastChannel,createLeaderElection:yy.createLeaderElection,clearNodeFolder:yy.clearNodeFolder,enforceOptions:yy.enforceOptions,beLeader:yy.beLeader},my=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ry=class{constructor(){this.isNativeBroadcastChannel="function"==typeof BroadcastChannel;const e=()=>{this.communicationChannel=new hy.BroadcastChannel("clientCommunication",{idb:{onclose:()=>{this.communicationChannel.close(),e()}}}),this.communicationChannel.onmessage=e=>{this.transactionalReceiver.handleClientRequest(e)}};e(),window.addEventListener("message",(e=>{const t=e.data;this.transactionalReceiver.handleAppRequest(t,e.origin,e.source)}),!1)}needMessageSerialization(){return!this.isNativeBroadcastChannel}sendMessageToClient(e){this.communicationChannel.postMessage(e)}sendMessageToApp(){}};my([function(e,t){}],Ry.prototype,"terminalStore",void 0),my([function(e,t){}],Ry.prototype,"transactionalReceiver",void 0),Ry=my([function(e){}],Ry);var Iy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ey=class{async retrieveDomain(e,t,n,i){return t.get(e)}};Ey=Iy([function(e){}],Ey);var gy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Oy=class{async build(e,t,n,i){await this.createApplication(e,i);for(const n of e.versions[e.versions.length-1].entities)await this.buildTable(e,n,t,i);const o=new Map;for(const r of e.versions[e.versions.length-1].entities)await this.buildForeignKeys(e,r,t,n,o,i)}async buildTable(e,t,n,i){const o=[],r=t.columns.map((n=>{let i=`${n.name} ${this.getColumnSuffix(e,t,n)}`;return this.isPrimaryKeyColumn(t,n)&&o.push(n.name),i})),a=this.getCreateTableSuffix(e,t),s=this.storeDriver.getTableName(e,t,i);let c="";o.length&&(c=this.getPrimaryKeyStatement(o));const l=`CREATE TABLE ${s} (\n\t\t${r.join(",\n")}${c}\n\t\t)${a}`;await this.storeDriver.query(_e.DDL,l,[],i,!1);let p=0;if(t.tableConfig.columnIndexes)for(const e of t.tableConfig.columnIndexes){const t=this.getIndexSql("idx_"+s+"_"+ ++p,s,e.columnList,e.unique);await this.storeDriver.query(_e.DDL,t,[],i,!1)}if(t.tableConfig.propertyIndexes)for(const e of t.tableConfig.propertyIndexes){const n=[];for(const i of t.columns)for(const t of i.propertyRefs)if(t.index===e.propertyIndex){n.push(i.name);break}const o=this.getIndexSql("idx_"+s+"_"+ ++p,s,n,e.unique);await this.storeDriver.query(_e.DDL,o,[],i,!1)}}async buildForeignKeys(e,t,n,i,o,r){if(!t.relations||!t.relations.length)return;const a=e.versions[e.versions.length-1],s=this.storeDriver.getTableName(e,t,r);for(const c of t.relations){if(c.relationType!==fe.MANY_TO_ONE)continue;let l,p;if(c.relationTableApplicationIndex||0===c.relationTableApplicationIndex){const e=a.referencedApplications[c.relationTableApplicationIndex];let t=J(e.domain,e.name);if(l=o.get(t),!l){const e=n.get(t);if(l=e?e.versions[0].jsonApplication:i.get(t),!l)throw new Error(`Could not find related application ${t}\n            in either existing applications or newly installing applications.`);o.set(t,l)}p=l.versions[l.versions.length-1].entities[c.relationTableIndex]}else l=e,p=a.entities[c.relationTableIndex];let d=[];for(const e of t.columns)for(const t of e.propertyRefs)if(t.index===c.propertyRef.index){d.push(e.name);break}const u=this.storeDriver.getTableName(l,p,r);let f=[];for(const e of p.idColumnRefs)f.push(p.columns[e.index].name);const y=this.getForeignKeySql(s,"fk_"+s+"_foreignKeyNumber",d,u,f);y&&await this.storeDriver.query(_e.DDL,y,[],r,!1)}}async buildForeignKeysForTable(){}isPrimaryKeyColumn(e,t){return t.propertyRefs.some((t=>{if(e.properties[t.index].isId)return!0}))}getPrimaryKeyStatement(e){return`,\n\t\t\tPRIMARY KEY (\n\t\t\t${e.join(",\n")}\n\t\t\t)`}};gy([function(e,t){}],Oy.prototype,"airportDatabase",void 0),gy([function(e,t){}],Oy.prototype,"sequenceDao",void 0),gy([function(e,t){}],Oy.prototype,"storeDriver",void 0),Oy=gy([function(e){}],Oy);var Ty=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wy=class{async check(e){if(!e)throw new Error("Json Application not provided");if(!(e.versions instanceof Array))throw new Error("application.versions is not an array");if(1!==e.versions.length)throw new Error("Currently only 1 version of application is supported");await this.checkDomain(e)}async checkDomain(e){}async checkDependencies(e){const t=new Map,n=new Map;for(const i of e){const e=i.versions[i.versions.length-1],o=je(je(n,i.domain),i.name);for(const n of e.referencedApplications)je(t,n.domain).set(n.name,n),je(o,n.domain).set(n.name,n)}this.pruneInGroupReferences(e,t,n),await this.pruneReferencesToExistingApplications(e,t,n);const i=[],o=[],r=[];for(const e of t.values())for(const t of e.values())r.push(t);for(const t of e){const e=n.get(t.domain).get(t.name);this.hasReferences(e)?o.push(t):i.push(t)}return{applicationsWithValidDependencies:i,applicationsInNeedOfAdditionalDependencies:o,neededDependencies:r}}pruneInGroupReferences(e,t,n){for(const i of e){for(const[e,t]of n)for(const[e,n]of t){const e=n.get(i.domain);e&&e.delete(i.name)}const e=t.get(i.domain);e&&e.delete(i.name)}}async pruneReferencesToExistingApplications(e,t,n){const i=await this.findExistingApplications(t);for(const e of i.existingApplicationMapByName.keys()){const o=i.coreDomainAndApplicationNamesByApplicationName.get(e);for(const e of n.values())for(const t of e.values()){const e=t.get(o.domain);e&&e.delete(o.application)}const r=t.get(o.domain);r&&r.delete(o.application)}}async findExistingApplications(e){const t=[],n=new Map;for(const[i,o]of e)for(const[e,r]of o){const o=Q(r);t.push(o),n.set(o,{domain:i,application:e})}let i;return i=t.length?await this.applicationDao.findMapByFullNames(t):new Map,{coreDomainAndApplicationNamesByApplicationName:n,existingApplicationMapByName:i}}hasReferences(e){for(const t of e.values())for(const e of t)return!0;return!1}};Ty([function(e,t){}],wy.prototype,"applicationDao",void 0),wy=Ty([function(e){}],wy);var by=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ny=class{locateExistingApplicationVersionRecord(e,t){const n=t.getLatestApplicationVersionMapByNames().get(e.domain);if(!n)return null;const i=J(e.domain,e.name),o=n.get(i),r=e.versions[0];if(o&&o.integerVersion!==r.integerVersion)throw new Error("Multiple versions of applications are not yet supported");return o}async locateLatestApplicationVersionByApplicationName(e,t){return t.getLatestApplicationVersionMapByFullApplicationName().get(e)}};Ny=by([function(e){}],Ny);var _y=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let xy=class{async compose(e,t){const n=new Map,i=t.terminalStore,o=i.getDomains().slice(),r=new Map;for(const e of o)r.set(e.name,e);const a=i.getApplications().slice(),s=new Map;for(const e of a)s.set(e.fullName,e);const c=[],l=new Map,p=new Map,d=new Map,u=new Map,f=new Map,y={columns:[],domains:[],entities:[],latestApplicationVersions:[],properties:[],propertyColumns:[],relationColumns:[],relations:[],applicationReferences:[],applications:[],applicationVersions:[]},h=[...i.getAllApplicationVersionsByIds()],m={columns:[],domains:[],entities:[],latestApplicationVersions:[],properties:[],propertyColumns:[],relationColumns:[],relations:[],applicationReferences:[],applications:[],applicationVersions:[]},R={all:m,allApplicationVersionsByIds:h,added:y};for(const t of e){n.set(Q(t),t);const e=await this.composeDomain(t.domain,o,y.domains,r),i=this.composeApplication(e,t,a,y.applications,s);this.composeApplicationVersion(t,i,c,y.applicationVersions,l)}const{newApplicationReferenceMap:I,newApplicationReferences:E}=await this.composeApplicationReferences(n,l,i,R,t.deepTraverseReferences);y.applicationReferences=E;for(const e of h)e&&this.addApplicationVersionObjects(e,m);for(const t of e){const e=Q(t);n.set(e,t);const o=r.get(t.domain),a=s.get(Q(t));a.index||(t.lastIds={...this.terminalStore.getLastIds()},a.index=++this.terminalStore.getLastIds().applications),o.id||(o.id=++this.terminalStore.getLastIds().domains);const c=l.get(a.fullName);c.id||(c.id=++this.terminalStore.getLastIds().applicationVersions,c.jsonApplication=t),this.composeApplicationEntities(t,c,p,y.entities),this.composeApplicationProperties(t,y.properties,d,p),await this.composeApplicationRelations(t,y.relations,u,p,d,I,i,R),this.composeApplicationColumns(t,y.columns,f,y.propertyColumns,p,d),await this.composeApplicationRelationColumns(t,y.relationColumns,l,I,u,f,i,R)}this.addObjects(R.added,R.all);for(const e of R.all.applicationVersions)R.allApplicationVersionsByIds[e.id]=e;return R}async getExistingLatestApplicationVersion(e,t){for(const n of t.all.latestApplicationVersions)if(n.application.fullName==e)return n;throw new Error(`Cannot find application "${e}".`)}addApplicationVersionObjects(e,t){let n=!1;for(const i of t.domains)if(i.name===e.application.domain.name){n=!0;break}n||t.domains.push(e.application.domain);let i=!1;for(const n of t.applications)if(n.domain===e.application.domain&&n.name===e.application.name){i=!0;break}i||t.applications.push(e.application),t.applicationVersions.push(e),t.latestApplicationVersions.push(e),t.applicationReferences=t.applicationReferences.concat(e.references),t.entities=t.entities.concat(e.entities);for(const n of e.entities){t.columns=t.columns.concat(n.columns),t.properties=t.properties.concat(n.properties);let e=[];for(const t of n.properties)e=e.concat(t.propertyColumns);t.propertyColumns=t.propertyColumns.concat(e),t.relations=t.relations.concat(n.relations);let i=[];for(const e of n.relations)i=i.concat(e.manyRelationColumns);t.relationColumns=t.relationColumns.concat(i)}}addObjects(e,t){t.columns=t.columns.concat(e.columns);for(const n of e.domains){let e=!1;for(const i of t.domains)if(i.name===n.name){e=!0;break}e||t.domains.push(n)}t.entities=t.entities.concat(e.entities),t.latestApplicationVersions=t.latestApplicationVersions.concat(e.latestApplicationVersions),t.properties=t.properties.concat(e.properties),t.propertyColumns=t.propertyColumns.concat(e.propertyColumns),t.relationColumns=t.relationColumns.concat(e.relationColumns),t.relations=t.relations.concat(e.relations);for(const n of e.applications){let e=!1;for(const i of t.applications)if(i.domain===n.domain&&i.name===n.name){e=!0;break}e||t.applications.push(n)}t.applicationReferences=t.applicationReferences.concat(e.applicationReferences),t.applicationVersions=t.applicationVersions.concat(e.applicationVersions)}async composeDomain(e,t,n,i){let o=await this.domainRetriever.retrieveDomain(e,i,t,n);return o||(o={id:null,name:e,applications:[]},t.push(o),n.push(o),i.set(e,o)),o}composeApplication(e,t,n,i,o){const r=Q(t);let a=o.get(r);return a||(a={domain:e,index:null,fullName:r,name:t.name,scope:"public",signature:"localhost",status:Pe.CURRENT},n.push(a),i.push(a),o.set(r,a)),a}composeApplicationVersion(e,t,n,i,o){let r;for(const n of e.versions){const o=n.versionString.split(".");r={id:null,integerVersion:n.integerVersion,versionString:n.versionString,majorVersion:parseInt(o[0]),minorVersion:parseInt(o[1]),patchVersion:parseInt(o[2]),application:t,jsonApplication:e,entities:[],references:[],referencedBy:[],entityMapByName:{},referencesMapByName:{},referencedByMapByName:{}},t.versions?t.versions.push(r):t.versions=[r],i.push(r)}let a={application:t,applicationVersion:r};return t.currentVersion=[a],n.push(r),o.set(t.fullName,r),r}async composeApplicationReferences(e,t,n,i,o){const r=new Map,a=new Map,s=[];for(const[c,l]of t){const p=l.application,d=e.get(p.fullName),u=d.versions[d.versions.length-1],f=Le(r,c),y=Fe(a,c);for(const r of u.referencedApplications){const a=Q(r);let c=t.get(a);if(!c){if(c=await this.applicationLocator.locateLatestApplicationVersionByApplicationName(a,n),!c)throw new Error(`Could not locate application:\n\t\t\t\t\t\t${a}\n\t\t\t\t\t\tin either existing applications or applications being currently processed`);this.addApplicationVersionObjects(c,i.all),o&&(e.set(a,c.jsonApplication),t.set(a,c))}const p={index:r.index,ownApplicationVersion:l,referencedApplicationVersion:c};y.has(r.index)||(y.add(r.index),s.push(p),f.push(p))}}return{newApplicationReferenceMap:r,newApplicationReferences:s}}composeApplicationEntities(e,t,n,i){const o=Q(e);let r=0;const a=e.versions[e.versions.length-1].entities,s=[];for(const e of a){const n={id:++this.terminalStore.getLastIds().entities,index:r++,applicationVersion:t,isLocal:e.isLocal,isRepositoryEntity:e.isRepositoryEntity,name:e.name,tableConfig:e.tableConfig};s.push(n),i.push(n)}n.set(o,s),t.entities=s}composeApplicationProperties(e,t,n,i){const o=Q(e),r=e.versions[e.versions.length-1].entities,a=i.get(o),s=Le(n,o);r.forEach(((e,n)=>{const i=a[n],o=[];s[n]=o;let r=0;for(const n of e.properties){const e={id:++this.terminalStore.getLastIds().properties,index:r,entity:i,name:n.name,isId:n.isId};o[r]=e,r++,t.push(e)}}))}async composeApplicationRelations(e,t,n,i,o,r,a,s){const c=Q(e),l=e.versions[e.versions.length-1].entities,p=i.get(c),d=o.get(c),u=Le(n,c),f=r.get(c);for(let e=0;e<l.length;e++){const n=l[e],o=d[e],r=[];u[e]=r;const y=p[e];let h=0;for(const e of n.relations){const n=o[e.propertyRef.index];let l=c;if(e.relationTableApplicationIndex||0===e.relationTableApplicationIndex){l=f[e.relationTableApplicationIndex].referencedApplicationVersion.application.fullName}let p=i.get(l);if(!p){p=(await this.getExistingLatestApplicationVersion(l,s)).entities}const d=p[e.relationTableIndex],u={entity:y,id:++a.getLastIds().relations,index:h,foreignKey:e.foreignKey,isId:n.isId,manyToOneElems:e.manyToOneElems,property:n,oneToManyElems:e.oneToManyElems,relationEntity:d,relationType:e.relationType};r[h]=u,h++,t.push(u)}}}composeApplicationColumns(e,t,n,i,o,r){const a=Q(e),s=[];n.set(a,s);const c=o.get(a),l=e.versions[e.versions.length-1].entities,p=r.get(a);l.forEach(((e,n)=>{const o=c[n],r=[];s[n]=r;const a=[];e.idColumnRefs.forEach(((e,t)=>{a[e.index]=t}));const l=p[n];e.columns.forEach(((e,n)=>{const s=a[n],c={allocationSize:e.allocationSize,entity:o,id:++this.terminalStore.getLastIds().columns,idIndex:s,index:n,isGenerated:e.isGenerated,manyRelationColumns:[],name:e.name,notNull:e.notNull,oneRelationColumns:[],precision:e.precision,propertyColumns:[],scale:e.scale,type:e.type};r[n]=c,t.push(c),e.propertyRefs.forEach((e=>{const t=l[e.index],n={column:c,property:t};i.push(n)}))}))}))}async composeApplicationRelationColumns(e,t,n,i,o,r,a,s){const c=Q(e),l=e.versions[e.versions.length-1].entities,p=r.get(c),d=o.get(c),u=i.get(c);for(let e=0;e<l.length;e++){const i=l[e],f=p[e],y=d[e];for(let e=0;e<i.columns.length;e++){const l=i.columns[e],p=f[e];for(const e of l.manyRelationColumnRefs){const i=y[e.manyRelationIndex];let l;if(e.oneApplicationIndex||0===e.oneApplicationIndex){l=u[e.oneApplicationIndex].referencedApplicationVersion}else l=n.get(c);const d=l.application.fullName,f=r.get(d);let h,m;if(f)h=f[e.oneTableIndex],m=o.get(l.application.fullName)[e.oneTableIndex];else{const t=(await this.getExistingLatestApplicationVersion(d,s)).entities[e.oneTableIndex];h=t.columns,m=t.relations}const R=h[e.oneColumnIndex],I=m[e.oneRelationIndex],E={id:++a.getLastIds().relationColumns,manyColumn:p,manyRelation:i,oneColumn:R,oneRelation:I,parentRelation:i};t.push(E)}p.manyRelationColumns=[]}}}};_y([function(e,t){}],xy.prototype,"applicationLocator",void 0),_y([function(e,t){}],xy.prototype,"domainRetriever",void 0),_y([function(e,t){}],xy.prototype,"terminalStore",void 0),xy=_y([function(e){}],xy);var Ay=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let vy=class{async record(e,t){await this.transactionManager.transactInternal((async()=>{this.setDefaultVersioning(e),await this.domainDao.checkAndInsertIfNeeded(e.domains),await this.applicationDao.insert(e.applications),await this.applicationVersionDao.insert(e.applicationVersions),await this.applicationReferenceDao.insert(e.applicationReferences),await this.applicationEntityDao.insert(e.entities),await this.applicationPropertyDao.insert(e.properties),await this.applicationRelationDao.insert(e.relations),await this.applicationColumnDao.insert(e.columns),await this.applicationPropertyColumnDao.insert(e.propertyColumns),await this.applicationRelationColumnDao.insert(e.relationColumns)}),t)}setDefaultVersioning(e){for(const t of e.applicationReferences)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.ownApplicationVersion;for(const t of e.entities)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.applicationVersion;for(const t of e.properties)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.relations)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.columns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.entity.applicationVersion;for(const t of e.propertyColumns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.property.entity.applicationVersion;for(const t of e.relationColumns)t.deprecatedSinceVersion=null,t.removedInVersion=null,t.sinceVersion=t.parentRelation.entity.applicationVersion}async bulkCreate(e,t,n){await e.save(t,n)}};Ay([function(e,t){}],vy.prototype,"applicationColumnDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationEntityDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationPropertyColumnDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationPropertyDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationReferenceDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationRelationColumnDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationRelationDao",void 0),Ay([function(e,t){}],vy.prototype,"applicationVersionDao",void 0),Ay([function(e,t){}],vy.prototype,"domainDao",void 0),Ay([function(e,t){}],vy.prototype,"transactionManager",void 0),vy=Ay([function(e){}],vy);var Sy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Cy=class{};Sy([function(e,t){},function(e,t){},function(e,t){}],Cy.prototype,"applicationIndex",void 0),Sy([function(e,t){},function(e,t){},function(e,t){}],Cy.prototype,"tableIndex",void 0),Sy([function(e,t){},function(e,t){},function(e,t){}],Cy.prototype,"columnIndex",void 0),Sy([function(e,t){}],Cy.prototype,"incrementBy",void 0),Sy([function(e,t){}],Cy.prototype,"currentValue",void 0),Cy=Sy([function(e){},function(e){}],Cy);var Dy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let My=class{};Dy([function(e,t){},function(e,t){},function(e,t){},function(e,t){}],My.prototype,"id",void 0),My=Dy([function(e){},function(e){}],My);var Vy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Py=class{};Vy([function(e,t){},function(e,t){}],Py.prototype,"id",void 0),Vy([function(e,t){}],Py.prototype,"createTimestamp",void 0),Vy([function(e,t){}],Py.prototype,"randomNumber",void 0),Py=Vy([function(e){},function(e){}],Py);const Ly={__constructors__:{Sequence:Cy,SystemWideOperationId:My,TerminalRun:Py},domain:"air",name:"@airport/airport-code"},Uy=Ly;function jy(e){return Jo(Uy.__dbApplication__,e)}k.db().eventuallyGet(Ro).then((e=>{e.QM[Q(Ly)]=Uy}));class Fy extends Bo{constructor(e){super(e,Uy)}}class ky extends Fy{constructor(){super(0)}static Save(e){return Bo.BaseSave(e)}static diSet(){return jy(0)}}ky.Find=new Ho,ky.FindOne=new Ho,ky.Search=new Ho,ky.SearchOne=new Ho;class By extends Fy{constructor(){super(1)}static Save(e){return Bo.BaseSave(e)}static diSet(){return jy(1)}}By.Find=new Ho,By.FindOne=new Ho,By.Search=new Ho,By.SearchOne=new Ho;class Hy extends Fy{constructor(){super(2)}static Save(e){return Bo.BaseSave(e)}static diSet(){return jy(2)}}Hy.Find=new Ho,Hy.FindOne=new Ho,Hy.Search=new Ho,Hy.SearchOne=new Ho;var $y=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Gy=class extends Hy{};Gy=$y([function(e){}],Gy);var qy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Yy=class extends ky{static diSet(){return Uy.__dbApplication__&&Uy.__dbApplication__.currentVersion[0].applicationVersion.entities[0]}async incrementCurrentValues(){const e=Uy.Sequence;await this.db.updateWhere({update:e,set:{currentValue:ei(e.currentValue,e.incrementBy)}})}async incrementSequence(){const e=Uy.Sequence;await this.db.updateWhere({update:e,set:{currentValue:ei(e.currentValue,e.incrementBy)}})}};Yy=qy([function(e){}],Yy);const Qy=V("airport-code"),Jy=Qy.token({class:Yy,interface:"ISequenceDao",token:"SEQUENCE_DAO"});Qy.token({class:Gy,interface:"ITerminalRunDao",token:"TERMINAL_RUN_DAO"});var Wy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let zy=class{populate(){}};zy=Wy([function(e){}],zy);var Ky=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Xy=class{link(e){const{all:t,allApplicationVersionsByIds:n,added:i}=e,{latestApplicationVersions:o,properties:r,relations:a,applicationReferences:s,applications:c}=i;this.linkDomainsAndApplicationsAndVersions(n,t.domains,c,o,s);const l=this.linkEntities(n,t.entities,i.entities),{propertyMapById:p,relationMapById:d}=this.linkPropertiesAndRelations(r,a,l);this.linkColumns(p,d,e,l)}linkDomainsAndApplicationsAndVersions(e,t,n,i,o){const r=new Map;t.forEach((e=>{r.set(e.id,e)}));const a=new Map;n.forEach((e=>{a.set(e.index,e);const t=r.get(e.domain.id);e.domain=t,t.applications.push(e)})),i.forEach((e=>{const t=a.get(e.application.index);let n={application:t,applicationVersion:e};t.currentVersion=[n],t.versions=[e],e.application=t,e.entities=[],e.references=[],e.referencedBy=[],e.entityMapByName={},e.referencesMapByName={},e.referencedByMapByName={}})),o.forEach((t=>{const n=e[t.ownApplicationVersion.id],i=e[t.referencedApplicationVersion.id];n.references[t.index]=t,n.referencesMapByName[i.application.fullName]=t,i.referencedBy.push(t),i.referencedByMapByName[n.application.fullName]=t,t.ownApplicationVersion=n,t.referencedApplicationVersion=i}))}linkEntities(e,t,n){const i=[];return t.forEach((e=>{i[e.id]=e})),n.forEach((t=>{const n=e[t.applicationVersion.id];t.applicationVersion=n,n.entities[t.index]=t,n.entityMapByName[t.name]=t,i[t.id]=t,t.columns=[],t.properties=[],t.relations=[],t.relationReferences=[],t.columnMap={},t.idColumns=[],t.idColumnMap={},t.propertyMap={}})),i}linkPropertiesAndRelations(e,t,n){const i=new Map;e.forEach((e=>{const t=n[e.entity.id];t.properties[e.index]=e,t.propertyMap[e.name]=e,e.entity=t,e.propertyColumns=[],i.set(e.id,e)}));const o=new Map;return t.forEach((e=>{const t=n[e.entity.id];t.relations[e.index]=e;let r=n[e.relationEntity.id];r||(r=this.terminalStore.getAllEntities()[e.relationEntity.id]),r.relationReferences.push(e);const a=i.get(e.property.id);e.property=a,a.relation=[e],e.entity=t,e.relationEntity=r,e.manyRelationColumns=[],e.oneRelationColumns=[],o.set(e.id,e)})),{propertyMapById:i,relationMapById:o}}linkColumns(e,t,n,i){const o=new Map;n.all.columns.forEach((e=>{o.set(e.id,e)})),n.added.columns.forEach((e=>{o.set(e.id,e);const t=i[e.entity.id];t.columns[e.index]=e,t.columnMap[e.name]=e,(e.idIndex||0===e.idIndex)&&(t.idColumns[e.idIndex]=e,t.idColumnMap[e.name]=e),e.entity=t})),n.added.propertyColumns.forEach((t=>{const n=o.get(t.column.id);n.propertyColumns.push(t);const i=e.get(t.property.id);i.propertyColumns.push(t),t.column=n,t.property=i})),n.added.relationColumns.forEach((e=>{let n=o.get(e.manyColumn.id);n||(n=this.terminalStore.getAllColumns()[e.manyColumn.id]),n.manyRelationColumns.push(e);let i,r,a=o.get(e.oneColumn.id);a||(a=this.terminalStore.getAllColumns()[e.oneColumn.id]),a.oneRelationColumns.push(e),e.manyRelation&&e.manyRelation.id&&(i=t.get(e.manyRelation.id),i||(i=this.terminalStore.getAllRelations()[e.manyRelation.id]),i.manyRelationColumns.push(e)),e.oneRelation&&e.oneRelation.id&&(r=t.get(e.oneRelation.id),r||(r=this.terminalStore.getAllRelations()[e.oneRelation.id]),r.oneRelationColumns.push(e)),e.manyColumn=n,e.manyRelation=i,e.oneColumn=a,e.oneRelation=r}))}};Ky([function(e,t){}],Xy.prototype,"terminalStore",void 0),Xy=Ky([function(e){}],Xy);var Zy=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let eh=class{async retrieveDdlObjects(){const e=await this.applicationDao.findAllActive(),t=[],n=new Set;e.forEach((e=>{t.push(e.index),n.add(e.domain.id)})),e.sort(((e,t)=>e.index-t.index));const i=await this.domainDao.findByIdIn(Array.from(n)),o=await this.applicationVersionDao.findAllActiveOrderByApplicationIndexAndId();let r;const a=[],s=[];for(const e of o)e.application.index!==r&&a.push(e),r=e.application.index,s.push(e);const c=a.map((e=>e.id)),l=await this.applicationReferenceDao.findAllForApplicationVersions(c),p=await this.applicationEntityDao.findAllForApplicationVersions(c),d=p.map((e=>e.id)),u=await this.applicationPropertyDao.findAllForEntities(d),f=u.map((e=>e.id)),y=await this.applicationRelationDao.findAllForProperties(f),h=await this.applicationColumnDao.findAllForEntities(d),m=h.map((e=>e.id)),R=await this.applicationPropertyColumnDao.findAllForColumns(m),I=await this.applicationRelationColumnDao.findAllForColumns(m),E=this.terminalStore.getTerminalState(),g={columns:h.length,domains:i.length,entities:p.length,properties:u.length,propertyColumns:R.length,relationColumns:I.length,relations:y.length,applications:e.length,applicationVersions:s.length};return this.terminalStore.state.next({...E,lastIds:g}),{columns:h,domains:i,entities:p,latestApplicationVersions:a,properties:u,propertyColumns:R,relationColumns:I,relations:y,applicationReferences:l,applications:e,applicationVersions:s}}};Zy([function(e,t){}],eh.prototype,"applicationColumnDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationEntityDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationPropertyColumnDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationPropertyDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationReferenceDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationRelationColumnDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationRelationDao",void 0),Zy([function(e,t){}],eh.prototype,"applicationVersionDao",void 0),Zy([function(e,t){}],eh.prototype,"domainDao",void 0),Zy([function(e,t){}],eh.prototype,"terminalStore",void 0),eh=Zy([function(e){}],eh);var th=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let nh=class{createAll(e){(function(e){const t=new Map,n=e.map((e=>{const n=new Set;for(const t of e.currentVersion[0].applicationVersion.references)n.add(t.referencedApplicationVersion.application.index);const i={application:e,dependencies:n};return t.set(e.index,i),i}));return n.sort(((e,t)=>kn(e,t.application.index)?1:kn(t,e.application.index)?-1:0)),n.map((e=>e.application))})(e).map((e=>this.create(e)))}create(e){let t=this.airportDatabase.QM[e.fullName];return t?t.__dbApplication__=e:(t={__constructors__:{},__qConstructors__:{},__dbApplication__:e,name:e.name,domain:e.domain.name},this.airportDatabase.QM[e.fullName]=t),this.airportDatabase.Q[e.index]=t,function(e,t,n){t.__qIdRelationConstructors__=[],t.__qConstructors__={},e.currentVersion[0].applicationVersion.entities.forEach((e=>{for(const t of e.idColumns)if(t.manyRelationColumns&&t.manyRelationColumns.length){const i=t.manyRelationColumns[0].oneColumn,o=i.entity;if(!n[o.applicationVersion.application.index])throw new Error(`QApplication not yet initialized for ID relation:\n\t\t\t\t\t${e.name}.${i.name}\n\t\t\t\t\t`)}const i=jn(e);t.__qIdRelationConstructors__[e.index]=i;const o=Ln(n);t.__qConstructors__[e.index]=o,Object.getOwnPropertyNames(t).filter((t=>t===e.name)).length||Object.defineProperty(t,e.name,{get:function(){return new this.__qConstructors__[e.index](e)}})}))}(e,t,this.airportDatabase.qApplications),t}};th([function(e,t){}],nh.prototype,"airportDatabase",void 0),nh=th([function(e){}],nh);var ih=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let oh=class{generateQObjectsAndPopulateStore(e){this.ddlObjectLinker.link(e),this.queryEntityClassCreator.createAll(e.all.applications);const t=this.terminalStore.getTerminalState(),n={};for(const e of t.domains)n[e.name]=e;for(const t of e.added.domains)delete n[t.name];const i=[];for(const e in n)i.push(n[e]);const o={};for(const e of t.applications)o[e.fullName]=e;for(const t of e.added.applications)delete o[t.fullName];const r=[];for(const e in o)r.push(o[e]);this.terminalStore.state.next({...t,domains:[...i,...e.added.domains],applications:[...r,...e.added.applications]})}async initialize(){const e=await this.ddlObjectRetriever.retrieveDdlObjects(),t=[];for(const n of e.applicationVersions)t[n.id]=n;let n={all:e,allApplicationVersionsByIds:t,added:e};return this.generateQObjectsAndPopulateStore(n),n}};ih([function(e,t){}],oh.prototype,"ddlObjectLinker",void 0),ih([function(e,t){}],oh.prototype,"ddlObjectRetriever",void 0),ih([function(e,t){}],oh.prototype,"queryEntityClassCreator",void 0),ih([function(e,t){}],oh.prototype,"terminalStore",void 0),oh=ih([function(e){}],oh);const rh=V("takeoff");rh.token({class:zy,interface:"IAirportDatabasePopulator",token:"AIRPORT_DATABASE_POPULATOR"});const ah=rh.token({class:Xy,interface:"IDdlObjectLinker",token:"DDL_OBJECT_LINKER"}),sh=rh.token({class:eh,interface:"IDdlObjectRetriever",token:"DDL_OBJECT_RETRIEVER"}),ch=rh.token({class:nh,interface:"IQueryEntityClassCreator",token:"QUERY_ENTITY_CLASS_CREATOR"}),lh=rh.token({class:oh,interface:"IQueryObjectInitializer",token:"QUERY_OBJECT_INITIALIZER"});ah.setDependencies({terminalStore:dr}),sh.setDependencies({applicationColumnDao:dp,applicationDao:up,applicationEntityDao:fp,applicationPropertyColumnDao:yp,applicationPropertyDao:hp,applicationReferenceDao:mp,applicationRelationColumnDao:Rp,applicationRelationDao:Ip,applicationVersionDao:Ep,domainDao:pp}),ch.setDependencies({airportDatabase:Ro}),lh.setDependencies({ddlObjectLinker:ah,ddlObjectRetriever:sh,queryEntityClassCreator:ch,terminalStore:dr});var ph=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let dh=class{addNewApplicationVersionsToAll(e){for(const t of e.added.applicationVersions)e.allApplicationVersionsByIds[t.id]=t}async hydrate(e,t){await this.stage(e,t);const n=await this.queryObjectInitializer.initialize();this.addNewApplicationVersionsToAll(n),this.setAirDbApplications(n),await this.sequenceGenerator.initialize()}async initialize(e,t,n,i){const o=await this.getApplicationsWithValidDependencies(e,n),r=new Map;if(i){const e=await this.applicationDao.findAllWithJson();for(const t of e)r.set(t.fullName,t)}const a=new Map;for(const t of e){const e=r.get(Q(t));e?t.lastIds=e.versions[0].jsonApplication.lastIds:a.set(Q(t),t)}let s=[];for(const e of o){r.get(Q(e))||(s.push(e),await this.applicationBuilder.build(e,r,a,t))}const c=await this.applicationComposer.compose(s,{terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(c),this.queryObjectInitializer.generateQObjectsAndPopulateStore(c),this.setAirDbApplications(c);const l=await this.applicationBuilder.buildAllSequences(o,t);await this.sequenceGenerator.initialize(l),await this.applicationRecorder.record(c.added,t)}async initializeForAIRportApp(e){const t=await this.getApplicationsWithValidDependencies([e],!1),n=await this.applicationComposer.compose(t,{deepTraverseReferences:!0,terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(n),this.queryObjectInitializer.generateQObjectsAndPopulateStore(n),this.setAirDbApplications(n)}async stage(e,t){const n=await this.applicationComposer.compose(e,{terminalStore:this.terminalStore});this.addNewApplicationVersionsToAll(n),this.queryObjectInitializer.generateQObjectsAndPopulateStore(n),this.setAirDbApplications(n);const i=await this.applicationBuilder.stageSequences(e,t);await this.sequenceGenerator.tempInitialize(i)}async wait(e){return new Promise(((t,n)=>{setTimeout((()=>{t()}),e)}))}async getApplicationsWithValidDependencies(e,t){const n=[];for(const t of e){await this.applicationChecker.check(t);this.applicationLocator.locateExistingApplicationVersionRecord(t,this.terminalStore)||n.push(t)}let i;if(t){const e=await this.applicationChecker.checkDependencies(n);if(e.applicationsInNeedOfAdditionalDependencies.length)for(let t=0;t<e.neededDependencies.length;t++){const n=e.neededDependencies[t],i=Q(n);await this.nativeInitializeApplication(n.domain,n.name,i)}i=[...e.applicationsWithValidDependencies,...e.applicationsInNeedOfAdditionalDependencies]}else i=n;return i}setAirDbApplications(e){for(let t of e.all.applications)this.airportDatabase.applications[t.index]=t}};ph([function(e,t){}],dh.prototype,"airportDatabase",void 0),ph([function(e,t){}],dh.prototype,"applicationBuilder",void 0),ph([function(e,t){}],dh.prototype,"applicationChecker",void 0),ph([function(e,t){}],dh.prototype,"applicationComposer",void 0),ph([function(e,t){}],dh.prototype,"applicationDao",void 0),ph([function(e,t){}],dh.prototype,"applicationLocator",void 0),ph([function(e,t){}],dh.prototype,"applicationRecorder",void 0),ph([function(e,t){}],dh.prototype,"queryObjectInitializer",void 0),ph([function(e,t){}],dh.prototype,"sequenceGenerator",void 0),ph([function(e,t){}],dh.prototype,"terminalStore",void 0),dh=ph([function(e){}],dh);const uh=V("landing"),fh=uh.token({class:dh,interface:"class ApplicationInitializer",token:"ABSTRACT_APPLICATION_INITIALIZER"}),yh=uh.token({class:null,interface:"IApplicationBuilder",token:"APPLICATION_BUILDER"}),hh=uh.token({class:wy,interface:"IApplicationChecker",token:"APPLICATION_CHECKER"}),mh=uh.token({class:xy,interface:"IApplicationComposer",token:"APPLICATION_COMPOSER"}),Rh=uh.token({class:Ny,interface:"IApplicationLocator",token:"APPLICATION_LOCATOR"}),Ih=uh.token({class:vy,interface:"IApplicationRecorder",token:"APPLICATION_RECORDER"}),Eh=uh.token({class:Oy,interface:"class SqlApplicationBuilder",token:"SQL_APPLICATION_BUILDER"});fh.setDependencies({airportDatabase:Ro,applicationBuilder:yh,applicationChecker:hh,applicationDao:up,applicationLocator:Rh,queryObjectInitializer:lh,sequenceGenerator:ar,terminalStore:dr}),yh.setDependencies({airportDatabase:Ro}),hh.setDependencies({applicationDao:up}),mh.setDependencies({applicationLocator:Rh,domainRetriever:lr,terminalStore:dr}),Ih.setDependencies({applicationColumnDao:dp,applicationDao:up,applicationEntityDao:fp,applicationPropertyColumnDao:yp,applicationPropertyDao:hp,applicationRecorder:Ih,applicationReferenceDao:mp,applicationRelationColumnDao:Rp,applicationRelationDao:Ip,applicationVersionDao:Ep,domainDao:pp,transactionManager:ur}),Eh.setDependencies({airportDatabase:Ro,sequenceDao:Jy,storeDriver:pr});var gh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Oh=class extends dh{constructor(){super(...arguments),this.applicationWindowMap=new Map,this.initializingApplicationMap=new Map}async nativeInitializeApplication(e,t,n){if(this.terminalStore.getReceiver().initializedApps.has(n))return;let i;for(document.getElementsByName(n).length||(i=document.createElement("iframe"),i.src="http://"+e+"/AIRport/apps/"+t+"/index.html",i.name=n,i.style.display="none",document.body.appendChild(i));!this.terminalStore.getReceiver().initializedApps.has(n);)await this.wait(100);this.applicationWindowMap.set(n,i.contentWindow),this.initializingApplicationMap.set(n,!1)}};Oh=gh([function(e){}],Oh);var Th=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let wh=class extends uc{constructor(){super();const e=window.location.hostname.split(".");("www"===e[0]||e[0].startsWith("random_"))&&e.splice(0,1);const t="."+e.join(".");"localhost"!==document.domain&&(document.domain="random_"+Math.random()+"_"+Math.random()+t);const n=this.terminalStore.getWebReceiver();n.domainPrefix=t,n.mainDomainFragments=e}handleClientRequest(e){if(e.__received__)return;if(e.__received__=!0,!this.hasValidApplicationInfo(e))return;this.webMessageReciever.needMessageSerialization();const t=this.terminalStore.getWebReceiver();if(t.onClientMessageCallback){const n=new Date;e.__receivedTime__=n.getTime(),t.onClientMessageCallback(e)}switch(e.category){case"FromClient":const t={...e,__received__:!1,__receivedTime__:null,category:"FromClientRedirected"};this.handleFromClientRequest(t).then();break;case"IsConnectionReady":this.ensureConnectionIsReady(e).then()}}handleAppRequest(e,t,n){if(e.__received__)return;if(e.__received__=!0,!this.hasValidApplicationInfo(e))return;const i=this.terminalStore.getWebReceiver();if(i.onClientMessageCallback){const t=new Date;e.__receivedTime__=t.getTime(),i.onClientMessageCallback(e)}switch(e.category){case"ToDb":this.handleIsolateMessage(e,t,n).then();break;case"ToClient":const o=i.pendingInterAppApiCallMessageMap.get(e.id),r={};this.endApiCall({application:e.application,domain:e.domain,methodName:e.methodName,objectName:e.objectName},e.errorMessage,r).then((n=>{if(o)n?e.errorMessage?o.reject(e.errorMessage):o.resolve(e.payload):o.reject(e.errorMessage);else{const i={...e,__received__:!1,__receivedTime__:null,application:e.application,category:"ToClientRedirected",domain:e.domain,errorMessage:null,methodName:e.methodName,objectName:e.objectName,payload:null,protocol:null};n||(i.errorMessage=r.errorMessage,i.payload=null),this.handleToClientRequest(i,t).then()}}))}}onMessage(e){this.terminalStore.getWebReceiver().onClientMessageCallback=e}async nativeStartApiCall(e,t){return await this.startApiCall(e,t,(async()=>{const t=J(e.domain,e.application),n=this.getFrameWindow(t);if(!n)throw new Error(`No Application IFrame found for: ${t}`);n.postMessage(e,"*")}))}async nativeHandleApiCall(e,t){if(!await this.nativeStartApiCall(e,t))throw new Error(t.errorMessage);const n=this.terminalStore.getWebReceiver();return new Promise(((t,i)=>{n.pendingInterAppApiCallMessageMap.set(e.id,{message:e,reject:i,resolve:t})}))}async ensureConnectionIsReady(e){const t=J(e.domain,e.application);if(this.applicationInitializer.initializingApplicationMap.get(t))return;this.applicationInitializer.applicationWindowMap.get(t)||(this.applicationInitializer.initializingApplicationMap.set(t,!0),await this.applicationInitializer.nativeInitializeApplication(e.domain,e.application,t));const n={application:e.application,category:"ConnectionIsReady",domain:e.domain,errorMessage:null,id:e.id,methodName:e.methodName,objectName:e.objectName,protocol:window.location.protocol,payload:null};this.webMessageReciever.needMessageSerialization(),this.webMessageReciever.sendMessageToClient(n)}hasValidApplicationInfo(e){return"string"==typeof e.domain&&e.domain.length>=3&&"string"==typeof e.application&&e.application.length>=3}async handleFromClientRequest(e){const t=this.terminalStore.getWebReceiver();let n=t.pendingHostCounts.get(e.domain);if(n||(n=0),n>4)return;const i=J(e.domain,e.application);let o=t.pendingApplicationCounts.get(i);if(o||(o=0),-1===o)return;if(t.pendingHostCounts.set(e.domain,n+1),t.pendingApplicationCounts.set(i,o+1),!await this.ensureApplicationIsInstalled(i))return void this.relyToClientWithError(e,"Application is not installed");const r={};await this.nativeStartApiCall(e,r)||this.relyToClientWithError(e,r.errorMessage)}relyToClientWithError(e,t){const n={__received__:!1,__receivedTime__:null,application:e.application,category:"ToClientRedirected",domain:e.domain,errorMessage:t,id:e.id,methodName:e.methodName,objectName:e.objectName,payload:null,protocol:e.protocol};this.replyToClientRequest(n)}getFrameWindow(e){const t=document.getElementsByName(e);return t&&t[0]?t[0].contentWindow:null}async handleToClientRequest(e,t){await this.messageIsFromValidApp(e,t)&&this.replyToClientRequest(e)}replyToClientRequest(e){const t=J(e.domain,e.application),n=this.terminalStore.getWebReceiver();let i=n.pendingHostCounts.get(e.domain);i>0&&n.pendingHostCounts.set(e.domain,i-1);let o=n.pendingApplicationCounts.get(t);o>0&&n.pendingApplicationCounts.set(e.domain,o-1),this.webMessageReciever.needMessageSerialization(),this.webMessageReciever.sendMessageToClient(e)}async ensureApplicationIsInstalled(e){return!!e&&!!this.applicationInitializer.applicationWindowMap.get(e)}async messageIsFromValidApp(e,t){const n=t.split("//")[1],i=n.split(".");if("localhost"===n.split(":")[0])return!0;const o=this.terminalStore.getWebReceiver(),r=J(e.domain,e.application);if(!t.startsWith("https")||n!==r+o.domainPrefix)return!1;if(i.length!==o.mainDomainFragments.length+1)return!1;if("www"===i[0])return!1;return i[0]===r&&!!this.applicationInitializer.applicationWindowMap.get(r)}async handleIsolateMessage(e,t,n){if(!await this.messageIsFromValidApp(e,t))return;const i=this.terminalStore.getWebReceiver(),o=J(e.domain,e.application);switch(e.type){case oc.SEARCH_UNSUBSCRIBE:let t=i.subsriptionMap.get(o);if(!t)return;let n=t.get(e.id);if(!n)return;return n.unsubscribe(),void t.delete(e.id)}this.processMessage(e).then((t=>{if(!t)return;const i=this.terminalStore.getWebReceiver();let r=o+"."+i.localDomain;switch(e.type){case oc.SEARCH:case oc.SEARCH_ONE:const n=t;n.result.pipe(Xt((e=>{window.postMessage(e,r)})));const a=n.result.subscribe();let s=i.subsriptionMap.get(o);return s||(s=new Map,i.subsriptionMap.set(o,s)),void s.set(e.id,a)}n.postMessage(t,"*")}))}};Th([function(e,t){}],wh.prototype,"applicationInitializer",void 0),Th([function(e,t){}],wh.prototype,"terminalStore",void 0),Th([function(e,t){}],wh.prototype,"webMessageReciever",void 0),wh=Th([function(e){}],wh);const bh=V("web-terminal");k.set(lr,Ey),k.set(cr,Oh);const Nh=bh.token({class:Ry,interface:"IWebMessageReceiver",token:"WEB_MESSAGE_RECEIVER"});Nh.setDependencies({transactionalReceiver:fr}),k.set(fr,wh),fr.setDependencies({terminalStore:dr,webMessageReciever:Nh});var _h=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let xh=class{constructor(){this.sequences=[],this.sequenceBlocks=[],this.generatingSequenceNumbers=!1}exists(e){const t=e.columns.filter((e=>e.isGenerated));if(!t.length)return!0;const n=this.sequences[e.applicationVersion.application.index];if(!n)return!1;const i=n[e.index];return!!i&&t.every((e=>!!i[e.index]))}async initialize(e){e||(e=await this.sequenceDao.findAll()),this.addSequences(e),await this.sequenceDao.incrementCurrentValues()}async tempInitialize(e){this.addSequences(e)}async generateSequenceNumbers(e,t){if(!e.length)return[];await this.waitForPreviousGeneration(),this.generatingSequenceNumbers=!0;try{return await this.doGenerateSequenceNumbers(e,t)}finally{this.generatingSequenceNumbers=!1}}async doGenerateSequenceNumbers(e,t){const n=[];for(let i=0;i<e.length;i++){const o=e[i];let r=t[i];const a=Le(n,i),s=o.propertyColumns[0].property.entity,c=s.applicationVersion.application;let l=this.sequenceBlocks[c.index][s.index][o.index];const p=this.sequences[c.index][s.index][o.index];for(;r&&l;)a.push(p.currentValue-l+1),r--,l--;if(this.sequenceBlocks[c.index][s.index][o.index]=l,r){const e=p.incrementBy+r,t={...p};for(t.currentValue+=e,await this.sequenceDao.save(t),this.sequences[c.index][s.index][o.index]=t,l=e;r;)a.push(p.currentValue-l+1),r--,l--;this.sequenceBlocks[c.index][s.index][o.index]=l}}return n}waitForPreviousGeneration(){return new Promise((e=>{this.isDoneGeneratingSeqNums(e)}))}isDoneGeneratingSeqNums(e){this.generatingSequenceNumbers?setTimeout((()=>{this.isDoneGeneratingSeqNums(e)}),20):e()}addSequences(e){for(const t of e)Le(Le(this.sequences,t.applicationIndex),t.tableIndex)[t.columnIndex]=t,t.currentValue+=t.incrementBy,Le(Le(this.sequenceBlocks,t.applicationIndex),t.tableIndex)[t.columnIndex]=t.incrementBy}};_h([function(e,t){}],xh.prototype,"sequenceDao",void 0),xh=_h([function(e){}],xh),ar.setClass(xh),ar.setDependencies({sequenceDao:Jy});class Ah extends nd{constructor(){super(),this.maxValues=999}composeTableName(e,t){return`${e}__${t}`}async doesTableExist(e,t,n){const i=await this.findNative(`SELECT\n\ttbl_name\nfrom\n\tsqlite_master\nWHERE\n\ttype = 'table'\n\tAND tbl_name = '${e}__${t}'`,[],n);return 1===this.getNumberOfRows(i)}getNumberOfRows(e){return this.getRows(e).length}async dropTable(e,t,n){return 1===(await this.findNative(`DROP TABLE '${e}__${t}'`,[],n)).length}async findNative(e,t,n){let i=t.map((e=>this.convertValueIn(e)));return await this.query(_e.SELECT,e,i,n)}async executeNative(e,t,n){return await this.query(_e.MUTATE,e,t,n)}convertValueIn(e){switch(typeof e){case"boolean":return e?1:0;case"number":case"string":return e;case"undefined":return null;case"object":if(e){if(e instanceof Date)return e.getTime();throw new Error(`Unexpected non-date object ${e}`)}return null;default:throw new Error("Unexpected typeof value: "+typeof e)}}isValueValid(e,t,n){throw new Error("Method not implemented.")}async initTables(e){for(let t=0;t<e.length;t++){let n=e[t];await n}}getDialect(){return jp.SQLITE}isServer(){return!1}}class vh extends class{getFunctionCalls(e,t,n,i,o){return e.appliedFunctions.forEach((e=>{t=this.getFunctionCall(e,t,n,i,o)})),t}}{getFunctionCall(e,t,n,i,o){let r;switch(e.ft){case me.ABS:return`ABS(${t})`;case me.AVG:return`AVG(${t})`;case me.COUNT:return`COUNT(${t})`;case me.MAX:return`MAX(${t})`;case me.MIN:return`MIN(${t})`;case me.SUM:return`SUM(${t})`;case me.UCASE:return`UPPER(${t})`;case me.LCASE:return`LOWER(${t})`;case me.MID:return`SUBSTR(${t}, ${i.getFunctionCallValue(e.p[0],o)}, ${i.getFunctionCallValue(e.p[1],o)})`;case me.LEN:return`LENGTH(${t})`;case me.ROUND:return`ROUND(${t}, ${i.getFunctionCallValue(e.p[0],o)})`;case me.NOW:return"DATE('now')";case me.FORMAT:let n=`FORMAT('${t}', `;for(let t=0;t<e.p.length;t++){let r=e.p[t];r=i.getFunctionCallValue(r,o),n=`${n}, ${r}`}return n+=")",n;case me.REPLACE:let a=i.getFunctionCallValue(e.p[0],o);return r=i.getFunctionCallValue(e.p[1],o),`REPLACE('${t}', ${a}, ${r})`;case me.TRIM:return`TRIM(${t})`;case me.DISTINCT:throw new Error("Invalid placement of a distinct function");case me.EXISTS:throw new Error("Invalid placement of an exists function");case me.DIVIDE:return r=i.getFunctionCallValue(e.p[0],o),`${t} / ${r}`;case me.MINUS:return r=i.getFunctionCallValue(e.p[0],o),`${t} - ${r}`;case me.MULTIPLY:return r=i.getFunctionCallValue(e.p[0],o),`${t} * ${r}`;case me.PLUS:return r=i.getFunctionCallValue(e.p[0],o),`${t} + ${r}`;case me.CONCATENATE:return e.p.reduce(((e,t)=>(this.toString(i.getFunctionCallValue(t,o)),e+t)),this.toString(t));case me.COALESCE:throw new Error("Not Implemented");default:throw new Error(`Unknown function type: ${e.ft}`)}}toString(e){switch(typeof e){case"string":return e;case"boolean":case"number":return e.toString();case"undefined":return"null";case"object":if(null===e)return"null";if(e instanceof Date)return e.toJSON();throw new Error("Unsupported value for conversion to string.");default:throw new Error("Unsupported value for conversion to string.")}}}var Sh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Ch=class extends Oy{async createApplication(e,t){}getColumnSuffix(e,t,n){let i="";(n.notNull||this.isPrimaryKeyColumn(t,n))&&(i=" NOT NULL");const o=i;switch(n.type){case Ie.ANY:return o;case Ie.BOOLEAN:return`INTEGER ${o}`;case Ie.DATE:return`REAL ${o}`;case Ie.JSON:return`TEXT ${o}`;case Ie.NUMBER:return o?`INTEGER ${o}`:"REAL";case Ie.STRING:return`TEXT ${o}`;default:throw new Error(`Unexpected data type for ${e.name}.${t.name}.${n.name}`)}}getCreateTableSuffix(e,t){return" WITHOUT ROWID"}async buildAllSequences(e){console.log("buildAllSequences");let t=[];for(const n of e){const e=this.airportDatabase.QM[Q(n)];for(const i of n.versions[n.versions.length-1].entities)t=t.concat(this.buildSequences(e.__dbApplication__,i))}return await this.sequenceDao.save(t),t}stageSequences(e,t){console.log("stageSequences");let n=[];for(const t of e){const e=this.airportDatabase.QM[Q(t)];for(const i of t.versions[t.versions.length-1].entities)n=n.concat(this.buildSequences(e.__dbApplication__,i))}return n}buildSequences(e,t){const n=[];for(const i of t.columns){if(!i.isGenerated)continue;let o=i.allocationSize;o||(o=100),n.push({applicationIndex:e.index,tableIndex:t.index,columnIndex:i.index,incrementBy:o,currentValue:0})}return n}getIndexSql(e,t,n,i){let o;return o=i?" UNIQUE":"",`CREATE${o} INDEX ${e}\n    ON ${t} (\n    ${n.join(", ")}\n    )`}getForeignKeySql(e,t,n,i,o){return null}};Sh([function(e,t){}],Ch.prototype,"airportDatabase",void 0),Ch=Sh([function(e){}],Ch),yh.setClass(Ch);class Dh extends class{constructor(e,t){this.driver=e,this.parentTransaction=t,this.isSync=!1,this.initiator={application:"",domain:"",methodName:"",objectName:""},this.__container__=e.__container__,this.id=br(),this.type=e.type,t&&(t.childTransaction=this)}async saveTransaction(e){}async query(e,t,n=[],i,o=!1){return this.driver.query(e,t,n,i,o)}async doesTableExist(e,t,n){return await this.driver.doesTableExist(e,t,n)}async dropTable(e,t,n){return await this.driver.dropTable(e,t,n)}getEntityTableName(e,t){return this.driver.getEntityTableName(e,t)}getTableName(e,t,n){return this.driver.getTableName(e,t,n)}async initialize(e,t){}search(e,t,n,i){return this.driver.search(e,t,n,i)}searchOne(e,t,n,i){return this.driver.searchOne(e,t,n,i)}async startTransaction(e,t){throw new Error("Nested transactions are not supported")}async setupTransaction(e,t){throw new Error("Nested transactions are not supported")}async tearDownTransaction(e,t){throw new Error("Nested transactions are not supported")}async commit(e,t){await this.driver.commit(this,t)}async rollback(e,t){await this.driver.rollback(this,t)}async deleteWhere(e,t){return await this.driver.deleteWhere(e,t)}async find(e,t,n,i){return await this.driver.find(e,t,n,i)}async findOne(e,t,n,i){return await this.driver.findOne(e,t,n,i)}async findNative(e,t,n){return await this.driver.findNative(e,t,n)}async insertValues(e,t,n){return await this.driver.insertValues(e,t,n)}async updateWhere(e,t,n){return await this.driver.updateWhere(e,t,n)}isValueValid(e,t,n){return this.driver.isValueValid(e,t,n)}}{isServer(e){return!1}}var Mh=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Vh=class extends Ah{constructor(){super(),this.type=Ae.SQLJS}async initialize(){const e=await initSqlJs({locateFile:e=>`./${e}`});this._db=new e.Database}async setupTransaction(e,t){const n=new Dh(this,t);return await this.internalSetupTransaction(n,e),n}async internalStartTransaction(e,t){this._db.exec(`SAVEPOINT ${e.id}`)}async internalCommit(e,t){this._db.exec(`RELEASE SAVEPOINT ${e.id}`)}async internalRollback(e,t){this._db.exec(`ROLLBACK TO SAVEPOINT ${e.id}`)}async query(e,t,n=[],i,o=!1){return new Promise(((e,i)=>{let o;try{["TQ_BOOLEAN_FIELD_CHANGE","TQ_DATE_FIELD_CHANGE","TQ_NUMBER_FIELD_CHANGE","TQ_STRING_FIELD_CHANGE","TQ_ENTITY_CHANGE","TQ_ENTITY_WHERE_CHANGE","TQ_TRANSACTION"].some((e=>t.indexOf(e)>-1))||(console.log(t),console.log(n)),o=this._db.prepare(t),o.bind(n);let i=[];for(;o.step();)i.push(o.get());console.log(i),e(i)}catch(e){i(e)}finally{o&&o.free()}}))}handleError(e){throw e}getRows(e){return e}getReturnValue(e,t){switch(e){case _e.MUTATE:return t.rowsAffected;case _e.SELECT:return t.rows;default:return null}}getDialect(){return jp.SQLITE}};Vh=Mh([function(e){}],Vh);var Ph=function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};let Lh=class extends class{constructor(){this.functionAdaptor=new vh}getParameterReference(e,t){return"?"}dateToDbQuery(e){return""+e.getTime()}getResultArray(e){return e.res.rows}getResultCellValue(e,t,n,i,o){let r=this.getResultCellRawValue(e,t,n,i,o);switch(i){case Ie.BOOLEAN:if(null!==r)return!!r;break;case Ie.DATE:if(null!==r)return new Date(r);break;case Ie.JSON:if(null!==r)return JSON.parse(r);break;case Ie.ANY:case Ie.NUMBER:case Ie.STRING:return r;default:throw new Error(`Unexpected data type for column ${t}`)}}getFunctionAdaptor(){return this.functionAdaptor}getOffsetFragment(e){return`\nOFFSET\n\t${e}`}getLimitFragment(e){return`\nLIMIT\n\t${e}`}getParameterValue(e){return this.getValue(e.value)}getValue(e,t=!0){switch(typeof e){case"boolean":return e?"1":"0";case"number":case"string":return e;case"object":if(e instanceof Date)return e.getTime();if(e instanceof Array)return e.map((e=>this.getValue(e,!1)));throw new Error("Unexpected object as a parameter.");default:throw new Error(`Unexpected type of parameter '${typeof e}.'`)}}}{getResultCellRawValue(e,t,n,i,o){return e[n]}};Lh=Ph([function(e){}],Lh),pr.setClass(Vh),dd.setClass(Lh),console.log("injecting SequenceGenerator"),console.log("Injecting TransactionalReceiver"),console.log("Injecting TransactionalConnector"),console.log("Injecting AirportDatabase"),console.log("Injecting TransactionalServer"),console.log("inject EntityStateManager"),H.getSync(dr).getWebReceiver().localDomain="localhost:31717";const Uh=new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),w(this,e,x,null,r,{})}}({target:document.body,props:{}});(async function(){await async function(e){await H.get(Ro);const t=await H.get(Wu);await t.initWithDb(e,{})}("AIRportA-demo-demo-demo-functionalty"),await H.get(fr)})().then();export{Uh as default};
//# sourceMappingURL=main.js.map
