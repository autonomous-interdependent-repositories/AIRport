var app=function(e){"use strict";var t;!function(e){e.DB="DB",e.UI="UI"}(t||(t={}));class n{constructor(e,t){this.name=e,this.type=t}}class o{constructor(e){this.name=e,this.applicationMap={}}app(e){if(this.applicationMap[e])throw new Error(`\n\t\t\tApplication already defined.\n\t\t\tDomain:      ${this.name}\n\t\t\tApplication: ${e}\n\t\t\t`);const t=new c(e,this);return this.applicationMap[e]=t,t}getApp(e){return this.applicationMap[e]}}const r={};function i(e){if(r[e])return r[e];const t=new o(e);return r[e]=t,t}const a=i("turbase.app");class s{constructor(e,t){this.application=e,this.name=t}getPath(){return this.application.domain.name+":"+this.application.name+":"+this.name}}class c{constructor(e,t){this.name=e,this.domain=t,this.tokenMap=new Map,this.autopilot=!1}token(e){if(this.tokenMap.get(e))throw new Error(`Token with name '${e}' has already been created`);const t=new s(this,e);return this.tokenMap.set(e,t),t}}function u(e){return a.app(e)}const d=u("di").token("AUTOPILOT_API_LOADER"),l=new Map,f=new Map;class h{set(e,t){l.set(e.name,t),f.set(e.name,null)}}class p extends h{constructor(e){super(),this.context=e}doEventuallyGet(e,t,n){let{firstDiNotSetClass:o,firstMissingClassToken:r,objects:i}=this.doGetCore(e);r||o?setTimeout((()=>{this.doEventuallyGet(e,t,n)}),100):i.length>1?t(i):t(i[0])}doGet(e,t,n){const{firstDiNotSetClass:o,firstMissingClassToken:r,objects:i}=this.doGetCore(e);if(o)return console.log(`Dependency Injection is not ready for token ${r.getPath()}\n\t\t\t, class: ${o.name}. Delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100);if(i.filter((e=>e&&!e.__initialized__)).length){const o=i.map(((e,t)=>e.__initialized__?-1:t)).filter((e=>-1!==e)),r=[];for(const t of o)r.push(e[t].getPath());return console.log(`Dependency Injection is not ready for tokens:\n\t\t\t\t ${r.join("\n")}\n\t\t\t, these classes are not yet initialized, delaying injection by 100ms`),void setTimeout((()=>{this.doGet(e,t,n)}),100)}if(r){const e="Dependency Injection could not find class for token: "+r.getPath();console.log(e),n(e)}else i.length>1?t(i):t(i[0])}doGetCore(e){let t,n;const o=e.map((e=>{if(t||n)return;let o=f.get(e.name);if(!o){if(!this.context.inAIRportApp&&e.application.autopilot)o=this.getSync(d).loadApiAutopilot(e);else{const r=l.get(e.name);if(!r)return void(t=e);if(r.diSet&&!r.diSet())return t=e,void(n=r);o=new r}if(o.__container__=this,f.set(e.name,o),!e.application.autopilot&&o.init){const t=o.init();t instanceof Promise?t.then((t=>{o.__initialized__=!0,console.log(`${e.getPath()} initialized.`)})):(o.__initialized__=!0,console.log(`${e.getPath()} initialized.`))}else o.__initialized__=!0}return o}));return{firstDiNotSetClass:n,firstMissingClassToken:t,objects:o}}async getByNames(e,t,n){if(!i(e))throw new Error(`Could nof find\n\tDomain:\n\t\t${e}\n\t\t`);const o=i(e).getApp(t);if(!o)throw new Error(`Could not find\n\tDomain:\n\t\t${e}\n\tApplication:\n\t\t${t}\n\t\t`);const r=o.tokenMap.get(n);if(!r)throw new Error(`Could not find token: ${n}\n\tin Domain:\n\t\t${e}\n \tApplication:\n\t\t\t${t}\n\t\t`);return await this.get(r)}get(...e){return new Promise(((t,n)=>{this.doGet(e,t,n)}))}eventuallyGet(...e){return new Promise(((t,n)=>{this.doEventuallyGet(e,t,n)}))}getSync(...e){const{firstDiNotSetClass:t,firstMissingClassToken:n,objects:o}=this.doGetCore(e);if(n)throw new Error("Dependency Injection could not find class for token: "+n);if(t)throw new Error("Dependency Injection is not ready for class: "+t.name);return o.length>1?o:o[0]}}const m=new class extends h{constructor(){super(...arguments),this.childContainers=new Set,this.uiContainerMap=new Map}db(){return this.dbContainer||(this.dbContainer=new p(new n(null,t.DB))),this.dbContainer}remove(e){e&&(this.childContainers.delete(e),e.context&&e.context.name&&this.uiContainerMap.get(e.context.name).delete(e))}ui(e){const o=new n(e,t.UI),r=this.addContainer(o);let i=this.uiContainerMap.get(e);return i||(i=new Set,this.uiContainerMap.set(e,i)),i.add(r),r}addContainer(e){const t=new p(e);return this.childContainers.add(t),t}};"undefined"!=typeof window&&(window.DI=m,window.lib=u,window.domain=i);const _=new class{async get(...e){return await m.db().get(...e)}async eventuallyGet(...e){return await m.db().eventuallyGet(...e)}getSync(...e){return m.db().getSync(...e)}},v=u("vhf-radio").token("CROSS_TAB_COMMUNCATOR");function g(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})})),t}function b(e){var t={exports:{}};return e(t,t.exports),t.exports}var w=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=t.PROMISE_RESOLVED_VOID=t.PROMISE_RESOLVED_TRUE=t.PROMISE_RESOLVED_FALSE=void 0,t.isPromise=function(e){return!(!e||"function"!=typeof e.then)},t.microSeconds=function(){var e=(new Date).getTime();return e===i?(a++,1e3*e+a):(i=e,a=0,1e3*e)},t.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},t.randomToken=function(){return Math.random().toString(36).substring(2)},t.sleep=function(e,t){e||(e=0);return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))};var n=Promise.resolve(!1);t.PROMISE_RESOLVED_FALSE=n;var o=Promise.resolve(!0);t.PROMISE_RESOLVED_TRUE=o;var r=Promise.resolve();t.PROMISE_RESOLVED_VOID=r;var i=0,a=0;var s="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);t.isNode=s})),y=b((function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}));b((function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}));var E=w,S=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=u,t.canBeUsed=c,t.close=i,t.create=r,t.microSeconds=t.default=void 0,t.onMessage=s,t.postMessage=a,t.type=void 0;var n=E.microSeconds;t.microSeconds=n;var o="native";function r(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function i(e){e.bc.close(),e.subFns=[]}function a(e,t){try{return e.bc.postMessage(t,!1),E.PROMISE_RESOLVED_VOID}catch(e){return Promise.reject(e)}}function s(e,t){e.messagesCallback=t}function c(){if(E.isNode&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function u(){return 150}t.type=o;var d={create:r,close:i,onMessage:s,postMessage:a,canBeUsed:c,type:o,averageResponseTime:u,microSeconds:n};t.default=d})),C=function(){function e(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(e){return this.set.has(e)},e.prototype.add=function(e){var t=this;this.timeMap.set(e,M()),this.set.add(e),setTimeout((function(){O(t)}),0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function O(e){for(var t=M()-e.ttl,n=e.set[Symbol.iterator]();;){var o=n.next().value;if(!o)return;if(!(e.timeMap.get(o)<t))return;e.timeMap.delete(o),e.set.delete(o)}}function M(){return(new Date).getTime()}var L=Object.freeze({__proto__:null,ObliviousSet:C,removeTooOldValues:O,now:M}),P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0);t.idb||(t.idb={});t.idb.ttl||(t.idb.ttl=45e3);t.idb.fallbackInterval||(t.idb.fallbackInterval=150);e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose);t.localstorage||(t.localstorage={});t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4);e.methods&&(t.methods=e.methods);t.node||(t.node={});t.node.ttl||(t.node.ttl=12e4);t.node.maxParallelWrites||(t.node.maxParallelWrites=2048);void 0===t.node.useFastPath&&(t.node.useFastPath=!0);return t};var k=Object.defineProperty({fillOptionsWithDefaults:P},"__esModule",{value:!0}),D=g(L),I=k,R=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=g,t.canBeUsed=v,t.cleanOldMessages=d,t.close=p,t.create=l,t.createDatabase=i,t.default=void 0,t.getAllMessages=function(e){var t=e.transaction(o).objectStore(o),n=[];return new Promise((function(e){t.openCursor().onsuccess=function(t){var o=t.target.result;o?(n.push(o.value),o.continue()):e(n)}}))},t.getIdb=r,t.getMessagesHigherThan=s,t.getOldMessages=u,t.microSeconds=void 0,t.onMessage=_,t.postMessage=m,t.removeMessageById=c,t.type=void 0,t.writeMessage=a;var n=E.microSeconds;t.microSeconds=n;var o="messages";function r(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function i(e){var t="pubkey.broadcast-channel-0-"+e,n=r().open(t,1);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(o,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}function a(e,t,n){var r={uuid:t,time:(new Date).getTime(),data:n},i=e.transaction([o],"readwrite");return new Promise((function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(o).add(r)}))}function s(e,t){var n=e.transaction(o).objectStore(o),r=[];return new Promise((function(e){(function(){try{var e=IDBKeyRange.bound(t+1,1/0);return n.openCursor(e)}catch(e){return n.openCursor()}}()).onsuccess=function(n){var o=n.target.result;o?o.value.id<t+1?o.continue(t+1):(r.push(o.value),o.continue()):e(r)}}))}function c(e,t){var n=e.transaction([o],"readwrite").objectStore(o).delete(t);return new Promise((function(e){n.onsuccess=function(){return e()}}))}function u(e,t){var n=(new Date).getTime()-t,r=e.transaction(o).objectStore(o),i=[];return new Promise((function(e){r.openCursor().onsuccess=function(t){var o=t.target.result;if(o){var r=o.value;if(!(r.time<n))return void e(i);i.push(r),o.continue()}else e(i)}}))}function d(e,t){return u(e,t).then((function(t){return Promise.all(t.map((function(t){return c(e,t.id)})))}))}function l(e,t){return t=(0,I.fillOptionsWithDefaults)(t),i(e).then((function(n){var o={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:(0,E.randomToken)(),eMIs:new D.ObliviousSet(2*t.idb.ttl),writeBlockPromise:E.PROMISE_RESOLVED_VOID,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){o.closed=!0,t.idb.onclose&&t.idb.onclose()},f(o),o}))}function f(e){e.closed||h(e).then((function(){return(0,E.sleep)(e.options.idb.fallbackInterval)})).then((function(){return f(e)}))}function h(e){return e.closed?E.PROMISE_RESOLVED_VOID:e.messagesCallback?s(e.db,e.lastCursorId).then((function(t){return t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time})).forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),E.PROMISE_RESOLVED_VOID})):E.PROMISE_RESOLVED_VOID}function p(e){e.closed=!0,e.db.close()}function m(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return a(e.db,e.uuid,t)})).then((function(){0===(0,E.randomInt)(0,10)&&d(e.db,e.options.idb.ttl)})),e.writeBlockPromise}function _(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,h(e)}function v(){return!E.isNode&&!!r()}function g(e){return 2*e.idb.fallbackInterval}t.type="idb";var b={create:l,close:p,onMessage:_,postMessage:m,canBeUsed:v,type:"idb",averageResponseTime:g,microSeconds:n};t.default=b})),T=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.addStorageEventListener=s,t.averageResponseTime=h,t.canBeUsed=f,t.close=d,t.create=u,t.default=void 0,t.getLocalStorage=r,t.microSeconds=void 0,t.onMessage=l,t.postMessage=a,t.removeStorageEventListener=c,t.storageKey=i,t.type=void 0;var n=E.microSeconds;t.microSeconds=n;var o="localstorage";function r(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function i(e){return"pubkey.broadcastChannel-"+e}function a(e,t){return new Promise((function(n){(0,E.sleep)().then((function(){var o=i(e.channelName),a={token:(0,E.randomToken)(),time:(new Date).getTime(),data:t,uuid:e.uuid},s=JSON.stringify(a);r().setItem(o,s);var c=document.createEvent("Event");c.initEvent("storage",!0,!0),c.key=o,c.newValue=s,window.dispatchEvent(c),n()}))}))}function s(e,t){var n=i(e),o=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",o),o}function c(e){window.removeEventListener("storage",e)}function u(e,t){if(t=(0,I.fillOptionsWithDefaults)(t),!f())throw new Error("BroadcastChannel: localstorage cannot be used");var n=(0,E.randomToken)(),o=new D.ObliviousSet(t.localstorage.removeTimeout),r={channelName:e,uuid:n,eMIs:o};return r.listener=s(e,(function(e){r.messagesCallback&&e.uuid!==n&&e.token&&!o.has(e.token)&&(e.data.time&&e.data.time<r.messagesCallbackTime||(o.add(e.token),r.messagesCallback(e.data)))})),r}function d(e){c(e.listener)}function l(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function f(){if(E.isNode)return!1;var e=r();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function h(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}t.type=o;var p={create:u,close:d,onMessage:l,postMessage:a,canBeUsed:f,type:o,averageResponseTime:h,microSeconds:n};t.default=p})),B=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.averageResponseTime=d,t.canBeUsed=u,t.close=a,t.create=i,t.microSeconds=t.default=void 0,t.onMessage=c,t.postMessage=s,t.type=void 0;var n=E.microSeconds;t.microSeconds=n;var o="simulate";t.type=o;var r=new Set;function i(e){var t={name:e,messagesCallback:null};return r.add(t),t}function a(e){r.delete(e)}function s(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(r).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))}function c(e,t){e.messagesCallback=t}function u(){return!0}function d(){return 5}var l={create:i,close:a,onMessage:c,postMessage:s,canBeUsed:u,type:o,averageResponseTime:d,microSeconds:n};t.default=l})),j=function(e){var t=[].concat(e.methods,U).filter(Boolean);if(e.type){if("simulate"===e.type)return V.default;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||E.isNode||(t=t.filter((function(e){return"idb"!==e.type})));var o=t.find((function(e){return e.canBeUsed()}));if(o)return o;throw new Error("No useable method found in "+JSON.stringify(U.map((function(e){return e.type}))))},N=y(S),x=y(R),A=y(T),V=y(B),U=[N.default,x.default,A.default];var G=Object.defineProperty({chooseMethod:j},"__esModule",{value:!0}),z=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OPEN_BROADCAST_CHANNELS=t.BroadcastChannel=void 0,t.clearNodeFolder=function(e){e=(0,I.fillOptionsWithDefaults)(e);var t=(0,G.chooseMethod)(e);return"node"===t.type?t.clearNodeFolder().then((function(){return!0})):E.PROMISE_RESOLVED_FALSE},t.enforceOptions=function(e){o=e};var n=new Set;t.OPEN_BROADCAST_CHANNELS=n;var o,r=0,i=function(e,t){var i,a;this.id=r++,n.add(this),this.name=e,o&&(t=o),this.options=(0,I.fillOptionsWithDefaults)(t),this.method=(0,G.chooseMethod)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,a=(i=this).method.create(i.name,i.options),(0,E.isPromise)(a)?(i._prepP=a,a.then((function(e){i._state=e}))):i._state=a};function a(e,t,n){var o={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:E.PROMISE_RESOLVED_VOID).then((function(){var t=e.method.postMessage(e._state,o);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function s(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function c(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&s(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=1e5,o=e.time-n;t.time>=o&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function u(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!s(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}t.BroadcastChannel=i,i._pubkey=!0,i.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return a(this,"message",e)},postInternal:function(e){return a(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};u(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,c(this,"message",t)):this._onML=null},addEventListener:function(e,t){c(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){u(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){n.delete(this),this.closed=!0;var t=this._prepP?this._prepP:E.PROMISE_RESOLVED_VOID;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}}}));var $={add:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}}},F=new Set,Q=!1;function W(){var e=[];return F.forEach((function(t){e.push(t()),F.delete(t)})),Promise.all(e)}var H=g(Object.freeze({__proto__:null,add:function(e){if(Q||(Q=!0,$.add(W)),"function"!=typeof e)throw new Error("Listener is no function");return F.add(e),{remove:function(){return F.delete(e)},run:function(){return F.delete(e),e()}}},runAll:W,removeAll:function(){F.clear()},getSize:function(){return F.size}})),J=Y,K=function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){e||(e={});(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3);e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options));return e}(t,e);var n=new q(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n},q=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=(0,E.randomToken)(),this._aplQ=E.PROMISE_RESOLVED_VOID,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var o=function(e){"leader"===e.context&&("death"===e.action&&(n.hasLeader=!1),"tell"===e.action&&(n.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",o),this._lstns.push(o)};function X(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function Y(e){e.isLeader=!0,e.hasLeader=!0;var t=(0,H.add)((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&X(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),X(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),X(e,"tell")}q.prototype={applyOnce:function(e){var t=this;if(this.isLeader)return(0,E.sleep)(0,!0);if(this.isDead)return(0,E.sleep)(0,!1);if(this._aplQC>1)return this._aplQ;return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return E.PROMISE_RESOLVED_TRUE;var n,o=!1,r=new Promise((function(e){n=function(){o=!0,e()}})),i=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t.hasLeader=!0))};t.broadcastChannel.addEventListener("internal",i);var a=e?4*t._options.responseTime:t._options.responseTime;return X(t,"apply").then((function(){return Promise.race([(0,E.sleep)(a),r.then((function(){return Promise.reject(new Error)}))])})).then((function(){return X(t,"apply")})).then((function(){return Promise.race([(0,E.sleep)(a),r.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",i),!o&&Y(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){if(e.isLeader)return E.PROMISE_RESOLVED_VOID;return new Promise((function(t){var n=!1;function o(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",r),t(!0))}e.applyOnce().then((function(){e.isLeader&&o()})),function t(){return(0,E.sleep)(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void o():e.applyOnce(!0).then((function(){e.isLeader?o():t()}))}))}();var r=function(t){"leader"===t.context&&"death"===t.action&&(e.hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&o()})))};e.broadcastChannel.addEventListener("internal",r),e._lstns.push(r)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,X(this,"death")}};var Z=z,ee=Object.defineProperty({beLeader:J,createLeaderElection:K},"__esModule",{value:!0}),te=b((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BroadcastChannel",{enumerable:!0,get:function(){return Z.BroadcastChannel}}),Object.defineProperty(t,"OPEN_BROADCAST_CHANNELS",{enumerable:!0,get:function(){return Z.OPEN_BROADCAST_CHANNELS}}),Object.defineProperty(t,"beLeader",{enumerable:!0,get:function(){return ee.beLeader}}),Object.defineProperty(t,"clearNodeFolder",{enumerable:!0,get:function(){return Z.clearNodeFolder}}),Object.defineProperty(t,"createLeaderElection",{enumerable:!0,get:function(){return ee.createLeaderElection}}),Object.defineProperty(t,"enforceOptions",{enumerable:!0,get:function(){return Z.enforceOptions}})})),ne={BroadcastChannel:te.BroadcastChannel,createLeaderElection:te.createLeaderElection,clearNodeFolder:te.clearNodeFolder,enforceOptions:te.enforceOptions,beLeader:te.beLeader};class oe{constructor(){this.demoListenerStarted=!1,this.isNativeBroadcastChannel="function"==typeof BroadcastChannel,window.addEventListener("message",(e=>{const t=e.data;if(t.__received__)return;let n={...t};t.__received__=!0;const o=e.origin.split("//")[1];t.domain===o&&("IsConnectionReady"===t.category&&(this.clientHost=t.domain),this.communicationChannel.postMessage(n))}));const e=()=>{this.communicationChannel=new ne.BroadcastChannel("clientCommunication",{idb:{onclose:()=>{this.communicationChannel.close(),e()}}}),this.communicationChannel.onmessage=e=>{if(!this.clientHost||e.domain!==this.clientHost)return;if(e.__received__)return;const t={...e};e.__received__=!0,window.parent.postMessage(t,this.clientHost)}};e()}}return m.set(v,oe),_.getSync(v),e.CROSS_TAB_COMMUNCATOR=v,e.CrossTabCommunicator=oe,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=bundle.js.map
