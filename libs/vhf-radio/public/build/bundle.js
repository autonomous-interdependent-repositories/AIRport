var app=function(t){"use strict";var e;!function(t){t.DB="DB",t.UI="UI"}(e||(e={}));class n{constructor(t,e){this.name=t,this.type=e}}class i{constructor(t){this.name=t,this.applicationMap={}}app(t){if(this.applicationMap[t])throw new Error(`\n\t\t\tApplication already defined.\n\t\t\tDomain:      ${this.name}\n\t\t\tApplication: ${t}\n\t\t\t`);const e=new c(t,this);return this.applicationMap[t]=e,e}getApp(t){return this.applicationMap[t]}}const o={};function s(t){if(o[t])return o[t];const e=new i(t);return o[t]=e,e}const a=s("turbase.app");class r{constructor(t,e){this.application=t,this.name=e}getPath(){return this.application.domain.name+":"+this.application.name+":"+this.name}}class c{constructor(t,e){this.name=t,this.domain=e,this.tokenMap=new Map,this.autopilot=!1}token(t){if(this.tokenMap.get(t))throw new Error(`Token with name '${t}' has already been created`);const e=new r(this,t);return this.tokenMap.set(t,e),e}}function l(t){return a.app(t)}const d=l("di").token("AUTOPILOT_API_LOADER"),h=new Map,p=new Map;class u{set(t,e){h.set(t.name,e),p.set(t.name,null)}}class f extends u{constructor(t){super(),this.context=t}doEventuallyGet(t,e,n){let{firstDiNotSetClass:i,firstMissingClassToken:o,objects:s}=this.doGetCore(t);o||i?setTimeout((()=>{this.doEventuallyGet(t,e,n)}),100):s.length>1?e(s):e(s[0])}doGet(t,e,n){const{firstDiNotSetClass:i,firstMissingClassToken:o,objects:s}=this.doGetCore(t);if(i)return console.log(`Dependency Injection is not ready for token ${o.getPath()}\n\t\t\t, class: ${i.name}. Delaying injection by 100ms`),void setTimeout((()=>{this.doGet(t,e,n)}),100);if(s.filter((t=>t&&!t.__initialized__)).length){const i=s.map(((t,e)=>t.__initialized__?-1:e)).filter((t=>-1!==t)),o=[];for(const e of i)o.push(t[e].getPath());return console.log(`Dependency Injection is not ready for tokens:\n\t\t\t\t ${o.join("\n")}\n\t\t\t, these classes are not yet initialized, delaying injection by 100ms`),void setTimeout((()=>{this.doGet(t,e,n)}),100)}if(o){const t="Dependency Injection could not find class for token: "+o.getPath();console.log(t),n(t)}else s.length>1?e(s):e(s[0])}doGetCore(t){let e,n;const i=t.map((t=>{if(e||n)return;let i=p.get(t.name);if(!i){if(!this.context.inAIRportApp&&t.application.autopilot)i=this.getSync(d).loadApiAutopilot(t);else{const o=h.get(t.name);if(!o)return void(e=t);if(o.diSet&&!o.diSet())return e=t,void(n=o);i=new o}if(i.__container__=this,p.set(t.name,i),!t.application.autopilot&&i.init){const e=i.init();e instanceof Promise?e.then((e=>{i.__initialized__=!0,console.log(`${t.getPath()} initialized.`)})):(i.__initialized__=!0,console.log(`${t.getPath()} initialized.`))}else i.__initialized__=!0}return i}));return{firstDiNotSetClass:n,firstMissingClassToken:e,objects:i}}async getByNames(t,e,n){if(!s(t))throw new Error(`Could nof find\n\tDomain:\n\t\t${t}\n\t\t`);const i=s(t).getApp(e);if(!i)throw new Error(`Could not find\n\tDomain:\n\t\t${t}\n\tApplication:\n\t\t${e}\n\t\t`);const o=i.tokenMap.get(n);if(!o)throw new Error(`Could not find token: ${n}\n\tin Domain:\n\t\t${t}\n \tApplication:\n\t\t\t${e}\n\t\t`);return await this.get(o)}get(...t){return new Promise(((e,n)=>{this.doGet(t,e,n)}))}eventuallyGet(...t){return new Promise(((e,n)=>{this.doEventuallyGet(t,e,n)}))}getSync(...t){const{firstDiNotSetClass:e,firstMissingClassToken:n,objects:i}=this.doGetCore(t);if(n)throw new Error("Dependency Injection could not find class for token: "+n);if(e)throw new Error("Dependency Injection is not ready for class: "+e.name);return i.length>1?i:i[0]}}const w=new class extends u{constructor(){super(...arguments),this.childContainers=new Set,this.uiContainerMap=new Map}db(){return this.dbContainer||(this.dbContainer=new f(new n(null,e.DB))),this.dbContainer}remove(t){t&&(this.childContainers.delete(t),t.context&&t.context.name&&this.uiContainerMap.get(t.context.name).delete(t))}ui(t){const i=new n(t,e.UI),o=this.addContainer(i);let s=this.uiContainerMap.get(t);return s||(s=new Set,this.uiContainerMap.set(t,s)),s.add(o),o}addContainer(t){const e=new f(t);return this.childContainers.add(e),e}};"undefined"!=typeof window&&(window.DI=w,window.lib=l,window.domain=s);const m=new class{async get(...t){return await w.db().get(...t)}async eventuallyGet(...t){return await w.db().eventuallyGet(...t)}getSync(...t){return w.db().getSync(...t)}},g=l("vhf-radio").token("CROSS_TAB_COMMUNCATOR");class _{constructor(){this.demoListenerStarted=!1,this.isNativeBroadcastChannel="function"==typeof BroadcastChannel,window.addEventListener("message",(t=>{const e=t.data;if(e.__received__)return;let n={...e};e.__received__=!0,"IsConnectionReady"===e.category&&(this.clientHost=e.host),this.communicationChannel.postMessage(n)}))}}return w.set(g,_),m.getSync(g),t.CROSS_TAB_COMMUNCATOR=g,t.CrossTabCommunicator=_,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=bundle.js.map
